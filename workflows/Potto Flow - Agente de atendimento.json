{
  "active": false,
  "activeVersion": null,
  "activeVersionId": null,
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Filtro de mensagens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filtro de mensagens": {
      "main": [
        [
          {
            "node": "simplificação de dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "simplificação de dados": {
      "main": [
        [
          {
            "node": "Supabase buscar usuário",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase buscar usuário": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Supabase criar usuário",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase criar usuário": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Google Docs": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "HTTP Request Z API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-12-17T12:27:33.681Z",
  "id": "W7PJLLnrQJRg0lsU",
  "isArchived": false,
  "meta": null,
  "name": "Potto Flow - Agente de atendimento",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "9f1f54be-eff8-4301-9ca9-91d8de905d2a",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        128,
        208
      ],
      "id": "81cfdf62-3db3-4c5a-a23d-0df96728193f",
      "name": "Webhook",
      "webhookId": "9f1f54be-eff8-4301-9ca9-91d8de905d2a"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "3eb5bf76-173d-4344-a48e-33509bfbcf2b",
              "leftValue": "={{ $json.body.waitingMessage }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            },
            {
              "id": "55f93291-f1b1-48ba-b1b7-e95bcb223115",
              "leftValue": "={{ $json.body.isEdit }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            },
            {
              "id": "a97d6f2a-cbb9-4688-8382-269f232881e7",
              "leftValue": "={{ $json.body.isGroup }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            },
            {
              "id": "57662324-c41f-42cf-acb8-c36700667887",
              "leftValue": "={{ $json.body.isNewsletter }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            },
            {
              "id": "8b51dbca-8110-4aed-9925-27ffdcd3bfa1",
              "leftValue": "={{ $json.body.fromMe }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        352,
        208
      ],
      "id": "33f4924d-031c-4bf5-b944-a46bac888e2f",
      "name": "Filtro de mensagens"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e70aaff7-15f2-4208-8dd8-138d55c899c1",
              "name": "whatsapp",
              "value": "={{ $('Webhook').item.json.body.phone }}",
              "type": "string"
            },
            {
              "id": "976e115d-5bc0-446c-9d3e-968a3d03767b",
              "name": "nome",
              "value": "={{ $('Webhook').item.json.body.chatName }}",
              "type": "string"
            },
            {
              "id": "f04e8cdc-6048-4d24-821f-5d2beb075186",
              "name": "message",
              "value": "={{ $('Webhook').item.json.body.text.message }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        560,
        208
      ],
      "id": "0f7a3f0a-a537-4a4f-b9f7-e5b07ed8cec2",
      "name": "simplificação de dados"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "clientes",
        "filters": {
          "conditions": [
            {
              "keyName": "whatsapp",
              "keyValue": "={{ $json.whatsapp }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        784,
        208
      ],
      "id": "03a10cd6-07b3-4d26-85b8-cfe958b3c158",
      "name": "Supabase buscar usuário",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "2c9859ec-014e-46c0-89d7-961307f7b595",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "number",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1008,
        208
      ],
      "id": "6697d06a-a017-4dca-ac62-65c73195cb06",
      "name": "If"
    },
    {
      "parameters": {
        "tableId": "clientes",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "nome",
              "fieldValue": "={{ $('simplificação de dados').item.json.nome }}"
            },
            {
              "fieldId": "whatsapp",
              "fieldValue": "={{ $('simplificação de dados').item.json.whatsapp }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1184,
        368
      ],
      "id": "2550770a-f2cc-416d-b40c-3ba4a8667212",
      "name": "Supabase criar usuário"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.1,
      "position": [
        1360,
        208
      ],
      "id": "f8c38ef4-0044-42d4-9d46-5021b3c9db82",
      "name": "Merge"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Webhook').item.json.body.text.message }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    },
                    "id": "ca7ccddf-60fd-425d-89bc-5f3b3b9394f7"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "texto"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "587e0156-bfed-4464-9745-96728b1ce152",
                    "leftValue": "={{ $('Webhook').item.json.body.audio.audioUrl }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "áudio "
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "17afdd94-ded8-46da-a63a-804b540c1eca",
                    "leftValue": "={{ $('Webhook').item.json.body.image.imageUrl }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Imagem"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1680,
        240
      ],
      "id": "d35ee70a-866c-459a-ae28-23dd650d424a",
      "name": "Switch"
    },
    {
      "parameters": {
        "url": "={{ $('Webhook').item.json.body.audio.audioUrl }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2112,
        272
      ],
      "id": "8e443d4d-ba2f-45e9-b724-95f2ec4b679f",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        2352,
        240
      ],
      "id": "973875f6-f18e-46b8-9a61-8a30ecb060e2",
      "name": "OpenAI"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "afe3fd17-523a-454c-8e7c-57048fbad207",
              "name": "mensagem",
              "value": "={{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2528,
        272
      ],
      "id": "95646db5-11d5-4f81-ba79-136929185dbd",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3DE8B7E0C5AB203F004E4E20A388CB1E/token/D6C681645D55E6E8104FB950/send-text",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "={{ $('simplificação de dados').item.json.whatsapp }}"
            },
            {
              "name": "message",
              "value": "Olá, desculpe não consigo interpretar ou responder a conteúdos enviados em formato de imagem. Poderia descrevê-lo em texto ou áudio para que eu possa ajudar melhor?"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2112,
        448
      ],
      "id": "00e98084-d66e-41f3-85c6-a1755c5093e1",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "41c5a8f4-c726-4914-83e9-e4e4f536c717",
              "name": "mensagem",
              "value": "={{ $('Webhook').item.json.body.text.message }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2112,
        80
      ],
      "id": "87cfaef7-75d6-4a3d-8e68-1ab77511e840",
      "name": "Edit Fields1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.1,
      "position": [
        2832,
        224
      ],
      "id": "b9b150f4-1b2f-408f-b0cb-04b32bf61b51",
      "name": "Merge1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.mensagem }}",
        "options": {
          "systemMessage": "=<prompt>\n\n<instruções>\nVocê é a Michelle, uma secretaria da clinica Viver Bem. Sua missão é responder clientes por WhatsApp.\n    - Seja educada, amigável e objetiva.\n    - Varie a linguagem para evitar parecer robótica, mantendo clareza e eficiência. \n    - Responda de forma clara e objetiva\n   - Não invente informações.\nQuando pedirem informações sobre a consulta primeiro entender o que o paciente precisa.\nNão enviar todas as informações de vez.\nSomente enviar informações que ele pedir.\nNão inventar tratamentos médicos.\n\n  </instruções>\n\n\n  <uso_de_tools>\n\n 1. Se o usuário quiser informações usar chame a tool \"Google Docs\"\n    </uso_de_tools>\n\n\n</prompt>"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        3360,
        192
      ],
      "id": "7c5aac7d-d512-43e5-97ae-e561fb3923ff",
      "name": "AI Agent",
      "notes": "Desenvolvido por Potto Flow"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        3280,
        464
      ],
      "id": "e78fc3dd-fcb3-4f4f-a253-c35bca59ef16",
      "name": "OpenAI Chat Model"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('simplificação de dados').item.json.whatsapp }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        3440,
        480
      ],
      "id": "64054111-4e99-4973-9be7-c3e324285a2b",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "operation": "get",
        "documentURL": "https://docs.google.com/document/d/1cE5Kv4HYIjdAv3bi9p073s8w56-WcuhBEJSBOp89jNI/edit?tab=t.0"
      },
      "type": "n8n-nodes-base.googleDocsTool",
      "typeVersion": 2,
      "position": [
        3632,
        464
      ],
      "id": "091bbfaf-7e98-47b9-b8c2-e0da68d1c281",
      "name": "Google Docs"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.z-api.io/instances/3DE8B7E0C5AB203F004E4E20A388CB1E/token/D6C681645D55E6E8104FB950/send-text",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "phone",
              "value": "={{ $('simplificação de dados').item.json.whatsapp }}"
            },
            {
              "name": "message",
              "value": "={{ $json.output }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3808,
        192
      ],
      "id": "f8aaab2e-6316-4409-8ae5-5a64233c98c2",
      "name": "HTTP Request Z API"
    },
    {
      "parameters": {
        "content": "## Simplificação de dados com busca e cadastro do usuário\n",
        "height": 640,
        "width": 1580,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        0
      ],
      "typeVersion": 1,
      "id": "3a5611d4-9501-45d0-822c-177efd11f3cb",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## Tipos de mensagens texto, áudio e imagem\n",
        "height": 640,
        "width": 1400,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1648,
        0
      ],
      "typeVersion": 1,
      "id": "a05d90b8-ba5a-4873-b49d-afebf968daa2",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## Agente de IA\n",
        "height": 640,
        "width": 960,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3104,
        0
      ],
      "typeVersion": 1,
      "id": "81ef34c7-95f3-4f50-bdf7-86ad4168a315",
      "name": "Sticky Note2"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-12-17T12:27:33.681Z",
      "createdAt": "2025-12-17T12:27:33.681Z",
      "role": "workflow:owner",
      "workflowId": "W7PJLLnrQJRg0lsU",
      "projectId": "o60HadikmqrvYZ9Z"
    }
  ],
  "staticData": null,
  "tags": [
    {
      "updatedAt": "2025-12-11T21:49:57.103Z",
      "createdAt": "2025-12-11T21:49:57.103Z",
      "id": "jVJBpv1Zg5iwH5ja",
      "name": "Potto Flow - Aula"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2025-12-17T12:27:33.681Z",
  "versionId": "a1b67a98-6779-45bc-8498-d66712b4e349"
}