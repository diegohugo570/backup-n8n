{
  "active": false,
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Facebook Graph API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Facebook Graph API": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Google Sheets1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets1": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Análise de Dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Claude 3.5 Sonnet": {
      "ai_languageModel": [
        [
          {
            "node": "IA de Análise de Dados",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "GPT-4o": {
      "ai_languageModel": [
        [
          {
            "node": "IA para Criação do Relatório",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Análise de Dados": {
      "main": [
        [
          {
            "node": "IA de Análise de Dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IA para Criação do Relatório": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IA de Análise de Dados": {
      "main": [
        [
          {
            "node": "IA para Criação do Relatório",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Gmail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-06-14T13:49:45.919Z",
  "id": "aHMWUMg7gWW9tFOs",
  "isArchived": false,
  "meta": null,
  "name": "Relatório Automático Facebook ADS",
  "nodes": [
    {
      "parameters": {
        "graphApiVersion": "v20.0",
        "node": "act_1080084793837525",
        "edge": "insights",
        "options": {
          "fields": {
            "field": [
              {
                "name": "ctr"
              },
              {
                "name": "ad_name"
              },
              {
                "name": "cpm"
              },
              {
                "name": "cpc"
              },
              {
                "name": "spend"
              },
              {
                "name": "clicks"
              },
              {
                "name": "adset_name"
              },
              {
                "name": "campaign_name"
              }
            ]
          },
          "queryParameters": {
            "parameter": [
              {
                "name": "level",
                "value": "ad"
              },
              {
                "name": "date_preset",
                "value": "last_month"
              }
            ]
          }
        }
      },
      "id": "8058e2af-51d9-4827-a6f2-f8604ff487d0",
      "name": "Facebook Graph API",
      "type": "n8n-nodes-base.facebookGraphApi",
      "typeVersion": 1,
      "position": [
        260,
        200
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 9
            }
          ]
        }
      },
      "id": "a7d1d07a-341a-45ee-a9d5-46c055e93dc4",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        40,
        200
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "36c60d42-c4ef-4408-8440-86c3840b996a",
              "name": "data",
              "value": "={{ $json.data }}",
              "type": "array"
            },
            {
              "id": "17fe260c-f460-4ad1-8192-df2d8e758e63",
              "name": "next",
              "value": "={{ $json.paging.next }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "bc4be8e5-4c1b-4551-8f3b-4dc035e91f88",
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        480,
        200
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "id": "63b34209-0c31-4593-b144-d4ac8bb561e4",
      "name": "Split Out",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        720,
        200
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "11m8xY1oyRCf5qLpWoV7zO7U6X5PvvL3jCk3XGZ5XhRo",
          "mode": "list",
          "cachedResultName": "Dados Tráfego | Aula DascIA",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11m8xY1oyRCf5qLpWoV7zO7U6X5PvvL3jCk3XGZ5XhRo/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Página1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11m8xY1oyRCf5qLpWoV7zO7U6X5PvvL3jCk3XGZ5XhRo/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "ctr": "={{ $json.ctr.replace(\".\", \",\") }}",
            "ad_name": "={{ $json.ad_name }}",
            "cpm": "={{ $json.cpm.replace(\".\", \",\") }}",
            "cpc": "={{ $json.cpc.replace(\".\", \",\") }}",
            "spend": "={{ $json.spend.replace(\".\", \",\") }}",
            "clicks": "={{ $json.clicks.replace(\".\", \",\") }}",
            "date": "={{ $today.minus(1, 'day').format(\"yyyy-MM-dd\") }}",
            "adset_name": "={{ $json.adset_name }}",
            "campaign_name": "={{ $json.campaign_name }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "ctr",
              "displayName": "ctr",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "ad_name",
              "displayName": "ad_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "adset_name",
              "displayName": "adset_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "campaign_name",
              "displayName": "campaign_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "cpm",
              "displayName": "cpm",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "cpc",
              "displayName": "cpc",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "spend",
              "displayName": "spend",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "clicks",
              "displayName": "clicks",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "date",
              "displayName": "date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "id": "431e8167-ca95-4f86-83b2-1957e51afb6d",
      "name": "Google Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        940,
        200
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "24d30414-23b0-4fe0-90ae-89ca7d7e9faa",
              "leftValue": "={{ $('Edit Fields').item.json.next }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "c13b4c28-2079-46cf-96c8-1fe238ee3fc7",
      "name": "If",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1160,
        200
      ],
      "executeOnce": true
    },
    {
      "parameters": {
        "url": "={{ $('Edit Fields').item.json.next }}",
        "options": {}
      },
      "id": "abd4554f-1481-4c88-9da0-ddf85a64a39d",
      "name": "HTTP Request",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1300,
        20
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "11m8xY1oyRCf5qLpWoV7zO7U6X5PvvL3jCk3XGZ5XhRo",
          "mode": "list",
          "cachedResultName": "Dados Tráfego | Aula DascIA",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11m8xY1oyRCf5qLpWoV7zO7U6X5PvvL3jCk3XGZ5XhRo/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Página1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/11m8xY1oyRCf5qLpWoV7zO7U6X5PvvL3jCk3XGZ5XhRo/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "date",
              "lookupValue": "={{ $today.minus(1, 'day').format(\"yyyy-MM-dd\") }}"
            }
          ]
        },
        "options": {}
      },
      "id": "0bdb6bb0-91dc-42dd-9107-813a5fac767d",
      "name": "Google Sheets1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        80,
        620
      ]
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "ctr"
            },
            {
              "fieldToAggregate": "ad_name"
            },
            {
              "fieldToAggregate": "cpm"
            },
            {
              "fieldToAggregate": "cpc"
            },
            {
              "fieldToAggregate": "spend"
            },
            {
              "fieldToAggregate": "clicks"
            },
            {
              "fieldToAggregate": "date"
            },
            {
              "fieldToAggregate": "adset_name"
            },
            {
              "fieldToAggregate": "campaign_name"
            }
          ]
        },
        "options": {}
      },
      "id": "00c9aa6e-1d91-43e8-bd1a-6dee7253150f",
      "name": "Aggregate",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        300,
        620
      ],
      "executeOnce": false
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ef4881ef-3223-40c0-bc02-259d2ff49944",
              "name": "analise",
              "value": "={\n  \"etapa_1\": {\n    \"resumo_estatistico\": {\n      \"cpm\": {\n        \"media\": {{ parseFloat(($json.cpm.reduce((a, b) => a + b, 0) / $json.cpm.length).toFixed(2)) }},\n        \"mediana\": {{ parseFloat([...$json.cpm].sort((a, b) => a - b)[Math.floor($json.cpm.length / 2)].toFixed(2)) }},\n        \"desvio_padrao\": {{ parseFloat(Math.sqrt($json.cpm.reduce((a, b) => a + Math.pow(b - ($json.cpm.reduce((a, b) => a + b, 0) / $json.cpm.length), 2), 0) / $json.cpm.length).toFixed(2)) }},\n        \"distribuicao\": {{ JSON.stringify($json.cpm.map(value => parseFloat(value.toFixed(2)))) }},\n        \"outliers\": {{ JSON.stringify($json.cpm.filter(value => value > (1.5 * $json.cpm.reduce((a, b) => a + b, 0) / $json.cpm.length)).map(value => parseFloat(value.toFixed(2)))) }}\n      },\n      \"ctr\": {\n        \"media\": {{ parseFloat(($json.ctr.reduce((a, b) => a + b, 0) / $json.ctr.length).toFixed(2)) }},\n        \"mediana\": {{ parseFloat([...$json.ctr].sort((a, b) => a - b)[Math.floor($json.ctr.length / 2)].toFixed(2)) }},\n        \"desvio_padrao\": {{ parseFloat(Math.sqrt($json.ctr.reduce((a, b) => a + Math.pow(b - ($json.ctr.reduce((a, b) => a + b, 0) / $json.ctr.length), 2), 0) / $json.ctr.length).toFixed(2)) }},\n        \"distribuicao\": {{ JSON.stringify($json.ctr.map(value => parseFloat(value.toFixed(2)))) }},\n        \"outliers\": {{ JSON.stringify($json.ctr.filter(value => value > (1.5 * $json.ctr.reduce((a, b) => a + b, 0) / $json.ctr.length)).map(value => parseFloat(value.toFixed(2)))) }}\n      },\n      \"cpc\": {\n        \"media\": {{ parseFloat(($json.cpc.reduce((a, b) => a + (b || 0), 0) / $json.cpc.filter(x => x != null).length).toFixed(2)) }},\n        \"mediana\": {{ parseFloat([...$json.cpc.filter(x => x != null)].sort((a, b) => a - b)[Math.floor($json.cpc.filter(x => x != null).length / 2)].toFixed(2)) }},\n        \"desvio_padrao\": {{ parseFloat(Math.sqrt($json.cpc.filter(x => x != null).reduce((a, b) => a + Math.pow(b - ($json.cpc.filter(x => x != null).reduce((a, b) => a + b, 0) / $json.cpc.filter(x => x != null).length), 2), 0) / $json.cpc.filter(x => x != null).length)).toFixed(2) }},\n        \"distribuicao\": {{ JSON.stringify($json.cpc.filter(x => x != null).map(value => parseFloat(value).toFixed(2))) }},\n        \"outliers\": {{ JSON.stringify($json.cpc.filter(x => x != null).filter(value => value > (1.5 * $json.cpc.filter(x => x != null).reduce((a, b) => a + b, 0) / $json.cpc.filter(x => x != null).length)).map(value => parseFloat(value.toFixed(2)))) }}\n      },\n      \"spend\": {\n        \"media\": {{ parseFloat(($json.spend.reduce((a, b) => a + b, 0) / $json.spend.length).toFixed(2)) }},\n        \"mediana\": {{ parseFloat([...$json.spend].sort((a, b) => a - b)[Math.floor($json.spend.length / 2)].toFixed(2)) }},\n        \"desvio_padrao\": {{ parseFloat(Math.sqrt($json.spend.reduce((a, b) => a + Math.pow(b - ($json.spend.reduce((a, b) => a + b, 0) / $json.spend.length), 2), 0) / $json.spend.length).toFixed(2)) }},\n        \"distribuicao\": {{ JSON.stringify($json.spend.map(value => parseFloat(value.toFixed(2)))) }},\n        \"outliers\": {{ JSON.stringify($json.spend.filter(value => value > (1.5 * $json.spend.reduce((a, b) => a + b, 0) / $json.spend.length)).map(value => parseFloat(value.toFixed(2)))) }}\n      }\n    }\n  },\n  \n  \"etapa_2\": {\n    \"analise_por_anuncio\": {{ JSON.stringify($json.ad_name.map((ad, index) => ({\n      \"nome\": ad,\n      \"performance\": {\n        \"cpm\": parseFloat($json.cpm[index]).toFixed(2),\n        \"ctr\": parseFloat($json.ctr[index]).toFixed(2),\n        \"cpc\": parseFloat($json.cpc[index]).toFixed(2),\n        \"spend\": parseFloat($json.spend[index].toFixed(2))\n      },\n      \"padroes\": {\n        \"eficiencia\": ($json.ctr[index] > ($json.ctr.reduce((a, b) => a + b, 0) / $json.ctr.length) && $json.cpc[index] < ($json.cpc.reduce((a, b) => a + b, 0) / $json.cpc.length)) ? \"Eficiente\" : \"Ineficiente\"\n      }\n    }))) }}\n  },\n  \n  \"etapa_3\": {\n    \"analise_por_adset\": {{ JSON.stringify($json.adset_name.map((adset, index) => ({\n      \"nome\": adset,\n      \"agrupamentos\": {\n        \"media_performance\": {\n          \"cpm\": parseFloat($json.cpm[index]).toFixed(2),\n          \"ctr\": parseFloat($json.ctr[index]).toFixed(2),\n          \"cpc\": parseFloat($json.cpc[index]).toFixed(2),\n          \"spend\": parseFloat($json.spend[index]).toFixed(2)\n        }\n      },\n      \"eficiencia_segmentacao\": $json.ctr[index] > (1.5 * $json.ctr.reduce((a, b) => a + b, 0) / $json.ctr.length) ? \"Segmentação eficiente\" : \"Segmentação a melhorar\",\n      \"distribuicao_investimento\": parseFloat($json.spend[index].toFixed(2))\n    }))) }}\n  },\n  \n  \"etapa_4\": {\n    \"analise_por_campanha\": {{ JSON.stringify($json.campaign_name.map((campaign, index) => ({\n      \"nome\": campaign,\n      \"visao_estrategica\": $json.ctr[index] > (1.5 * $json.ctr.reduce((a, b) => a + b, 0) / $json.ctr.length) ? \"Boa performance\" : \"Performance a melhorar\",\n      \"roi_objetivo\": $json.spend[index] > 0 ? parseFloat((($json.cpm[index] / $json.spend[index]) * 100).toFixed(2)) : \"Sem gasto registrado\",\n      \"direcionamento_recursos\": parseFloat($json.spend[index].toFixed(2))\n    }))) }}\n  }\n}\n",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "a999469b-70c2-4504-8de5-5ae69529e4be",
      "name": "Análise de Dados",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        500,
        620
      ]
    },
    {
      "parameters": {
        "model": "claude-3-5-sonnet-20241022",
        "options": {}
      },
      "id": "6e5ef157-735e-427f-a339-289f03daf6d0",
      "name": "Claude 3.5 Sonnet",
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1.2,
      "position": [
        740,
        760
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "910442dd-d27b-4c4c-94b2-ad58b99b655e",
      "name": "GPT-4o",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        1120,
        780
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=<role>\n        Você é um especialista em comunicação executiva, responsável por transformar análises técnicas em relatórios **HTML para e-mail** claros e profissionais para líderes.\n    </role>\n\n    <input>\n        - XML com análises do analista\n        - Data de referência\n    </input>\n\n    <instructions>\n        - Você DEVE manter tom executivo e profissional\n        - É OBRIGATÓRIO usar \"nós\" e \"nosso\" em todo o texto\n        - Você DEVE organizar informações por prioridade e impacto\n        - É PROIBIDO usar linguagem técnica sem explicação\n        - NUNCA seja prolixo ou repetitivo\n        - Você DEVE incluir formatação visual adequada\n        - É OBRIGATÓRIO destacar insights críticos\n        - Você DEVE usar cores adequadamente para destaque\n\n        ESTRUTURA OBRIGATÓRIA:\n        1. Resumo Executivo (máximo 3 parágrafos)\n        2. Destaques Principais (máximo 5 bullets)\n        3. Análises Detalhadas (separadas por seção)\n        4. Plano de Ação (formato de timeline)\n        5. Conclusão (máximo 2 parágrafos)\n    </instructions>\n\n    <email_template>\n        <!DOCTYPE html>\n        <html>\n        <head>\n            <style>\n                .container { max-width: 800px; margin: 0 auto; font-family: Arial, sans-serif; }\n                .header { background: #f8f9fa; padding: 20px; }\n                .section { margin: 20px 0; }\n                .highlight { background: #fff3cd; padding: 15px; }\n                .metric-positive { color: #198754; }\n                .metric-negative { color: #dc3545; }\n                .action-item { border-left: 4px solid #0d6efd; padding-left: 15px; }\n            </style>\n        </head>\n        <body>\n            <div class=\"container\">\n                [Seu conteúdo formatado aqui, seguindo a estrutura obrigatória]\n            </div>\n        </body>\n        </html>\n    </email_template>\n\n    <penalties>\n        Você será PENALIZADO se:\n        - Não seguir a estrutura definida\n        - Usar linguagem inadequada para executivos\n        - Não destacar informações críticas\n        - Criar um email visualmente poluído\n        - Não manter consistência no tom\n    </penalties>\n\n<Insights>\n{{ $json.text }}\n</Insights>\n\n\nRETORNE SOMENTE O HTML!"
      },
      "id": "73ef8af5-4f6d-4f87-8922-7a9d38b706ee",
      "name": "IA para Criação do Relatório",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.4,
      "position": [
        1140,
        620
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f3f08110-b006-41d0-9499-3dc379e320c2",
              "name": "email",
              "value": "={{ $json.text.replace(\"```html\\n\", \"\").replace(\"\\n```\", \"\") }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "3eec0dd4-91f5-439c-a21a-76a74e49df15",
      "name": "Edit Fields1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1520,
        620
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=<role> \nVocê é um analista de dados sênior com mais de 20 anos de experiência em Facebook Ads. Sua especialidade é transformar números em narrativas acionáveis e identificar padrões específicos em campanhas, conjuntos e anúncios.\n</role>\n<input_data>\n    - cpc (Cost per Click) (R$)\n    - cpm (Cost per Mille) (R$)\n    - ctr (Click-through Rate)\n    - spend (Investimento) (R$)\n    - ad_name (Nome do Anúncio)\n    - adset_name (Nome do Conjunto de Anúncios)\n    - campaign_name (Nome da Campanha)\n    - data_referencia (Data dos dados analisados = {{ $now.minus(1, \"days\").format(\"dd/MM/yyyy\") }}\n</input_data>\n\n<instructions>\n    REGRAS FUNDAMENTAIS:\n    - NUNCA use termos genéricos como \"alguns anúncios\" ou \"certas campanhas\"\n    - É OBRIGATÓRIO citar o nome específico de cada elemento analisado\n    - Você DEVE criar agrupamentos lógicos baseados em padrões nos nomes\n    - É OBRIGATÓRIO fazer comparações diretas entre elementos similares\n    - Você DEVE fazer análises cruzadas entre níveis (ads, adsets, campaigns)\n\n    ESTRUTURA DE ANÁLISE:\n\n    1. Agrupamento e Classificação:\n        VOCÊ DEVE:\n        - Agrupar anúncios por padrões no nome (ex: produto, público, criativo)\n        - Agrupar conjuntos por estratégia de targeting\n        - Agrupar campanhas por objetivo\n        - CITAR EXPLICITAMENTE os nomes dos elementos em cada grupo\n        \n        Exemplo de output:\n        \"Os anúncios do grupo 'Produto X' ('ProdX_001', 'ProdX_002', 'ProdX_003') tiveram CPC médio de R$0.45, enquanto os do 'Produto Y' ('ProdY_001', 'ProdY_002') tiveram R$0.65.\"\n\n    2. Análise Comparativa:\n        VOCÊ DEVE:\n        - Comparar performance entre anúncios similares\n        - Comparar conjuntos com mesmo targeting\n        - Comparar campanhas com mesmo objetivo\n        - EXPLICAR razões das diferenças\n        \n        Exemplo de output:\n        \"No conjunto 'Interesse_Gaming', o anúncio 'Gaming_Creative01' teve CTR 2.5% vs 1.2% do 'Gaming_Creative02'. A diferença é atribuída ao [motivo específico].\"\n\n    3. Análise Hierárquica:\n        VOCÊ DEVE:\n        - Analisar impacto de cada campanha nos resultados gerais\n        - Detalhar performance de conjuntos dentro de cada campanha\n        - Especificar contribuição de cada anúncio no conjunto\n        - CITAR NOMES em todos os níveis\n        \n        Exemplo de output:\n        \"A campanha 'Conversao_BlackFriday' (40% do spend) contém os conjuntos 'BF_InteressesA' e 'BF_InteressesB', onde o anúncio 'BF_CreativeX' representa 60% das conversões.\"\n\n    4. Análise de Padrões:\n        VOCÊ DEVE:\n        - Identificar elementos comuns em top performers\n        - Agrupar por padrões de nomenclatura\n        - Relacionar padrões com performance\n        - ESPECIFICAR nomes que seguem cada padrão\n        \n        Exemplo de output:\n        \"Anúncios com prefixo 'Desc_' ('Desc_A', 'Desc_B', 'Desc_C') têm CPC 30% menor que os com prefixo 'Title_' ('Title_A', 'Title_B').\"\n\n    5. Recomendações Específicas:\n        VOCÊ DEVE:\n        - Indicar otimizações para anúncios específicos\n        - Sugerir ajustes para conjuntos nomeados\n        - Recomendar mudanças em campanhas identificadas\n        - SEMPRE citar os nomes dos elementos\n        \n        Exemplo de output:\n        \"Pausar os anúncios 'LowCTR_1', 'LowCTR_2'. Aumentar budget do conjunto 'HighROAS_InterestA'. Replicar estrutura da campanha 'TopConversion_Campaign'.\"\n</instructions>\n\n<output_format>\n    VOCÊ DEVE RETORNAR um XML com esta estrutura EXATA:\n    \n    <analise_dados>\n        <resumo_executivo>\n            [Overview com números e nomes específicos]\n        </resumo_executivo>\n\n        <agrupamentos>\n            <grupo>\n                <padrao>[Padrão identificado]</padrao>\n                <elementos>\n                    <nome>[Nome específico do elemento]</nome>\n                    <metricas>[Métricas do elemento]</metricas>\n                </elementos>\n                <analise>[Análise do grupo]</analise>\n            </grupo>\n        </agrupamentos>\n\n        <comparacoes>\n            <comparacao>\n                <elemento_a>\n                    <nome>[Nome do elemento A]</nome>\n                    <metricas>[Métricas do elemento A]</metricas>\n                </elemento_a>\n                <elemento_b>\n                    <nome>[Nome do elemento B]</nome>\n                    <metricas>[Métricas do elemento B]</metricas>\n                </elemento_b>\n                <analise>[Análise comparativa]</analise>\n            </comparacao>\n        </comparacoes>\n\n        <hierarquia>\n            <campanha>\n                <nome>[Nome da campanha]</nome>\n                <conjuntos>\n                    <conjunto>\n                        <nome>[Nome do conjunto]</nome>\n                        <anuncios>\n                            <anuncio>\n                                <nome>[Nome do anúncio]</nome>\n                                <performance>[Métricas e análise]</performance>\n                            </anuncio>\n                        </anuncios>\n                    </conjunto>\n                </conjuntos>\n            </campanha>\n        </hierarquia>\n\n        <plano_acao>\n            <acao>\n                <prioridade>Alta/Média/Baixa</prioridade>\n                <elemento>[Nome específico do elemento]</elemento>\n                <what>O que fazer</what>\n                <why>Por que fazer</why>\n                <how>Como fazer</how>\n                <when>Quando fazer</when>\n                <impact>Impacto esperado</impact>\n            </acao>\n        </plano_acao>\n    </analise_dados>\n</output_format>\n\n<penalties>\n    Você será DESQUALIFICADO se:\n    - Usar termos genéricos sem nomear elementos\n    - Não criar agrupamentos lógicos\n    - Não fazer comparações específicas\n    - Não analisar hierarquicamente\n    - Fazer recomendações sem citar nomes\n</penalties>\n\n<Dados>\n{{ $json.analise }}\n</Dados>\n\nData dos dados a serem analisados: {{ $now.minus(1, \"days\").format(\"dd/MM/yyyy\") }}"
      },
      "id": "2bf1014f-8223-41d6-9b3f-7f485e11208c",
      "name": "IA de Análise de Dados",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.4,
      "position": [
        740,
        620
      ]
    },
    {
      "parameters": {
        "sendTo": "anwar@dascia.com.br",
        "subject": "=Relatório de Tráfego | {{ $today.minus(1, 'day').format(\"dd/MM/yyyy\") }} }",
        "message": "={{ $json.email }}",
        "options": {}
      },
      "id": "8e4a6007-fa33-4a10-90d3-be51926ba4b3",
      "name": "Gmail",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        1740,
        620
      ],
      "webhookId": "c63a3886-3255-487a-aa91-3d51924fe2b5"
    },
    {
      "parameters": {
        "content": "## Pega dados Facebook ADS",
        "height": 362.2684778681561,
        "width": 1434.6481974087953
      },
      "id": "144f4f59-cf7f-41d5-b2a4-e858e6e841bd",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        0
      ]
    },
    {
      "parameters": {
        "content": "## Faz análise e envia dados",
        "height": 365.3421739439856,
        "width": 1865.879985295384,
        "color": 4
      },
      "id": "2aab145b-eacf-46f7-9955-50e05c9a1114",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -20,
        520
      ]
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "createdAt": "2025-06-14T13:49:45.919Z",
      "updatedAt": "2025-06-14T13:49:45.919Z",
      "role": "workflow:owner",
      "workflowId": "aHMWUMg7gWW9tFOs",
      "projectId": "o60HadikmqrvYZ9Z"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-06-14T13:49:45.919Z",
  "versionId": "25e4788c-27a7-424a-9df8-6cd355c66e9b"
}