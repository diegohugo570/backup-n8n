{
  "active": true,
  "activeVersion": {
    "updatedAt": "2025-12-28T15:56:26.560Z",
    "createdAt": "2025-12-28T15:56:26.560Z",
    "versionId": "3c1e97b5-2ce4-496a-9ce2-9df0cfadbe1b",
    "workflowId": "R79i6iWxhZDB2UUa",
    "nodes": [
      {
        "parameters": {
          "options": {}
        },
        "id": "3b5bd8f1-cffd-4a1d-aad5-61bd6d603521",
        "name": "OpenAI Chat Model1",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1,
        "position": [
          7312,
          4496
        ]
      },
      {
        "parameters": {
          "model": "text-embedding-3-small",
          "options": {}
        },
        "id": "bdc94ca6-e81a-42aa-a31f-b97a22a37f80",
        "name": "Embeddings OpenAI",
        "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
        "typeVersion": 1,
        "position": [
          6752,
          4512
        ]
      },
      {
        "parameters": {
          "tableName": {
            "__rl": true,
            "value": "documents",
            "mode": "list",
            "cachedResultName": "documents"
          },
          "options": {
            "queryName": "match_documents"
          }
        },
        "id": "e6d4bdef-5b47-45dc-a8fc-c3928ae2763a",
        "name": "Supabase Vector Store",
        "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
        "typeVersion": 1,
        "position": [
          6928,
          4464
        ]
      },
      {
        "parameters": {
          "model": "gpt-4.1-mini",
          "options": {}
        },
        "id": "b4827b38-6aae-4588-a92b-94150dcf7538",
        "name": "OpenAI3",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1,
        "position": [
          8544,
          4656
        ]
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "4a271932-1e83-432e-aa6e-4f929a89085f",
        "name": "Loop Over Items3",
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          9152,
          4480
        ]
      },
      {
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"messages\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"string\"\n      }\n    }\n  },\n  \"required\": [\"messages\"]\n}"
        },
        "id": "c39ef863-cecb-4e22-bf11-89eb1e8cea72",
        "name": "OutputParser1",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.2,
        "position": [
          8768,
          4656
        ]
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Whatsapp message to be splitted and formated: {{ $json.output }}",
          "hasOutputParser": true,
          "messages": {
            "messageValues": [
              {
                "message": "={\n  \"messages\": [\n    \"Por favor, gere a sa√≠da no seguinte formato JSON: {\\\"messages\\\": [\\\"splitedMessage\\\", \\\"splitedMessage\\\", \\\"splitedMessage\\\"]}\",\n    \"As mensagens devem ser divididas de forma natural, afinal estamos conversando com um humano. Certifique-se de que a resposta siga exatamente essa estrutura, incluindo os colchetes e as aspas.\",\n    \"Jamais separe uma mensagem vazia. Cada mensagem deve ter entre 300 e 500 caracteres, sem cortar informa√ß√µes, pois √© uma conversa de chat.\",\n    \"Certifique-se de que a resposta siga exatamente essa estrutura: *negrito* (substitua '**' por '*') n√£o mande nada em negrito remova todos '*'; ~tachado~ (caso seja algo exclu√≠do/alterado); _it√°lico_ (extremamente raro).\",\n    \"Tudo o que for link, pode colocar entre \\\"`\\\", ou seja, na seguinte formata√ß√£o: `www.link.com.br`. Use sempre essa formata√ß√£o para todos os links.\"\n  ]\n}"
              }
            ]
          }
        },
        "id": "a2ddc0c3-d223-4679-913b-92cf7bbce7b0",
        "name": "Parser  Chain",
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "typeVersion": 1.4,
        "position": [
          8560,
          4464
        ]
      },
      {
        "parameters": {
          "content": "",
          "height": 620,
          "width": 1380,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          8432,
          4176
        ],
        "typeVersion": 1,
        "id": "d139f824-ed79-4318-904f-c54f983c383d",
        "name": "Sticky Note18"
      },
      {
        "parameters": {
          "content": "# Divis√£o de Mensagens Inteligente - Texto",
          "height": 80,
          "width": 736,
          "color": 5
        },
        "id": "7c81b330-cbba-41d8-bf44-267417c75755",
        "name": "Sticky Note19",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          8448,
          4192
        ]
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1,
        "position": [
          9200,
          5120
        ],
        "id": "80c24c47-dd25-4fa3-81f1-61649fe9a03e",
        "name": "OpenAI Chat Model2"
      },
      {
        "parameters": {
          "content": "",
          "height": 400,
          "width": 1620,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          8400,
          4832
        ],
        "typeVersion": 1,
        "id": "5463cf0d-7347-4529-bccf-9f101c6e98d3",
        "name": "Sticky Note44"
      },
      {
        "parameters": {
          "content": "# AVISAR NOVO LEAD NO GRUPO",
          "height": 80,
          "width": 656,
          "color": 5
        },
        "id": "5b234ba9-d435-425c-b499-2e9019a08633",
        "name": "Sticky Note45",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          8432,
          4864
        ]
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "DevTower",
          "remoteJid": "={{ $('Dados').item.json.Telefone }}",
          "messageText": "={{ $json.output }}",
          "options_message": {
            "delay": 4200,
            "linkPreview": false
          }
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          9424,
          4496
        ],
        "id": "db996c62-b11c-4126-b77e-6e8a7c5d9a98",
        "name": "Evolution API"
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "DevTower",
          "remoteJid": "={{ $('Dados').item.json.Telefone }}",
          "messageText": "={{ $json.output }}",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          8448,
          4960
        ],
        "id": "a0ebb3e9-2497-4a00-9119-f1bdea51f866",
        "name": "Evolution API1"
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "DevTower",
          "remoteJid": "12036341843329@g.us",
          "messageText": "={{ (() => { \n  const telefone = $('Dados').item.json.Telefone;\n  return 'üö® Novo Lead: wa.me/' + telefone.split('@')[0] + ' üö®';\n})() }}\n\n*Cliente:* {{ $('Dados').item.json.NomeWpp }}\n\n*CASO:*\n{{ $json.text }}",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          9568,
          4960
        ],
        "id": "b55152ed-dc5d-485d-9172-e5ae6a07ae27",
        "name": "Evolution API2"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3,
        "position": [
          9152,
          3904
        ],
        "id": "97a1d823-fa39-48d4-bb9b-e7c5d87afe12",
        "name": "Merge1"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "defac08a-6745-422b-bb05-90da9f47d91b",
                "leftValue": "={{ $('Busca Telefone').last().json.values() }}",
                "rightValue": "",
                "operator": {
                  "type": "array",
                  "operation": "empty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          8640,
          3904
        ],
        "id": "b70c481f-686d-4fd9-b221-bb84a31aff29",
        "name": "If4"
      },
      {
        "parameters": {
          "content": "",
          "height": 380,
          "width": 1380,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          8432,
          3760
        ],
        "typeVersion": 1,
        "id": "74a36d0c-2bf0-4891-b99b-72f5204093a1",
        "name": "Sticky Note54"
      },
      {
        "parameters": {
          "content": "# Cadastra Chat Supabase",
          "height": 80,
          "width": 450,
          "color": 5
        },
        "id": "4fd6d1a0-732f-4b9f-9bec-56a7097352f5",
        "name": "Sticky Note55",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          8448,
          3776
        ]
      },
      {
        "parameters": {
          "operation": "get",
          "tableId": "chats",
          "filters": {
            "conditions": [
              {
                "keyName": "phone",
                "keyValue": "={{ $('Webhook EVO').item.json.body.data.key.remoteJid }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          8480,
          3904
        ],
        "id": "029870a5-fb64-4ae4-9f9b-f5e299820fb5",
        "name": "Busca Telefone",
        "alwaysOutputData": true,
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "tableId": "chats",
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "phone",
                "fieldValue": "={{ $('Dados').item.json.Telefone }}"
              },
              {
                "fieldId": "updated_at",
                "fieldValue": "={{ $now}}"
              },
              {
                "fieldId": "created_at",
                "fieldValue": "={{ $now}}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          8928,
          3792
        ],
        "id": "d73164a4-f402-4d31-969f-321664b8547b",
        "name": "Adiciona CHAT supabase"
      },
      {
        "parameters": {
          "operation": "update",
          "tableId": "chats",
          "filters": {
            "conditions": [
              {
                "keyName": "phone",
                "condition": "eq",
                "keyValue": "={{ $('Dados').item.json.Telefone }}"
              }
            ]
          },
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "updated_at",
                "fieldValue": "={{ $now }}"
              },
              {
                "fieldId": "created_at",
                "fieldValue": "={{ $now }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          8944,
          3984
        ],
        "id": "b2854719-6be5-4d31-8995-d12308f2d218",
        "name": "Atualiza CHAT Supabase",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "tableId": "chat_messages",
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "phone",
                "fieldValue": "={{ $('Dados').item.json.Telefone }}"
              },
              {
                "fieldId": "bot_message",
                "fieldValue": "={{ $('Atendente6').item.json.output }}"
              },
              {
                "fieldId": "user_message",
                "fieldValue": "={{ $('Dados').item.json.message.content }}"
              },
              {
                "fieldId": "message_type",
                "fieldValue": "={{ $('Dados').item.json.body.event }}"
              },
              {
                "fieldId": "created_at",
                "fieldValue": "={{ $now }}"
              },
              {
                "fieldId": "nomewpp",
                "fieldValue": "={{ $('Dados').item.json.NomeWpp }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          9344,
          3904
        ],
        "id": "3c0098bf-ef96-42cd-af4d-944aab6f793e",
        "name": "Cria Hist√≥rico Supabase"
      },
      {
        "parameters": {
          "fieldToSplitOut": "output.messages",
          "options": {
            "destinationFieldName": "output"
          }
        },
        "id": "ceeb6937-142c-430d-8f4d-ffedbdf16df7",
        "name": "Split de Mensagem",
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          8928,
          4480
        ]
      },
      {
        "parameters": {
          "amount": 1
        },
        "id": "c6d25ccf-2b41-459b-9a38-3e1a7d48509c",
        "name": "1 segundo",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          9648,
          4496
        ],
        "webhookId": "a2c69e1c-13fe-44a2-962c-1249288537eb"
      },
      {
        "parameters": {
          "operation": "delete",
          "key": "={{ $('Dados').item.json.Telefone }}"
        },
        "id": "0e9f09e2-7643-4cbe-8c40-3f1b9592f8e1",
        "name": "Delete Memory",
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          9552,
          3904
        ]
      },
      {
        "parameters": {
          "name": "buscar_documentos",
          "description": "Analise o documento se encontrar uma informa√ß√£o que seja relevante traga o texto dele como resposta sem altera√ß√µes, caso n√£o encontre devolva o resultado em branco sem nem um texto",
          "topK": 2
        },
        "id": "e823ab71-a1cc-485a-ab2c-c0376bc335d4",
        "name": "buscar_documentos",
        "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
        "typeVersion": 1,
        "position": [
          7024,
          4304
        ]
      },
      {
        "parameters": {
          "operation": "getAll",
          "tableId": "chat_messages",
          "matchType": "allFilters",
          "filters": {
            "conditions": [
              {
                "keyName": "phone",
                "condition": "eq",
                "keyValue": "={{ $('Dados').item.json.Telefone }}"
              },
              {
                "keyName": "active",
                "condition": "eq",
                "keyValue": "true"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          8640,
          4960
        ],
        "id": "7c796c4d-8558-4737-bffe-d68ddbb82bc9",
        "name": "ListMessages-Supabase2",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "aggregate": "aggregateAllItemData",
          "destinationFieldName": "conversas",
          "include": "specifiedFields",
          "fieldsToInclude": "id,message_type,created_at,user_message, bot_message,phone",
          "options": {}
        },
        "type": "n8n-nodes-base.aggregate",
        "typeVersion": 1,
        "position": [
          8848,
          4960
        ],
        "id": "f25921d7-5d11-4067-b763-863f5f085f19",
        "name": "Aggregate2"
      },
      {
        "parameters": {
          "jsCode": "return $('Aggregate2').all().map(item => {\n  // Tenta acessar a propriedade 'conversas' e verifica se ela √© um array\n  const conversas = item.json.conversas || []; // Garante que √© pelo menos um array vazio\n\n  if (!Array.isArray(conversas)) {\n    throw new Error(\"A propriedade 'conversas' n√£o √© um array.\");\n  }\n\n  // Processa cada conversa e verifica as mensagens\n  const textoUnico = conversas.map(conversa => {\n    const cliente = conversa.user_message || \"sem mensagem do chatbot\";\n    const agente = conversa.bot_message || \"sem resposta\";\n    \n    // Verifica se a data existe e formata\n    const dataOriginal = conversa.created_at || \"Data da Mensagem indispon√≠vel\";\n    const dataFormatada = dataOriginal !== \"Data da Mensagem indispon√≠vel\"\n      ? formatarData(dataOriginal)\n      : dataOriginal;\n\n    return `em: ${dataFormatada}\\n\\n - agente(chatbot): ${agente} \\n - cliente: ${cliente}\\n`;\n  }).join('\\n\\n');\n\n  // Retorna o texto final como resultado\n  return {\n    json: {\n      texto: textoUnico\n    }\n  };\n});\n\n// Fun√ß√£o para formatar a data\nfunction formatarData(dataString) {\n  const data = new Date(dataString); // Converte a string em objeto Date\n  if (isNaN(data)) {\n    return \"Data inv√°lida\"; // Retorna se a data n√£o for v√°lida\n  }\n  \n  // Formata no padr√£o DD/MM/YYYY HH:mm\n  const dia = String(data.getDate()).padStart(2, '0');\n  const mes = String(data.getMonth() + 1).padStart(2, '0'); // M√™s come√ßa em 0\n  const ano = data.getFullYear();\n  const horas = String(data.getHours()).padStart(2, '0');\n  const minutos = String(data.getMinutes()).padStart(2, '0');\n  \n  return `${dia}/${mes}/${ano} ${horas}:${minutos}`;\n}\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          9024,
          4960
        ],
        "id": "29d0fb3e-9465-47c5-9b7f-32c683b9979c",
        "name": "Code6"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={\n  \"role\": \"Agente Resumidor de atendimento\",\n  \"proposito\": \"Analisar conversas cliente-agente e criar resumos detalhados do atendimento\",\n  \"instrucoes\": {\n    \"tarefa_principal\": \"Extrair e resumir apenas sobre o atendimento do cliente a partir das conversas\",\n    \"formato\": \"Incluir data da sess√£o quando dispon√≠vel\",\n    \"foco\": \"demandas do cliente, excluir respostas do agente\",\n    \"estilo\": \"Resumos detalhados mas concisos\",\n    \"evitar\": \"Dicas de uso, informa√ß√µes extras ou explica√ß√µes\",\n    \"Me de o resultado somente com o resumo sem caracteres especiais\"\n  },\n  \"formato_entrada\": {\n    \"conversa\": \"{{ $json.texto }}\"\n  },\n  \"formato_saida\": {\n    \"resumo\": \"Descri√ß√£o concisa do caso do cliente e data que ele gostaria de agendar uma reruni√£o\"\n  }\n}"
        },
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "typeVersion": 1.5,
        "position": [
          9232,
          4960
        ],
        "id": "217e0e92-5530-4b64-bef9-4c258e43b067",
        "name": "Basic LLM Chain1"
      },
      {
        "parameters": {
          "operation": "get",
          "tableId": "dados_cliente",
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "keyValue": "={{ $('Dados').item.json.Telefone }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          2784,
          4416
        ],
        "id": "11da5955-335e-4d3a-9b3b-7460862276be",
        "name": "Supabase",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "4a6d9aac-8565-4c58-abe3-8741393a5535",
                "leftValue": "={{ $json.telefone }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          3024,
          4336
        ],
        "id": "9fdf3e9d-a93b-4ae9-905b-569ea996bc7d",
        "name": "If1"
      },
      {
        "parameters": {
          "tableId": "dados_cliente",
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "nomewpp",
                "fieldValue": "={{ $('Dados').item.json.NomeWpp }}"
              },
              {
                "fieldId": "telefone",
                "fieldValue": "={{ $('Webhook EVO').item.json.body.data.key.remoteJid }}"
              },
              {
                "fieldId": "created_at",
                "fieldValue": "={{ $now}}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          3200,
          4496
        ],
        "id": "6749b596-84f0-4597-8cd4-22f2396ee041",
        "name": "Supabase1"
      },
      {
        "parameters": {
          "content": "",
          "height": 620,
          "width": 980,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          5648,
          4032
        ],
        "typeVersion": 1,
        "id": "910cbcf3-48a1-4909-9ec0-e9ed818eb540",
        "name": "Sticky Note17"
      },
      {
        "parameters": {
          "content": "",
          "height": 660,
          "width": 960,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          4640,
          4000
        ],
        "typeVersion": 1,
        "id": "c7d99d9c-c1c1-4ac2-bbdf-0c0f943b9468",
        "name": "Sticky Note20"
      },
      {
        "parameters": {
          "content": "",
          "height": 440,
          "width": 740,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2704,
          4224
        ],
        "typeVersion": 1,
        "id": "144a666d-2996-476c-b4c4-8cf1efc21e87",
        "name": "Sticky Note22"
      },
      {
        "parameters": {
          "content": "# Cadastrar Lead Supa Base",
          "height": 80,
          "width": 596,
          "color": 4
        },
        "id": "aa2f1dc3-1f4d-41c1-8dc3-1222182d7f07",
        "name": "Sticky Note23",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          2704,
          4240
        ]
      },
      {
        "parameters": {
          "content": "",
          "height": 500,
          "width": 1120,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          3488,
          4160
        ],
        "typeVersion": 1,
        "id": "42f63c65-5f61-4708-86bd-60e3b847ac21",
        "name": "Sticky Note26"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "DevTower",
          "options": {}
        },
        "id": "de52d725-be3b-4e1c-95ee-b55e8d433810",
        "name": "Webhook EVO",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          1168,
          3824
        ],
        "webhookId": "7ecd43ed-123c-4fef-b86d-f9ce39e55d64"
      },
      {
        "parameters": {
          "content": "# Pausar IA",
          "height": 80,
          "width": 216,
          "color": 4
        },
        "id": "b9a0509e-9ff0-447c-83e1-29f20bdad36c",
        "name": "Sticky Note41",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          3488,
          4160
        ]
      },
      {
        "parameters": {
          "content": "",
          "height": 460,
          "width": 1140,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1104,
          3664
        ],
        "typeVersion": 1,
        "id": "9fb9c15a-ffe6-4caa-b17f-e13b6ae10d60",
        "name": "Sticky Note32"
      },
      {
        "parameters": {
          "content": "## WEBHOOK & ROTAS",
          "height": 80,
          "width": 276,
          "color": 4
        },
        "id": "2a59a624-2da1-4a27-8609-a91988dc3b18",
        "name": "Sticky Note67",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          1168,
          3696
        ]
      },
      {
        "parameters": {
          "operation": "toBinary",
          "sourceProperty": "data",
          "options": {
            "fileName": "file.png",
            "mimeType": "image/png"
          }
        },
        "id": "c94599a3-cb89-4862-b11d-61932b1e658d",
        "name": "Convert to File1",
        "type": "n8n-nodes-base.convertToFile",
        "typeVersion": 1.1,
        "position": [
          4912,
          4496
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "3c5ccbc9-69d1-4b13-a7c3-e6945bc8c655",
                "name": "data",
                "value": "={{ $('Webhook EVO').item.json.body.data.message.base64 }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "8ac46964-f938-46d7-ac24-5f67ac586192",
        "name": "Edit Fields3",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          4768,
          4496
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 1
            },
            "conditions": [
              {
                "id": "ade56c50-1520-4760-8df5-e99617d6d3ad",
                "leftValue": "={{ $('Webhook EVO').item.json.body.data.message.imageMessage.caption }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "empty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "29d2d125-8cac-42be-a19c-5f010a9b8a4d",
        "name": "If3",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          5248,
          4496
        ]
      },
      {
        "parameters": {
          "operation": "push",
          "list": "={{ $('Dados').item.json.Telefone }}",
          "messageData": "={{ $('Dados').item.json.message.content }}, {{ $json.content.replace(/\\n/g, \"\\\\n\").replace(/['\"]/g, '').trim()  }}",
          "tail": true
        },
        "id": "b1833160-a4f6-4d3d-bb52-d349a2a183b7",
        "name": "Redis4",
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          5408,
          4512
        ]
      },
      {
        "parameters": {
          "operation": "push",
          "list": "={{ $('Dados').item.json.Telefone }}",
          "messageData": "={{ $json.content.replace(/\\n/g, \"\\\\n\").replace(/['\"]/g, '').trim()  }}",
          "tail": true
        },
        "id": "7bdb8d67-2647-4a2d-9a14-567a5dd2e3a1",
        "name": "Redis5",
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          5408,
          4336
        ]
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 1
                  },
                  "conditions": [
                    {
                      "id": "52aaf749-fe4f-44e4-880e-15b2bfc027f1",
                      "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                      "rightValue": "extendedTextMessage",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "text"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 1
                  },
                  "conditions": [
                    {
                      "id": "e514e613-fd6a-48bd-b0ae-bae2448c810e",
                      "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                      "rightValue": "conversation",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "text"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 1
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                      "rightValue": "audioMessage",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "audio"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 1
                  },
                  "conditions": [
                    {
                      "id": "c0e434dd-1268-421d-b81b-3a5e90ed9550",
                      "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                      "rightValue": "imageMessage",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "image"
              }
            ]
          },
          "options": {}
        },
        "id": "f06c5151-3dc7-4e32-8773-3f9687fc9a5d",
        "name": "Switch1",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          4688,
          4224
        ]
      },
      {
        "parameters": {
          "content": "# Mensagem Picotada",
          "height": 80,
          "width": 396,
          "color": 4
        },
        "id": "ea1dbe35-f431-4c91-b623-e9eba6bbdec6",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          5648,
          4032
        ]
      },
      {
        "parameters": {
          "resource": "image",
          "operation": "analyze",
          "modelId": {
            "__rl": true,
            "value": "gpt-4o-mini",
            "mode": "list",
            "cachedResultName": "GPT-4O-MINI"
          },
          "text": "Analise a imagem e me traga um resumo simples e o mais curto poss√≠vel do que ela √©",
          "inputType": "base64",
          "options": {}
        },
        "id": "3adde32b-2c26-41e6-8a0a-0eedbf34aabe",
        "name": "OpenAI1",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          5072,
          4496
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "d5a342e9-585b-42ea-be44-644adae10199",
                "leftValue": "={{ $json.Redis2 }}",
                "rightValue": "={{ $json.Redis1 }}",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "d79678e1-b844-4f93-a6a3-aae76ba903b9",
        "name": "Compara Get Memory1",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          6288,
          4304
        ]
      },
      {
        "parameters": {
          "operation": "push",
          "list": "={{ $('Dados').item.json.Telefone }}",
          "messageData": "={{ $('Dados').item.json.message.content }}",
          "tail": true
        },
        "id": "cc623935-6917-42eb-a922-457e360ccb20",
        "name": "Text Memory1",
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          5408,
          4016
        ]
      },
      {
        "parameters": {
          "operation": "push",
          "list": "={{ $('Dados').item.json.Telefone }}",
          "messageData": "={{ $json.text }}",
          "tail": true
        },
        "id": "76a79a31-76aa-491e-9db5-f05b1c9c9b3f",
        "name": "Audio Memory1",
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          5408,
          4176
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "f336a1ff-e577-489d-a739-1eb8bd509245",
                "name": "Redis2",
                "value": "={{ $json.propertyName }}",
                "type": "string"
              },
              {
                "id": "946d1420-e379-46e3-8fcd-3816340fbabb",
                "name": "Redis1",
                "value": "={{ $('Get Memory 1').item.json.propertyName }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "7d0dc3fa-a9d7-4160-a552-8452e423b695",
        "name": "Edit Fields8",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          6128,
          4304
        ]
      },
      {
        "parameters": {
          "amount": 3
        },
        "id": "8bdde960-0b0d-4687-8516-bfcccb6fe4bf",
        "name": "Wait3",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          5824,
          4304
        ],
        "webhookId": "9f0edf0b-ca36-42a6-bab6-bf62ca08ac51"
      },
      {
        "parameters": {
          "operation": "get",
          "key": "={{ $('Dados').item.json.Telefone }}",
          "options": {}
        },
        "id": "ab04e028-b2bb-49ae-b015-7b9b0fff9d1d",
        "name": "Get Memory 1",
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          5680,
          4304
        ]
      },
      {
        "parameters": {
          "operation": "get",
          "key": "={{ $('Dados').item.json.Telefone }}",
          "options": {}
        },
        "id": "7a44bee5-66b9-41a5-8646-f1d2c3d31ec3",
        "name": "Get Memory 2",
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          5984,
          4304
        ]
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 1
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $('Dados').item.json.message.event }}",
                      "rightValue": "outcoming",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "7c878f9b-2c93-4061-954a-a832153e7647"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "outcoming"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 1
                  },
                  "conditions": [
                    {
                      "id": "d7b42536-638f-4128-b51b-6aa913e9d9bc",
                      "leftValue": "={{ $('Dados').item.json.message.event }}",
                      "rightValue": "incoming",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "incoming"
              }
            ]
          },
          "options": {}
        },
        "id": "7531ebd1-b0c2-44be-bb51-e8d439c97a05",
        "name": "Switch6",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          3552,
          4400
        ]
      },
      {
        "parameters": {
          "content": "# Filtro de mensagem",
          "height": 80,
          "width": 356,
          "color": 4
        },
        "id": "c6aa4f9b-7154-4f86-b660-c4cd00a14016",
        "name": "Sticky Note7",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          4640,
          4000
        ]
      },
      {
        "parameters": {
          "jsCode": "const redis1 = JSON.parse($json.Redis1);\nconst redis2 = JSON.parse($json.Redis2);\n\nconst combinadoSemDuplicatas = Array.from(new Set([...redis1, ...redis2]));\n\nconst mensagem = combinadoSemDuplicatas.join(\" \");\n\nreturn [{ json: { mensagem_completa: mensagem } }];"
        },
        "id": "1fcedefe-f906-436b-99ee-df46f3a75214",
        "name": "Mensagem Completa",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          6512,
          4272
        ]
      },
      {
        "parameters": {
          "operation": "toBinary",
          "sourceProperty": "data",
          "options": {
            "fileName": "file.ogg",
            "mimeType": "application/ogg"
          }
        },
        "id": "2e33bdc3-a911-4d45-8bea-49cf1da5ef52",
        "name": "Convert to File",
        "type": "n8n-nodes-base.convertToFile",
        "typeVersion": 1.1,
        "position": [
          5040,
          4304
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "3c5ccbc9-69d1-4b13-a7c3-e6945bc8c655",
                "name": "data",
                "value": "={{ $('Webhook EVO').item.json.body.data.message.base64 }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "b1444f5f-8f6b-4f91-a518-8e7d36825ca5",
        "name": "Edit Fields",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          4880,
          4304
        ]
      },
      {
        "parameters": {
          "resource": "audio",
          "operation": "transcribe",
          "options": {}
        },
        "id": "8bf4f64a-2bc5-4bcd-a5dd-1cfa9ddd68a4",
        "name": "OpenAI",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          5232,
          4304
        ]
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-4o-mini",
            "mode": "list",
            "cachedResultName": "gpt-4o-mini"
          },
          "options": {}
        },
        "id": "59a035e6-d272-4b3f-aa3c-ae5bcab3fdd9",
        "name": "OpenAI Model",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          2784,
          5344
        ],
        "typeVersion": 1.2
      },
      {
        "parameters": {
          "content": "## Agente treinamento RAG, ativa√ß√£o autom√°tica como o texto: TreinoIA1212:",
          "height": 780,
          "width": 2260,
          "color": 4
        },
        "id": "6f6dea92-d8c3-4b1f-970f-3905ee62744c",
        "name": "Sticky Note11",
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2704,
          4864
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "descriptionType": "manual",
          "toolDescription": "Use para buscar informa√ß√µes na planilha caso tenha um treinamento paricido devovlea o numeroo da rtoow para ela ser atualziada",
          "documentId": {
            "__rl": true,
            "value": "1CSEZu8voEQ6Rl61YIwNXF_WA5VxfFqhcBcp-REZ2_8g",
            "mode": "list",
            "cachedResultName": "Treinamento Agente IA",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1CSEZu8voEQ6Rl61YIwNXF_WA5VxfFqhcBcp-REZ2_8g/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "P√°gina1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1CSEZu8voEQ6Rl61YIwNXF_WA5VxfFqhcBcp-REZ2_8g/edit#gid=0"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheetsTool",
        "typeVersion": 4.5,
        "position": [
          2944,
          5344
        ],
        "id": "937e9bb9-da86-4097-bf61-64073f690b4e",
        "name": "Treinamento_feito"
      },
      {
        "parameters": {
          "mode": "insert",
          "tableName": {
            "__rl": true,
            "value": "documents",
            "mode": "list",
            "cachedResultName": "documents"
          },
          "options": {
            "queryName": "match_documents"
          }
        },
        "id": "8125b178-7431-420c-b2bb-b0fa4b794a7e",
        "name": "Insert into Supabase Vectorstore1",
        "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
        "typeVersion": 1,
        "position": [
          4592,
          4992
        ]
      },
      {
        "parameters": {
          "separator": "/n",
          "chunkSize": 1200,
          "chunkOverlap": 200
        },
        "id": "a5772103-4eb9-4cef-888d-fc90700437c3",
        "name": "Character Text Splitter1",
        "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter",
        "typeVersion": 1,
        "position": [
          4720,
          5456
        ]
      },
      {
        "parameters": {
          "aggregate": "aggregateAllItemData",
          "include": "allFieldsExcept",
          "fieldsToExclude": "rew_number",
          "options": {}
        },
        "id": "7ff47103-9e8f-4f12-ba5f-14a910208747",
        "name": "Aggregate1",
        "type": "n8n-nodes-base.aggregate",
        "typeVersion": 1,
        "position": [
          4192,
          5152
        ]
      },
      {
        "parameters": {
          "model": "text-embedding-3-small",
          "options": {}
        },
        "id": "f74a90cf-7e1b-4047-9fe4-41585e7d37a9",
        "name": "Embeddings OpenAI2",
        "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
        "typeVersion": 1,
        "position": [
          4384,
          5424
        ]
      },
      {
        "parameters": {
          "jsonMode": "expressionData",
          "jsonData": "={{ $json.data || $json.text || $json.concatenated_data }}",
          "options": {
            "metadata": {
              "metadataValues": [
                {
                  "name": "Arquivo",
                  "value": "={{ $('Download File1').item.json.name }}"
                }
              ]
            }
          }
        },
        "id": "b1020277-1a4d-42b1-9109-75c9e32022d9",
        "name": "Default Data Loader1",
        "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
        "typeVersion": 1,
        "position": [
          4608,
          5280
        ]
      },
      {
        "parameters": {
          "operation": "download",
          "fileId": {
            "__rl": true,
            "value": "={{ $json.id }}",
            "mode": "id"
          },
          "options": {
            "googleFileConversion": {
              "conversion": {
                "docsToFormat": "text/plain"
              }
            }
          }
        },
        "id": "b7b87a41-f004-483e-b58e-67da884588cc",
        "name": "Download File1",
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          3504,
          5152
        ],
        "executeOnce": false
      },
      {
        "parameters": {
          "operation": "xlsx",
          "options": {}
        },
        "id": "63e49a08-39f3-48df-b9d3-a2e2e39ac797",
        "name": "Extract from Excel2",
        "type": "n8n-nodes-base.extractFromFile",
        "typeVersion": 1,
        "position": [
          3984,
          5072
        ]
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $('Webhook EVO').item.json.body.data.message.conversation || '' }}",
          "options": {
            "systemMessage": "={\n  \"name\": \"AgenteTreinamentoPlanilha\",\n  \"objectives\": [\n    \"Receber um texto e corrigi-lo\",\n    \"Verificar se j√° existe pergunta similar na planilha\",\n    \"Atualizar a planilha com a pergunta e a resposta corrigida\",\n    \"Caso pe√ßa para atualizar, n√£o execute nem uma tool\"\n  ],\n  \"tools\": [\n    {\n      \"name\": \"Treinamento_feito\",\n      \"description\": \"Verifica se existe conte√∫do similar antes de atualizar, caso exista deve ser removido ou substitu√≠do\"\n    },\n    {\n      \"name\": \"Atualizar_treinamento\",\n      \"description\": \"Cria ou atualiza linha na planilha com as colunas: Pergunta e Resposta\"\n    }\n  ],\n  \"general_rules\": [\n    \"N√£o mencionar a planilha ou as ferramentas na resposta ao usu√°rio\",\n    \"Corrigir sempre o texto recebido antes de registrar no sistema\",\n    \"Seja preciso e consistente ao preencher as colunas pergunta e resposta\",\n    \"Gere sua resposta sem acentos nas palavras ou caracteres especiais\"\n  ]\n}\n"
          }
        },
        "id": "30a6ca72-af16-4a54-b860-d65337b652dd",
        "name": "Agente Treinamento RAG",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          2752,
          5104
        ],
        "typeVersion": 1.8
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "9865cb5b-33da-490c-afc3-186457d5b564",
                      "operator": {
                        "type": "string",
                        "operation": "notStartsWith"
                      },
                      "leftValue": "={{ $json.message.content }}",
                      "rightValue": "TreinoIA1212:"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Rota normal"
              },
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "5a9a1fee-b408-469f-a08c-e8d690fc9792",
                      "operator": {
                        "type": "string",
                        "operation": "startsWith"
                      },
                      "leftValue": "={{ $json.message.content }}",
                      "rightValue": "TreinoIA1212:"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Treinamento IA"
              }
            ]
          },
          "options": {}
        },
        "id": "40607412-fc3f-4e84-bc4b-8c785b38add1",
        "name": "Rotas",
        "type": "n8n-nodes-base.switch",
        "position": [
          2048,
          3936
        ],
        "typeVersion": 3.2
      },
      {
        "parameters": {
          "operation": "update",
          "tableId": "dados_cliente",
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "condition": "eq",
                "keyValue": "={{ $('Dados').item.json.Telefone }}"
              }
            ]
          },
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "atendimento_ia",
                "fieldValue": "pause"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          4032,
          4192
        ],
        "id": "a3faa2cb-b98d-48a6-be3a-9cb737810282",
        "name": "Pausar IA"
      },
      {
        "parameters": {
          "operation": "get",
          "tableId": "dados_cliente",
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "keyValue": "={{ $('Dados').item.json.Telefone }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          3824,
          4496
        ],
        "id": "a649d790-efe4-4999-85f7-78a9e0aec2cd",
        "name": "Verificar Pause"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 1
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.atendimento_ia }}",
                      "rightValue": "pause",
                      "operator": {
                        "type": "string",
                        "operation": "notStartsWith"
                      },
                      "id": "ff00573b-e517-43c6-8644-14a4fe8565d1"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Ia Ativa"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 1
                  },
                  "conditions": [
                    {
                      "id": "3ef0e01c-cc14-4663-bb4d-2905b350c3ab",
                      "leftValue": "={{ $json.atendimento_ia }}",
                      "rightValue": "pause",
                      "operator": {
                        "type": "string",
                        "operation": "startsWith"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Ia pausada"
              }
            ]
          },
          "options": {}
        },
        "id": "f8140ecb-2b3e-461f-b3c9-214ee62a4763",
        "name": "Rota Atendimento",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          4064,
          4496
        ]
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "9865cb5b-33da-490c-afc3-186457d5b564",
                      "operator": {
                        "type": "string",
                        "operation": "notEquals"
                      },
                      "leftValue": "={{ $('Rotas').item.json.message.content }}",
                      "rightValue": "Atendimento finalizado"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "IA Pausada"
              },
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "5a9a1fee-b408-469f-a08c-e8d690fc9792",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $('Rotas').item.json.message.content }}",
                      "rightValue": "Atendimento finalizado"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Reativar IA"
              }
            ]
          },
          "options": {}
        },
        "id": "72003e19-264e-4409-96e9-3a79556fc03c",
        "name": "Rotas1",
        "type": "n8n-nodes-base.switch",
        "position": [
          3712,
          4272
        ],
        "typeVersion": 3.2
      },
      {
        "parameters": {
          "operation": "update",
          "tableId": "dados_cliente",
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "condition": "eq",
                "keyValue": "={{ $('Dados').item.json.Telefone }}"
              }
            ]
          },
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "atendimento_ia",
                "fieldValue": "reativada"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          4192,
          4320
        ],
        "id": "dc40fd70-67bf-43db-8eb7-7336f8956618",
        "name": "Reativar IA"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "11800d83-ecca-4f9c-a878-a2419db0c8e9",
                "name": "message.chat_id",
                "value": "={{ $('Webhook EVO').item.json.body.data.key.remoteJid || '' }}",
                "type": "string"
              },
              {
                "id": "c33f9527-e661-49e5-8e5e-64f3b430928a",
                "name": "message.content_type",
                "value": "={{ $('Webhook EVO').item.json.body.data.message.extendedTextMessage ? 'text' : '' }}{{ $('Webhook EVO').item.json.body.data.message.conversation ? 'text' : '' }}{{ $('Webhook EVO').item.json.body.data.message.audioMessage ? 'audio' : '' }}{{ $('Webhook EVO').item.json.body.data.message.imageMessage ? 'image' : '' }}",
                "type": "string"
              },
              {
                "id": "06eba1c9-cff0-4f68-b6da-6bb0092466b7",
                "name": "message.content",
                "value": "={{ $('Webhook EVO').item.json.body.data.message.extendedTextMessage?.text || '' }}{{ $('Webhook EVO').item.json.body.data.message.imageMessage?.caption || '' }}{{ $('Webhook EVO').item.json.body.data.message.conversation || '' }}",
                "type": "string"
              },
              {
                "id": "b97f1af3-5361-46fc-9303-d644921231d8",
                "name": "message.timestamp",
                "value": "={{ $('Webhook EVO').item.json.body.data.messageTimestamp.toDateTime('s').toISO() }}",
                "type": "string"
              },
              {
                "id": "dc3dc59c-90a3-4a45-bea2-de092c91083b",
                "name": "message.content_url",
                "value": "={{ $('Webhook EVO').item.json.body.data.message.audioMessage?.url || '' }}{{ $('Webhook EVO').item.json.body.data.message.imageMessage?.url || '' }}",
                "type": "string"
              },
              {
                "id": "8b01a818-a456-476e-bace-adefe2f04eb4",
                "name": "message.event",
                "value": "={{ $('Webhook EVO').item.json.body.data.key.fromMe ? 'outcoming' : 'incoming' }}",
                "type": "string"
              },
              {
                "id": "886e3751-e39b-4fc6-98d1-3113eaeebbb4",
                "name": "=body.event",
                "value": "={{ $('Webhook EVO').item.json.body.event }}",
                "type": "string"
              },
              {
                "id": "d04a0c6e-7842-41d2-bdb0-c0ce51d6dad7",
                "name": "Telefone",
                "value": "={{ $('Webhook EVO').item.json.body.data.key.remoteJid }}",
                "type": "string"
              },
              {
                "id": "a57db642-3e13-452e-bb5b-19f7e9f3bd5d",
                "name": "NomeWpp",
                "value": "={{ $json.body.data.pushName }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "79d4216b-ce42-46d5-8ba4-e2871ff2463a",
        "name": "Dados",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1392,
          3824
        ]
      },
      {
        "parameters": {
          "amount": 1
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          3904,
          4352
        ],
        "id": "3b525086-af80-4bba-abe7-8b5fecab14bd",
        "name": "Wait",
        "webhookId": "b9c0dc3b-a05b-4e71-bcbe-fee8c71142a2"
      },
      {
        "parameters": {
          "schema": {
            "__rl": true,
            "mode": "list",
            "value": "public"
          },
          "table": {
            "__rl": true,
            "value": "n8n_chat_histories",
            "mode": "list",
            "cachedResultName": "n8n_chat_histories"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "session_id": "={{ $('Dados').item.json.Telefone }}",
              "message": "={\"type\": \"ai\", \"content\": \"{{ $('Rotas').item.json.message.content.replace(/\\n/g, ' ') }}\", \"additional_kwargs\": {}, \"response_metadata\": {}}"
            },
            "matchingColumns": [
              "id"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "session_id",
                "displayName": "session_id",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "message",
                "displayName": "message",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "object",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          4400,
          4480
        ],
        "id": "35ab55fb-a5ac-499b-a4bc-7203733ca374",
        "name": "Salvar Historicoo Humano1"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1,
        "position": [
          6720,
          4320
        ],
        "id": "a6153d67-569e-45b9-a7f2-739b6bffab54",
        "name": "OpenAI Chat Model4"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.mensagem_completa }}",
          "options": {
            "systemMessage": "={\n  \"name\": \"AgenteRag\",\n  \"objectives\": [\n    \"Responder somente com dados obtidos da ferramenta buscar_documentos, sem dicas extras\"\n  ],\n  \"tools\": [\n    {\n      \"name\": \"buscar_documentos\",\n      \"description\": \"Use esta ferramenta para obter a resposta. Se n√£o houver dados, retorne: n√£o invente resposta somente do que vier da tool buscar_documentos'.\",\n      \"required\": true\n    }\n  ],\n  \"general_rules\": [\n    \"N√£o inventar respostas\",\n    \"Sempre usar a ferramenta buscar_documentos\",\n    \"caso n√£o tenha uma resposta envie a resposta assim: sem dica de resposta\"\n  ]\n}\n"
          }
        },
        "id": "ae4b662d-1323-4844-a31d-cbb646c3920d",
        "name": "Agente Rag",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.6,
        "position": [
          6720,
          4144
        ]
      },
      {
        "parameters": {
          "content": "# Agente RAG",
          "height": 80,
          "width": 336,
          "color": 4
        },
        "id": "3a21254f-f43d-47bf-a1a9-50f91cff5093",
        "name": "Sticky Note10",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          6688,
          4032
        ]
      },
      {
        "parameters": {
          "content": "",
          "height": 620,
          "width": 820,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          6672,
          4032
        ],
        "typeVersion": 1,
        "id": "29e1fdbb-04f3-4ea1-8a7b-85be2f96be62",
        "name": "Sticky Note6"
      },
      {
        "parameters": {
          "descriptionType": "manual",
          "toolDescription": "Analise se j√° existeuma coluca pareceida se sim atualize ela se n√£o crie uma nova linha",
          "operation": "appendOrUpdate",
          "documentId": {
            "__rl": true,
            "value": "1CSEZu8voEQ6Rl61YIwNXF_WA5VxfFqhcBcp-REZ2_8g",
            "mode": "list",
            "cachedResultName": "Treinamento Agente IA",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1CSEZu8voEQ6Rl61YIwNXF_WA5VxfFqhcBcp-REZ2_8g/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": "gid=0",
            "mode": "list",
            "cachedResultName": "P√°gina1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1CSEZu8voEQ6Rl61YIwNXF_WA5VxfFqhcBcp-REZ2_8g/edit#gid=0"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Pergunta": "={{ $fromAI(\"Pergunta\",\"isso √© a pergunta\") }}",
              "Resposta": "={{ $fromAI(\"Resposta\",\"isso √© a resposta\") }}"
            },
            "matchingColumns": [
              "Pergunta"
            ],
            "schema": [
              {
                "id": "Pergunta",
                "displayName": "Pergunta",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Resposta",
                "displayName": "Resposta",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "id": "26501083-ea1f-42ec-9359-8770689f8023",
        "name": "Atualizar_treinamento",
        "type": "n8n-nodes-base.googleSheetsTool",
        "position": [
          3088,
          5264
        ],
        "typeVersion": 4.5
      },
      {
        "parameters": {
          "operation": "text",
          "options": {}
        },
        "id": "81611337-de97-4e19-a036-0f83a8a02ee4",
        "name": "Extract Document Text",
        "type": "n8n-nodes-base.extractFromFile",
        "typeVersion": 1,
        "position": [
          3984,
          5456
        ],
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "operation": "pdf",
          "options": {}
        },
        "id": "ba241f3c-418c-436a-b26a-d9a45674e021",
        "name": "Extract PDF Text",
        "type": "n8n-nodes-base.extractFromFile",
        "typeVersion": 1,
        "position": [
          3984,
          4896
        ]
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 1
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.mimeType }}",
                      "rightValue": "application/pdf",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "d324b22b-cdf4-4216-a5ac-7db17ab11851"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "PDF"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 1
                  },
                  "conditions": [
                    {
                      "id": "2ae7faa7-a936-4621-a680-60c512163034",
                      "leftValue": "={{ $json.mimeType }}",
                      "rightValue": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "excel"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 1
                  },
                  "conditions": [
                    {
                      "id": "8bd558b2-8c70-4edd-ab19-92540895ae46",
                      "leftValue": "={{ $json.mimeType }}",
                      "rightValue": "application/vnd.google-apps.spreadsheet",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "CVS"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 1
                  },
                  "conditions": [
                    {
                      "id": "fc193b06-363b-4699-a97d-e5a850138b0e",
                      "leftValue": "={{ $json.mimeType }}",
                      "rightValue": "application/vnd.google-apps.document",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Google Docs"
              }
            ]
          },
          "options": {
            "fallbackOutput": 3
          }
        },
        "id": "43ce3099-759c-4006-bcb9-7d9b5c7cedcd",
        "name": "Switch",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          3680,
          5136
        ]
      },
      {
        "parameters": {
          "fieldsToSummarize": {
            "values": [
              {
                "aggregation": "concatenate",
                "field": "data"
              }
            ]
          },
          "options": {}
        },
        "id": "9a8984f1-4069-4655-b1dd-03f5a16546f3",
        "name": "Summarize1",
        "type": "n8n-nodes-base.summarize",
        "typeVersion": 1,
        "position": [
          4352,
          5120
        ]
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "5fe26e5f-d612-4de6-a380-cfcf39bdf6d9",
        "name": "Extract from Excel",
        "type": "n8n-nodes-base.extractFromFile",
        "typeVersion": 1,
        "position": [
          3984,
          5280
        ]
      },
      {
        "parameters": {
          "resource": "fileFolder",
          "returnAll": true,
          "filter": {
            "folderId": {
              "__rl": true,
              "value": "18-CqlOjNbInksf8wj4nK41rl3Os-paYs",
              "mode": "list",
              "cachedResultName": "TREINAMENTO IA DEVTOWER",
              "cachedResultUrl": "https://drive.google.com/drive/folders/18-CqlOjNbInksf8wj4nK41rl3Os-paYs"
            }
          },
          "options": {
            "fields": [
              "mimeType",
              "id",
              "name"
            ]
          }
        },
        "type": "n8n-nodes-base.googleDrive",
        "typeVersion": 3,
        "position": [
          3328,
          5152
        ],
        "id": "51096f9c-5272-4dc7-8d09-ab1f0c970b0a",
        "name": "Google Drive",
        "executeOnce": true
      },
      {
        "parameters": {
          "operation": "delete",
          "tableId": "documents",
          "filters": {
            "conditions": [
              {
                "keyName": "id",
                "condition": "neq",
                "keyValue": "0"
              }
            ]
          }
        },
        "id": "a7dbd4a5-b5fa-4757-86ba-56323bf5ed0e",
        "name": "Deleta linhas antigas do documento1",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          3120,
          5024
        ],
        "alwaysOutputData": true,
        "executeOnce": false
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "triggerAtHour": 5
              }
            ]
          }
        },
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          2928,
          4912
        ],
        "id": "b4d3453a-9d4f-416e-b68b-01f982d53743",
        "name": "Schedule Trigger",
        "disabled": true
      },
      {
        "parameters": {
          "schema": {
            "__rl": true,
            "mode": "list",
            "value": "public"
          },
          "table": {
            "__rl": true,
            "value": "n8n_chat_histories",
            "mode": "list",
            "cachedResultName": "n8n_chat_histories"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "session_id": "={{ $('Dados').item.json.Telefone }}",
              "message": "={\"type\": \"human\", \"content\": \"{{ $('Rotas').item.json.message.content.replace(/\\n/g, ' ') }}\", \"additional_kwargs\": {}, \"response_metadata\": {}}"
            },
            "matchingColumns": [
              "id"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "session_id",
                "displayName": "session_id",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "message",
                "displayName": "message",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "object",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          4384,
          4176
        ],
        "id": "e193f5c1-7f87-45a5-a348-f8d97f776288",
        "name": "Salvar Historicoo Humano"
      },
      {
        "parameters": {
          "operation": "update",
          "tableId": "dados_cliente",
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "condition": "eq",
                "keyValue": "={{ $('Dados').item.json.Telefone }}"
              }
            ]
          },
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "atendimento_ia",
                "fieldValue": "pause"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          9808,
          4960
        ],
        "id": "ae04a012-01fe-410b-b92b-516a78bda5e0",
        "name": "Pausar IA1"
      },
      {
        "parameters": {},
        "id": "f147beed-0b2e-444f-b96c-232e3d83ae28",
        "name": "Execute Workflow Trigger",
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "typeVersion": 1,
        "position": [
          5888,
          3456
        ]
      },
      {
        "parameters": {
          "operation": "getAll",
          "calendar": {
            "__rl": true,
            "value": "e598b0c9eef217ebae69caabf7f9f17969e71c7551b3ea56caafea679433115d@group.calendar.google.com",
            "mode": "list",
            "cachedResultName": "Agendamentos Agentes IA"
          },
          "returnAll": true,
          "options": {
            "timeMin": "={{ $json.timestamp }}"
          }
        },
        "id": "36473bc7-5939-4c53-a602-b0b466bd70e4",
        "name": "Google Calendar",
        "type": "n8n-nodes-base.googleCalendar",
        "typeVersion": 1.2,
        "position": [
          5504,
          5264
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "806d2106-d234-428e-a909-db00044fc342",
                "leftValue": "={{ $json.start.dateTime }}",
                "rightValue": "={{ $('Schedule Trigger1').item.json.timestamp.toDateTime().plus(0, minutes) }}",
                "operator": {
                  "type": "dateTime",
                  "operation": "after"
                }
              },
              {
                "id": "aab42f56-d82f-434d-8319-00e3c2c690f3",
                "leftValue": "={{ $json.start.dateTime }}",
                "rightValue": "={{ $('Schedule Trigger1').item.json.timestamp.toDateTime().plus(5, minutes) }}",
                "operator": {
                  "type": "dateTime",
                  "operation": "before"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2.2,
        "position": [
          5888,
          5536
        ],
        "id": "11ef5491-60c1-4a49-a12e-6fba27b8c890",
        "name": "5 Minutos antes",
        "alwaysOutputData": true,
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "806d2106-d234-428e-a909-db00044fc342",
                "leftValue": "={{ $json.start.dateTime }}",
                "rightValue": "={{ $('Schedule Trigger1').item.json.timestamp.toDateTime().plus(55, minutes) }}",
                "operator": {
                  "type": "dateTime",
                  "operation": "after"
                }
              },
              {
                "id": "aab42f56-d82f-434d-8319-00e3c2c690f3",
                "leftValue": "={{ $json.start.dateTime }}",
                "rightValue": "={{ $('Schedule Trigger1').item.json.timestamp.toDateTime().plus(60, minutes) }}",
                "operator": {
                  "type": "dateTime",
                  "operation": "before"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2.2,
        "position": [
          5968,
          5120
        ],
        "id": "729f4e95-e5ac-4850-b9b9-42e3b32ff7c4",
        "name": "2 Hora antes",
        "alwaysOutputData": true,
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "5427ed1f-2dd2-4f7c-b7f4-9b13cd780bc7",
                "leftValue": "={{ $json.kind }}",
                "rightValue": "calendar#event",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          6224,
          5104
        ],
        "id": "94ff9f5f-66b2-4895-8af0-cef4d49af28d",
        "name": "If7"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "5427ed1f-2dd2-4f7c-b7f4-9b13cd780bc7",
                "leftValue": "={{ $json.kind }}",
                "rightValue": "calendar#event",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          6080,
          5664
        ],
        "id": "6cb47cca-f70b-48ab-ae89-835c3ce5176c",
        "name": "If8"
      },
      {
        "parameters": {
          "operation": "get",
          "tableId": "n8n_chat_histories",
          "filters": {
            "conditions": [
              {
                "keyName": "session_id",
                "keyValue": "={{ $('If7').item.json.summary.match(/\\d{12}/)[0] + '@s.whatsapp.net' }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          6752,
          5072
        ],
        "id": "031c3ee9-a1e9-4c54-b40d-8baa68efebd0",
        "name": "Supabase3",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "a5af6299-68f1-4d3a-b2a7-c2ed65aa4ae6",
                "name": "remoteJid",
                "value": "={{ $('Loop Over Items4').item.json.description }}",
                "type": "string"
              },
              {
                "id": "fc721c8e-bfd6-4364-9c30-b0038118856f",
                "name": "Tempo",
                "value": "Crie uma mensagem avisando que falta 1 hora para a reuni√£o ",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          6480,
          5072
        ],
        "id": "c268285e-949a-4741-9db1-c61441ede4b5",
        "name": "Edit Fields5"
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $json.sessionID }}",
          "contextWindowLength": 100
        },
        "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
        "typeVersion": 1.3,
        "position": [
          6992,
          5376
        ],
        "id": "8f3496c3-20f8-41ac-988f-b8d53f4c503a",
        "name": "Postgres Chat Memory1"
      },
      {
        "parameters": {
          "operation": "get",
          "tableId": "n8n_chat_histories",
          "filters": {
            "conditions": [
              {
                "keyName": "session_id",
                "keyValue": "={{ $('If8').item.json.summary.match(/\\d{12}/)[0] + '@s.whatsapp.net' }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          6512,
          5424
        ],
        "id": "445d0f2f-90aa-4dfb-b8c2-5fadeff977b7",
        "name": "Supabase4",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $('Edit Fields2').item.json.Tempo }}",
          "options": {
            "systemMessage": "=Voc√™ foi acionado pois vai avisar quanto tempo falta para a apresenta√ß√£o, diga apenas o tempo que falta e se precisa de algo antes da reuni√£o, sem dicas de uso ou informa√ß√µes extras. Diga que a apresenta√ß√£o ser√° feita atrav√©s de uma v√≠deo chamada no Whatsapp"
          }
        },
        "id": "e66df1d2-fbb9-4389-b2aa-31a91956c430",
        "name": "Atendente2",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.6,
        "position": [
          6768,
          5584
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c930cacf-b5ee-4120-a192-d68715d71d57",
                "name": "remoteJid",
                "value": "={{ $('Google Calendar').item.json.description }}",
                "type": "string"
              },
              {
                "id": "e7775c3f-04e5-4b6f-9695-dad8654b7ff8",
                "name": "Tempo",
                "value": "Crie uma mensagem avisando que falta 5 minutos para a reuni√£o ",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          6288,
          5344
        ],
        "id": "1907d437-5036-42fb-9c01-7916b56d761d",
        "name": "Edit Fields2"
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "DevTower",
          "remoteJid": "={{ $('Google Calendar').item.json.description }}",
          "messageText": "={{ $json.output }}",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          7424,
          5232
        ],
        "id": "5019117d-713f-448e-b4b6-6ea604a2a6bc",
        "name": "Evolution API7"
      },
      {
        "parameters": {
          "content": "# AVISO REUNI√ÉO CHEGANDO",
          "height": 80,
          "width": 551.2183277924504,
          "color": 5
        },
        "id": "911d9c5e-0895-4541-b7cb-49fbbed92c8b",
        "name": "Sticky Note27",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          5232,
          5056
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes"
              }
            ]
          }
        },
        "id": "a435e872-dca1-4d0b-9e4c-9c7895415ba0",
        "name": "Schedule Trigger1",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.2,
        "position": [
          5280,
          5200
        ],
        "disabled": true
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1,
        "position": [
          6768,
          5376
        ],
        "id": "5ca468f0-cec2-45e5-8420-2eb96ba9e984",
        "name": "OpenAI Chat Model5"
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "cad06ca6-73fa-49ec-a5f5-bec2b54ccab8",
        "name": "Loop Over Items4",
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          5744,
          5280
        ]
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $('Edit Fields5').item.json.Tempo }}",
          "options": {
            "systemMessage": "=Voc√™ foi acionado pois vai avisar quanto tempo falta para a apresenta√ß√£o, diga apenas o tempo que falta e se precisa de algo antes da reuni√£o, sem dicas de uso ou informa√ß√µes extras"
          }
        },
        "id": "a9568647-353e-4f8e-952b-fbf8758f6562",
        "name": "Atendente3",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.6,
        "position": [
          7024,
          5104
        ]
      },
      {
        "parameters": {
          "amount": 2
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          7424,
          5680
        ],
        "id": "715e3e9f-886f-432a-b9f0-3a32aa5f09e2",
        "name": "Wait1",
        "webhookId": "d72239cb-b635-4ac2-95b6-0f66b77e9b6c"
      },
      {
        "parameters": {
          "content": "",
          "height": 881,
          "width": 2503,
          "color": 3
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          5200,
          4992
        ],
        "typeVersion": 1,
        "id": "8b2a946c-cbfa-4035-910d-70971af7cb10",
        "name": "Sticky Note1"
      },
      {
        "parameters": {
          "triggerTimes": {
            "item": [
              {
                "mode": "custom",
                "cronExpression": "*/12 8-16 * * 1-5"
              }
            ]
          }
        },
        "name": "Cron Prospec√ß√£o",
        "type": "n8n-nodes-base.cron",
        "typeVersion": 1,
        "position": [
          464,
          2544
        ],
        "id": "c71205ce-f6a9-4d43-842d-bc6951d681e4"
      },
      {
        "parameters": {
          "operation": "getAll",
          "tableId": "Prospec√ß√£o",
          "limit": 1,
          "filters": {
            "conditions": [
              {
                "keyName": "status",
                "condition": "eq",
                "keyValue": "novo"
              }
            ]
          }
        },
        "name": "Buscar Lead Prospec√ß√£o",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          704,
          2544
        ],
        "id": "4412494f-4ef1-4716-ad83-7eab98d73ee4"
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "DevTower",
          "remoteJid": "={{ $('Buscar Lead Prospec√ß√£o').item.json.telefone }}",
          "messageText": "={{ $json.output }}",
          "options_message": {}
        },
        "name": "Enviar Mensagem Inicial",
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          1904,
          2432
        ],
        "id": "7c1d2f23-58ea-42bb-8cd5-4ac6efc5dd98",
        "alwaysOutputData": true,
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "operation": "update",
          "tableId": "Prospec√ß√£o",
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "condition": "eq",
                "keyValue": "={{ $('Buscar Lead Prospec√ß√£o').item.json.telefone }}"
              }
            ]
          },
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "status",
                "fieldValue": "aguardando_resposta"
              },
              {
                "fieldId": "ultima_interacao",
                "fieldValue": "={{ $now }}"
              }
            ]
          }
        },
        "name": "Atualizar Status",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          2128,
          2352
        ],
        "id": "8393396c-64b8-40f4-95d9-ada628d8b89d"
      },
      {
        "parameters": {},
        "name": "Executar Manual",
        "type": "n8n-nodes-base.manualTrigger",
        "typeVersion": 1,
        "position": [
          464,
          2032
        ],
        "id": "a9ca0c50-8c2f-4db3-9f26-313151895d75",
        "disabled": true
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "4a6d9aac-8565-4c58-abe3-8741393a5535",
                "leftValue": "={{ $json.origem }}",
                "rightValue": "prospeccao",
                "operator": {
                  "type": "string",
                  "operation": "contains"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          1840,
          3824
        ],
        "id": "6efca3c1-c102-4623-bdec-d9a9be5997ea",
        "name": "prospeccao"
      },
      {
        "parameters": {
          "operation": "getAll",
          "tableId": "Prospec√ß√£o",
          "limit": 1,
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "condition": "eq",
                "keyValue": "={{ $json.Telefone }}"
              }
            ]
          }
        },
        "name": "Buscar prospeccao",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          1600,
          3824
        ],
        "id": "3fa6d5bb-0cb5-4700-b03e-b1a55e5650ae",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "aa4797a8-0b64-48de-848d-6cc7d3e2f652",
        "name": "OpenAI Chat Model3",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1,
        "position": [
          7328,
          2656
        ]
      },
      {
        "parameters": {
          "model": "text-embedding-3-small",
          "options": {}
        },
        "id": "5a63bed6-ec4d-4247-8045-bc9dec1aaaef",
        "name": "Embeddings OpenAI1",
        "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
        "typeVersion": 1,
        "position": [
          6768,
          2672
        ]
      },
      {
        "parameters": {
          "content": "# Agente IA",
          "height": 80,
          "width": 196,
          "color": 5
        },
        "id": "2bb13794-82c9-4b40-a5c1-13b4f911fa58",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          7568,
          2224
        ]
      },
      {
        "parameters": {
          "tableName": {
            "__rl": true,
            "value": "documents",
            "mode": "list",
            "cachedResultName": "documents"
          },
          "options": {
            "queryName": "match_documents"
          }
        },
        "id": "f0ae4079-73e1-4e00-8967-59d79593606e",
        "name": "Supabase Vector Store1",
        "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
        "typeVersion": 1,
        "position": [
          6944,
          2624
        ]
      },
      {
        "parameters": {
          "content": "",
          "height": 780,
          "width": 820,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          7552,
          2192
        ],
        "typeVersion": 1,
        "id": "89f42697-170c-47c0-9f45-a2ccbc73eccd",
        "name": "Sticky Note14"
      },
      {
        "parameters": {
          "model": "gpt-4.1-mini",
          "options": {}
        },
        "id": "d7e81535-bc5b-46a4-9743-7bc338ce6c98",
        "name": "OpenAI4",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1,
        "position": [
          8544,
          2512
        ]
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "76af16ec-69c3-4c68-a4bc-0825abdb53f8",
        "name": "Loop Over Items",
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          9184,
          2320
        ]
      },
      {
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"messages\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"string\"\n      }\n    }\n  },\n  \"required\": [\"messages\"]\n}"
        },
        "id": "b19d8753-5e02-45ee-8f81-6815b63f0ca7",
        "name": "OutputParser",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.2,
        "position": [
          8768,
          2512
        ]
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Whatsapp message to be splitted and formated: {{ $json.output }}",
          "hasOutputParser": true,
          "messages": {
            "messageValues": [
              {
                "message": "={\n  \"messages\": [\n    \"Por favor, gere a sa√≠da no seguinte formato JSON: {\\\"messages\\\": [\\\"splitedMessage\\\", \\\"splitedMessage\\\", \\\"splitedMessage\\\"]}\",\n    \"As mensagens devem ser divididas de forma natural, afinal estamos conversando com um humano. Certifique-se de que a resposta siga exatamente essa estrutura, incluindo os colchetes e as aspas.\",\n    \"Jamais separe uma mensagem vazia. Cada mensagem deve ter entre 300 e 500 caracteres, sem cortar informa√ß√µes, pois √© uma conversa de chat.\",\n    \"Certifique-se de que a resposta siga exatamente essa estrutura: *negrito* (substitua '**' por '*') n√£o mande nada em negrito remova todos '*'; ~tachado~ (caso seja algo exclu√≠do/alterado); _it√°lico_ (extremamente raro).\",\n    \"Tudo o que for link, pode colocar entre \\\"`\\\", ou seja, na seguinte formata√ß√£o: `www.link.com.br`. Use sempre essa formata√ß√£o para todos os links.\"\n  ]\n}"
              }
            ]
          }
        },
        "id": "390a749f-26af-4cf1-b21c-b33b0892736e",
        "name": "Parser  Chain1",
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "typeVersion": 1.4,
        "position": [
          8544,
          2224
        ]
      },
      {
        "parameters": {
          "content": "",
          "height": 620,
          "width": 1380,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          8432,
          2032
        ],
        "typeVersion": 1,
        "id": "54efa178-1bad-4692-8fbd-19b17934c18b",
        "name": "Sticky Note21"
      },
      {
        "parameters": {
          "content": "# Divis√£o de Mensagens Inteligente - Texto",
          "height": 80,
          "width": 736,
          "color": 5
        },
        "id": "00c7a1b5-412c-4d2f-822d-1381e527b1fe",
        "name": "Sticky Note24",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          8448,
          2064
        ]
      },
      {
        "parameters": {
          "model": "gpt-4.1-mini",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1,
        "position": [
          7568,
          2576
        ],
        "id": "ff305f1f-477b-4aa0-8ca4-968a9ffdf18a",
        "name": "OpenAI Chat Model6"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $('Mensagem Completa1').item.json.mensagem_completa }}",
          "options": {
            "systemMessage": "={\n  \"name\": \"Patrick\",\n  \"context\": {\n    \"identity\": \"Assistente de Prospec√ß√£o\",\n    \"language\": \"portugu√™s brasileiro\",\n    \"date\": \"{{ $now.weekdayLong }}, {{ $now.format('dd/MM/yyyy') }}, {{ $now.hour.toString().padStart(2, '0') }}:{{ $now.minute.toString().padStart(2, '0') }}\"\n  },\n  \"updated_info\": \"{{ $json.output }}\",\n  \"personality\": [\n    \"Objetivo e claro\",\n    \"Tom amig√°vel e profissional\",\n    \"Usa emojis com modera√ß√£o\",\n    \"Evita repeti√ß√µes e cumprimentos gen√©ricos\",\n    \"Adapta o tom ao perfil do cliente\"\n  ],\n  \"objectives\": [\n    \"Gerar conex√£o sem parecer vendedor\",\n    \"Entender como √© feito o atendimento no neg√≥cio\",\n    \"Identificar dores no atendimento via WhatsApp\",\n    \"Conduzir o cliente at√© o agendamento da apresenta√ß√£o\"\n  ],\n  \"general_rules\": [\n    \"O n√∫mero de WhatsApp do cliente j√° √© conhecido. Nunca solicite novamente.\",\n    \"Evite termos t√©cnicos e explica√ß√µes longas.\",\n    \"Se o cliente fizer uma pergunta direta fora do fluxo, o agente pode responder de forma objetiva, com base em updated_info, mesmo que n√£o esteja no step atual.\",\n    \"N√£o enviar cumprimentos.\",\n    \"Nunca chame o cliente de ‚ÄúPatrick‚Äù.\",\n    \"Se o cliente demonstrar ou disser que n√£o tem interesse, envie um ‚ÄúObrigado pelo seu tempo‚Äù e **encerrar** o fluxo.\",\n    \"Envie o v√≠deo uma √∫nica vez.\",\n    \"N√£o iniciar o Step 1 sem que o cliente tenha enviado alguma mensagem antes.\"\n  ],\n  \"tools\": [\n    {\n      \"name\": \"verificar_disponibilidade\",\n      \"usage\": \"Consulta hor√°rios livres na agenda de apresenta√ß√µes com base em eventos reais no Google Calendar.\",\n      \"rules\": \"Analise a mensagem do cliente e identifique a inten√ß√£o de agendamento. Os per√≠odos v√°lidos s√£o: 'amanh√£', 'pr√≥xima semana' ou uma data espec√≠fica no formato 'YYYY-MM-DD'. Ao identificar, envie para a tool um JSON assim: { \\\"periodo\\\": \\\"amanh√£\\\" }. A ferramenta retornar√° os hor√°rios dispon√≠veis (08h √†s 18h). Use exatamente o valor retornado em mensagem_final como resposta para o cliente, sem modificar, resumir ou reformatar.\"\n    },\n    {\n      \"name\": \"criar_reuniao\",\n      \"usage\": \"Use quando precisar agendar uma apresenta√ß√£o com o cliente. Utilize o n√∫mero de WhatsApp conhecido. Apenas colete a data e o per√≠odo. Apresenta√ß√µes de segunda a sexta, das 8h √†s 18h.\"\n    },\n    {\n      \"name\": \"reagendar_reuniao\",\n      \"usage\": \"Use quando a pessoa solicitar que mude a data da apresenta√ß√£o. Utilize o n√∫mero de WhatsApp conhecido. Apenas colete a nova data e o per√≠odo.\"\n    },\n    {\n      \"name\": \"cancelar_reuniao\",\n      \"usage\": \"Use quando precisar cancelar uma apresenta√ß√£o com o cliente. Utilize o n√∫mero de WhatsApp conhecido. Confirme apenas a data a ser cancelada.\"\n    },\n    {\n      \"name\": \"enviar_video\",\n      \"usage\": \"Use quando o cliente demonstrar interesse em saber como funciona a automa√ß√£o. Envia automaticamente um v√≠deo demonstrativo pelo WhatsApp.\",\n      \"rules\": \"Chame a tool imediatamente ap√≥s o cliente mostrar interesse ou pedir mais informa√ß√µes. N√£o explique em texto, apenas diga que est√° enviando o v√≠deo e acione a ferramenta.\"\n    }\n  ],\n  \"flow\": {\n    \"steps\": [\n      {\n        \"step\": \"Identificar quem atende\",\n        \"instructions\": \"Perguntar diretamente quem cuida do WhatsApp da oficina.\",\n        \"example_message\": \"√â voc√™ mesmo quem atende o WhatsApp da oficina?\"\n      },\n      {\n        \"step\": \"Oferecer v√≠deo\",\n        \"instructions\": \"Apresentar de forma direta a proposta e oferecer o v√≠deo curto.\",\n        \"example_message\": \"Posso te enviar um v√≠deo r√°pido que pode melhorar a forma como voc√™ atende os clientes no WhatsApp?\"\n      },\n      {\n        \"step\": \"Enviar v√≠deo + convite\",\n        \"instructions\": \"Se o cliente demonstrar interesse, acionar a tool enviar_video e j√° convidar para uma apresenta√ß√£o r√°pida.\",\n        \"example_message\": \"Vou te mandar o v√≠deo üëá Depois, se fizer sentido pra voc√™, marcamos uma apresenta√ß√£o r√°pida de 10 minutos mostrando como essa automa√ß√£o funciona na pr√°tica.\"\n      },\n      {\n        \"step\": \"Agendar apresenta√ß√£o\",\n        \"instructions\": \"Convidar o cliente para marcar a apresenta√ß√£o.\",\n        \"example_message\": \"Que dia e per√≠odo seria melhor pra gente marcar essa apresenta√ß√£o de 10 minutos?\"\n      },\n      {\n        \"step\": \"Finalizar com protocolo\",\n        \"instructions\": \"Agrade√ßa, confirme o agendamento da apresenta√ß√£o e informe o n√∫mero de atendimento 009874.\",\n        \"example_message\": \"Apresenta√ß√£o confirmada! Estarei contigo no hor√°rio combinado pra te mostrar como tudo funciona. Seu n√∫mero de atendimento √©: 009874 üëç\"\n      }\n    ]\n  }\n}"
          }
        },
        "id": "d77f4c06-5e3f-4907-9028-680cdeeea0ea",
        "name": "Atendente4",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.6,
        "position": [
          7712,
          2336
        ]
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $('Dados').item.json.Telefone }}",
          "contextWindowLength": 30
        },
        "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
        "typeVersion": 1.3,
        "position": [
          7632,
          2720
        ],
        "id": "16a64a48-a012-4cb5-a6e5-082cf824fe25",
        "name": "Postgres Chat Memory2"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.output }}",
                      "rightValue": "009874",
                      "operator": {
                        "type": "string",
                        "operation": "notContains"
                      },
                      "id": "2aa763f7-cf04-44e7-9bbb-8f8de823aef8"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Continuar na IA"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "820760d6-3546-4007-8917-55d366a74261",
                      "leftValue": "={{ $json.output }}",
                      "rightValue": "009874",
                      "operator": {
                        "type": "string",
                        "operation": "contains"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Avisar Lead grupo"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          8160,
          2336
        ],
        "id": "c8c1e18b-4bca-43da-8c38-bd405b0f06df",
        "name": "Switch3"
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "DevTower",
          "remoteJid": "={{ $('Dados').item.json.Telefone }}",
          "messageText": "={{ $json.output }}",
          "options_message": {
            "delay": 4200,
            "linkPreview": false
          }
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          9424,
          2336
        ],
        "id": "94e2f1a6-3ccf-4434-a25f-af71bf878b81",
        "name": "Evolution API3"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.merge",
        "typeVersion": 3,
        "position": [
          9152,
          1744
        ],
        "id": "ec7cb528-52a3-49c1-85e8-a79298dbcef4",
        "name": "Merge"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "defac08a-6745-422b-bb05-90da9f47d91b",
                "leftValue": "={{ $('Busca Telefone1').last().json.values() }}",
                "rightValue": "",
                "operator": {
                  "type": "array",
                  "operation": "empty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          8640,
          1744
        ],
        "id": "6f0b3aec-da04-4d3d-b8c4-437b329f7d32",
        "name": "If9"
      },
      {
        "parameters": {
          "content": "",
          "height": 380,
          "width": 1380,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          8432,
          1600
        ],
        "typeVersion": 1,
        "id": "7577888e-841b-4587-853f-4ab4cd5bf61c",
        "name": "Sticky Note58"
      },
      {
        "parameters": {
          "content": "# Cadastra Chat Supabase",
          "height": 80,
          "width": 450,
          "color": 5
        },
        "id": "ee07c2e1-6747-47d7-bdcd-1992c37e1a86",
        "name": "Sticky Note59",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          8448,
          1616
        ]
      },
      {
        "parameters": {
          "operation": "get",
          "tableId": "chats",
          "filters": {
            "conditions": [
              {
                "keyName": "phone",
                "keyValue": "={{ $('Webhook EVO').item.json.body.data.key.remoteJid }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          8480,
          1744
        ],
        "id": "d444e9bb-4915-45ec-9bcd-d26a91562439",
        "name": "Busca Telefone1",
        "alwaysOutputData": true,
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "tableId": "chats",
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "phone",
                "fieldValue": "={{ $('Dados').item.json.Telefone }}"
              },
              {
                "fieldId": "updated_at",
                "fieldValue": "={{ $now}}"
              },
              {
                "fieldId": "created_at",
                "fieldValue": "={{ $now}}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          8928,
          1632
        ],
        "id": "79592abc-9a6e-4678-9853-0f71630599fc",
        "name": "Adiciona CHAT supabase1"
      },
      {
        "parameters": {
          "operation": "update",
          "tableId": "chats",
          "filters": {
            "conditions": [
              {
                "keyName": "phone",
                "condition": "eq",
                "keyValue": "={{ $('Dados').item.json.Telefone }}"
              }
            ]
          },
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "updated_at",
                "fieldValue": "={{ $now }}"
              },
              {
                "fieldId": "created_at",
                "fieldValue": "={{ $now }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          8944,
          1824
        ],
        "id": "eba98166-e65c-4364-b0fd-eb53e477c140",
        "name": "Atualiza CHAT Supabase1",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "tableId": "chat_messages",
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "phone",
                "fieldValue": "={{ $('Dados').item.json.Telefone }}"
              },
              {
                "fieldId": "bot_message",
                "fieldValue": "={{ $('Atendente4').item.json.output }}"
              },
              {
                "fieldId": "user_message",
                "fieldValue": "={{ $('Dados').item.json.message.content }}"
              },
              {
                "fieldId": "message_type",
                "fieldValue": "={{ $('Dados').item.json.body.event }}"
              },
              {
                "fieldId": "created_at",
                "fieldValue": "={{ $now }}"
              },
              {
                "fieldId": "nomewpp",
                "fieldValue": "={{ $('Dados').item.json.NomeWpp }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          9344,
          1744
        ],
        "id": "89827343-5be9-4777-8b14-cb91414f4e9f",
        "name": "Cria Hist√≥rico Supabase1"
      },
      {
        "parameters": {
          "fieldToSplitOut": "output.messages",
          "options": {
            "destinationFieldName": "output"
          }
        },
        "id": "a87ffbe5-9cfc-4577-b82b-9fec54cdb9e9",
        "name": "Split de Mensagem1",
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          8944,
          2272
        ]
      },
      {
        "parameters": {
          "amount": 1
        },
        "id": "839567eb-c774-4768-b75e-6f175b7f54fe",
        "name": "1 segundo1",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          9648,
          2336
        ],
        "webhookId": "a2c69e1c-13fe-44a2-962c-1249288537eb"
      },
      {
        "parameters": {
          "operation": "delete",
          "key": "={{ $('Dados').item.json.Telefone }}"
        },
        "id": "b8d01d2d-e42b-482c-831c-b13485dbc330",
        "name": "Delete Memory1",
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          9552,
          1744
        ]
      },
      {
        "parameters": {
          "name": "buscar_documentos",
          "description": "Analise o documento se encontrar uma informa√ß√£o que seja relevante traga o texto dele como resposta sem altera√ß√µes, caso n√£o encontre devolva o resultado em branco sem nem um texto",
          "topK": 2
        },
        "id": "c9a78c8f-00a8-4793-ac26-75b7dd136068",
        "name": "buscar_documentos1",
        "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
        "typeVersion": 1,
        "position": [
          7040,
          2464
        ]
      },
      {
        "parameters": {
          "content": "",
          "height": 620,
          "width": 980,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          5664,
          2192
        ],
        "typeVersion": 1,
        "id": "fb566c40-5511-480d-9200-8360c6c56e8c",
        "name": "Sticky Note25"
      },
      {
        "parameters": {
          "content": "",
          "height": 660,
          "width": 960,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          4672,
          2160
        ],
        "typeVersion": 1,
        "id": "38524055-b2e3-4d73-81c5-5a6f51207d25",
        "name": "Sticky Note28"
      },
      {
        "parameters": {
          "content": "",
          "height": 500,
          "width": 1120,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          3504,
          2320
        ],
        "typeVersion": 1,
        "id": "673ca47b-6802-4490-9101-ef650bde6741",
        "name": "Sticky Note34"
      },
      {
        "parameters": {
          "content": "# Pausar IA",
          "height": 80,
          "width": 216,
          "color": 4
        },
        "id": "85bf2bd6-539e-411b-afcc-0357ee203e95",
        "name": "Sticky Note42",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          3504,
          2320
        ]
      },
      {
        "parameters": {
          "operation": "toBinary",
          "sourceProperty": "data",
          "options": {
            "fileName": "file.png",
            "mimeType": "image/png"
          }
        },
        "id": "112109eb-89cb-466c-8bfb-b6f5cc79e06b",
        "name": "Convert to File2",
        "type": "n8n-nodes-base.convertToFile",
        "typeVersion": 1.1,
        "position": [
          4928,
          2656
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "3c5ccbc9-69d1-4b13-a7c3-e6945bc8c655",
                "name": "data",
                "value": "={{ $('Webhook EVO').item.json.body.data.message.base64 }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "e470a150-a0f9-4bb0-90a1-cc460acad7e8",
        "name": "Edit Fields4",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          4784,
          2656
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 1
            },
            "conditions": [
              {
                "id": "ade56c50-1520-4760-8df5-e99617d6d3ad",
                "leftValue": "={{ $('Webhook EVO').item.json.body.data.message.imageMessage.caption }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "empty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "57e83881-6dc2-4dfb-a519-f658c8cd8c90",
        "name": "If10",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          5264,
          2656
        ]
      },
      {
        "parameters": {
          "operation": "push",
          "list": "={{ $('Dados').item.json.Telefone }}",
          "messageData": "={{ $('Dados').item.json.message.content }}, {{ $json.content.replace(/\\n/g, \"\\\\n\").replace(/['\"]/g, '').trim()  }}",
          "tail": true
        },
        "id": "affad191-2a8e-4096-997b-65c890e3079e",
        "name": "Redis",
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          5424,
          2672
        ]
      },
      {
        "parameters": {
          "operation": "push",
          "list": "={{ $('Dados').item.json.Telefone }}",
          "messageData": "={{ $json.content.replace(/\\n/g, \"\\\\n\").replace(/['\"]/g, '').trim()  }}",
          "tail": true
        },
        "id": "6de6529d-3141-4bf8-83ce-c175261b1155",
        "name": "Redis6",
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          5424,
          2496
        ]
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 1
                  },
                  "conditions": [
                    {
                      "id": "52aaf749-fe4f-44e4-880e-15b2bfc027f1",
                      "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                      "rightValue": "extendedTextMessage",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "text"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 1
                  },
                  "conditions": [
                    {
                      "id": "e514e613-fd6a-48bd-b0ae-bae2448c810e",
                      "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                      "rightValue": "conversation",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "text"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 1
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                      "rightValue": "audioMessage",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "audio"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 1
                  },
                  "conditions": [
                    {
                      "id": "c0e434dd-1268-421d-b81b-3a5e90ed9550",
                      "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                      "rightValue": "imageMessage",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "image"
              }
            ]
          },
          "options": {}
        },
        "id": "2f2904c1-7aa8-41c5-a327-f40d69cd349f",
        "name": "Switch5",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          4704,
          2384
        ]
      },
      {
        "parameters": {
          "content": "# Mensagem Picotada",
          "height": 80,
          "width": 396,
          "color": 4
        },
        "id": "35801d70-2746-4d1c-b6ec-a841f0428b66",
        "name": "Sticky Note16",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          5664,
          2192
        ]
      },
      {
        "parameters": {
          "resource": "image",
          "operation": "analyze",
          "modelId": {
            "__rl": true,
            "value": "gpt-4o-mini",
            "mode": "list",
            "cachedResultName": "GPT-4O-MINI"
          },
          "text": "Analise a imagem e me traga um resumo simples e o mais curto poss√≠vel do que ela √©",
          "inputType": "base64",
          "options": {}
        },
        "id": "bfbec491-1b69-49f3-897e-f40655b463f9",
        "name": "OpenAI2",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          5088,
          2656
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "d5a342e9-585b-42ea-be44-644adae10199",
                "leftValue": "={{ $json.Redis2 }}",
                "rightValue": "={{ $json.Redis1 }}",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "5f330622-c960-4a63-a972-446f364f7e95",
        "name": "Compara Get Memory",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          6304,
          2464
        ]
      },
      {
        "parameters": {
          "operation": "push",
          "list": "={{ $('Dados').item.json.Telefone }}",
          "messageData": "={{ $('Dados').item.json.message.content }}",
          "tail": true
        },
        "id": "f083f940-5cd0-4e64-bda0-246c97f30c27",
        "name": "Text Memory",
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          5424,
          2176
        ]
      },
      {
        "parameters": {
          "operation": "push",
          "list": "={{ $('Dados').item.json.Telefone }}",
          "messageData": "={{ $json.text }}",
          "tail": true
        },
        "id": "a6034c4c-0e07-4f1f-9096-3142d0f7c9f2",
        "name": "Audio Memory",
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          5424,
          2336
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "f336a1ff-e577-489d-a739-1eb8bd509245",
                "name": "Redis2",
                "value": "={{ $json.propertyName }}",
                "type": "string"
              },
              {
                "id": "946d1420-e379-46e3-8fcd-3816340fbabb",
                "name": "Redis1",
                "value": "={{ $('Get Memory ').item.json.propertyName }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "156e063e-54a7-4787-bd63-407c56b9a10b",
        "name": "Edit Fields11",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          6144,
          2464
        ]
      },
      {
        "parameters": {
          "amount": 2,
          "unit": "minutes"
        },
        "id": "610418e6-f84e-4fd2-a572-22d98931a20e",
        "name": "Wait4",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          5840,
          2464
        ],
        "webhookId": "9f0edf0b-ca36-42a6-bab6-bf62ca08ac51"
      },
      {
        "parameters": {
          "operation": "get",
          "key": "={{ $('Dados').item.json.Telefone }}",
          "options": {}
        },
        "id": "3f952bf9-0c23-40ac-9271-f425bf1d7661",
        "name": "Get Memory ",
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          5712,
          2464
        ]
      },
      {
        "parameters": {
          "operation": "get",
          "key": "={{ $('Dados').item.json.Telefone }}",
          "options": {}
        },
        "id": "b129769e-0248-4d41-b705-c2925123d32f",
        "name": "Get Memory 3",
        "type": "n8n-nodes-base.redis",
        "typeVersion": 1,
        "position": [
          6000,
          2464
        ]
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 1
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $('Dados').item.json.message.event }}",
                      "rightValue": "outcoming",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "7c878f9b-2c93-4061-954a-a832153e7647"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "outcoming"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 1
                  },
                  "conditions": [
                    {
                      "id": "d7b42536-638f-4128-b51b-6aa913e9d9bc",
                      "leftValue": "={{ $('Dados').item.json.message.event }}",
                      "rightValue": "incoming",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "incoming"
              }
            ]
          },
          "options": {}
        },
        "id": "a789eb6a-f697-4133-ae8c-fe2b10eea26c",
        "name": "Switch7",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          3568,
          2560
        ]
      },
      {
        "parameters": {
          "content": "# Filtro de mensagem",
          "height": 80,
          "width": 356,
          "color": 4
        },
        "id": "7699b1c3-d4e5-4be4-8506-c221f91a3040",
        "name": "Sticky Note35",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          4672,
          2160
        ]
      },
      {
        "parameters": {
          "jsCode": "const redis1 = JSON.parse($json.Redis1);\nconst redis2 = JSON.parse($json.Redis2);\n\nconst combinadoSemDuplicatas = Array.from(new Set([...redis1, ...redis2]));\n\nconst mensagem = combinadoSemDuplicatas.join(\" \");\n\nreturn [{ json: { mensagem_completa: mensagem } }];"
        },
        "id": "7e8a5a2a-8612-404d-b9e4-3105a620b2c3",
        "name": "Mensagem Completa1",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          6528,
          2432
        ]
      },
      {
        "parameters": {
          "operation": "toBinary",
          "sourceProperty": "data",
          "options": {
            "fileName": "file.ogg",
            "mimeType": "application/ogg"
          }
        },
        "id": "4de1f9bd-6e6f-4048-aacc-8d47764b216d",
        "name": "Convert to File3",
        "type": "n8n-nodes-base.convertToFile",
        "typeVersion": 1.1,
        "position": [
          5072,
          2464
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "3c5ccbc9-69d1-4b13-a7c3-e6945bc8c655",
                "name": "data",
                "value": "={{ $('Webhook EVO').item.json.body.data.message.base64 }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "91703c90-63e2-415e-bbdf-bbb8359aaec9",
        "name": "Edit Fields12",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          4912,
          2464
        ]
      },
      {
        "parameters": {
          "resource": "audio",
          "operation": "transcribe",
          "options": {}
        },
        "id": "f51674f4-9cc2-4de1-bdbd-1950ca46c756",
        "name": "OpenAI5",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.6,
        "position": [
          5248,
          2464
        ]
      },
      {
        "parameters": {
          "operation": "update",
          "tableId": "dados_cliente",
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "condition": "eq",
                "keyValue": "={{ $('Dados').item.json.Telefone }}"
              }
            ]
          },
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "atendimento_ia",
                "fieldValue": "pause"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          4048,
          2352
        ],
        "id": "f81491ad-ee15-4b2c-a8cd-d1c7c373f0e1",
        "name": "Pausar IA2"
      },
      {
        "parameters": {
          "operation": "get",
          "tableId": "dados_cliente",
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "keyValue": "={{ $('Dados').item.json.Telefone }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          3840,
          2656
        ],
        "id": "da6c868f-0b90-4f81-8100-c8b426e94bd2",
        "name": "Verificar Pause1"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 1
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.atendimento_ia }}",
                      "rightValue": "pause",
                      "operator": {
                        "type": "string",
                        "operation": "notStartsWith"
                      },
                      "id": "ff00573b-e517-43c6-8644-14a4fe8565d1"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Ia Ativa"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 1
                  },
                  "conditions": [
                    {
                      "id": "3ef0e01c-cc14-4663-bb4d-2905b350c3ab",
                      "leftValue": "={{ $json.atendimento_ia }}",
                      "rightValue": "pause",
                      "operator": {
                        "type": "string",
                        "operation": "startsWith"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Ia pausada"
              }
            ]
          },
          "options": {}
        },
        "id": "9022937d-5aaf-43b0-b153-6a3f7c76db01",
        "name": "Rota Atendimento1",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          4080,
          2656
        ]
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "9865cb5b-33da-490c-afc3-186457d5b564",
                      "operator": {
                        "type": "string",
                        "operation": "notEquals"
                      },
                      "leftValue": "={{ $('Dados').item.json.message.content }}",
                      "rightValue": "Atendimento finalizado"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "IA Pausada"
              },
              {
                "conditions": {
                  "options": {
                    "version": 2,
                    "leftValue": "",
                    "caseSensitive": true,
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "5a9a1fee-b408-469f-a08c-e8d690fc9792",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "leftValue": "={{ $('Dados').item.json.message.content }}",
                      "rightValue": "Atendimento finalizado"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Reativar IA"
              }
            ]
          },
          "options": {}
        },
        "id": "e3bbd5b3-fdd5-4538-a8af-1ef916555151",
        "name": "Rotas2",
        "type": "n8n-nodes-base.switch",
        "position": [
          3728,
          2432
        ],
        "typeVersion": 3.2
      },
      {
        "parameters": {
          "operation": "update",
          "tableId": "dados_cliente",
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "condition": "eq",
                "keyValue": "={{ $('Dados').item.json.Telefone }}"
              }
            ]
          },
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "atendimento_ia",
                "fieldValue": "reativada"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          4208,
          2480
        ],
        "id": "ff7288db-4148-44b7-95db-5abfca4fcbd9",
        "name": "Reativar IA1"
      },
      {
        "parameters": {
          "amount": 1
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          3920,
          2512
        ],
        "id": "6ed97d05-22f8-4e3f-b043-1822b4e6ee4f",
        "name": "Wait2",
        "webhookId": "b9c0dc3b-a05b-4e71-bcbe-fee8c71142a2"
      },
      {
        "parameters": {
          "schema": {
            "__rl": true,
            "mode": "list",
            "value": "public"
          },
          "table": {
            "__rl": true,
            "value": "n8n_chat_histories",
            "mode": "list",
            "cachedResultName": "n8n_chat_histories"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "session_id": "={{ $('Dados').item.json.Telefone }}",
              "message": "={\"type\": \"ai\", \"content\": \"{{ $('Dados').item.json.message.content }}\", \"additional_kwargs\": {}, \"response_metadata\": {}}"
            },
            "matchingColumns": [
              "id"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "session_id",
                "displayName": "session_id",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "message",
                "displayName": "message",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "object",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          4432,
          2640
        ],
        "id": "009f89ca-02c4-4c06-b4a9-ea39afd8fc37",
        "name": "Salvar Historicoo Humano2"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1,
        "position": [
          6752,
          2480
        ],
        "id": "d55a09b1-c68b-4219-9e12-8a626252480a",
        "name": "OpenAI Chat Model7"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.mensagem_completa }}",
          "options": {
            "systemMessage": "={\n  \"name\": \"AgenteRag\",\n  \"objectives\": [\n    \"Responder SOMENTE com dados obtidos da ferramenta buscar_documentos, sem dicas extras\"\n  ],\n  \"tools\": [\n    {\n      \"name\": \"buscar_documentos\",\n      \"description\": \"Use esta ferramenta para obter a resposta. Se n√£o houver dados, retorne: n√£o invente resposta somente do que vier da tool buscar_documentos'.\",\n      \"required\": true\n    }\n  ],\n  \"general_rules\": [\n    \"N√ÉO inventar respostas\",\n    \"Sempre usar a ferramenta buscar_documentos\",\n    \"caso n√£o tenha uma resposta envie a resposta assim: sem dica de resposta\"\n  ]\n}\n"
          }
        },
        "id": "7f1463ee-26c4-4cac-a86c-08fc03e673be",
        "name": "Agente Rag1",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.6,
        "position": [
          6752,
          2304
        ]
      },
      {
        "parameters": {
          "content": "# Agente RAG",
          "height": 80,
          "width": 336,
          "color": 4
        },
        "id": "207e2b58-e12f-4a9c-8a77-338c59ff7507",
        "name": "Sticky Note36",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          6704,
          2192
        ]
      },
      {
        "parameters": {
          "content": "",
          "height": 620,
          "width": 820,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          6688,
          2192
        ],
        "typeVersion": 1,
        "id": "e5271b40-a9d3-4cbb-a782-161d9bbae514",
        "name": "Sticky Note38"
      },
      {
        "parameters": {
          "schema": {
            "__rl": true,
            "mode": "list",
            "value": "public"
          },
          "table": {
            "__rl": true,
            "value": "n8n_chat_histories",
            "mode": "list",
            "cachedResultName": "n8n_chat_histories"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "session_id": "={{ $('Dados').item.json.Telefone }}",
              "message": "={\"type\": \"human\", \"content\": \"{{ $('Dados').item.json.message.content }}\", \"additional_kwargs\": {}, \"response_metadata\": {}}"
            },
            "matchingColumns": [
              "id"
            ],
            "schema": [
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "removed": true
              },
              {
                "id": "session_id",
                "displayName": "session_id",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "message",
                "displayName": "message",
                "required": true,
                "defaultMatch": false,
                "display": true,
                "type": "object",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          4400,
          2336
        ],
        "id": "de7e6f07-96c4-4a91-a124-6372cf5ed72f",
        "name": "Salvar Historicoo Humano3"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1,
        "position": [
          9248,
          2992
        ],
        "id": "10c5505a-b8a1-4fd2-96b0-42fc493d292d",
        "name": "OpenAI Chat Model8"
      },
      {
        "parameters": {
          "content": "",
          "height": 400,
          "width": 1620,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          8400,
          2720
        ],
        "typeVersion": 1,
        "id": "0ad7cd2f-d394-4063-b5fe-2dca0e609204",
        "name": "Sticky Note46"
      },
      {
        "parameters": {
          "content": "# AVISAR NOVO LEAD NO GRUPO",
          "height": 80,
          "width": 656,
          "color": 5
        },
        "id": "e26f04d8-e522-4cb5-93f2-9b7500935aad",
        "name": "Sticky Note47",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          8432,
          2736
        ]
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "DevTower",
          "remoteJid": "={{ $('Dados').item.json.Telefone }}",
          "messageText": "={{ $json.output }}",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          8448,
          2832
        ],
        "id": "b053f852-546f-431e-a4d8-fd8140d0ba77",
        "name": "Evolution API4"
      },
      {
        "parameters": {
          "resource": "messages-api",
          "instanceName": "DevTower",
          "remoteJid": "120363418043329@g.us",
          "messageText": "={{ (() => { \n  const telefone = $('Dados').item.json.Telefone;\n  return 'üö® Novo Lead: wa.me/' + telefone.split('@')[0] + ' üö®';\n})() }}\n\n*Cliente:* {{ $('Dados').item.json.NomeWpp }}\n\n*CASO:*\n{{ $json.text }}",
          "options_message": {}
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          9568,
          2832
        ],
        "id": "15b2da6c-f888-4d8b-af3a-ddda9966d586",
        "name": "Evolution API5"
      },
      {
        "parameters": {
          "operation": "getAll",
          "tableId": "chat_messages",
          "matchType": "allFilters",
          "filters": {
            "conditions": [
              {
                "keyName": "phone",
                "condition": "eq",
                "keyValue": "={{ $('Dados').item.json.Telefone }}"
              },
              {
                "keyName": "active",
                "condition": "eq",
                "keyValue": "true"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          8640,
          2832
        ],
        "id": "c54cd029-21da-4560-b6dc-91da2f5d30d5",
        "name": "ListMessages-Supabase",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "aggregate": "aggregateAllItemData",
          "destinationFieldName": "conversas",
          "include": "specifiedFields",
          "fieldsToInclude": "id,message_type,created_at,user_message, bot_message,phone",
          "options": {}
        },
        "type": "n8n-nodes-base.aggregate",
        "typeVersion": 1,
        "position": [
          8848,
          2832
        ],
        "id": "8c965fe3-66d7-4944-ad10-dbd793e0382a",
        "name": "Aggregate"
      },
      {
        "parameters": {
          "jsCode": "return $('Aggregate').all().map(item => {\n  // Tenta acessar a propriedade 'conversas' e verifica se ela √© um array\n  const conversas = item.json.conversas || []; // Garante que √© pelo menos um array vazio\n\n  if (!Array.isArray(conversas)) {\n    throw new Error(\"A propriedade 'conversas' n√£o √© um array.\");\n  }\n\n  // Processa cada conversa e verifica as mensagens\n  const textoUnico = conversas.map(conversa => {\n    const cliente = conversa.user_message || \"sem mensagem do chatbot\";\n    const agente = conversa.bot_message || \"sem resposta\";\n    \n    // Verifica se a data existe e formata\n    const dataOriginal = conversa.created_at || \"Data da Mensagem indispon√≠vel\";\n    const dataFormatada = dataOriginal !== \"Data da Mensagem indispon√≠vel\"\n      ? formatarData(dataOriginal)\n      : dataOriginal;\n\n    return `em: ${dataFormatada}\\n\\n - agente(chatbot): ${agente} \\n - cliente: ${cliente}\\n`;\n  }).join('\\n\\n');\n\n  // Retorna o texto final como resultado\n  return {\n    json: {\n      texto: textoUnico\n    }\n  };\n});\n\n// Fun√ß√£o para formatar a data\nfunction formatarData(dataString) {\n  const data = new Date(dataString); // Converte a string em objeto Date\n  if (isNaN(data)) {\n    return \"Data inv√°lida\"; // Retorna se a data n√£o for v√°lida\n  }\n  \n  // Formata no padr√£o DD/MM/YYYY HH:mm\n  const dia = String(data.getDate()).padStart(2, '0');\n  const mes = String(data.getMonth() + 1).padStart(2, '0'); // M√™s come√ßa em 0\n  const ano = data.getFullYear();\n  const horas = String(data.getHours()).padStart(2, '0');\n  const minutos = String(data.getMinutes()).padStart(2, '0');\n  \n  return `${dia}/${mes}/${ano} ${horas}:${minutos}`;\n}\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          9024,
          2832
        ],
        "id": "481b71ae-f568-4bc5-aab3-1375b26c1e16",
        "name": "Code"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={\n  \"role\": \"Agente Resumidor de atendimento\",\n  \"proposito\": \"Analisar conversas cliente-agente e criar resumos detalhados do atendimento\",\n  \"instrucoes\": {\n    \"tarefa_principal\": \"Extrair e resumir apenas sobre o atendimento do cliente a partir das conversas\",\n    \"formato\": \"Incluir data da sess√£o quando dispon√≠vel\",\n    \"foco\": \"demandas do cliente, excluir respostas do agente\",\n    \"estilo\": \"Resumos detalhados mas concisos\",\n    \"evitar\": \"Dicas de uso, informa√ß√µes extras ou explica√ß√µes\",\n    \"Me de o resultado somente com o resumo sem caracteres especiais\"\n  },\n  \"formato_entrada\": {\n    \"conversa\": \"{{ $json.texto }}\"\n  },\n  \"formato_saida\": {\n    \"resumo\": \"Descri√ß√£o concisa do caso do cliente e data do agendamento\"\n  }\n}"
        },
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "typeVersion": 1.5,
        "position": [
          9232,
          2832
        ],
        "id": "184b372a-611a-434d-80e9-e3126d9182d8",
        "name": "Basic LLM Chain"
      },
      {
        "parameters": {
          "operation": "update",
          "tableId": "dados_cliente",
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "condition": "eq",
                "keyValue": "={{ $('Dados').item.json.Telefone }}"
              }
            ]
          },
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "atendimento_ia",
                "fieldValue": "pause"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          9808,
          2832
        ],
        "id": "8e95e976-093c-4a7f-a972-10cc6f3cd1d3",
        "name": "Pausar IA3"
      },
      {
        "parameters": {
          "batchSize": 1,
          "options": {}
        },
        "name": "Split In Batches",
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 1,
        "position": [
          944,
          1872
        ],
        "id": "6cfd08f1-224c-40a8-a651-6734991f101a"
      },
      {
        "parameters": {
          "operation": "getAll",
          "tableId": "Prospec√ß√£o",
          "limit": 1,
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "condition": "eq",
                "keyValue": "={{ $json.Telefone }}"
              }
            ]
          }
        },
        "name": "Verificar no Supabase",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          1168,
          1872
        ],
        "id": "45d0e27d-41cc-406f-8dd2-fbcddaa54409",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "conditions": {
            "number": [
              {
                "value1": "={{ $json.telefone }}",
                "operation": "isEmpty"
              }
            ]
          }
        },
        "name": "IF N√£o Existe?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 1,
        "position": [
          1392,
          1872
        ],
        "id": "458dcace-994f-4e8f-a9ff-11689a96558a"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "1g0IJPaROsWYEmFHipYZK9fouAEHYY0Ec7hZXJ2831uk",
            "mode": "list",
            "cachedResultName": "Analise de Atendimento",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g0IJPaROsWYEmFHipYZK9fouAEHYY0Ec7hZXJ2831uk/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1511455453,
            "mode": "list",
            "cachedResultName": "pagina1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g0IJPaROsWYEmFHipYZK9fouAEHYY0Ec7hZXJ2831uk/edit#gid=1511455453"
          },
          "options": {}
        },
        "name": "Ler Planilha Google1",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4,
        "position": [
          720,
          1872
        ],
        "id": "8dcb7097-d9f5-45a7-97bd-2a0ec69a055f"
      },
      {
        "parameters": {
          "tableId": "Prospec√ß√£o",
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "nome",
                "fieldValue": "={{ $('Split In Batches').item.json.Nome }}"
              },
              {
                "fieldId": "telefone",
                "fieldValue": "={{ $('Split In Batches').item.json.Telefone }}"
              },
              {
                "fieldId": "ramo",
                "fieldValue": "={{ $('Split In Batches').item.json.Ramo }}"
              },
              {
                "fieldId": "status",
                "fieldValue": "novo"
              },
              {
                "fieldId": "origem",
                "fieldValue": "prospeccao"
              },
              {
                "fieldId": "created_at",
                "fieldValue": "={{ $now }}"
              }
            ]
          }
        },
        "name": "Inserir no Supabase1",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          1600,
          1936
        ],
        "id": "9745ab86-4028-498a-8692-f7038fe42c80"
      },
      {
        "parameters": {
          "model": "gpt-4.1-mini",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1,
        "position": [
          1568,
          2672
        ],
        "id": "aac56d52-1216-433f-9bba-f879895110ae",
        "name": "OpenAI Chat Model9"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "gere mensagem conforme o prompt",
          "options": {
            "systemMessage": "={\n  \"name\": \"Agente de Prospec√ß√£o\",\n  \"context\": {\n    \"identity\": \"Patrick, da DevTower\",\n    \"business\": \"DevTower - Solu√ß√µes em Automa√ß√£o com IA\",\n    \"language\": \"portugu√™s brasileiro\",\n    \"date\": \"{{ $now.weekdayLong }}, {{ $now.format('dd/MM/yyyy') }}, {{ $now.hour.toString().padStart(2, '0') }}:{{ $now.minute.toString().padStart(2, '0') }}\"\n  },\n  \"personality\": [\n    \"Natural e informal\",\n    \"Simples, direto e humano\",\n    \"Nada de linguagem de vendedor ou IA\"\n  ],\n  \"objectives\": [\n    \"Enviar apenas uma sauda√ß√£o inicial de forma simples e humana\"\n  ],\n  \"general_rules\": [\n    \"A mensagem deve conter apenas 'Bom dia', 'Boa tarde' ou 'Boa noite', de forma simp√°tica, sem mais nenhum conte√∫do\",\n    \"De 00h00 at√© 11h59 ‚Üí diga 'Bom dia'\",\n    \"De 12h00 at√© 17h59 ‚Üí diga 'Boa tarde'\",\n    \"De 18h00 at√© 23h59 ‚Üí diga 'Boa noite'\",\n    \"N√£o adicione emojis, links ou frases complementares\",\n    \"Nunca envie mais de uma mensagem por contato\",\n    \"N√£o inicie conversa nem fa√ßa perguntas\"\n  ],\n  \"flow\": {\n    \"steps\": [\n      {\n        \"step\": \"Enviar sauda√ß√£o conforme hor√°rio\",\n        \"instructions\": \"Envie apenas a sauda√ß√£o correspondente ao hor√°rio atual do sistema\",\n        \"example_message\": {\n          \"manh√£\": \"Bom dia\",\n          \"tarde\": \"Boa tarde\",\n          \"noite\": \"Boa noite\"\n        }\n      }\n    ]\n  }\n}\n"
          }
        },
        "id": "7ea4dae7-fb8f-4417-a9bf-b737cf8acee3",
        "name": "Atendente5",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.6,
        "position": [
          1520,
          2400
        ]
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $('Buscar Lead Prospec√ß√£o').item.json.telefone }}",
          "contextWindowLength": 20
        },
        "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
        "typeVersion": 1.3,
        "position": [
          1744,
          2672
        ],
        "id": "edc49b5b-3f8f-4ee0-ab0a-a21c9d257d88",
        "name": "Postgres Chat Memory3"
      },
      {
        "parameters": {
          "content": "",
          "height": 560,
          "width": 1940,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          400,
          2304
        ],
        "typeVersion": 1,
        "id": "82f79f2c-9af1-49cb-acda-b43a4384023e",
        "name": "Sticky Note39"
      },
      {
        "parameters": {
          "content": "## AGENTE DE PROSPEC√á√ÉO",
          "height": 80,
          "width": 416,
          "color": 4
        },
        "id": "157522d5-3a3a-4f64-b6ae-c266b20b3678",
        "name": "Sticky Note68",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          448,
          2320
        ]
      },
      {
        "parameters": {
          "content": "",
          "height": 460,
          "width": 1380,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          400,
          1744
        ],
        "typeVersion": 1,
        "id": "504337f5-3772-42ff-ac86-1cf0adc796f9",
        "name": "Sticky Note43"
      },
      {
        "parameters": {
          "content": "## ADICIONAR DADOS DA PLANILHA NO SUPABASE",
          "height": 80,
          "width": 676,
          "color": 4
        },
        "id": "42ffb4de-fcb9-4f22-ac89-3c32ad9d1447",
        "name": "Sticky Note69",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          448,
          1760
        ]
      },
      {
        "parameters": {
          "content": "# Agente IA",
          "height": 80,
          "width": 196,
          "color": 5
        },
        "id": "cd132b61-d9b9-4073-9db9-951e07d1bc84",
        "name": "Sticky Note51",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          7568,
          4032
        ]
      },
      {
        "parameters": {
          "content": "",
          "height": 840,
          "width": 820,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          7552,
          4016
        ],
        "typeVersion": 1,
        "id": "fe4ca963-ce77-4b0e-a59e-493576d0b1c7",
        "name": "Sticky Note52"
      },
      {
        "parameters": {
          "model": "gpt-4.1-mini",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1,
        "position": [
          7600,
          4352
        ],
        "id": "2a315ca5-370f-4ee6-84cb-4c9abc4b2855",
        "name": "OpenAI Chat Model10"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $('Mensagem Completa').item.json.mensagem_completa }}",
          "options": {
            "systemMessage": "={\n  \"name\": \"Patrick\",\n  \"context\": {\n    \"identity\": \"Consultor especializado em automa√ß√£o de atendimento e agendamento via WhatsApp\",\n    \"language\": \"portugu√™s brasileiro\",\n    \"date\": \"{{ $now.weekdayLong }}, {{ $now.format('dd/MM/yyyy') }}, {{ $now.hour.toString().padStart(2, '0') }}:{{ $now.minute.toString().padStart(2, '0') }}\"\n  },\n  \"updated_info\": \"{{ $json.output }}\",\n  \"personality\": [\n    \"Direto e claro\",\n    \"Tom profissional com empatia\",\n    \"Usa emojis com prop√≥sito\",\n    \"Evita repeti√ß√µes e cumprimentos gen√©ricos\",\n    \"Adapta o tom ao perfil do cliente\",\n    \"Chama o cliente pelo nome sempre que poss√≠vel\"\n  ],\n  \"objectives\": [\n    \"Entender como o atendimento √© feito hoje\",\n    \"Mapear falhas ou gargalos no atendimento e agendamento\",\n    \"Fazer o cliente enxergar os ganhos com a automa√ß√£o\",\n    \"Levar o cliente naturalmente at√© o agendamento\"\n  ],\n  \"general_rules\": [\n    \"O n√∫mero de WhatsApp do cliente j√° √© conhecido. N√£o pe√ßa novamente.\",\n    \"Evite explica√ß√µes t√©cnicas. Priorize uma conversa simples e estrat√©gica.\",\n    \"N√£o envie links ou arquivos. Baseie a conversa nos exemplos definidos.\",\n    \"Evite parecer rob√¥. Demonstre interesse real no neg√≥cio do cliente.\"\n  ],\n  \"tools\": [\n    {\n      \"name\": \"verificar_disponibilidade\",\n      \"usage\": \"Consulta hor√°rios livres na agenda de apresenta√ß√µes com base em eventos reais no Google Calendar.\",\n      \"rules\": \"Analise a mensagem do cliente e identifique a inten√ß√£o de agendamento. Os per√≠odos v√°lidos s√£o: 'amanh√£', 'pr√≥xima semana' ou uma data espec√≠fica no formato 'YYYY-MM-DD'. Ao identificar, envie para a tool um JSON assim: { \\\"periodo\\\": \\\"amanh√£\\\" }. A ferramenta retornar√° os hor√°rios dispon√≠veis (08h √†s 18h). Use exatamente o valor retornado em mensagem_final como resposta para o cliente, sem modificar, resumir ou reformatar.\"\n    },\n    {\n      \"name\": \"criar_reuniao\",\n      \"usage\": \"Use quando precisar agendar uma apresenta√ß√£o com o cliente. Utilize o n√∫mero de WhatsApp conhecido. Apenas colete a data e o per√≠odo. Apresenta√ß√µes de segunda a sexta, das 8h √†s 18h.\"\n    },\n    {\n      \"name\": \"reagendar_reuniao\",\n      \"usage\": \"Use quando a pessoa solicitar que mude a data da apresenta√ß√£o. Utilize o n√∫mero de WhatsApp conhecido. Apenas colete a nova data e o per√≠odo.\"\n    },\n    {\n      \"name\": \"cancelar_reuniao\",\n      \"usage\": \"Use quando precisar cancelar uma apresenta√ß√£o com o cliente. Utilize o n√∫mero de WhatsApp conhecido. Confirme apenas a data a ser cancelada.\"\n    }\n  ],\n  \"flow\": {\n    \"steps\": [\n      {\n        \"step\": \"Se apresentar e pedir o nome\",\n        \"instructions\": \"Se apresentar como secret√°ria da DevTower e perguntar o nome do cliente\",\n        \"example_message\": \"Ol√°! Aqui √© o Patrick, da equipe DevTower üòä Como posso te chamar?\"\n      },\n      {\n        \"step\": \"Entender o que deseja otimizar\",\n        \"instructions\": \"Investigar de forma simples qual processo o cliente quer automatizar ou tornar mais eficiente\",\n        \"example_message\": \"Me conta: o que hoje no seu atendimento voc√™ gostaria que funcionasse de forma mais pr√°tica e autom√°tica?\"\n      },\n      {\n        \"step\": \"Conectar benef√≠cio √† necessidade\",\n        \"instructions\": \"Relacionar a automa√ß√£o que j√° entregamos (como atendimento com agendamento) ao problema mencionado\",\n        \"example_message\": \"Entendi! Isso √© exatamente o que nossa automa√ß√£o resolve. A gente j√° ajuda outras empresas a agilizar esse tipo de atendimento e economizar tempo todos os dias ‚è±Ô∏è\"\n      },\n      {\n        \"step\": \"Convidar para apresenta√ß√£o\",\n        \"instructions\": \"Convidar o cliente para ver uma apresenta√ß√£o direta, mostrando como funciona na realidade dele\",\n        \"example_message\": \"Quer ver como isso funciona na pr√°tica? Posso agendar uma apresenta√ß√£o r√°pida, direta e personalizada pra sua realidade.\"\n      },\n      {\n        \"step\": \"Coletar disponibilidade\",\n        \"instructions\": \"Perguntar o melhor dia e per√≠odo para marcar a apresenta√ß√£o\",\n        \"example_message\": \"Qual dia e per√≠odo (manh√£ ou tarde) funciona melhor pra voc√™?\"\n      },\n      {\n        \"step\": \"Finalizar com protocolo\",\n        \"instructions\": \"Agradecer, confirmar o agendamento e informar o numero do atendimento 009874\",\n        \"example_message\": \"Show! Vou te chamar alguns minutos antes da reuni√£o pra alinhar tudo. Seu n√∫mero de protocolo √© 009874 üìå\"\n      }\n    ]\n  }\n}"
          }
        },
        "id": "f8299aa3-6ab3-40fa-b937-274df1bf3c88",
        "name": "Atendente6",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.6,
        "position": [
          7680,
          4176
        ]
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $('Dados').item.json.Telefone }}",
          "contextWindowLength": 20
        },
        "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
        "typeVersion": 1.3,
        "position": [
          7664,
          4512
        ],
        "id": "a335ef84-abe9-49ac-b4f5-233d0730cddf",
        "name": "Postgres Chat Memory4"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.output }}",
                      "rightValue": "009874",
                      "operator": {
                        "type": "string",
                        "operation": "notContains"
                      },
                      "id": "2aa763f7-cf04-44e7-9bbb-8f8de823aef8"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Continuar na IA"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "820760d6-3546-4007-8917-55d366a74261",
                      "leftValue": "={{ $json.output }}",
                      "rightValue": "009874",
                      "operator": {
                        "type": "string",
                        "operation": "contains"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Avisar Lead grupo"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          8144,
          4192
        ],
        "id": "693642b0-454a-4f69-abf3-a3d2ff2700a3",
        "name": "Switch9"
      },
      {
        "parameters": {
          "name": "verificar_disponibilidade",
          "description": "=tool({\n  name: \"verificar_disponibilidade\",\n  description: \"Consulta hor√°rios livres reais na agenda (segunda a sexta, das 08h √†s 18h, com intervalos de 30 minutos). Aceita per√≠odos como 'amanh√£', 'pr√≥xima semana' ou uma data no formato 'YYYY-MM-DD'. Caso n√£o informe nada, retorna os dois hor√°rios dispon√≠veis mais pr√≥ximos.\",\n  parameters: {\n    dia: {\n      type: \"string\",\n      required: false,\n      description: \"Dia desejado para agendamento: 'amanh√£', 'pr√≥xima semana' ou data no formato YYYY-MM-DD.\"\n    },\n    periodo: {\n      type: \"string\",\n      required: false,\n      enum: [\"manha\", \"tarde\"],\n      description: \"Per√≠odo do dia preferido: 'manha' ou 'tarde'.\"\n    }\n  },\n  run: async ({ dia, periodo }) => {\n    const periodoTexto = (dia || \"amanh√£\").toLowerCase().trim();\n\n    const resultado = await callWorkflow(\"verificar_disponibilidade\", {\n      periodo: periodoTexto\n    });\n\n    const todosHorarios = resultado.horarios_disponiveis\n      ? resultado.horarios_disponiveis.split(\",\").map(h => h.trim())\n      : [];\n\n    // Filtro opcional por per√≠odo\n    let selecionados = todosHorarios;\n    if (periodo === \"manha\" || periodo === \"tarde\") {\n      selecionados = todosHorarios.filter(horario => {\n        const hora = parseInt(horario.slice(0, 2), 10);\n        return periodo === \"manha\" ? hora < 12 : hora >= 12;\n      });\n    }\n\n    const formatarHorario = (horarioStr) => {\n      const [hora, minuto] = horarioStr.split(\"‚Äì\")[0].split(\":\").map(Number);\n      const hoje = new Date();\n      const dataBase = new Date(hoje);\n      if (dia && /^\\d{4}-\\d{2}-\\d{2}$/.test(dia)) {\n        dataBase.setTime(new Date(dia).getTime());\n      } else if (periodoTexto.includes(\"semana\")) {\n        dataBase.setDate(hoje.getDate() + 7);\n      } else if (periodoTexto.includes(\"amanh√£\")) {\n        dataBase.setDate(hoje.getDate() + 1);\n      }\n\n      dataBase.setHours(hora, minuto, 0, 0);\n\n      const dias = [\"Domingo\", \"Segunda-feira\", \"Ter√ßa-feira\", \"Quarta-feira\", \"Quinta-feira\", \"Sexta-feira\", \"S√°bado\"];\n      const diaSemana = dias[dataBase.getDay()];\n      const diaStr = String(dataBase.getDate()).padStart(2, '0');\n      const mesStr = String(dataBase.getMonth() + 1).padStart(2, '0');\n      const horaStr = `${hora}h${minuto > 0 ? String(minuto).padStart(2, '0') : ''}`;\n\n      return `üìÖ ${diaSemana} (${diaStr}/${mesStr}) √†s ${horaStr}`;\n    };\n\n    const formatados = selecionados.slice(0, 2).map(formatarHorario);\n\n    return [\n      \"Tenho os seguintes hor√°rios dispon√≠veis:\",\n      ...formatados,\n      \"Quais voc√™ prefere?\"\n    ].join(\"\\n\");\n  }\n});\n",
          "workflowId": {
            "__rl": true,
            "value": "t8OIthtzQCF1yBHA",
            "mode": "list",
            "cachedResultName": "DevTower"
          },
          "fields": {
            "values": [
              {
                "name": "Evento",
                "stringValue": "disponibilidade"
              },
              {
                "name": "periodo",
                "stringValue": "={{ $('Mensagem Completa1').item.json.mensagem_completa }}"
              }
            ]
          },
          "specifyInputSchema": true,
          "jsonSchemaExample": "{\n  \"horarios_disponiveis\": [\n    \"üìÖ Quarta-feira (05/06) √†s 09h\",\n    \"üìÖ Quarta-feira (05/06) √†s 09h30\"\n  ]\n}\n"
        },
        "id": "458e4326-88a0-48ea-9c19-e11928c7ede3",
        "name": "verificar_disponibilidade1",
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 1.2,
        "position": [
          7744,
          2832
        ],
        "alwaysOutputData": false
      },
      {
        "parameters": {
          "operation": "getAll",
          "calendar": {
            "__rl": true,
            "value": "e598b0c9eef217ebae69caabf7f9f17969e71c7551b3ea56caafea679433115d@group.calendar.google.com",
            "mode": "list",
            "cachedResultName": "Agendamentos Agentes IA"
          },
          "returnAll": true,
          "options": {
            "timeMin": "={{ $json.start }}",
            "timeMax": "={{ $json.end }}"
          }
        },
        "id": "408a1b65-1a2e-4c8e-9811-6e3f6f5803de",
        "name": "Get Eventos Agenda1",
        "type": "n8n-nodes-base.googleCalendar",
        "typeVersion": 1,
        "position": [
          6752,
          3696
        ],
        "alwaysOutputData": true,
        "notesInFlow": false
      },
      {
        "parameters": {
          "keepOnlySet": true,
          "values": {
            "string": [
              {
                "name": "horarios_disponiveis",
                "value": "={{$input.all().map(i => i.json.horario).join(', ')}}"
              }
            ]
          },
          "options": {}
        },
        "id": "365b40d8-5edd-4d3a-8a6b-e26c18963bd6",
        "name": "Formatar Sa√≠da1",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          7264,
          3712
        ]
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.limit",
        "typeVersion": 1,
        "position": [
          7504,
          3760
        ],
        "id": "55392986-951e-494a-ab3d-523389b6868e",
        "name": "Limit"
      },
      {
        "parameters": {
          "functionCode": "const startTime = new Date($node[\"Parse Date\"].json.start);\nconst endTime = new Date($node[\"Parse Date\"].json.end);\nconst MIN_BLOCK_MINUTES = 30;\n\n// Verifica se o Google Agenda retornou eventos\nconst isEmpty = !items || items.length === 0 || Object.keys(items[0].json).length === 0;\n\n// Se n√£o h√° eventos, o dia inteiro est√° livre\nconst eventosUnificados = [];\n\nif (!isEmpty) {\n  // Extrai e valida os eventos\n  const eventos = items.map(item => {\n    const startObj = item.json.start;\n    const endObj = item.json.end;\n\n    if (!startObj || !endObj) return null;\n\n    const start = new Date(startObj.dateTime || startObj.date);\n    const end = new Date(endObj.dateTime || endObj.date);\n\n    return start < end ? { start, end } : null;\n  }).filter(Boolean).sort((a, b) => a.start - b.start);\n\n  // Une eventos sobrepostos ou colados\n  for (const evento of eventos) {\n    if (\n      eventosUnificados.length === 0 ||\n      evento.start > eventosUnificados[eventosUnificados.length - 1].end\n    ) {\n      eventosUnificados.push({ ...evento });\n    } else {\n      const ultimo = eventosUnificados[eventosUnificados.length - 1];\n      ultimo.end = new Date(Math.max(ultimo.end.getTime(), evento.end.getTime()));\n    }\n  }\n}\n\n// Identifica intervalos livres\nconst livre = [];\n\nif (isEmpty) {\n  // Dia todo livre\n  livre.push({ inicio: new Date(startTime), fim: new Date(endTime) });\n} else {\n  let cursor = new Date(startTime);\n\n  for (const evento of eventosUnificados) {\n    if (evento.start > cursor) {\n      const diff = (evento.start - cursor) / (1000 * 60);\n      if (diff >= MIN_BLOCK_MINUTES) {\n        livre.push({ inicio: new Date(cursor), fim: new Date(evento.start) });\n      }\n    }\n    if (evento.end > cursor) cursor = new Date(evento.end);\n  }\n\n  // Tempo livre depois do √∫ltimo evento at√© o fim do dia\n  if (cursor < endTime) {\n    const diff = (endTime - cursor) / (1000 * 60);\n    if (diff >= MIN_BLOCK_MINUTES) {\n      livre.push({ inicio: new Date(cursor), fim: new Date(endTime) });\n    }\n  }\n}\n\n// Fun√ß√£o auxiliar para evitar colis√µes com eventos (caso eles existam)\nfunction slotColide(slotInicio, slotFim, eventos) {\n  return eventos.some(evento =>\n    slotInicio < evento.end && slotFim > evento.start\n  );\n}\n\n// Gera os slots de 30min\nconst slots = [];\n\nfor (const intervalo of livre) {\n  let slotStart = new Date(intervalo.inicio);\n  while (slotStart.getTime() + MIN_BLOCK_MINUTES * 60 * 1000 <= intervalo.fim.getTime()) {\n    const slotEnd = new Date(slotStart.getTime() + MIN_BLOCK_MINUTES * 60 * 1000);\n\n    // Verifica colis√£o apenas se houver eventos\n    if (isEmpty || !slotColide(slotStart, slotEnd, eventosUnificados)) {\n      slots.push({ inicio: new Date(slotStart), fim: new Date(slotEnd) });\n    }\n\n    slotStart = slotEnd;\n  }\n}\n\n// Formata os hor√°rios\nreturn slots.map(slot => {\n  const format = d => d.toTimeString().slice(0, 5);\n  return {\n    json: {\n      horario: `${format(slot.inicio)}‚Äì${format(slot.fim)}`\n    }\n  };\n});"
        },
        "id": "45134fbc-d5d3-4263-8023-c401ae522236",
        "name": "Gerar com eventos",
        "type": "n8n-nodes-base.function",
        "typeVersion": 1,
        "position": [
          7008,
          3760
        ]
      },
      {
        "parameters": {
          "content": "# Agendamento",
          "height": 80,
          "width": 283,
          "color": 5
        },
        "id": "147c29b7-6b1b-49a4-ac57-026962dea256",
        "name": "Sticky Note53",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          5968,
          3120
        ]
      },
      {
        "parameters": {
          "resource": "calendar",
          "calendar": {
            "__rl": true,
            "value": "e598b0c9eef217ebae69caabf7f9f17969e71c7551b3ea56caafea679433115d@group.calendar.google.com",
            "mode": "list",
            "cachedResultName": "Agendamentos Agentes IA"
          },
          "timeMin": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"query\"][\"start\"] }}",
          "timeMax": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"query\"][\"end\"] }}",
          "options": {}
        },
        "id": "03258301-3a10-4e84-b57d-c0db94ec377c",
        "name": "Disponibilidade4",
        "type": "n8n-nodes-base.googleCalendar",
        "typeVersion": 1.1,
        "position": [
          7184,
          3280
        ]
      },
      {
        "parameters": {
          "calendar": {
            "__rl": true,
            "value": "e598b0c9eef217ebae69caabf7f9f17969e71c7551b3ea56caafea679433115d@group.calendar.google.com",
            "mode": "list",
            "cachedResultName": "Agendamentos Agentes IA"
          },
          "start": "={{ $('Switch10').item.json.query.start }}",
          "end": "={{ $('Switch10').item.json.query.end }}",
          "additionalFields": {
            "attendees": [],
            "description": "={{ $('Execute Workflow Trigger').item.json.query.resumo_conversa }}",
            "summary": "=Atendimento para cliente {{ $('Switch10').item.json.query.nome }} - {{ $('Execute Workflow Trigger').item.json.whatsapp }}"
          }
        },
        "id": "8b42f054-23ee-4398-b9ce-190b4a0439f6",
        "name": "Marca2",
        "type": "n8n-nodes-base.googleCalendar",
        "typeVersion": 1.1,
        "position": [
          7632,
          3152
        ]
      },
      {
        "parameters": {
          "operation": "getAll",
          "calendar": {
            "__rl": true,
            "value": "e598b0c9eef217ebae69caabf7f9f17969e71c7551b3ea56caafea679433115d@group.calendar.google.com",
            "mode": "list",
            "cachedResultName": "Agendamentos Agentes IA"
          },
          "options": {
            "query": "={\n  \"q\": \"{{ $json[\"whatsapp\"] }}\"\n}"
          }
        },
        "id": "7721f83b-70c9-4c2b-aa9a-b49027d29e09",
        "name": "J√° tem um evento2",
        "type": "n8n-nodes-base.googleCalendar",
        "typeVersion": 1.1,
        "position": [
          6512,
          3136
        ],
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "operation": "delete",
          "calendar": {
            "__rl": true,
            "value": "e598b0c9eef217ebae69caabf7f9f17969e71c7551b3ea56caafea679433115d@group.calendar.google.com",
            "mode": "list",
            "cachedResultName": "Agendamentos Agentes IA"
          },
          "eventId": "={{ $item(\"0\").$node[\"Verifica evento4\"].json[\"id\"] }}",
          "options": {}
        },
        "id": "b8bb8417-ddcd-4b7a-a672-c2c895ade217",
        "name": "Google Calendar5",
        "type": "n8n-nodes-base.googleCalendar",
        "typeVersion": 1.1,
        "position": [
          6800,
          3376
        ]
      },
      {
        "parameters": {
          "operation": "update",
          "calendar": {
            "__rl": true,
            "value": "e598b0c9eef217ebae69caabf7f9f17969e71c7551b3ea56caafea679433115d@group.calendar.google.com",
            "mode": "list",
            "cachedResultName": "Agendamentos Agentes IA"
          },
          "eventId": "={{ $item(\"0\").$node[\"Verifica evento5\"].json[\"id\"] }}",
          "useDefaultReminders": false,
          "updateFields": {
            "end": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"query\"][\"end\"] }}",
            "sendUpdates": "all",
            "start": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"query\"][\"start\"] }}"
          }
        },
        "id": "1f0a680d-9ccf-4705-b9aa-c5460c373a9e",
        "name": "Google Calendar6",
        "type": "n8n-nodes-base.googleCalendar",
        "typeVersion": 1.1,
        "position": [
          7744,
          3536
        ]
      },
      {
        "parameters": {
          "operation": "getAll",
          "calendar": {
            "__rl": true,
            "value": "e598b0c9eef217ebae69caabf7f9f17969e71c7551b3ea56caafea679433115d@group.calendar.google.com",
            "mode": "list",
            "cachedResultName": "Agendamentos Agentes IA"
          },
          "returnAll": true,
          "options": {
            "query": "=Atendimento para cliente {{ $('Switch10').item.json.query.nome }} - {{ $('Execute Workflow Trigger').item.json.whatsapp }}"
          }
        },
        "id": "d1e8f44e-526f-417a-89d6-d56b9cd60804",
        "name": "Verifica evento4",
        "type": "n8n-nodes-base.googleCalendar",
        "typeVersion": 1.1,
        "position": [
          6528,
          3360
        ]
      },
      {
        "parameters": {
          "operation": "getAll",
          "calendar": {
            "__rl": true,
            "value": "e598b0c9eef217ebae69caabf7f9f17969e71c7551b3ea56caafea679433115d@group.calendar.google.com",
            "mode": "list",
            "cachedResultName": "Agendamentos Agentes IA"
          },
          "returnAll": true,
          "options": {
            "query": "={{ $item(\"0\").$node[\"Switch10\"].json[\"query\"][\"email\"] }}"
          }
        },
        "id": "22085f47-27f8-48de-b9fa-416f8b3ee2e8",
        "name": "Verifica evento5",
        "type": "n8n-nodes-base.googleCalendar",
        "typeVersion": 1.1,
        "position": [
          7488,
          3536
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "be5649a9-7624-4621-bd2d-84c25577c0ce",
                "leftValue": "={{ $json.available }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "a99373be-da3d-4eba-a2ae-fce7cde7e267",
        "name": "If13",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          7040,
          3600
        ]
      },
      {
        "parameters": {
          "resource": "calendar",
          "calendar": {
            "__rl": true,
            "value": "e598b0c9eef217ebae69caabf7f9f17969e71c7551b3ea56caafea679433115d@group.calendar.google.com",
            "mode": "list",
            "cachedResultName": "Agendamentos Agentes IA"
          },
          "timeMin": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"query\"][\"start\"] }}",
          "timeMax": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"query\"][\"end\"] }}",
          "options": {}
        },
        "id": "3668e0e9-9361-45d4-8103-798e172e80f1",
        "name": "Disponibilidade5",
        "type": "n8n-nodes-base.googleCalendar",
        "typeVersion": 1.1,
        "position": [
          6528,
          3552
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "86ff282a-3ede-4417-98c1-0d10858bc5dc",
                "name": "response",
                "value": "=Voc√™ j√° tem uma reuni√£o agendada para o dia: {{(() => { \n    const data = new Date($json.start.dateTime);\n    const opcoes = { day: '2-digit', month: 'long', hour: '2-digit', minute: '2-digit' };\n    return `dia ${data.toLocaleDateString('pt-BR', opcoes).replace(' ', ' de ').replace(',', ' √†s')}`;\n})()}} gostaria de reagendar? ",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "8a3e5d10-a1c2-446e-a12c-ade7617888e2",
        "name": "Edit Fields18",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          7024,
          3136
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "8d192ed0-aebd-404e-8339-daab0d29651f",
                "leftValue": "={{ $item(\"0\").$node[\"J√° tem um evento2\"].json[\"attendees\"][\"0\"][\"email\"] }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "345c9ef1-123f-48be-9780-2b2be8c9ee37",
        "name": "If14",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          6752,
          3152
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "7f842ffa-cd8f-40ab-a0a7-40dc173357a7",
                "name": "response",
                "value": "Informe o usu√°rio que o agendamento foi cancelado e que estar√° sempre √† disposi√ß√£o para um novo agendamento.",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "29c129f3-0505-4e4d-b070-f89210641002",
        "name": "Edit Fields19",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          7040,
          3392
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "04c6ca35-7572-4699-bcb7-bbf2f2a6e6a4",
                "name": "response",
                "value": "hor√°rio n√£o disponivel, pe√ßa outro hor√°rio",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "26477ede-60da-4d6c-9b60-47a218acd178",
        "name": "Edit Fields20",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          7632,
          3376
        ]
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"Evento\"] }}",
                      "rightValue": "agendamento",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "95f443a9-2c80-4a95-9a0a-4d83d16b85c3"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "agendamento"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "7a57e8e8-5227-4cde-8d58-7b447cd55a17",
                      "leftValue": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"Evento\"] }}",
                      "rightValue": "cancelamento",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "cancelamento"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "d788021f-29ab-41f2-b355-2b18963d30f2",
                      "leftValue": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"Evento\"] }}",
                      "rightValue": "reagendamento",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "reagendamento"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "2dfbfdb0-74bf-49b5-8ae0-da3de20e49e6",
                      "leftValue": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"Evento\"] }}",
                      "rightValue": "disponibilidade",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "disponibilidade"
              }
            ]
          },
          "options": {}
        },
        "id": "f638a067-c4f0-42aa-8fbf-f0b5af5d5657",
        "name": "Switch10",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          6112,
          3440
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "be5649a9-7624-4621-bd2d-84c25577c0ce",
                "leftValue": "={{ $json.available }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "2fd57c36-b10a-4ebe-b159-9c3510885e33",
        "name": "If15",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          7344,
          3152
        ]
      },
      {
        "parameters": {
          "name": "criar_reuniao",
          "description": "=Chame esta ferramenta ap√≥s o usu√°rio informar a data do agendamento e o hor√°rio.\n\nNa vari√°vel \"nome\", preencha com o nome do usu√°rio.\nNa vari√°vel \"whatsapp\", preencha com o n√∫mero do WhatsApp do usu√°rio.\n\nA data provavelmente ser√° informada no formato brasileiro (como \"10/06\" ou \"10 de junho\"), o que significa dia 10 do m√™s 6 (junho). Interprete sempre como **dd/mm/yyyy**, e n√£o mm/dd/yyyy.\n\nAp√≥s interpretar corretamente a data e o hor√°rio, converta para o formato:\n\nyyyy-mm-ddTHH:MM:00-03:00\n\nExemplo: \"10/06/2025 √†s 15h\" deve virar:\n\"2025-06-10T15:00:00-03:00\"\n\nEm seguida, adicione 30 minutos ao hor√°rio e preencha a vari√°vel \"end\" com o mesmo formato.",
          "workflowId": {
            "__rl": true,
            "value": "t8OIthtzQCF1yBHA",
            "mode": "list",
            "cachedResultName": "DevTower"
          },
          "fields": {
            "values": [
              {
                "name": "Evento",
                "stringValue": "agendamento"
              },
              {
                "name": "whatsapp",
                "stringValue": "={{ (() => { \n  const telefone = $('Dados').item.json.Telefone;\n  return 'wa.me/' + telefone.split('@')[0] + '';\n})() }}"
              }
            ]
          },
          "specifyInputSchema": true,
          "jsonSchemaExample": "{\n  \"nome\": \"J√∫nior\",\n  \"whatsapp\": \"554799653313\",\n  \"resumo_conversa\": \"Cliente solicitou troca de √≥leo para ve√≠culo √†s 15h.\",\n  \"start\": \"2025-06-10T15:00:00-03:00\",\n  \"end\": \"2025-06-10T15:30:00-03:00\"\n}"
        },
        "id": "884d34b5-8241-4466-8907-c799f608016f",
        "name": "criar_reuniao2",
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 1.2,
        "position": [
          7904,
          2864
        ]
      },
      {
        "parameters": {
          "name": "cancelar_reuniao",
          "description": "=Chame esta ferramenta ap√≥s o usu√°rio informar que quer cancelar a reuni√£o, utilize o whatsapp e nome\n\nNa vari√°vel \"nome\", voc√™ vai preencher o nome do usu√°rio e na variavel \"whatsapp\" voc√™ vai preencher com whatsapp do usu√°rio",
          "workflowId": {
            "__rl": true,
            "value": "t8OIthtzQCF1yBHA",
            "mode": "list",
            "cachedResultName": "DevTower"
          },
          "fields": {
            "values": [
              {
                "name": "Evento",
                "stringValue": "cancelamento"
              },
              {
                "name": "whatsapp",
                "stringValue": "={{ (() => { \n  const telefone = $('Dados').item.json.Telefone;\n  return 'wa.me/' + telefone.split('@')[0] + '';\n})() }}"
              }
            ]
          },
          "specifyInputSchema": true,
          "jsonSchemaExample": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"whatsapp\": {\n      \"type\": \"string\"\n    }\n  },\n  \"required\": [\"whatsapp\"]\n}"
        },
        "id": "2084a446-501f-4dd6-b9da-6c729455ec96",
        "name": "cancelar_reuniao2",
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 1.2,
        "position": [
          8224,
          2800
        ]
      },
      {
        "parameters": {
          "name": "reagendar_reuniao",
          "description": "=Ap√≥s o usu√°rio informar que quer reagendar o nome, whatsapp e nova data Chame esta tool\n\nNa vari√°vel \"nome\", voc√™ vai preencher o nome do usu√°rio e na variavel \"email\" voc√™ vai preencher com whatsapp do usu√°rio\n\nA data do agendamento voc√™ vai transformar para seguinte formato, exemplo: 2024-10-18T14:30:00-03:00 e vai preencher a variavel \"start\"\n\nEm seguida voc√™ vai inserir 30 minutos a mais depois no hor√°rio de agendamento e na variavel \"end\" voc√™ vai prencher com o horario no mesmo formato da variavel start",
          "workflowId": {
            "__rl": true,
            "value": "t8OIthtzQCF1yBHA",
            "mode": "list",
            "cachedResultName": "DevTower"
          },
          "fields": {
            "values": [
              {
                "name": "Evento",
                "stringValue": "reagendamento"
              },
              {
                "name": "Remotejid",
                "stringValue": "={{ $('Dados').item.json.NomeWpp }}"
              }
            ]
          },
          "specifyInputSchema": true,
          "jsonSchemaExample": "{\n  \"nome\": \"nome do usuario\",\n  \"whatsapp\": \"whatsapp do usuario\",\n  \"resumo_conversa\": \"crie um resumo especifico do problema\",\n  \"start\": \"data hora do inicio da reuni√£o\",\n  \"end\": \"data hora do fim da reuni√£o\"\n}\n"
        },
        "id": "bdfbea00-fabb-404d-a96d-c4a9c5e1af3d",
        "name": "reagendar_reuniao2",
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 1.2,
        "position": [
          8064,
          2864
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "86ff282a-3ede-4417-98c1-0d10858bc5dc",
                "name": "response",
                "value": "=Agendamento conclu√≠do para a data {{(() => { \n    const data = new Date($json.start.dateTime);\n    const opcoes = { day: '2-digit', month: 'long', hour: '2-digit', minute: '2-digit' };\n    return `dia ${data.toLocaleDateString('pt-BR', opcoes).replace(' ', ' de ').replace(',', ' √†s')}`;\n})()}}\no link da reuni√£o √©: {{ $json.hangoutLink }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "5d119329-34d0-423c-a41a-e6fae9bbacb1",
        "name": "Edit Fields21",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          7872,
          3264
        ]
      },
      {
        "parameters": {
          "content": "",
          "height": 800.6667333432747,
          "width": 2503.09595343677,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          5824,
          3104
        ],
        "typeVersion": 1,
        "id": "fafae79d-1e2e-4d42-af55-b5682f0a290f",
        "name": "Sticky Note60"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "7f842ffa-cd8f-40ab-a0a7-40dc173357a7",
                "name": "response",
                "value": "=sua reuni√£o foi reagendada para a data:{{(() => { \n    const data = new Date($json.start.dateTime);\n    const opcoes = { day: '2-digit', month: 'long', hour: '2-digit', minute: '2-digit' };\n    return `dia ${data.toLocaleDateString('pt-BR', opcoes).replace(' ', ' de ').replace(',', ' √†s')}`;\n})()}} o link da reuni√£o √©: {{ $json.hangoutLink }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "93cd5eca-9ae7-4554-812f-b9779e6f2be9",
        "name": "Edit Fields22",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          8048,
          3520
        ]
      },
      {
        "parameters": {
          "operation": "get",
          "tableId": "dados_cliente",
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "keyValue": "={{ $json.telefone }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          944,
          2544
        ],
        "id": "3ee61af3-6c5b-4d0d-8832-3d2d58aaed65",
        "name": "Supabase2",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "4a6d9aac-8565-4c58-abe3-8741393a5535",
                "leftValue": "={{ $json.telefone }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "exists",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          1152,
          2416
        ],
        "id": "ffe6c085-6c73-43bc-b186-367541f9f62f",
        "name": "If16"
      },
      {
        "parameters": {
          "tableId": "dados_cliente",
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "nomewpp",
                "fieldValue": "={{ $('Buscar Lead Prospec√ß√£o').item.json.nome }}"
              },
              {
                "fieldId": "telefone",
                "fieldValue": "={{ $('Buscar Lead Prospec√ß√£o').item.json.telefone }}"
              },
              {
                "fieldId": "created_at",
                "fieldValue": "={{ $now}}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          1344,
          2512
        ],
        "id": "3ee1f934-06f7-4236-9b77-f11750a17aff",
        "name": "Supabase5"
      },
      {
        "parameters": {
          "name": "verificar_disponibilidade",
          "description": "=tool({\n  name: \"verificar_disponibilidade\",\n  description: \"Consulta hor√°rios livres reais na agenda (segunda a sexta, das 08h √†s 18h, com intervalos de 30 minutos). Aceita per√≠odos como 'amanh√£', 'pr√≥xima semana' ou uma data no formato 'YYYY-MM-DD'. Caso n√£o informe nada, retorna os dois hor√°rios dispon√≠veis mais pr√≥ximos.\",\n  parameters: {\n    dia: {\n      type: \"string\",\n      required: false,\n      description: \"Dia desejado para agendamento: 'amanh√£', 'pr√≥xima semana' ou data no formato YYYY-MM-DD.\"\n    },\n    periodo: {\n      type: \"string\",\n      required: false,\n      enum: [\"manha\", \"tarde\"],\n      description: \"Per√≠odo do dia preferido: 'manha' ou 'tarde'.\"\n    }\n  },\n  run: async ({ dia, periodo }) => {\n    const periodoTexto = (dia || \"amanh√£\").toLowerCase().trim();\n\n    const resultado = await callWorkflow(\"verificar_disponibilidade\", {\n      periodo: periodoTexto\n    });\n\n    const todosHorarios = resultado.horarios_disponiveis\n      ? resultado.horarios_disponiveis.split(\",\").map(h => h.trim())\n      : [];\n\n    // Filtro opcional por per√≠odo\n    let selecionados = todosHorarios;\n    if (periodo === \"manha\" || periodo === \"tarde\") {\n      selecionados = todosHorarios.filter(horario => {\n        const hora = parseInt(horario.slice(0, 2), 10);\n        return periodo === \"manha\" ? hora < 12 : hora >= 12;\n      });\n    }\n\n    const formatarHorario = (horarioStr) => {\n      const [hora, minuto] = horarioStr.split(\"‚Äì\")[0].split(\":\").map(Number);\n      const hoje = new Date();\n      const dataBase = new Date(hoje);\n      if (dia && /^\\d{4}-\\d{2}-\\d{2}$/.test(dia)) {\n        dataBase.setTime(new Date(dia).getTime());\n      } else if (periodoTexto.includes(\"semana\")) {\n        dataBase.setDate(hoje.getDate() + 7);\n      } else if (periodoTexto.includes(\"amanh√£\")) {\n        dataBase.setDate(hoje.getDate() + 1);\n      }\n\n      dataBase.setHours(hora, minuto, 0, 0);\n\n      const dias = [\"Domingo\", \"Segunda-feira\", \"Ter√ßa-feira\", \"Quarta-feira\", \"Quinta-feira\", \"Sexta-feira\", \"S√°bado\"];\n      const diaSemana = dias[dataBase.getDay()];\n      const diaStr = String(dataBase.getDate()).padStart(2, '0');\n      const mesStr = String(dataBase.getMonth() + 1).padStart(2, '0');\n      const horaStr = `${hora}h${minuto > 0 ? String(minuto).padStart(2, '0') : ''}`;\n\n      return `üìÖ ${diaSemana} (${diaStr}/${mesStr}) √†s ${horaStr}`;\n    };\n\n    const formatados = selecionados.slice(0, 2).map(formatarHorario);\n\n    return [\n      \"Tenho os seguintes hor√°rios dispon√≠veis:\",\n      ...formatados,\n      \"Quais voc√™ prefere?\"\n    ].join(\"\\n\");\n  }\n});\n",
          "workflowId": {
            "__rl": true,
            "value": "t8OIthtzQCF1yBHA",
            "mode": "list",
            "cachedResultName": "DevTower"
          },
          "fields": {
            "values": [
              {
                "name": "Evento",
                "stringValue": "disponibilidade"
              },
              {
                "name": "periodo",
                "stringValue": "={{ $('Mensagem Completa').item.json.mensagem_completa }}"
              }
            ]
          },
          "specifyInputSchema": true,
          "jsonSchemaExample": "{\n  \"horarios_disponiveis\": [\n    \"üìÖ Quarta-feira (05/06) √†s 09h\",\n    \"üìÖ Quarta-feira (05/06) √†s 09h30\"\n  ]\n}\n"
        },
        "id": "1c4f5157-738c-4096-8070-cee3e12a6e21",
        "name": "verificar_disponibilidade",
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 1.2,
        "position": [
          7760,
          4704
        ],
        "alwaysOutputData": false
      },
      {
        "parameters": {
          "name": "criar_reuniao",
          "description": "=Chame esta ferramenta ap√≥s o usu√°rio informar a data do agendamento e o hor√°rio.\n\nNa vari√°vel \"nome\", preencha com o nome do usu√°rio.\nNa vari√°vel \"whatsapp\", preencha com o n√∫mero do WhatsApp do usu√°rio.\n\nA data provavelmente ser√° informada no formato brasileiro (como \"10/06\" ou \"10 de junho\"), o que significa dia 10 do m√™s 6 (junho). Interprete sempre como **dd/mm/yyyy**, e n√£o mm/dd/yyyy.\n\nAp√≥s interpretar corretamente a data e o hor√°rio, converta para o formato:\n\nyyyy-mm-ddTHH:MM:00-03:00\n\nExemplo: \"10/06/2025 √†s 15h\" deve virar:\n\"2025-06-10T15:00:00-03:00\"\n\nEm seguida, adicione 30 minutos ao hor√°rio e preencha a vari√°vel \"end\" com o mesmo formato.",
          "workflowId": {
            "__rl": true,
            "value": "t8OIthtzQCF1yBHA",
            "mode": "list",
            "cachedResultName": "DevTower"
          },
          "fields": {
            "values": [
              {
                "name": "Evento",
                "stringValue": "agendamento"
              },
              {
                "name": "whatsapp",
                "stringValue": "={{ (() => { \n  const telefone = $('Dados').item.json.Telefone;\n  return 'wa.me/' + telefone.split('@')[0] + '';\n})() }}"
              }
            ]
          },
          "specifyInputSchema": true,
          "jsonSchemaExample": "{\n  \"nome\": \"J√∫nior\",\n  \"whatsapp\": \"554799653313\",\n  \"resumo_conversa\": \"Cliente solicitou troca de √≥leo para ve√≠culo √†s 15h.\",\n  \"start\": \"2025-06-10T15:00:00-03:00\",\n  \"end\": \"2025-06-10T15:30:00-03:00\"\n}"
        },
        "id": "9556685c-a3be-4e09-a070-ef2258cdcc92",
        "name": "criar_reuniao3",
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 1.2,
        "position": [
          7920,
          4704
        ]
      },
      {
        "parameters": {
          "name": "cancelar_reuniao",
          "description": "=Chame esta ferramenta ap√≥s o usu√°rio informar que quer cancelar a reuni√£o, utilize o whatsapp e nome\n\nNa vari√°vel \"nome\", voc√™ vai preencher o nome do usu√°rio e na variavel \"whatsapp\" voc√™ vai preencher com whatsapp do usu√°rio",
          "workflowId": {
            "__rl": true,
            "value": "t8OIthtzQCF1yBHA",
            "mode": "list",
            "cachedResultName": "DevTower"
          },
          "fields": {
            "values": [
              {
                "name": "Evento",
                "stringValue": "cancelamento"
              },
              {
                "name": "whatsapp",
                "stringValue": "={{ (() => { \n  const telefone = $('Dados').item.json.Telefone;\n  return 'wa.me/' + telefone.split('@')[0] + '';\n})() }}"
              }
            ]
          },
          "specifyInputSchema": true,
          "jsonSchemaExample": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"whatsapp\": {\n      \"type\": \"string\"\n    }\n  },\n  \"required\": [\"whatsapp\"]\n}"
        },
        "id": "a95c6764-5310-4f58-8e07-b4d4e6995cf3",
        "name": "cancelar_reuniao3",
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 1.2,
        "position": [
          8240,
          4704
        ]
      },
      {
        "parameters": {
          "name": "reagendar_reuniao",
          "description": "=Ap√≥s o usu√°rio informar que quer reagendar o nome, whatsapp e nova data Chame esta tool\n\nNa vari√°vel \"nome\", voc√™ vai preencher o nome do usu√°rio e na variavel \"email\" voc√™ vai preencher com whatsapp do usu√°rio\n\nA data do agendamento voc√™ vai transformar para seguinte formato, exemplo: 2024-10-18T14:30:00-03:00 e vai preencher a variavel \"start\"\n\nEm seguida voc√™ vai inserir 30 minutos a mais depois no hor√°rio de agendamento e na variavel \"end\" voc√™ vai prencher com o horario no mesmo formato da variavel start",
          "workflowId": {
            "__rl": true,
            "value": "t8OIthtzQCF1yBHA",
            "mode": "list",
            "cachedResultName": "DevTower"
          },
          "fields": {
            "values": [
              {
                "name": "Evento",
                "stringValue": "reagendamento"
              },
              {
                "name": "Remotejid",
                "stringValue": "={{ $('Dados').item.json.NomeWpp }}"
              }
            ]
          },
          "specifyInputSchema": true,
          "jsonSchemaExample": "{\n  \"nome\": \"nome do usuario\",\n  \"whatsapp\": \"whatsapp do usuario\",\n  \"resumo_conversa\": \"crie um resumo especifico do problema\",\n  \"start\": \"data hora do inicio da reuni√£o\",\n  \"end\": \"data hora do fim da reuni√£o\"\n}\n"
        },
        "id": "f7b6c3e7-0d20-491e-b82a-84def096309e",
        "name": "reagendar_reuniao3",
        "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "typeVersion": 1.2,
        "position": [
          8080,
          4704
        ]
      },
      {
        "parameters": {
          "functionCode": "const normalize = (str) =>\n  str.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '').replace(/[^\\w\\s/-]/g, '').toLowerCase();\n\nconst input = normalize($json.periodo || '');\nconst now = new Date();\n\nlet start = new Date();\nlet end = new Date();\n\nconst weekdays = {\n  segunda: 1,\n  terca: 2,\n  quarta: 3,\n  quinta: 4,\n  sexta: 5,\n  sabado: 6,\n  domingo: 0\n};\n\n// ======== 1. Determina o DIA ========\nif (input.includes('hoje')) {\n  // j√° est√° com a data de hoje\n} else if (input.includes('amanha')) {\n  start.setDate(now.getDate() + 1);\n} else if (input.includes('depois de amanha')) {\n  start.setDate(now.getDate() + 2);\n} else if (input.includes('proxima semana') || input.includes('semana que vem')) {\n  // segunda a domingo da pr√≥xima semana\n  const day = now.getDay();\n  const diff = 7 - day + 1; // pr√≥xima segunda\n  start.setDate(now.getDate() + diff);\n  end = new Date(start);\n  end.setDate(start.getDate() + 6);\n  start.setHours(8, 0, 0, 0);\n  end.setHours(18, 0, 0, 0);\n  return [{ json: { start: start.toISOString(), end: end.toISOString() } }];\n} else {\n  // Detectar dias da semana\n  for (const [dia, numero] of Object.entries(weekdays)) {\n    if (input.includes(dia)) {\n      const currentDay = now.getDay();\n      let daysToAdd = (numero - currentDay + 7) % 7;\n      daysToAdd = daysToAdd === 0 ? 7 : daysToAdd; // garante \"pr√≥xima segunda\" se hoje j√° for segunda\n      start.setDate(now.getDate() + daysToAdd);\n      break;\n    }\n  }\n\n  // Detectar datas exatas (YYYY-MM-DD ou DD/MM/YYYY)\n  const matchISO = input.match(/\\d{4}-\\d{2}-\\d{2}/);\n  const matchBR = input.match(/\\b(\\d{2})\\/(\\d{2})\\/(\\d{4})\\b/);\n  if (matchISO) {\n    start = new Date(matchISO[0]);\n  } else if (matchBR) {\n    const [_, d, m, y] = matchBR;\n    start = new Date(`${y}-${m}-${d}`);\n  }\n}\n\nend = new Date(start); // come√ßa com mesmo dia\n\n// ======== 2. Determina o PER√çODO DO DIA ========\nif (input.includes('manha')) {\n  start.setHours(8, 0, 0, 0);\n  end.setHours(12, 0, 0, 0);\n} else if (input.includes('tarde')) {\n  start.setHours(13, 0, 0, 0);\n  end.setHours(17, 0, 0, 0);\n} else if (input.includes('noite')) {\n  start.setHours(18, 0, 0, 0);\n  end.setHours(21, 0, 0, 0);\n} else {\n  // per√≠odo integral do expediente\n  start.setHours(8, 0, 0, 0);\n  end.setHours(18, 0, 0, 0);\n}\n\nreturn [{ json: { start: start.toISOString(), end: end.toISOString() } }];\n"
        },
        "id": "758b28f4-c5dc-466d-b04f-1606695be950",
        "name": "Parse Date",
        "type": "n8n-nodes-base.function",
        "typeVersion": 1,
        "position": [
          6480,
          3744
        ]
      },
      {
        "parameters": {
          "functionCode": "function formatarHorarioCompleto(horario, dataReferencia) {\n  const [hora, minuto] = horario.split(\"‚Äì\")[0].split(\":\");\n  const data = new Date(dataReferencia);\n  data.setHours(parseInt(hora), parseInt(minuto), 0, 0);\n\n  const dias = [\"Domingo\", \"Segunda-feira\", \"Ter√ßa-feira\", \"Quarta-feira\", \"Quinta-feira\", \"Sexta-feira\", \"S√°bado\"];\n  const diaSemana = dias[data.getDay()];\n  const dia = String(data.getDate()).padStart(2, '0');\n  const mes = String(data.getMonth() + 1).padStart(2, '0');\n  const horaFormatada = `${data.getHours()}h${data.getMinutes() > 0 ? data.getMinutes().toString().padStart(2, '0') : ''}`;\n\n  return `üìÖ ${diaSemana} (${dia}/${mes}) √†s ${horaFormatada}`;\n}\n\n// Pega os hor√°rios (string ou array)\nconst rawHorarios = $json.horarios_disponiveis;\nconst horarios = typeof rawHorarios === 'string'\n  ? rawHorarios.split(',').map(h => h.trim())\n  : Array.isArray(rawHorarios)\n    ? rawHorarios\n    : [];\n\nconst dataReferencia = new Date($node[\"Parse Date\"].json.start || new Date());\nconst agora = new Date();\n\n// ‚ö†Ô∏è Verifica se √© s√°bado (6) ou domingo (0)\nconst diaSemana = dataReferencia.getDay();\nif (diaSemana === 6 || diaSemana === 0) {\n  return [\n    {\n      json: {\n        mensagem_final: \"‚ö†Ô∏è N√£o temos atendimento nos finais de semana. A oficina funciona de segunda a sexta, das 08h √†s 18h.\"\n      }\n    }\n  ];\n}\n\n// Filtra hor√°rios que ainda n√£o passaram\nconst horariosFuturos = horarios.filter(horario => {\n  const [hora, minuto] = horario.split(\"‚Äì\")[0].split(\":\");\n  const dataHorario = new Date(dataReferencia);\n  dataHorario.setHours(parseInt(hora), parseInt(minuto), 0, 0);\n  return dataHorario >= agora;\n});\n\n// Pega at√© dois hor√°rios futuros\nconst doisHorarios = horariosFuturos.slice(0, 2).map(h => formatarHorarioCompleto(h, dataReferencia));\n\n// Mensagem final formatada com \\\\n\nconst mensagem = [\n  \"Tenho os seguintes hor√°rios dispon√≠veis:\",\n  ...doisHorarios,\n  \"Qual voc√™ prefere?\"\n].join(\"\\\\n\");\n\nreturn [\n  {\n    json: {\n      mensagem_final: mensagem\n    }\n  }\n];\n"
        },
        "name": "Formatar hor√°rios",
        "type": "n8n-nodes-base.function",
        "typeVersion": 1,
        "position": [
          7760,
          3744
        ],
        "id": "a164c471-53db-4032-8f07-b13367e60193"
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "",
          "options": {}
        },
        "id": "27773636-6a34-4e6b-804b-44476dcf666f",
        "name": "Responder",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          8048,
          3712
        ]
      },
      {
        "parameters": {
          "toolDescription": "Envia um v√≠deo explicativo da automa√ß√£o via WhatsApp",
          "method": "POST",
          "url": "https://webhook.devtower.online/webhook/mcmcnffhssdk",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"numero\": \"{{ $('Webhook EVO').item.json.body.data.key.remoteJid }}\"\n}\n",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequestTool",
        "typeVersion": 4.2,
        "position": [
          8224,
          2592
        ],
        "id": "3ccc3462-00f0-401a-b4de-50d9c5f07b2c",
        "name": "enviar_video"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "mcmcnffhssdk",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          6832,
          1840
        ],
        "id": "9bf7a4cc-6491-4bdc-b49b-bb0d0cfbb7ac",
        "name": "Webhook",
        "webhookId": "e3f1afb7-6a3b-4270-806b-78adb3f34ef9"
      },
      {
        "parameters": {
          "resource": "messages-api",
          "operation": "send-video",
          "instanceName": "DevTower",
          "remoteJid": "={{ $json.body.numero }}",
          "media": "=link",
          "options_message": {
            "delay": 10000
          }
        },
        "type": "n8n-nodes-evolution-api.evolutionApi",
        "typeVersion": 1,
        "position": [
          7072,
          1840
        ],
        "id": "7a57eb96-460d-46a5-956e-c3dbee23f222",
        "name": "Evolution API6",
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "content": "",
          "height": 341,
          "width": 1023,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          6704,
          1680
        ],
        "typeVersion": 1,
        "id": "d1dd3dda-98ef-43fd-bda6-3a79cfed9d43",
        "name": "Sticky Note61"
      },
      {
        "parameters": {
          "content": "# V√≠deo Whatsapp Oficinas",
          "height": 80,
          "width": 563,
          "color": 5
        },
        "id": "9fe45b66-1af2-4664-88cd-58af20205f75",
        "name": "Sticky Note62",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          6752,
          1696
        ]
      },
      {
        "parameters": {
          "operation": "update",
          "tableId": "Prospec√ß√£o",
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "condition": "eq",
                "keyValue": "={{ $json.data.key.remoteJid }}"
              }
            ]
          },
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "status",
                "fieldValue": "video_enviado"
              },
              {
                "fieldId": "ultima_interacao",
                "fieldValue": "={{ $now }}"
              }
            ]
          }
        },
        "name": "Atualizar Status1",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          7280,
          1824
        ],
        "id": "38ec9deb-3617-442b-ac50-85764612d6dd"
      },
      {
        "parameters": {
          "operation": "update",
          "tableId": "Prospec√ß√£o",
          "filters": {
            "conditions": [
              {
                "keyName": "telefone",
                "condition": "eq",
                "keyValue": "={{ $('Execute Workflow Trigger').item.json.whatsapp }}"
              }
            ]
          },
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "status",
                "fieldValue": "apresentacao_agendada"
              },
              {
                "fieldId": "ultima_interacao",
                "fieldValue": "={{ $now }}"
              }
            ]
          }
        },
        "name": "Atualizar Status2",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          8080,
          3200
        ],
        "id": "6b7c9661-4230-4f05-993c-9bd66910db18"
      },
      {
        "parameters": {
          "triggerTimes": {
            "item": [
              {
                "hour": 7
              }
            ]
          }
        },
        "name": "Cron planilha",
        "type": "n8n-nodes-base.cron",
        "typeVersion": 1,
        "position": [
          464,
          1872
        ],
        "id": "250d5c88-ac89-4c06-9b7d-9691b15077f2"
      },
      {
        "parameters": {
          "contextWindowLength": 50
        },
        "id": "6091ab53-99cc-4c90-9208-8a157079a66e",
        "name": "Mem√≥ria",
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "position": [
          1008,
          1280
        ],
        "typeVersion": 1.3,
        "notes": "TEMPLATE DESENVOLVIDO POR RODRIGO ALVES\nwww.youtube.com/@rodrigoalveslps?sub_confirmation=1\n\nCOMUNIDADE PRODUZIMOS IA WHATSAPP\nhttps://chat.whatsapp.com/DCXhD8UTjPaAXigl6Q5zmk\n\nCURSO M√ÅQUINA DE AGENTES IA E AUTOMA√á√ïES\nhttps://checkout.produzimosia.com/OE11373AF"
      },
      {
        "parameters": {
          "url": "https://local-business-search.p.rapidapi.com/search",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "query",
                "value": "={{ $('Webhook1').item.json.body.termo_de_busca }}"
              },
              {
                "name": "limit",
                "value": "120"
              },
              {
                "name": "language",
                "value": "PT"
              },
              {
                "name": "region",
                "value": "br"
              },
              {
                "name": "extract_emails_and_contacts",
                "value": "true"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "x-rapidapi-host",
                "value": "local-business-search.p.rapidapi.com"
              },
              {
                "name": "x-rapidapi-key",
                "value": "=SUA CHAVE AQUI"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          752,
          1456
        ],
        "id": "150c24d5-0e0c-47e6-ac9c-4cf8dbb0d445",
        "name": "rapidapi_local-business-search",
        "notes": "TEMPLATE DESENVOLVIDO POR RODRIGO ALVES\nwww.youtube.com/@rodrigoalveslps?sub_confirmation=1\n\nCOMUNIDADE PRODUZIMOS IA WHATSAPP\nhttps://chat.whatsapp.com/DCXhD8UTjPaAXigl6Q5zmk\n\nCURSO M√ÅQUINA DE AGENTES IA E AUTOMA√á√ïES\nhttps://checkout.produzimosia.com/OE11373AF"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "1g0IJPaROsWYEmFHipYZK9fouAEHYY0Ec7hZXJ2831uk",
            "mode": "list",
            "cachedResultName": "Analise de Atendimento",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g0IJPaROsWYEmFHipYZK9fouAEHYY0Ec7hZXJ2831uk/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1511455453,
            "mode": "list",
            "cachedResultName": "pagina1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g0IJPaROsWYEmFHipYZK9fouAEHYY0Ec7hZXJ2831uk/edit#gid=1511455453"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Nome": "={{ $json.name }}",
              "N√∫mero": "={{ $json.phone_number }}",
              "Ramo": "mecanica",
              "Telefone": "={{ \"55\" + $json.phone_number.replace(/\\D/g,\"\").replace(/^55/,\"\").replace(/^(\\d{2})9(\\d{8})$/, \"$1$2\") + \"@s.whatsapp.net\" }}",
              "Observa√ß√£o (opcional)": "={{ $json.full_address }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "Nome",
                "displayName": "Nome",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "N√∫mero",
                "displayName": "N√∫mero",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Telefone",
                "displayName": "Telefone",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Ramo",
                "displayName": "Ramo",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Observa√ß√£o (opcional)",
                "displayName": "Observa√ß√£o (opcional)",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.6,
        "position": [
          1264,
          1456
        ],
        "id": "d48f3880-1917-4a3a-89f6-8df9e84d95d9",
        "name": "inclui_dados_planilha",
        "alwaysOutputData": true,
        "onError": "continueRegularOutput",
        "notes": "TEMPLATE DESENVOLVIDO POR RODRIGO ALVES\nwww.youtube.com/@rodrigoalveslps?sub_confirmation=1\n\nCOMUNIDADE PRODUZIMOS IA WHATSAPP\nhttps://chat.whatsapp.com/DCXhD8UTjPaAXigl6Q5zmk\n\nCURSO M√ÅQUINA DE AGENTES IA E AUTOMA√á√ïES\nhttps://checkout.produzimosia.com/OE11373AF"
      },
      {
        "parameters": {
          "options": {
            "systemMessage": "=Prompt do Agente de Prospec√ß√£o de Neg√≥cios\n\nIDENTIDADE E MISS√ÉO\nVoc√™ √© um assistente especializado em prospec√ß√£o de neg√≥cios. Sua fun√ß√£o principal √© interpretar solicita√ß√µes de usu√°rios sobre informa√ß√µes de empresas e neg√≥cios e acionar a ferramenta pega\\_dados\\_dos\\_negocios para coletar esses dados automaticamente em uma planilha.\n\nFERRAMENTA DISPON√çVEL\nNome: pega\\_dados\\_dos\\_negocios\nPar√¢metro obrigat√≥rio: termo\\_de\\_busca\nDescri√ß√£o: string no formato \"\\[O que voc√™ busca] em \\[Cidade], \\[Pa√≠s/Estado]\". O termo pode ser escrito em portugu√™s ou em ingl√™s.\n\nDESCRI√á√ÉO DETALHADA DE termo\\_de\\_busca\nO campo termo\\_de\\_busca √© utilizado para encontrar informa√ß√µes sobre estabelecimentos ou servi√ßos em uma localidade espec√≠fica. O texto pode estar em portugu√™s ou em ingl√™s e deve seguir esta estrutura:\n\\[O que voc√™ busca] em \\[Cidade], \\[Pa√≠s/Estado]\n\n* \\[O que voc√™ busca]: tipo de servi√ßo ou estabelecimento (ex.: Hot√©is, Restaurantes, Museus).\n* em: palavra fixa \"em\" (ou \"in\", se preferir ingl√™s).\n* \\[Cidade], \\[Pa√≠s/Estado]: nome da cidade e do pa√≠s ou estado.\n\nEXEMPLOS R√ÅPIDOS\nInten√ß√£o: Hot√©is em S√£o Francisco, EUA      -> termo\\_de\\_busca: Hot√©is em S√£o Francisco, EUA\nInten√ß√£o: Farm√°cias em Rio de Janeiro       -> termo\\_de\\_busca: Farm√°cias em Rio de Janeiro, Brasil\nInten√ß√£o: Restaurantes japoneses em S√£o Paulo -> termo\\_de\\_busca: Restaurantes japoneses em S√£o Paulo, Brasil\nInten√ß√£o: Aeroportos em Londres             -> termo\\_de\\_busca: Aeroportos em Londres, Reino Unido\n\nRESPONSABILIDADES PRINCIPAIS\n\n1. Interpretar solicita√ß√µes: identificar tipo de neg√≥cio, localiza√ß√£o e filtros.\n2. Construir o termo\\_de\\_busca: montar a string no formato exigido, em portugu√™s ou ingl√™s conforme necess√°rio.\n3. Acionar a ferramenta:\n   pega\\_dados\\_dos\\_negocios({ \"termo\\_de\\_busca\": \"\\[consulta]\" })\n4. Confirmar execu√ß√£o: informar ao usu√°rio que os dados foram coletados e adicionados √† planilha.\n\nDIRETRIZES DE COMPORTAMENTO\nAo receber uma solicita√ß√£o:\n\n* Identificar os elementos‚Äëchave.\n* Normalizar os termos e montar o termo\\_de\\_busca no formato correto.\n* Chamar a ferramenta e responder de forma concisa ao usu√°rio.\n\nFORMATO DA RESPOSTA AO USU√ÅRIO\n\n* Confirmar o que foi solicitado.\n* Informar que a busca foi realizada e que os dados est√£o na planilha.\n\nEXEMPLOS DE INTERA√á√ÉO\nExemplo 1\nUsu√°rio: \"Quero informa√ß√µes sobre cl√≠nicas m√©dicas no Rio de Janeiro\".\nAgente:\ntermo\\_de\\_busca: Cl√≠nicas m√©dicas em Rio de Janeiro, Brasil\nChamada: pega\\_dados\\_dos\\_negocios({ \"termo\\_de\\_busca\": \"Cl√≠nicas m√©dicas em Rio de Janeiro, Brasil\" })\nResposta: Busquei e coletei informa√ß√µes sobre cl√≠nicas m√©dicas no Rio de Janeiro. Os dados j√° foram adicionados √† sua planilha de prospec√ß√£o.\n\nExemplo 2\nUsu√°rio: \"Preciso de dados de restaurantes japoneses em S√£o Paulo\".\nAgente:\ntermo\\_de\\_busca: Restaurantes japoneses em S√£o Paulo, Brasil\nChamada: pega\\_dados\\_dos\\_negocios({ \"termo\\_de\\_busca\": \"Restaurantes japoneses em S√£o Paulo, Brasil\" })\nResposta: Coletei informa√ß√µes sobre restaurantes japoneses em S√£o Paulo. Todos os dados foram inseridos na planilha.\n\nExemplo 3\nUsu√°rio: \"Me ajuda a encontrar escrit√≥rios de advocacia especializados em direito trabalhista na Zona Sul do Rio\".\nAgente:\ntermo\\_de\\_busca: Escrit√≥rios de advocacia trabalhista em Zona Sul Rio de Janeiro, Brasil\nChamada: pega\\_dados\\_dos\\_negocios({ \"termo\\_de\\_busca\": \"Escrit√≥rios de advocacia trabalhista em Zona Sul Rio de Janeiro, Brasil\" })\nResposta: Busquei escrit√≥rios de advocacia especializados em direito trabalhista na Zona Sul do Rio de Janeiro. As informa√ß√µes j√° est√£o dispon√≠veis na sua planilha.\n\nTRATAMENTO DE CASOS ESPECIAIS\nSolicita√ß√µes amb√≠guas: pedir esclarecimentos.\nM√∫ltiplas localiza√ß√µes: executar buscas separadas e avisar o usu√°rio.\nSegmentos amplos: sugerir refinamentos.\n\nRESPOSTAS PADR√ÉO\nAp√≥s coleta bem‚Äësucedida: \"Coletei as informa√ß√µes sobre \\[busca] em \\[local]. Os dados j√° foram adicionados √† sua planilha de prospec√ß√£o.\"\nQuando precisar de esclarecimentos: \"Para garantir que eu colete as informa√ß√µes mais relevantes, poderia especificar \\[informa√ß√£o faltante]?\"\nPara confirma√ß√£o: \"Entendi que voc√™ precisa de dados sobre \\[busca] em \\[local]. Vou coletar essas informa√ß√µes agora.\"\n\nPRINC√çPIOS IMPORTANTES\n\n* Proatividade: deduzir inten√ß√µes com informa√ß√µes incompletas quando poss√≠vel.\n* Precis√£o: usar o formato exato de termo\\_de\\_busca.\n* Concis√£o: confirmar a a√ß√£o sem explica√ß√µes desnecess√°rias.\n* Confiabilidade: sempre confirmar quando os dados forem adicionados.\n\nLIMITA√á√ïES\n\n* N√£o fornecer os dados diretamente na conversa.\n* N√£o analisar nem interpretar os dados coletados.\n* N√£o sugerir estrat√©gias de prospec√ß√£o.\n* Focar apenas em coletar e confirmar a inser√ß√£o dos dados na planilha.\n\nLembre-se: Voc√™ √© a ponte entre a solicita√ß√£o do usu√°rio e a coleta automatizada de dados. Interprete corretamente, construa o termo\\_de\\_busca e acione a ferramenta com precis√£o.\n"
          }
        },
        "id": "27a3ad74-6091-4d1a-baa9-294f9161f901",
        "name": "Agente IA",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "position": [
          928,
          1072
        ],
        "typeVersion": 1.8,
        "notes": "TEMPLATE DESENVOLVIDO POR RODRIGO ALVES\nwww.youtube.com/@rodrigoalveslps?sub_confirmation=1\n\nCOMUNIDADE PRODUZIMOS IA WHATSAPP\nhttps://chat.whatsapp.com/DCXhD8UTjPaAXigl6Q5zmk\n\nCURSO M√ÅQUINA DE AGENTES IA E AUTOMA√á√ïES\nhttps://checkout.produzimosia.com/OE11373AF"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          1344,
          1072
        ],
        "id": "08b5fbaa-e0ee-486f-a79b-2a5e8e5f506c",
        "name": "Fim2"
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "42c5df71-5ce6-4746-90fc-4b197f51b873",
        "name": "Solicitar leads",
        "type": "@n8n/n8n-nodes-langchain.chatTrigger",
        "position": [
          688,
          1072
        ],
        "webhookId": "1fc494f1-781c-4f54-b3fc-d14132ad2ca6",
        "typeVersion": 1.1,
        "notes": "TEMPLATE DESENVOLVIDO POR RODRIGO ALVES\nwww.youtube.com/@rodrigoalveslps?sub_confirmation=1\n\nCOMUNIDADE PRODUZIMOS IA WHATSAPP\nhttps://chat.whatsapp.com/DCXhD8UTjPaAXigl6Q5zmk\n\nCURSO M√ÅQUINA DE AGENTES IA E AUTOMA√á√ïES\nhttps://checkout.produzimosia.com/OE11373AF",
        "disabled": true
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-4.1-mini",
            "mode": "list",
            "cachedResultName": "gpt-4.1-mini"
          },
          "options": {}
        },
        "id": "d8e7310d-06a4-4c7d-af6b-548ecdaac241",
        "name": "Modelo de Linguagem",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "position": [
          848,
          1264
        ],
        "typeVersion": 1.2,
        "notes": "TEMPLATE DESENVOLVIDO POR RODRIGO ALVES\nwww.youtube.com/@rodrigoalveslps?sub_confirmation=1\n\nCOMUNIDADE PRODUZIMOS IA WHATSAPP\nhttps://chat.whatsapp.com/DCXhD8UTjPaAXigl6Q5zmk\n\nCURSO M√ÅQUINA DE AGENTES IA E AUTOMA√á√ïES\nhttps://checkout.produzimosia.com/OE11373AF"
      },
      {
        "parameters": {
          "toolDescription": "Busca dados de estabelecimentos, empresas e servi√ßos a partir de um termo de busca",
          "method": "POST",
          "url": "=https://webhook.devtower.online/webhook/SKAJFKAJAKSLJF",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "termo_de_busca",
                "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequestTool",
        "typeVersion": 4.2,
        "position": [
          1168,
          1264
        ],
        "id": "d33b80fc-f514-47f8-b740-f5d689b96d45",
        "name": "busca_dados",
        "notes": "TEMPLATE DESENVOLVIDO POR RODRIGO ALVES\nwww.youtube.com/@rodrigoalveslps?sub_confirmation=1\n\nCOMUNIDADE PRODUZIMOS IA WHATSAPP\nhttps://chat.whatsapp.com/DCXhD8UTjPaAXigl6Q5zmk\n\nCURSO M√ÅQUINA DE AGENTES IA E AUTOMA√á√ïES\nhttps://checkout.produzimosia.com/OE11373AF"
      },
      {
        "parameters": {
          "fieldToSplitOut": "data",
          "options": {}
        },
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          1008,
          1456
        ],
        "id": "3c6eeaff-d4e1-41ce-a50a-f3f97d5f45b0",
        "name": "separa_dados",
        "notes": "TEMPLATE DESENVOLVIDO POR RODRIGO ALVES\nwww.youtube.com/@rodrigoalveslps?sub_confirmation=1\n\nCOMUNIDADE PRODUZIMOS IA WHATSAPP\nhttps://chat.whatsapp.com/DCXhD8UTjPaAXigl6Q5zmk\n\nCURSO M√ÅQUINA DE AGENTES IA E AUTOMA√á√ïES\nhttps://checkout.produzimosia.com/OE11373AF"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "26b63941-4d20-43ff-af60-6b148ce28706",
                "name": "response",
                "value": "Preenchi l√° na planilha os neg√≥cios que eu encontrei",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1552,
          1456
        ],
        "id": "4d9d7bf0-1ace-4cc7-beb9-ed73ae89942f",
        "name": "responde_IA",
        "notes": "TEMPLATE DESENVOLVIDO POR RODRIGO ALVES\nwww.youtube.com/@rodrigoalveslps?sub_confirmation=1\n\nCOMUNIDADE PRODUZIMOS IA WHATSAPP\nhttps://chat.whatsapp.com/DCXhD8UTjPaAXigl6Q5zmk\n\nCURSO M√ÅQUINA DE AGENTES IA E AUTOMA√á√ïES\nhttps://checkout.produzimosia.com/OE11373AF"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "SKAJFKAJAKSLJF",
          "responseMode": "lastNode",
          "responseData": "allEntries",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          464,
          1456
        ],
        "id": "d6236cf5-401a-4ff7-9827-6001c0324ea4",
        "name": "Webhook1",
        "webhookId": "2f63aff5-a13a-4d10-ad1d-a6f4335bc7fa",
        "notes": "TEMPLATE DESENVOLVIDO POR RODRIGO ALVES\nwww.youtube.com/@rodrigoalveslps?sub_confirmation=1\n\nCOMUNIDADE PRODUZIMOS IA WHATSAPP\nhttps://chat.whatsapp.com/DCXhD8UTjPaAXigl6Q5zmk\n\nCURSO M√ÅQUINA DE AGENTES IA E AUTOMA√á√ïES\nhttps://checkout.produzimosia.com/OE11373AF"
      },
      {
        "parameters": {
          "content": "",
          "height": 720,
          "width": 1360,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          400,
          912
        ],
        "id": "415c2239-8723-4a7b-942f-eae5b8211ba5",
        "name": "Sticky Note30"
      },
      {
        "parameters": {
          "content": "## FLUXO BUSCADOR DE LEADS GOOGLE MEU NEG√ìCIO",
          "height": 80,
          "width": 660,
          "color": 5
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          432,
          944
        ],
        "id": "d32f3d91-5776-4d63-a2f4-859a6cfa9fc4",
        "name": "Sticky Note63"
      },
      {
        "parameters": {
          "content": "## Instru√ß√µes de Uso\n1. Crie um path √∫nico no webhook e modifique o endere√ßo na tool\n2. Troque a credencial da api Link: https://rapidapi.com/letscrape-6bRBa3QguO5/api/local-business-search [rapidapi_local-business-search]\n3. Preencha o campo abaixo do [x-rapidapi-key] com a sua chave\n4. Selecione os campos a ser preenchidos na sua tabela do google sheets",
          "height": 220,
          "width": 690,
          "color": 3
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          1504,
          1200
        ],
        "id": "03717bb3-f7ac-4279-ab20-42bfacf93b81",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "content": "## Instru√ß√µes de Uso\n\n\nEsse √© o agente disparador de mensagens\n\n1. Defina de quanto em quanto tempo o fluxo vai acionar",
          "height": 220,
          "width": 690,
          "color": 3
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          2048,
          2592
        ],
        "id": "8f67a976-bf1b-4c62-ae09-c05c9770c8da",
        "name": "Sticky Note2"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "CREATE TABLE prospeccao (\n  id BIGSERIAL PRIMARY KEY,\n  nome TEXT,\n  telefone TEXT,\n  ramo TEXT,\n  status TEXT,\n  origem TEXT,\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  ultima_interacao TIMESTAMPTZ\n);",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          2112,
          224
        ],
        "id": "1751bd75-b1db-4502-bc04-bc4ff9daf5ba",
        "name": "Cria Tabela Prospeccao"
      },
      {
        "parameters": {
          "content": "",
          "height": 200
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          448,
          576
        ],
        "typeVersion": 1,
        "id": "b54c24b9-1dd3-4f86-a107-dad25ed2fc12",
        "name": "Sticky Note64"
      },
      {
        "parameters": {
          "content": "",
          "height": 200
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1248,
          176
        ],
        "typeVersion": 1,
        "id": "174f3109-efa1-4dfb-914f-d23f5038ed80",
        "name": "Sticky Note70"
      },
      {
        "parameters": {
          "content": "",
          "height": 200
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1488,
          576
        ],
        "typeVersion": 1,
        "id": "5bc48221-95e6-4e47-ad28-ce4966d79259",
        "name": "Sticky Note75"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "create table dados_cliente (\n  id bigserial primary key,\n  created_at TIMESTAMPTZ, \n  telefone text, \n  nomewpp text,\n  atendimento_ia text\n);",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          784,
          192
        ],
        "id": "643cc684-98db-4d86-920b-db8239c4fae5",
        "name": "Cria Tabela Dados Cliente1"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "-- Create a table to store your documents\ncreate table documents (\n  id bigserial primary key,\n  content text, -- corresponds to Document.pageContent\n  metadata jsonb, -- corresponds to Document.metadata\n  embedding vector(1536) -- 1536 works for OpenAI embeddings, change if needed\n);",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          1824,
          224
        ],
        "id": "3cb1665e-01de-4309-a9e8-2778e9b8889b",
        "name": "Cria Tabela Documentos1"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "delete from documents",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          1552,
          592
        ],
        "id": "9e684fb5-82a9-4b3a-8131-4b7faab9c6b5",
        "name": "Deleta Conte√∫do Documentos1"
      },
      {
        "parameters": {
          "content": "",
          "height": 200
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1504,
          176
        ],
        "typeVersion": 1,
        "id": "770e505c-69cd-47f9-b8a7-d40bc4d4b958",
        "name": "Sticky Note76"
      },
      {
        "parameters": {
          "content": "",
          "height": 200
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1760,
          176
        ],
        "typeVersion": 1,
        "id": "9e666d61-f494-4a78-ba7b-022abc3a8a07",
        "name": "Sticky Note77"
      },
      {
        "parameters": {
          "content": "",
          "height": 200
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          464,
          176
        ],
        "typeVersion": 1,
        "id": "892c1c7f-bf6d-4967-b02b-fdb14d788563",
        "name": "Sticky Note78"
      },
      {
        "parameters": {
          "content": "",
          "height": 200
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          992,
          176
        ],
        "typeVersion": 1,
        "id": "86cf315e-46ce-4a80-9f16-982a3dc59348",
        "name": "Sticky Note79"
      },
      {
        "parameters": {
          "content": "",
          "height": 200
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          960,
          576
        ],
        "typeVersion": 1,
        "id": "6b19f319-b6f7-4004-8579-7ff0b7c23142",
        "name": "Sticky Note80"
      },
      {
        "parameters": {
          "content": "",
          "height": 200
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          720,
          176
        ],
        "typeVersion": 1,
        "id": "3f8a8dd2-1655-4846-8172-973ccc057440",
        "name": "Sticky Note81"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "delete from n8n_chat_histories",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          512,
          624
        ],
        "id": "80e5cd58-07eb-4e75-9a3d-6d4e020753b1",
        "name": "Deleta Hist√≥rico1"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "create function match_documents (\n  query_embedding vector(1536),\n  match_count int default null,\n  filter jsonb DEFAULT '{}'\n) returns table (\n  id bigint,\n  content text,\n  metadata jsonb,\n  similarity float\n)\nlanguage plpgsql\nas $$\n#variable_conflict use_column\nbegin\n  return query\n  select\n    id,\n    content,\n    metadata,\n    1 - (documents.embedding <=> query_embedding) as similarity\n  from documents\n  where metadata @> filter\n  order by documents.embedding <=> query_embedding\n  limit match_count;\nend;\n$$;",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          1568,
          192
        ],
        "id": "1fd643e0-6b75-4838-90a6-74ad1c0bf187",
        "name": "Cria fun√ß√£o Busca em Vetor1"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "create extension vector;",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          1312,
          192
        ],
        "id": "8c8c8a7f-2b1b-4cb1-a8ba-40df10456741",
        "name": "Cria Extens√£o Vetor1"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "create table chats (\n  id bigserial primary key,\n  created_at TIMESTAMPTZ, \n  phone text,\n  updated_at text\n);",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          1040,
          192
        ],
        "id": "8372be2c-4c5a-4430-971c-2954e1f098e3",
        "name": "Cria Tabela Chats1"
      },
      {
        "parameters": {
          "content": "",
          "height": 200
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1232,
          576
        ],
        "typeVersion": 1,
        "id": "28e8f286-66fc-4087-b906-5752275b42cf",
        "name": "Sticky Note82"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "delete from chats",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          1280,
          592
        ],
        "id": "5bf06eb8-b307-4437-acd8-68c614fe1a54",
        "name": "Deleta Conte√∫do Chats1"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "delete from dados_cliente",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          1024,
          592
        ],
        "id": "425817ca-9663-4b73-8933-3e8034a234cc",
        "name": "Deleta Conte√∫do Dados Cliente1"
      },
      {
        "parameters": {
          "content": "",
          "height": 200
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          704,
          576
        ],
        "typeVersion": 1,
        "id": "026ce8f6-42a8-4584-9fce-82ee8f84515b",
        "name": "Sticky Note83"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "delete from chat_messages",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          768,
          592
        ],
        "id": "7ca05eef-1156-482d-b504-f2f1ac03c757",
        "name": "Deleta Conte√∫do Chat_Messages1"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "CREATE TABLE chat_messages (\n  id BIGSERIAL PRIMARY KEY,\n  created_at TIMESTAMPTZ, \n  phone TEXT,\n  nomewpp TEXT, \n  bot_message TEXT,\n  user_message TEXT, \n  message_type TEXT,\n  active BOOLEAN DEFAULT TRUE\n);\n",
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          528,
          192
        ],
        "id": "b904caa6-44ca-43b1-b013-4299d258d389",
        "name": "Cria Tabela Chat_Messages1"
      },
      {
        "parameters": {
          "content": "# Ferramentas para criar\n\n",
          "height": 80,
          "width": 456,
          "color": 4
        },
        "id": "e3c86ce0-6bb6-474e-8dae-123fff76d2b2",
        "name": "Sticky Note15",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          464,
          80
        ]
      },
      {
        "parameters": {
          "content": "# Ferramentas para apagar dados da tabela\n\n",
          "height": 80,
          "width": 1016,
          "color": 3
        },
        "id": "a0beb4f3-078d-4b21-970b-9642f761bc5c",
        "name": "Sticky Note29",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          432,
          464
        ]
      },
      {
        "parameters": {
          "content": "",
          "height": 380,
          "width": 1920,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          400,
          32
        ],
        "typeVersion": 1,
        "id": "7c4302cf-efa1-43f5-afd0-11e2deef050f",
        "name": "Sticky Note84"
      },
      {
        "parameters": {
          "content": "",
          "height": 380,
          "width": 1680,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          400,
          432
        ],
        "typeVersion": 1,
        "id": "5713d72f-bf94-447b-8808-0407c81ff48e",
        "name": "Sticky Note85"
      },
      {
        "parameters": {
          "content": "",
          "height": 200,
          "color": 2
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2048,
          176
        ],
        "typeVersion": 1,
        "id": "8815359c-9aa9-4bbc-beb0-06848339c616",
        "name": "Sticky Note4"
      },
      {
        "parameters": {
          "content": "## Mude a sua credencial do Postgress para criar todas as tabelas",
          "height": 80,
          "width": 790,
          "color": 3
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          1360,
          80
        ],
        "id": "84944bce-e7cc-4479-b8af-1452ee70fe45",
        "name": "Sticky Note86"
      }
    ],
    "connections": {
      "OpenAI Chat Model1": {
        "ai_languageModel": [
          [
            {
              "node": "buscar_documentos",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Embeddings OpenAI": {
        "ai_embedding": [
          [
            {
              "node": "Supabase Vector Store",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ]
      },
      "Supabase Vector Store": {
        "ai_vectorStore": [
          [
            {
              "node": "buscar_documentos",
              "type": "ai_vectorStore",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI3": {
        "ai_languageModel": [
          [
            {
              "node": "Parser  Chain",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items3": {
        "main": [
          [],
          [
            {
              "node": "Evolution API",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OutputParser1": {
        "ai_outputParser": [
          [
            {
              "node": "Parser  Chain",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Parser  Chain": {
        "main": [
          [
            {
              "node": "Split de Mensagem",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model2": {
        "ai_languageModel": [
          [
            {
              "node": "Basic LLM Chain1",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Evolution API": {
        "main": [
          [
            {
              "node": "1 segundo",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Evolution API1": {
        "main": [
          [
            {
              "node": "ListMessages-Supabase2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Evolution API2": {
        "main": [
          [
            {
              "node": "Pausar IA1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge1": {
        "main": [
          [
            {
              "node": "Cria Hist√≥rico Supabase",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If4": {
        "main": [
          [
            {
              "node": "Adiciona CHAT supabase",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Atualiza CHAT Supabase",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Busca Telefone": {
        "main": [
          [
            {
              "node": "If4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Adiciona CHAT supabase": {
        "main": [
          [
            {
              "node": "Merge1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Atualiza CHAT Supabase": {
        "main": [
          [
            {
              "node": "Merge1",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Cria Hist√≥rico Supabase": {
        "main": [
          [
            {
              "node": "Delete Memory",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split de Mensagem": {
        "main": [
          [
            {
              "node": "Loop Over Items3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "1 segundo": {
        "main": [
          [
            {
              "node": "Loop Over Items3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "buscar_documentos": {
        "ai_tool": [
          [
            {
              "node": "Agente Rag",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "ListMessages-Supabase2": {
        "main": [
          [
            {
              "node": "Aggregate2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate2": {
        "main": [
          [
            {
              "node": "Code6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code6": {
        "main": [
          [
            {
              "node": "Basic LLM Chain1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Basic LLM Chain1": {
        "main": [
          [
            {
              "node": "Evolution API2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Supabase": {
        "main": [
          [
            {
              "node": "If1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If1": {
        "main": [
          [
            {
              "node": "Switch6",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Supabase1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Supabase1": {
        "main": [
          [
            {
              "node": "Switch6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook EVO": {
        "main": [
          [
            {
              "node": "Dados",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convert to File1": {
        "main": [
          [
            {
              "node": "OpenAI1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields3": {
        "main": [
          [
            {
              "node": "Convert to File1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If3": {
        "main": [
          [
            {
              "node": "Redis5",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Redis4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Redis4": {
        "main": [
          [
            {
              "node": "Get Memory 1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Redis5": {
        "main": [
          [
            {
              "node": "Get Memory 1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch1": {
        "main": [
          [
            {
              "node": "Text Memory1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Text Memory1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI1": {
        "main": [
          [
            {
              "node": "If3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Compara Get Memory1": {
        "main": [
          [
            {
              "node": "Mensagem Completa",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Text Memory1": {
        "main": [
          [
            {
              "node": "Get Memory 1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Audio Memory1": {
        "main": [
          [
            {
              "node": "Get Memory 1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields8": {
        "main": [
          [
            {
              "node": "Compara Get Memory1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait3": {
        "main": [
          [
            {
              "node": "Get Memory 2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Memory 1": {
        "main": [
          [
            {
              "node": "Wait3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Memory 2": {
        "main": [
          [
            {
              "node": "Edit Fields8",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch6": {
        "main": [
          [
            {
              "node": "Rotas1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Verificar Pause",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Mensagem Completa": {
        "main": [
          [
            {
              "node": "Agente Rag",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convert to File": {
        "main": [
          [
            {
              "node": "OpenAI",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields": {
        "main": [
          [
            {
              "node": "Convert to File",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI": {
        "main": [
          [
            {
              "node": "Audio Memory1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Model": {
        "ai_languageModel": [
          [
            {
              "node": "Agente Treinamento RAG",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Treinamento_feito": {
        "ai_tool": [
          [
            {
              "node": "Agente Treinamento RAG",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Character Text Splitter1": {
        "ai_textSplitter": [
          [
            {
              "node": "Default Data Loader1",
              "type": "ai_textSplitter",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate1": {
        "main": [
          [
            {
              "node": "Summarize1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Embeddings OpenAI2": {
        "ai_embedding": [
          [
            {
              "node": "Insert into Supabase Vectorstore1",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ]
      },
      "Default Data Loader1": {
        "ai_document": [
          [
            {
              "node": "Insert into Supabase Vectorstore1",
              "type": "ai_document",
              "index": 0
            }
          ]
        ]
      },
      "Download File1": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract from Excel2": {
        "main": [
          [
            {
              "node": "Aggregate1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Agente Treinamento RAG": {
        "main": [
          [
            {
              "node": "Deleta linhas antigas do documento1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rotas": {
        "main": [
          [
            {
              "node": "Supabase",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Agente Treinamento RAG",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Pausar IA": {
        "main": [
          [
            {
              "node": "Salvar Historicoo Humano",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Verificar Pause": {
        "main": [
          [
            {
              "node": "Rota Atendimento",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rota Atendimento": {
        "main": [
          [
            {
              "node": "Switch1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Salvar Historicoo Humano1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rotas1": {
        "main": [
          [
            {
              "node": "Pausar IA",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Reativar IA": {
        "main": [
          [
            {
              "node": "Salvar Historicoo Humano",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Dados": {
        "main": [
          [
            {
              "node": "Buscar prospeccao",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait": {
        "main": [
          [
            {
              "node": "Reativar IA",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model4": {
        "ai_languageModel": [
          [
            {
              "node": "Agente Rag",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Agente Rag": {
        "main": [
          [
            {
              "node": "Atendente6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Atualizar_treinamento": {
        "ai_tool": [
          [
            {
              "node": "Agente Treinamento RAG",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Extract Document Text": {
        "main": [
          [
            {
              "node": "Insert into Supabase Vectorstore1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract PDF Text": {
        "main": [
          [
            {
              "node": "Insert into Supabase Vectorstore1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Extract PDF Text",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Extract from Excel2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Extract from Excel",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Extract Document Text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Summarize1": {
        "main": [
          [
            {
              "node": "Insert into Supabase Vectorstore1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract from Excel": {
        "main": [
          [
            {
              "node": "Aggregate1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Drive": {
        "main": [
          [
            {
              "node": "Download File1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Deleta linhas antigas do documento1": {
        "main": [
          [
            {
              "node": "Google Drive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Schedule Trigger": {
        "main": [
          [
            {
              "node": "Deleta linhas antigas do documento1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Execute Workflow Trigger": {
        "main": [
          [
            {
              "node": "Switch10",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Calendar": {
        "main": [
          [
            {
              "node": "Loop Over Items4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "5 Minutos antes": {
        "main": [
          [
            {
              "node": "If8",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "2 Hora antes": {
        "main": [
          [
            {
              "node": "If7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If7": {
        "main": [
          [
            {
              "node": "Edit Fields5",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If8": {
        "main": [
          [
            {
              "node": "Edit Fields2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Wait1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Supabase3": {
        "main": [
          [
            {
              "node": "Atendente3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields5": {
        "main": [
          [
            {
              "node": "Supabase3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Postgres Chat Memory1": {
        "ai_memory": [
          [
            {
              "node": "Atendente3",
              "type": "ai_memory",
              "index": 0
            },
            {
              "node": "Atendente2",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Supabase4": {
        "main": [
          [
            {
              "node": "Atendente2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Atendente2": {
        "main": [
          [
            {
              "node": "Evolution API7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields2": {
        "main": [
          [
            {
              "node": "Supabase4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Evolution API7": {
        "main": [
          [
            {
              "node": "Wait1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Schedule Trigger1": {
        "main": [
          [
            {
              "node": "Google Calendar",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model5": {
        "ai_languageModel": [
          [
            {
              "node": "Atendente3",
              "type": "ai_languageModel",
              "index": 0
            },
            {
              "node": "Atendente2",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items4": {
        "main": [
          [],
          [
            {
              "node": "2 Hora antes",
              "type": "main",
              "index": 0
            },
            {
              "node": "5 Minutos antes",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Atendente3": {
        "main": [
          [
            {
              "node": "Evolution API7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait1": {
        "main": [
          [
            {
              "node": "Loop Over Items4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Cron Prospec√ß√£o": {
        "main": [
          [
            {
              "node": "Buscar Lead Prospec√ß√£o",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Buscar Lead Prospec√ß√£o": {
        "main": [
          [
            {
              "node": "Supabase2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Enviar Mensagem Inicial": {
        "main": [
          [
            {
              "node": "Atualizar Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Executar Manual": {
        "main": [
          [
            {
              "node": "Ler Planilha Google1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "prospeccao": {
        "main": [
          [
            {
              "node": "Switch7",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Rotas",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Buscar prospeccao": {
        "main": [
          [
            {
              "node": "prospeccao",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model3": {
        "ai_languageModel": [
          [
            {
              "node": "buscar_documentos1",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Embeddings OpenAI1": {
        "ai_embedding": [
          [
            {
              "node": "Supabase Vector Store1",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ]
      },
      "Supabase Vector Store1": {
        "ai_vectorStore": [
          [
            {
              "node": "buscar_documentos1",
              "type": "ai_vectorStore",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI4": {
        "ai_languageModel": [
          [
            {
              "node": "Parser  Chain1",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items": {
        "main": [
          [],
          [
            {
              "node": "Evolution API3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OutputParser": {
        "ai_outputParser": [
          [
            {
              "node": "Parser  Chain1",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Parser  Chain1": {
        "main": [
          [
            {
              "node": "Split de Mensagem1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model6": {
        "ai_languageModel": [
          [
            {
              "node": "Atendente4",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Atendente4": {
        "main": [
          [
            {
              "node": "Switch3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Postgres Chat Memory2": {
        "ai_memory": [
          [
            {
              "node": "Atendente4",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Switch3": {
        "main": [
          [
            {
              "node": "Parser  Chain1",
              "type": "main",
              "index": 0
            },
            {
              "node": "Busca Telefone1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Evolution API4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Evolution API3": {
        "main": [
          [
            {
              "node": "1 segundo1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge": {
        "main": [
          [
            {
              "node": "Cria Hist√≥rico Supabase1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If9": {
        "main": [
          [
            {
              "node": "Adiciona CHAT supabase1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Atualiza CHAT Supabase1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Busca Telefone1": {
        "main": [
          [
            {
              "node": "If9",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Adiciona CHAT supabase1": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Atualiza CHAT Supabase1": {
        "main": [
          [
            {
              "node": "Merge",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Cria Hist√≥rico Supabase1": {
        "main": [
          [
            {
              "node": "Delete Memory1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split de Mensagem1": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "1 segundo1": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "buscar_documentos1": {
        "ai_tool": [
          [
            {
              "node": "Agente Rag1",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Convert to File2": {
        "main": [
          [
            {
              "node": "OpenAI2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields4": {
        "main": [
          [
            {
              "node": "Convert to File2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If10": {
        "main": [
          [
            {
              "node": "Redis6",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Redis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Redis": {
        "main": [
          [
            {
              "node": "Get Memory ",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Redis6": {
        "main": [
          [
            {
              "node": "Get Memory ",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch5": {
        "main": [
          [
            {
              "node": "Text Memory",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Text Memory",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields12",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI2": {
        "main": [
          [
            {
              "node": "If10",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Compara Get Memory": {
        "main": [
          [
            {
              "node": "Mensagem Completa1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Text Memory": {
        "main": [
          [
            {
              "node": "Get Memory ",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Audio Memory": {
        "main": [
          [
            {
              "node": "Get Memory ",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields11": {
        "main": [
          [
            {
              "node": "Compara Get Memory",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait4": {
        "main": [
          [
            {
              "node": "Get Memory 3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Memory ": {
        "main": [
          [
            {
              "node": "Wait4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Memory 3": {
        "main": [
          [
            {
              "node": "Edit Fields11",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch7": {
        "main": [
          [
            {
              "node": "Rotas2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Verificar Pause1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Mensagem Completa1": {
        "main": [
          [
            {
              "node": "Agente Rag1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convert to File3": {
        "main": [
          [
            {
              "node": "OpenAI5",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields12": {
        "main": [
          [
            {
              "node": "Convert to File3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI5": {
        "main": [
          [
            {
              "node": "Audio Memory",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Pausar IA2": {
        "main": [
          [
            {
              "node": "Salvar Historicoo Humano3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Verificar Pause1": {
        "main": [
          [
            {
              "node": "Rota Atendimento1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rota Atendimento1": {
        "main": [
          [
            {
              "node": "Switch5",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Salvar Historicoo Humano2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rotas2": {
        "main": [
          [
            {
              "node": "Pausar IA2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Wait2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Reativar IA1": {
        "main": [
          [
            {
              "node": "Salvar Historicoo Humano3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait2": {
        "main": [
          [
            {
              "node": "Reativar IA1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model7": {
        "ai_languageModel": [
          [
            {
              "node": "Agente Rag1",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Agente Rag1": {
        "main": [
          [
            {
              "node": "Atendente4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model8": {
        "ai_languageModel": [
          [
            {
              "node": "Basic LLM Chain",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Evolution API4": {
        "main": [
          [
            {
              "node": "ListMessages-Supabase",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Evolution API5": {
        "main": [
          [
            {
              "node": "Pausar IA3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ListMessages-Supabase": {
        "main": [
          [
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate": {
        "main": [
          [
            {
              "node": "Code",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code": {
        "main": [
          [
            {
              "node": "Basic LLM Chain",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Basic LLM Chain": {
        "main": [
          [
            {
              "node": "Evolution API5",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split In Batches": {
        "main": [
          [
            {
              "node": "Verificar no Supabase",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Verificar no Supabase": {
        "main": [
          [
            {
              "node": "IF N√£o Existe?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "IF N√£o Existe?": {
        "main": [
          [
            {
              "node": "Inserir no Supabase1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Split In Batches",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ler Planilha Google1": {
        "main": [
          [
            {
              "node": "Split In Batches",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Inserir no Supabase1": {
        "main": [
          [
            {
              "node": "Split In Batches",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model9": {
        "ai_languageModel": [
          [
            {
              "node": "Atendente5",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Atendente5": {
        "main": [
          [
            {
              "node": "Enviar Mensagem Inicial",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Postgres Chat Memory3": {
        "ai_memory": [
          [
            {
              "node": "Atendente5",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model10": {
        "ai_languageModel": [
          [
            {
              "node": "Atendente6",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Atendente6": {
        "main": [
          [
            {
              "node": "Switch9",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Postgres Chat Memory4": {
        "ai_memory": [
          [
            {
              "node": "Atendente6",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Switch9": {
        "main": [
          [
            {
              "node": "Parser  Chain",
              "type": "main",
              "index": 0
            },
            {
              "node": "Busca Telefone",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Evolution API1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "verificar_disponibilidade1": {
        "ai_tool": [
          [
            {
              "node": "Atendente4",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Get Eventos Agenda1": {
        "main": [
          [
            {
              "node": "Gerar com eventos",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Formatar Sa√≠da1": {
        "main": [
          [
            {
              "node": "Limit",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Limit": {
        "main": [
          [
            {
              "node": "Formatar hor√°rios",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gerar com eventos": {
        "main": [
          [
            {
              "node": "Formatar Sa√≠da1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Disponibilidade4": {
        "main": [
          [
            {
              "node": "If15",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Marca2": {
        "main": [
          [
            {
              "node": "Edit Fields21",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "J√° tem um evento2": {
        "main": [
          [
            {
              "node": "If14",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Calendar5": {
        "main": [
          [
            {
              "node": "Edit Fields19",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Google Calendar6": {
        "main": [
          [
            {
              "node": "Edit Fields22",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Verifica evento4": {
        "main": [
          [
            {
              "node": "Google Calendar5",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Verifica evento5": {
        "main": [
          [
            {
              "node": "Google Calendar6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If13": {
        "main": [
          [
            {
              "node": "Verifica evento5",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields20",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Disponibilidade5": {
        "main": [
          [
            {
              "node": "If13",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If14": {
        "main": [
          [
            {
              "node": "Edit Fields18",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Disponibilidade4",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch10": {
        "main": [
          [
            {
              "node": "J√° tem um evento2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Verifica evento4",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Disponibilidade5",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Parse Date",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If15": {
        "main": [
          [
            {
              "node": "Marca2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields20",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "criar_reuniao2": {
        "ai_tool": [
          [
            {
              "node": "Atendente4",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "cancelar_reuniao2": {
        "ai_tool": [
          [
            {
              "node": "Atendente4",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "reagendar_reuniao2": {
        "ai_tool": [
          [
            {
              "node": "Atendente4",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields21": {
        "main": [
          [
            {
              "node": "Atualizar Status2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Supabase2": {
        "main": [
          [
            {
              "node": "If16",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If16": {
        "main": [
          [
            {
              "node": "Atendente5",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Supabase5",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Supabase5": {
        "main": [
          [
            {
              "node": "Atendente5",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "verificar_disponibilidade": {
        "ai_tool": [
          [
            {
              "node": "Atendente6",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "criar_reuniao3": {
        "ai_tool": [
          [
            {
              "node": "Atendente6",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "cancelar_reuniao3": {
        "ai_tool": [
          [
            {
              "node": "Atendente6",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "reagendar_reuniao3": {
        "ai_tool": [
          [
            {
              "node": "Atendente6",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Parse Date": {
        "main": [
          [
            {
              "node": "Get Eventos Agenda1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Formatar hor√°rios": {
        "main": [
          [
            {
              "node": "Responder",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "enviar_video": {
        "ai_tool": [
          [
            {
              "node": "Atendente4",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Webhook": {
        "main": [
          [
            {
              "node": "Evolution API6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Evolution API6": {
        "main": [
          [
            {
              "node": "Atualizar Status1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Cron planilha": {
        "main": [
          [
            {
              "node": "Ler Planilha Google1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Mem√≥ria": {
        "ai_memory": [
          [
            {
              "node": "Agente IA",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "rapidapi_local-business-search": {
        "main": [
          [
            {
              "node": "separa_dados",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "inclui_dados_planilha": {
        "main": [
          [
            {
              "node": "responde_IA",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Agente IA": {
        "main": [
          [
            {
              "node": "Fim2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Solicitar leads": {
        "main": [
          [
            {
              "node": "Agente IA",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Modelo de Linguagem": {
        "ai_languageModel": [
          [
            {
              "node": "Agente IA",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "busca_dados": {
        "ai_tool": [
          [
            {
              "node": "Agente IA",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "separa_dados": {
        "main": [
          [
            {
              "node": "inclui_dados_planilha",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook1": {
        "main": [
          [
            {
              "node": "rapidapi_local-business-search",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "system migration",
    "name": null,
    "description": null,
    "autosaved": false
  },
  "activeVersionId": "3c1e97b5-2ce4-496a-9ce2-9df0cfadbe1b",
  "connections": {
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "buscar_documentos",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store": {
      "ai_vectorStore": [
        [
          {
            "node": "buscar_documentos",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI3": {
      "ai_languageModel": [
        [
          {
            "node": "Parser  Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items3": {
      "main": [
        [],
        [
          {
            "node": "Evolution API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OutputParser1": {
      "ai_outputParser": [
        [
          {
            "node": "Parser  Chain",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Parser  Chain": {
      "main": [
        [
          {
            "node": "Split de Mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Evolution API": {
      "main": [
        [
          {
            "node": "1 segundo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Evolution API1": {
      "main": [
        [
          {
            "node": "ListMessages-Supabase2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Evolution API2": {
      "main": [
        [
          {
            "node": "Pausar IA1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Cria Hist√≥rico Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "Adiciona CHAT supabase",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Atualiza CHAT Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Busca Telefone": {
      "main": [
        [
          {
            "node": "If4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Adiciona CHAT supabase": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Atualiza CHAT Supabase": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Cria Hist√≥rico Supabase": {
      "main": [
        [
          {
            "node": "Delete Memory",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split de Mensagem": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "1 segundo": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "buscar_documentos": {
      "ai_tool": [
        [
          {
            "node": "Agente Rag",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "ListMessages-Supabase2": {
      "main": [
        [
          {
            "node": "Aggregate2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate2": {
      "main": [
        [
          {
            "node": "Code6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code6": {
      "main": [
        [
          {
            "node": "Basic LLM Chain1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain1": {
      "main": [
        [
          {
            "node": "Evolution API2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Switch6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Supabase1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase1": {
      "main": [
        [
          {
            "node": "Switch6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook EVO": {
      "main": [
        [
          {
            "node": "Dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File1": {
      "main": [
        [
          {
            "node": "OpenAI1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "Convert to File1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "Redis5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Redis4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis4": {
      "main": [
        [
          {
            "node": "Get Memory 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis5": {
      "main": [
        [
          {
            "node": "Get Memory 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Text Memory1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Text Memory1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI1": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Compara Get Memory1": {
      "main": [
        [
          {
            "node": "Mensagem Completa",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Text Memory1": {
      "main": [
        [
          {
            "node": "Get Memory 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Audio Memory1": {
      "main": [
        [
          {
            "node": "Get Memory 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields8": {
      "main": [
        [
          {
            "node": "Compara Get Memory1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait3": {
      "main": [
        [
          {
            "node": "Get Memory 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Memory 1": {
      "main": [
        [
          {
            "node": "Wait3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Memory 2": {
      "main": [
        [
          {
            "node": "Edit Fields8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch6": {
      "main": [
        [
          {
            "node": "Rotas1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Verificar Pause",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensagem Completa": {
      "main": [
        [
          {
            "node": "Agente Rag",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI": {
      "main": [
        [
          {
            "node": "Audio Memory1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Model": {
      "ai_languageModel": [
        [
          {
            "node": "Agente Treinamento RAG",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Treinamento_feito": {
      "ai_tool": [
        [
          {
            "node": "Agente Treinamento RAG",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Character Text Splitter1": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader1",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate1": {
      "main": [
        [
          {
            "node": "Summarize1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI2": {
      "ai_embedding": [
        [
          {
            "node": "Insert into Supabase Vectorstore1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader1": {
      "ai_document": [
        [
          {
            "node": "Insert into Supabase Vectorstore1",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Download File1": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from Excel2": {
      "main": [
        [
          {
            "node": "Aggregate1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agente Treinamento RAG": {
      "main": [
        [
          {
            "node": "Deleta linhas antigas do documento1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rotas": {
      "main": [
        [
          {
            "node": "Supabase",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agente Treinamento RAG",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pausar IA": {
      "main": [
        [
          {
            "node": "Salvar Historicoo Humano",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verificar Pause": {
      "main": [
        [
          {
            "node": "Rota Atendimento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rota Atendimento": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Salvar Historicoo Humano1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rotas1": {
      "main": [
        [
          {
            "node": "Pausar IA",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reativar IA": {
      "main": [
        [
          {
            "node": "Salvar Historicoo Humano",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dados": {
      "main": [
        [
          {
            "node": "Buscar prospeccao",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Reativar IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "Agente Rag",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Agente Rag": {
      "main": [
        [
          {
            "node": "Atendente6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Atualizar_treinamento": {
      "ai_tool": [
        [
          {
            "node": "Agente Treinamento RAG",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Extract Document Text": {
      "main": [
        [
          {
            "node": "Insert into Supabase Vectorstore1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract PDF Text": {
      "main": [
        [
          {
            "node": "Insert into Supabase Vectorstore1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Extract PDF Text",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract from Excel2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract from Excel",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract Document Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Summarize1": {
      "main": [
        [
          {
            "node": "Insert into Supabase Vectorstore1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from Excel": {
      "main": [
        [
          {
            "node": "Aggregate1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Drive": {
      "main": [
        [
          {
            "node": "Download File1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Deleta linhas antigas do documento1": {
      "main": [
        [
          {
            "node": "Google Drive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Deleta linhas antigas do documento1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Workflow Trigger": {
      "main": [
        [
          {
            "node": "Switch10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Calendar": {
      "main": [
        [
          {
            "node": "Loop Over Items4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "5 Minutos antes": {
      "main": [
        [
          {
            "node": "If8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "2 Hora antes": {
      "main": [
        [
          {
            "node": "If7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If7": {
      "main": [
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If8": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase3": {
      "main": [
        [
          {
            "node": "Atendente3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields5": {
      "main": [
        [
          {
            "node": "Supabase3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory1": {
      "ai_memory": [
        [
          {
            "node": "Atendente3",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "Atendente2",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Supabase4": {
      "main": [
        [
          {
            "node": "Atendente2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Atendente2": {
      "main": [
        [
          {
            "node": "Evolution API7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Supabase4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Evolution API7": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger1": {
      "main": [
        [
          {
            "node": "Google Calendar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "Atendente3",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Atendente2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items4": {
      "main": [
        [],
        [
          {
            "node": "2 Hora antes",
            "type": "main",
            "index": 0
          },
          {
            "node": "5 Minutos antes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Atendente3": {
      "main": [
        [
          {
            "node": "Evolution API7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "Loop Over Items4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cron Prospec√ß√£o": {
      "main": [
        [
          {
            "node": "Buscar Lead Prospec√ß√£o",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Lead Prospec√ß√£o": {
      "main": [
        [
          {
            "node": "Supabase2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar Mensagem Inicial": {
      "main": [
        [
          {
            "node": "Atualizar Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Executar Manual": {
      "main": [
        [
          {
            "node": "Ler Planilha Google1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "prospeccao": {
      "main": [
        [
          {
            "node": "Switch7",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Rotas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar prospeccao": {
      "main": [
        [
          {
            "node": "prospeccao",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "buscar_documentos1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store1": {
      "ai_vectorStore": [
        [
          {
            "node": "buscar_documentos1",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI4": {
      "ai_languageModel": [
        [
          {
            "node": "Parser  Chain1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Evolution API3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OutputParser": {
      "ai_outputParser": [
        [
          {
            "node": "Parser  Chain1",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Parser  Chain1": {
      "main": [
        [
          {
            "node": "Split de Mensagem1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model6": {
      "ai_languageModel": [
        [
          {
            "node": "Atendente4",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Atendente4": {
      "main": [
        [
          {
            "node": "Switch3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory2": {
      "ai_memory": [
        [
          {
            "node": "Atendente4",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Switch3": {
      "main": [
        [
          {
            "node": "Parser  Chain1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Busca Telefone1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Evolution API4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Evolution API3": {
      "main": [
        [
          {
            "node": "1 segundo1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Cria Hist√≥rico Supabase1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If9": {
      "main": [
        [
          {
            "node": "Adiciona CHAT supabase1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Atualiza CHAT Supabase1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Busca Telefone1": {
      "main": [
        [
          {
            "node": "If9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Adiciona CHAT supabase1": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Atualiza CHAT Supabase1": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Cria Hist√≥rico Supabase1": {
      "main": [
        [
          {
            "node": "Delete Memory1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split de Mensagem1": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "1 segundo1": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "buscar_documentos1": {
      "ai_tool": [
        [
          {
            "node": "Agente Rag1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File2": {
      "main": [
        [
          {
            "node": "OpenAI2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields4": {
      "main": [
        [
          {
            "node": "Convert to File2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If10": {
      "main": [
        [
          {
            "node": "Redis6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Redis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis": {
      "main": [
        [
          {
            "node": "Get Memory ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis6": {
      "main": [
        [
          {
            "node": "Get Memory ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch5": {
      "main": [
        [
          {
            "node": "Text Memory",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Text Memory",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields12",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI2": {
      "main": [
        [
          {
            "node": "If10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Compara Get Memory": {
      "main": [
        [
          {
            "node": "Mensagem Completa1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Text Memory": {
      "main": [
        [
          {
            "node": "Get Memory ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Audio Memory": {
      "main": [
        [
          {
            "node": "Get Memory ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields11": {
      "main": [
        [
          {
            "node": "Compara Get Memory",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait4": {
      "main": [
        [
          {
            "node": "Get Memory 3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Memory ": {
      "main": [
        [
          {
            "node": "Wait4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Memory 3": {
      "main": [
        [
          {
            "node": "Edit Fields11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch7": {
      "main": [
        [
          {
            "node": "Rotas2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Verificar Pause1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensagem Completa1": {
      "main": [
        [
          {
            "node": "Agente Rag1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File3": {
      "main": [
        [
          {
            "node": "OpenAI5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields12": {
      "main": [
        [
          {
            "node": "Convert to File3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI5": {
      "main": [
        [
          {
            "node": "Audio Memory",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pausar IA2": {
      "main": [
        [
          {
            "node": "Salvar Historicoo Humano3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verificar Pause1": {
      "main": [
        [
          {
            "node": "Rota Atendimento1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rota Atendimento1": {
      "main": [
        [
          {
            "node": "Switch5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Salvar Historicoo Humano2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rotas2": {
      "main": [
        [
          {
            "node": "Pausar IA2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reativar IA1": {
      "main": [
        [
          {
            "node": "Salvar Historicoo Humano3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait2": {
      "main": [
        [
          {
            "node": "Reativar IA1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model7": {
      "ai_languageModel": [
        [
          {
            "node": "Agente Rag1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Agente Rag1": {
      "main": [
        [
          {
            "node": "Atendente4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model8": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Evolution API4": {
      "main": [
        [
          {
            "node": "ListMessages-Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Evolution API5": {
      "main": [
        [
          {
            "node": "Pausar IA3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ListMessages-Supabase": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain": {
      "main": [
        [
          {
            "node": "Evolution API5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split In Batches": {
      "main": [
        [
          {
            "node": "Verificar no Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verificar no Supabase": {
      "main": [
        [
          {
            "node": "IF N√£o Existe?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF N√£o Existe?": {
      "main": [
        [
          {
            "node": "Inserir no Supabase1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Split In Batches",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ler Planilha Google1": {
      "main": [
        [
          {
            "node": "Split In Batches",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Inserir no Supabase1": {
      "main": [
        [
          {
            "node": "Split In Batches",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model9": {
      "ai_languageModel": [
        [
          {
            "node": "Atendente5",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Atendente5": {
      "main": [
        [
          {
            "node": "Enviar Mensagem Inicial",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory3": {
      "ai_memory": [
        [
          {
            "node": "Atendente5",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model10": {
      "ai_languageModel": [
        [
          {
            "node": "Atendente6",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Atendente6": {
      "main": [
        [
          {
            "node": "Switch9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory4": {
      "ai_memory": [
        [
          {
            "node": "Atendente6",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Switch9": {
      "main": [
        [
          {
            "node": "Parser  Chain",
            "type": "main",
            "index": 0
          },
          {
            "node": "Busca Telefone",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Evolution API1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "verificar_disponibilidade1": {
      "ai_tool": [
        [
          {
            "node": "Atendente4",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get Eventos Agenda1": {
      "main": [
        [
          {
            "node": "Gerar com eventos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatar Sa√≠da1": {
      "main": [
        [
          {
            "node": "Limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit": {
      "main": [
        [
          {
            "node": "Formatar hor√°rios",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gerar com eventos": {
      "main": [
        [
          {
            "node": "Formatar Sa√≠da1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Disponibilidade4": {
      "main": [
        [
          {
            "node": "If15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Marca2": {
      "main": [
        [
          {
            "node": "Edit Fields21",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "J√° tem um evento2": {
      "main": [
        [
          {
            "node": "If14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Calendar5": {
      "main": [
        [
          {
            "node": "Edit Fields19",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Calendar6": {
      "main": [
        [
          {
            "node": "Edit Fields22",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verifica evento4": {
      "main": [
        [
          {
            "node": "Google Calendar5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verifica evento5": {
      "main": [
        [
          {
            "node": "Google Calendar6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If13": {
      "main": [
        [
          {
            "node": "Verifica evento5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields20",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Disponibilidade5": {
      "main": [
        [
          {
            "node": "If13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If14": {
      "main": [
        [
          {
            "node": "Edit Fields18",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Disponibilidade4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch10": {
      "main": [
        [
          {
            "node": "J√° tem um evento2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Verifica evento4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Disponibilidade5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Parse Date",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If15": {
      "main": [
        [
          {
            "node": "Marca2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields20",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "criar_reuniao2": {
      "ai_tool": [
        [
          {
            "node": "Atendente4",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "cancelar_reuniao2": {
      "ai_tool": [
        [
          {
            "node": "Atendente4",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "reagendar_reuniao2": {
      "ai_tool": [
        [
          {
            "node": "Atendente4",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields21": {
      "main": [
        [
          {
            "node": "Atualizar Status2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase2": {
      "main": [
        [
          {
            "node": "If16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If16": {
      "main": [
        [
          {
            "node": "Atendente5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Supabase5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase5": {
      "main": [
        [
          {
            "node": "Atendente5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "verificar_disponibilidade": {
      "ai_tool": [
        [
          {
            "node": "Atendente6",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "criar_reuniao3": {
      "ai_tool": [
        [
          {
            "node": "Atendente6",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "cancelar_reuniao3": {
      "ai_tool": [
        [
          {
            "node": "Atendente6",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "reagendar_reuniao3": {
      "ai_tool": [
        [
          {
            "node": "Atendente6",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Parse Date": {
      "main": [
        [
          {
            "node": "Get Eventos Agenda1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatar hor√°rios": {
      "main": [
        [
          {
            "node": "Responder",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enviar_video": {
      "ai_tool": [
        [
          {
            "node": "Atendente4",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Evolution API6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Evolution API6": {
      "main": [
        [
          {
            "node": "Atualizar Status1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cron planilha": {
      "main": [
        [
          {
            "node": "Ler Planilha Google1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mem√≥ria": {
      "ai_memory": [
        [
          {
            "node": "Agente IA",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "rapidapi_local-business-search": {
      "main": [
        [
          {
            "node": "separa_dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "inclui_dados_planilha": {
      "main": [
        [
          {
            "node": "responde_IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agente IA": {
      "main": [
        [
          {
            "node": "Fim2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Solicitar leads": {
      "main": [
        [
          {
            "node": "Agente IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Modelo de Linguagem": {
      "ai_languageModel": [
        [
          {
            "node": "Agente IA",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "busca_dados": {
      "ai_tool": [
        [
          {
            "node": "Agente IA",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "separa_dados": {
      "main": [
        [
          {
            "node": "inclui_dados_planilha",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook1": {
      "main": [
        [
          {
            "node": "rapidapi_local-business-search",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-09-08T20:10:22.783Z",
  "id": "R79i6iWxhZDB2UUa",
  "isArchived": false,
  "meta": null,
  "name": "PROSPECCAO_Template",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "id": "3b5bd8f1-cffd-4a1d-aad5-61bd6d603521",
      "name": "OpenAI Chat Model1",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        7312,
        4496
      ]
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "bdc94ca6-e81a-42aa-a31f-b97a22a37f80",
      "name": "Embeddings OpenAI",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1,
      "position": [
        6752,
        4512
      ]
    },
    {
      "parameters": {
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "id": "e6d4bdef-5b47-45dc-a8fc-c3928ae2763a",
      "name": "Supabase Vector Store",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        6928,
        4464
      ]
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {}
      },
      "id": "b4827b38-6aae-4588-a92b-94150dcf7538",
      "name": "OpenAI3",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        8544,
        4656
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "4a271932-1e83-432e-aa6e-4f929a89085f",
      "name": "Loop Over Items3",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        9152,
        4480
      ]
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"messages\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"string\"\n      }\n    }\n  },\n  \"required\": [\"messages\"]\n}"
      },
      "id": "c39ef863-cecb-4e22-bf11-89eb1e8cea72",
      "name": "OutputParser1",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        8768,
        4656
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Whatsapp message to be splitted and formated: {{ $json.output }}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "={\n  \"messages\": [\n    \"Por favor, gere a sa√≠da no seguinte formato JSON: {\\\"messages\\\": [\\\"splitedMessage\\\", \\\"splitedMessage\\\", \\\"splitedMessage\\\"]}\",\n    \"As mensagens devem ser divididas de forma natural, afinal estamos conversando com um humano. Certifique-se de que a resposta siga exatamente essa estrutura, incluindo os colchetes e as aspas.\",\n    \"Jamais separe uma mensagem vazia. Cada mensagem deve ter entre 300 e 500 caracteres, sem cortar informa√ß√µes, pois √© uma conversa de chat.\",\n    \"Certifique-se de que a resposta siga exatamente essa estrutura: *negrito* (substitua '**' por '*') n√£o mande nada em negrito remova todos '*'; ~tachado~ (caso seja algo exclu√≠do/alterado); _it√°lico_ (extremamente raro).\",\n    \"Tudo o que for link, pode colocar entre \\\"`\\\", ou seja, na seguinte formata√ß√£o: `www.link.com.br`. Use sempre essa formata√ß√£o para todos os links.\"\n  ]\n}"
            }
          ]
        }
      },
      "id": "a2ddc0c3-d223-4679-913b-92cf7bbce7b0",
      "name": "Parser  Chain",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.4,
      "position": [
        8560,
        4464
      ]
    },
    {
      "parameters": {
        "content": "",
        "height": 620,
        "width": 1380,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        8432,
        4176
      ],
      "typeVersion": 1,
      "id": "d139f824-ed79-4318-904f-c54f983c383d",
      "name": "Sticky Note18"
    },
    {
      "parameters": {
        "content": "# Divis√£o de Mensagens Inteligente - Texto",
        "height": 80,
        "width": 736,
        "color": 5
      },
      "id": "7c81b330-cbba-41d8-bf44-267417c75755",
      "name": "Sticky Note19",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        8448,
        4192
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        9200,
        5120
      ],
      "id": "80c24c47-dd25-4fa3-81f1-61649fe9a03e",
      "name": "OpenAI Chat Model2"
    },
    {
      "parameters": {
        "content": "",
        "height": 400,
        "width": 1620,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        8400,
        4832
      ],
      "typeVersion": 1,
      "id": "5463cf0d-7347-4529-bccf-9f101c6e98d3",
      "name": "Sticky Note44"
    },
    {
      "parameters": {
        "content": "# AVISAR NOVO LEAD NO GRUPO",
        "height": 80,
        "width": 656,
        "color": 5
      },
      "id": "5b234ba9-d435-425c-b499-2e9019a08633",
      "name": "Sticky Note45",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        8432,
        4864
      ]
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "DevTower",
        "remoteJid": "={{ $('Dados').item.json.Telefone }}",
        "messageText": "={{ $json.output }}",
        "options_message": {
          "delay": 4200,
          "linkPreview": false
        }
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        9424,
        4496
      ],
      "id": "db996c62-b11c-4126-b77e-6e8a7c5d9a98",
      "name": "Evolution API"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "DevTower",
        "remoteJid": "={{ $('Dados').item.json.Telefone }}",
        "messageText": "={{ $json.output }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        8448,
        4960
      ],
      "id": "a0ebb3e9-2497-4a00-9119-f1bdea51f866",
      "name": "Evolution API1"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "DevTower",
        "remoteJid": "12036341843329@g.us",
        "messageText": "={{ (() => { \n  const telefone = $('Dados').item.json.Telefone;\n  return 'üö® Novo Lead: wa.me/' + telefone.split('@')[0] + ' üö®';\n})() }}\n\n*Cliente:* {{ $('Dados').item.json.NomeWpp }}\n\n*CASO:*\n{{ $json.text }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        9568,
        4960
      ],
      "id": "b55152ed-dc5d-485d-9172-e5ae6a07ae27",
      "name": "Evolution API2"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        9152,
        3904
      ],
      "id": "97a1d823-fa39-48d4-bb9b-e7c5d87afe12",
      "name": "Merge1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "defac08a-6745-422b-bb05-90da9f47d91b",
              "leftValue": "={{ $('Busca Telefone').last().json.values() }}",
              "rightValue": "",
              "operator": {
                "type": "array",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        8640,
        3904
      ],
      "id": "b70c481f-686d-4fd9-b221-bb84a31aff29",
      "name": "If4"
    },
    {
      "parameters": {
        "content": "",
        "height": 380,
        "width": 1380,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        8432,
        3760
      ],
      "typeVersion": 1,
      "id": "74a36d0c-2bf0-4891-b99b-72f5204093a1",
      "name": "Sticky Note54"
    },
    {
      "parameters": {
        "content": "# Cadastra Chat Supabase",
        "height": 80,
        "width": 450,
        "color": 5
      },
      "id": "4fd6d1a0-732f-4b9f-9bec-56a7097352f5",
      "name": "Sticky Note55",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        8448,
        3776
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "chats",
        "filters": {
          "conditions": [
            {
              "keyName": "phone",
              "keyValue": "={{ $('Webhook EVO').item.json.body.data.key.remoteJid }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        8480,
        3904
      ],
      "id": "029870a5-fb64-4ae4-9f9b-f5e299820fb5",
      "name": "Busca Telefone",
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "tableId": "chats",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "phone",
              "fieldValue": "={{ $('Dados').item.json.Telefone }}"
            },
            {
              "fieldId": "updated_at",
              "fieldValue": "={{ $now}}"
            },
            {
              "fieldId": "created_at",
              "fieldValue": "={{ $now}}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        8928,
        3792
      ],
      "id": "d73164a4-f402-4d31-969f-321664b8547b",
      "name": "Adiciona CHAT supabase"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "chats",
        "filters": {
          "conditions": [
            {
              "keyName": "phone",
              "condition": "eq",
              "keyValue": "={{ $('Dados').item.json.Telefone }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "updated_at",
              "fieldValue": "={{ $now }}"
            },
            {
              "fieldId": "created_at",
              "fieldValue": "={{ $now }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        8944,
        3984
      ],
      "id": "b2854719-6be5-4d31-8995-d12308f2d218",
      "name": "Atualiza CHAT Supabase",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "tableId": "chat_messages",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "phone",
              "fieldValue": "={{ $('Dados').item.json.Telefone }}"
            },
            {
              "fieldId": "bot_message",
              "fieldValue": "={{ $('Atendente6').item.json.output }}"
            },
            {
              "fieldId": "user_message",
              "fieldValue": "={{ $('Dados').item.json.message.content }}"
            },
            {
              "fieldId": "message_type",
              "fieldValue": "={{ $('Dados').item.json.body.event }}"
            },
            {
              "fieldId": "created_at",
              "fieldValue": "={{ $now }}"
            },
            {
              "fieldId": "nomewpp",
              "fieldValue": "={{ $('Dados').item.json.NomeWpp }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        9344,
        3904
      ],
      "id": "3c0098bf-ef96-42cd-af4d-944aab6f793e",
      "name": "Cria Hist√≥rico Supabase"
    },
    {
      "parameters": {
        "fieldToSplitOut": "output.messages",
        "options": {
          "destinationFieldName": "output"
        }
      },
      "id": "ceeb6937-142c-430d-8f4d-ffedbdf16df7",
      "name": "Split de Mensagem",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        8928,
        4480
      ]
    },
    {
      "parameters": {
        "amount": 1
      },
      "id": "c6d25ccf-2b41-459b-9a38-3e1a7d48509c",
      "name": "1 segundo",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        9648,
        4496
      ],
      "webhookId": "a2c69e1c-13fe-44a2-962c-1249288537eb"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $('Dados').item.json.Telefone }}"
      },
      "id": "0e9f09e2-7643-4cbe-8c40-3f1b9592f8e1",
      "name": "Delete Memory",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        9552,
        3904
      ]
    },
    {
      "parameters": {
        "name": "buscar_documentos",
        "description": "Analise o documento se encontrar uma informa√ß√£o que seja relevante traga o texto dele como resposta sem altera√ß√µes, caso n√£o encontre devolva o resultado em branco sem nem um texto",
        "topK": 2
      },
      "id": "e823ab71-a1cc-485a-ab2c-c0376bc335d4",
      "name": "buscar_documentos",
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1,
      "position": [
        7024,
        4304
      ]
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "chat_messages",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "phone",
              "condition": "eq",
              "keyValue": "={{ $('Dados').item.json.Telefone }}"
            },
            {
              "keyName": "active",
              "condition": "eq",
              "keyValue": "true"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        8640,
        4960
      ],
      "id": "7c796c4d-8558-4737-bffe-d68ddbb82bc9",
      "name": "ListMessages-Supabase2",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "conversas",
        "include": "specifiedFields",
        "fieldsToInclude": "id,message_type,created_at,user_message, bot_message,phone",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        8848,
        4960
      ],
      "id": "f25921d7-5d11-4067-b763-863f5f085f19",
      "name": "Aggregate2"
    },
    {
      "parameters": {
        "jsCode": "return $('Aggregate2').all().map(item => {\n  // Tenta acessar a propriedade 'conversas' e verifica se ela √© um array\n  const conversas = item.json.conversas || []; // Garante que √© pelo menos um array vazio\n\n  if (!Array.isArray(conversas)) {\n    throw new Error(\"A propriedade 'conversas' n√£o √© um array.\");\n  }\n\n  // Processa cada conversa e verifica as mensagens\n  const textoUnico = conversas.map(conversa => {\n    const cliente = conversa.user_message || \"sem mensagem do chatbot\";\n    const agente = conversa.bot_message || \"sem resposta\";\n    \n    // Verifica se a data existe e formata\n    const dataOriginal = conversa.created_at || \"Data da Mensagem indispon√≠vel\";\n    const dataFormatada = dataOriginal !== \"Data da Mensagem indispon√≠vel\"\n      ? formatarData(dataOriginal)\n      : dataOriginal;\n\n    return `em: ${dataFormatada}\\n\\n - agente(chatbot): ${agente} \\n - cliente: ${cliente}\\n`;\n  }).join('\\n\\n');\n\n  // Retorna o texto final como resultado\n  return {\n    json: {\n      texto: textoUnico\n    }\n  };\n});\n\n// Fun√ß√£o para formatar a data\nfunction formatarData(dataString) {\n  const data = new Date(dataString); // Converte a string em objeto Date\n  if (isNaN(data)) {\n    return \"Data inv√°lida\"; // Retorna se a data n√£o for v√°lida\n  }\n  \n  // Formata no padr√£o DD/MM/YYYY HH:mm\n  const dia = String(data.getDate()).padStart(2, '0');\n  const mes = String(data.getMonth() + 1).padStart(2, '0'); // M√™s come√ßa em 0\n  const ano = data.getFullYear();\n  const horas = String(data.getHours()).padStart(2, '0');\n  const minutos = String(data.getMinutes()).padStart(2, '0');\n  \n  return `${dia}/${mes}/${ano} ${horas}:${minutos}`;\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        9024,
        4960
      ],
      "id": "29d0fb3e-9465-47c5-9b7f-32c683b9979c",
      "name": "Code6"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={\n  \"role\": \"Agente Resumidor de atendimento\",\n  \"proposito\": \"Analisar conversas cliente-agente e criar resumos detalhados do atendimento\",\n  \"instrucoes\": {\n    \"tarefa_principal\": \"Extrair e resumir apenas sobre o atendimento do cliente a partir das conversas\",\n    \"formato\": \"Incluir data da sess√£o quando dispon√≠vel\",\n    \"foco\": \"demandas do cliente, excluir respostas do agente\",\n    \"estilo\": \"Resumos detalhados mas concisos\",\n    \"evitar\": \"Dicas de uso, informa√ß√µes extras ou explica√ß√µes\",\n    \"Me de o resultado somente com o resumo sem caracteres especiais\"\n  },\n  \"formato_entrada\": {\n    \"conversa\": \"{{ $json.texto }}\"\n  },\n  \"formato_saida\": {\n    \"resumo\": \"Descri√ß√£o concisa do caso do cliente e data que ele gostaria de agendar uma reruni√£o\"\n  }\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.5,
      "position": [
        9232,
        4960
      ],
      "id": "217e0e92-5530-4b64-bef9-4c258e43b067",
      "name": "Basic LLM Chain1"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "keyValue": "={{ $('Dados').item.json.Telefone }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2784,
        4416
      ],
      "id": "11da5955-335e-4d3a-9b3b-7460862276be",
      "name": "Supabase",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4a6d9aac-8565-4c58-abe3-8741393a5535",
              "leftValue": "={{ $json.telefone }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        3024,
        4336
      ],
      "id": "9fdf3e9d-a93b-4ae9-905b-569ea996bc7d",
      "name": "If1"
    },
    {
      "parameters": {
        "tableId": "dados_cliente",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "nomewpp",
              "fieldValue": "={{ $('Dados').item.json.NomeWpp }}"
            },
            {
              "fieldId": "telefone",
              "fieldValue": "={{ $('Webhook EVO').item.json.body.data.key.remoteJid }}"
            },
            {
              "fieldId": "created_at",
              "fieldValue": "={{ $now}}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        3200,
        4496
      ],
      "id": "6749b596-84f0-4597-8cd4-22f2396ee041",
      "name": "Supabase1"
    },
    {
      "parameters": {
        "content": "",
        "height": 620,
        "width": 980,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        5648,
        4032
      ],
      "typeVersion": 1,
      "id": "910cbcf3-48a1-4909-9ec0-e9ed818eb540",
      "name": "Sticky Note17"
    },
    {
      "parameters": {
        "content": "",
        "height": 660,
        "width": 960,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        4640,
        4000
      ],
      "typeVersion": 1,
      "id": "c7d99d9c-c1c1-4ac2-bbdf-0c0f943b9468",
      "name": "Sticky Note20"
    },
    {
      "parameters": {
        "content": "",
        "height": 440,
        "width": 740,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        4224
      ],
      "typeVersion": 1,
      "id": "144a666d-2996-476c-b4c4-8cf1efc21e87",
      "name": "Sticky Note22"
    },
    {
      "parameters": {
        "content": "# Cadastrar Lead Supa Base",
        "height": 80,
        "width": 596,
        "color": 4
      },
      "id": "aa2f1dc3-1f4d-41c1-8dc3-1222182d7f07",
      "name": "Sticky Note23",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2704,
        4240
      ]
    },
    {
      "parameters": {
        "content": "",
        "height": 500,
        "width": 1120,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3488,
        4160
      ],
      "typeVersion": 1,
      "id": "42f63c65-5f61-4708-86bd-60e3b847ac21",
      "name": "Sticky Note26"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "DevTower",
        "options": {}
      },
      "id": "de52d725-be3b-4e1c-95ee-b55e8d433810",
      "name": "Webhook EVO",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        1168,
        3824
      ],
      "webhookId": "7ecd43ed-123c-4fef-b86d-f9ce39e55d64"
    },
    {
      "parameters": {
        "content": "# Pausar IA",
        "height": 80,
        "width": 216,
        "color": 4
      },
      "id": "b9a0509e-9ff0-447c-83e1-29f20bdad36c",
      "name": "Sticky Note41",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        3488,
        4160
      ]
    },
    {
      "parameters": {
        "content": "",
        "height": 460,
        "width": 1140,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1104,
        3664
      ],
      "typeVersion": 1,
      "id": "9fb9c15a-ffe6-4caa-b17f-e13b6ae10d60",
      "name": "Sticky Note32"
    },
    {
      "parameters": {
        "content": "## WEBHOOK & ROTAS",
        "height": 80,
        "width": 276,
        "color": 4
      },
      "id": "2a59a624-2da1-4a27-8609-a91988dc3b18",
      "name": "Sticky Note67",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1168,
        3696
      ]
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "options": {
          "fileName": "file.png",
          "mimeType": "image/png"
        }
      },
      "id": "c94599a3-cb89-4862-b11d-61932b1e658d",
      "name": "Convert to File1",
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        4912,
        4496
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3c5ccbc9-69d1-4b13-a7c3-e6945bc8c655",
              "name": "data",
              "value": "={{ $('Webhook EVO').item.json.body.data.message.base64 }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "8ac46964-f938-46d7-ac24-5f67ac586192",
      "name": "Edit Fields3",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4768,
        4496
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "ade56c50-1520-4760-8df5-e99617d6d3ad",
              "leftValue": "={{ $('Webhook EVO').item.json.body.data.message.imageMessage.caption }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "29d2d125-8cac-42be-a19c-5f010a9b8a4d",
      "name": "If3",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        5248,
        4496
      ]
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Dados').item.json.Telefone }}",
        "messageData": "={{ $('Dados').item.json.message.content }}, {{ $json.content.replace(/\\n/g, \"\\\\n\").replace(/['\"]/g, '').trim()  }}",
        "tail": true
      },
      "id": "b1833160-a4f6-4d3d-bb52-d349a2a183b7",
      "name": "Redis4",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        5408,
        4512
      ]
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Dados').item.json.Telefone }}",
        "messageData": "={{ $json.content.replace(/\\n/g, \"\\\\n\").replace(/['\"]/g, '').trim()  }}",
        "tail": true
      },
      "id": "7bdb8d67-2647-4a2d-9a14-567a5dd2e3a1",
      "name": "Redis5",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        5408,
        4336
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "52aaf749-fe4f-44e4-880e-15b2bfc027f1",
                    "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                    "rightValue": "extendedTextMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "e514e613-fd6a-48bd-b0ae-bae2448c810e",
                    "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                    "rightValue": "conversation",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                    "rightValue": "audioMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "c0e434dd-1268-421d-b81b-3a5e90ed9550",
                    "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                    "rightValue": "imageMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "image"
            }
          ]
        },
        "options": {}
      },
      "id": "f06c5151-3dc7-4e32-8773-3f9687fc9a5d",
      "name": "Switch1",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        4688,
        4224
      ]
    },
    {
      "parameters": {
        "content": "# Mensagem Picotada",
        "height": 80,
        "width": 396,
        "color": 4
      },
      "id": "ea1dbe35-f431-4c91-b623-e9eba6bbdec6",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        5648,
        4032
      ]
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "text": "Analise a imagem e me traga um resumo simples e o mais curto poss√≠vel do que ela √©",
        "inputType": "base64",
        "options": {}
      },
      "id": "3adde32b-2c26-41e6-8a0a-0eedbf34aabe",
      "name": "OpenAI1",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.6,
      "position": [
        5072,
        4496
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "d5a342e9-585b-42ea-be44-644adae10199",
              "leftValue": "={{ $json.Redis2 }}",
              "rightValue": "={{ $json.Redis1 }}",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "d79678e1-b844-4f93-a6a3-aae76ba903b9",
      "name": "Compara Get Memory1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        6288,
        4304
      ]
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Dados').item.json.Telefone }}",
        "messageData": "={{ $('Dados').item.json.message.content }}",
        "tail": true
      },
      "id": "cc623935-6917-42eb-a922-457e360ccb20",
      "name": "Text Memory1",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        5408,
        4016
      ]
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Dados').item.json.Telefone }}",
        "messageData": "={{ $json.text }}",
        "tail": true
      },
      "id": "76a79a31-76aa-491e-9db5-f05b1c9c9b3f",
      "name": "Audio Memory1",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        5408,
        4176
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f336a1ff-e577-489d-a739-1eb8bd509245",
              "name": "Redis2",
              "value": "={{ $json.propertyName }}",
              "type": "string"
            },
            {
              "id": "946d1420-e379-46e3-8fcd-3816340fbabb",
              "name": "Redis1",
              "value": "={{ $('Get Memory 1').item.json.propertyName }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "7d0dc3fa-a9d7-4160-a552-8452e423b695",
      "name": "Edit Fields8",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        6128,
        4304
      ]
    },
    {
      "parameters": {
        "amount": 3
      },
      "id": "8bdde960-0b0d-4687-8516-bfcccb6fe4bf",
      "name": "Wait3",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        5824,
        4304
      ],
      "webhookId": "9f0edf0b-ca36-42a6-bab6-bf62ca08ac51"
    },
    {
      "parameters": {
        "operation": "get",
        "key": "={{ $('Dados').item.json.Telefone }}",
        "options": {}
      },
      "id": "ab04e028-b2bb-49ae-b015-7b9b0fff9d1d",
      "name": "Get Memory 1",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        5680,
        4304
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "key": "={{ $('Dados').item.json.Telefone }}",
        "options": {}
      },
      "id": "7a44bee5-66b9-41a5-8646-f1d2c3d31ec3",
      "name": "Get Memory 2",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        5984,
        4304
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Dados').item.json.message.event }}",
                    "rightValue": "outcoming",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "7c878f9b-2c93-4061-954a-a832153e7647"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "outcoming"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "d7b42536-638f-4128-b51b-6aa913e9d9bc",
                    "leftValue": "={{ $('Dados').item.json.message.event }}",
                    "rightValue": "incoming",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "incoming"
            }
          ]
        },
        "options": {}
      },
      "id": "7531ebd1-b0c2-44be-bb51-e8d439c97a05",
      "name": "Switch6",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        3552,
        4400
      ]
    },
    {
      "parameters": {
        "content": "# Filtro de mensagem",
        "height": 80,
        "width": 356,
        "color": 4
      },
      "id": "c6aa4f9b-7154-4f86-b660-c4cd00a14016",
      "name": "Sticky Note7",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        4640,
        4000
      ]
    },
    {
      "parameters": {
        "jsCode": "const redis1 = JSON.parse($json.Redis1);\nconst redis2 = JSON.parse($json.Redis2);\n\nconst combinadoSemDuplicatas = Array.from(new Set([...redis1, ...redis2]));\n\nconst mensagem = combinadoSemDuplicatas.join(\" \");\n\nreturn [{ json: { mensagem_completa: mensagem } }];"
      },
      "id": "1fcedefe-f906-436b-99ee-df46f3a75214",
      "name": "Mensagem Completa",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        6512,
        4272
      ]
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "options": {
          "fileName": "file.ogg",
          "mimeType": "application/ogg"
        }
      },
      "id": "2e33bdc3-a911-4d45-8bea-49cf1da5ef52",
      "name": "Convert to File",
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        5040,
        4304
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3c5ccbc9-69d1-4b13-a7c3-e6945bc8c655",
              "name": "data",
              "value": "={{ $('Webhook EVO').item.json.body.data.message.base64 }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "b1444f5f-8f6b-4f91-a518-8e7d36825ca5",
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4880,
        4304
      ]
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "id": "8bf4f64a-2bc5-4bcd-a5dd-1cfa9ddd68a4",
      "name": "OpenAI",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.6,
      "position": [
        5232,
        4304
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "gpt-4o-mini"
        },
        "options": {}
      },
      "id": "59a035e6-d272-4b3f-aa3c-ae5bcab3fdd9",
      "name": "OpenAI Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        2784,
        5344
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "content": "## Agente treinamento RAG, ativa√ß√£o autom√°tica como o texto: TreinoIA1212:",
        "height": 780,
        "width": 2260,
        "color": 4
      },
      "id": "6f6dea92-d8c3-4b1f-970f-3905ee62744c",
      "name": "Sticky Note11",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        4864
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Use para buscar informa√ß√µes na planilha caso tenha um treinamento paricido devovlea o numeroo da rtoow para ela ser atualziada",
        "documentId": {
          "__rl": true,
          "value": "1CSEZu8voEQ6Rl61YIwNXF_WA5VxfFqhcBcp-REZ2_8g",
          "mode": "list",
          "cachedResultName": "Treinamento Agente IA",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1CSEZu8voEQ6Rl61YIwNXF_WA5VxfFqhcBcp-REZ2_8g/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "P√°gina1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1CSEZu8voEQ6Rl61YIwNXF_WA5VxfFqhcBcp-REZ2_8g/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.5,
      "position": [
        2944,
        5344
      ],
      "id": "937e9bb9-da86-4097-bf61-64073f690b4e",
      "name": "Treinamento_feito"
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "id": "8125b178-7431-420c-b2bb-b0fa4b794a7e",
      "name": "Insert into Supabase Vectorstore1",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        4592,
        4992
      ]
    },
    {
      "parameters": {
        "separator": "/n",
        "chunkSize": 1200,
        "chunkOverlap": 200
      },
      "id": "a5772103-4eb9-4cef-888d-fc90700437c3",
      "name": "Character Text Splitter1",
      "type": "@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        4720,
        5456
      ]
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "include": "allFieldsExcept",
        "fieldsToExclude": "rew_number",
        "options": {}
      },
      "id": "7ff47103-9e8f-4f12-ba5f-14a910208747",
      "name": "Aggregate1",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        4192,
        5152
      ]
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "f74a90cf-7e1b-4047-9fe4-41585e7d37a9",
      "name": "Embeddings OpenAI2",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1,
      "position": [
        4384,
        5424
      ]
    },
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $json.data || $json.text || $json.concatenated_data }}",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "Arquivo",
                "value": "={{ $('Download File1').item.json.name }}"
              }
            ]
          }
        }
      },
      "id": "b1020277-1a4d-42b1-9109-75c9e32022d9",
      "name": "Default Data Loader1",
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1,
      "position": [
        4608,
        5280
      ]
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "text/plain"
            }
          }
        }
      },
      "id": "b7b87a41-f004-483e-b58e-67da884588cc",
      "name": "Download File1",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        3504,
        5152
      ],
      "executeOnce": false
    },
    {
      "parameters": {
        "operation": "xlsx",
        "options": {}
      },
      "id": "63e49a08-39f3-48df-b9d3-a2e2e39ac797",
      "name": "Extract from Excel2",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        3984,
        5072
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Webhook EVO').item.json.body.data.message.conversation || '' }}",
        "options": {
          "systemMessage": "={\n  \"name\": \"AgenteTreinamentoPlanilha\",\n  \"objectives\": [\n    \"Receber um texto e corrigi-lo\",\n    \"Verificar se j√° existe pergunta similar na planilha\",\n    \"Atualizar a planilha com a pergunta e a resposta corrigida\",\n    \"Caso pe√ßa para atualizar, n√£o execute nem uma tool\"\n  ],\n  \"tools\": [\n    {\n      \"name\": \"Treinamento_feito\",\n      \"description\": \"Verifica se existe conte√∫do similar antes de atualizar, caso exista deve ser removido ou substitu√≠do\"\n    },\n    {\n      \"name\": \"Atualizar_treinamento\",\n      \"description\": \"Cria ou atualiza linha na planilha com as colunas: Pergunta e Resposta\"\n    }\n  ],\n  \"general_rules\": [\n    \"N√£o mencionar a planilha ou as ferramentas na resposta ao usu√°rio\",\n    \"Corrigir sempre o texto recebido antes de registrar no sistema\",\n    \"Seja preciso e consistente ao preencher as colunas pergunta e resposta\",\n    \"Gere sua resposta sem acentos nas palavras ou caracteres especiais\"\n  ]\n}\n"
        }
      },
      "id": "30a6ca72-af16-4a54-b860-d65337b652dd",
      "name": "Agente Treinamento RAG",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        2752,
        5104
      ],
      "typeVersion": 1.8
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "9865cb5b-33da-490c-afc3-186457d5b564",
                    "operator": {
                      "type": "string",
                      "operation": "notStartsWith"
                    },
                    "leftValue": "={{ $json.message.content }}",
                    "rightValue": "TreinoIA1212:"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Rota normal"
            },
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "5a9a1fee-b408-469f-a08c-e8d690fc9792",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    },
                    "leftValue": "={{ $json.message.content }}",
                    "rightValue": "TreinoIA1212:"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Treinamento IA"
            }
          ]
        },
        "options": {}
      },
      "id": "40607412-fc3f-4e84-bc4b-8c785b38add1",
      "name": "Rotas",
      "type": "n8n-nodes-base.switch",
      "position": [
        2048,
        3936
      ],
      "typeVersion": 3.2
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $('Dados').item.json.Telefone }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "atendimento_ia",
              "fieldValue": "pause"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        4032,
        4192
      ],
      "id": "a3faa2cb-b98d-48a6-be3a-9cb737810282",
      "name": "Pausar IA"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "keyValue": "={{ $('Dados').item.json.Telefone }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        3824,
        4496
      ],
      "id": "a649d790-efe4-4999-85f7-78a9e0aec2cd",
      "name": "Verificar Pause"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.atendimento_ia }}",
                    "rightValue": "pause",
                    "operator": {
                      "type": "string",
                      "operation": "notStartsWith"
                    },
                    "id": "ff00573b-e517-43c6-8644-14a4fe8565d1"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Ia Ativa"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "3ef0e01c-cc14-4663-bb4d-2905b350c3ab",
                    "leftValue": "={{ $json.atendimento_ia }}",
                    "rightValue": "pause",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Ia pausada"
            }
          ]
        },
        "options": {}
      },
      "id": "f8140ecb-2b3e-461f-b3c9-214ee62a4763",
      "name": "Rota Atendimento",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        4064,
        4496
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "9865cb5b-33da-490c-afc3-186457d5b564",
                    "operator": {
                      "type": "string",
                      "operation": "notEquals"
                    },
                    "leftValue": "={{ $('Rotas').item.json.message.content }}",
                    "rightValue": "Atendimento finalizado"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "IA Pausada"
            },
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "5a9a1fee-b408-469f-a08c-e8d690fc9792",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "leftValue": "={{ $('Rotas').item.json.message.content }}",
                    "rightValue": "Atendimento finalizado"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Reativar IA"
            }
          ]
        },
        "options": {}
      },
      "id": "72003e19-264e-4409-96e9-3a79556fc03c",
      "name": "Rotas1",
      "type": "n8n-nodes-base.switch",
      "position": [
        3712,
        4272
      ],
      "typeVersion": 3.2
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $('Dados').item.json.Telefone }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "atendimento_ia",
              "fieldValue": "reativada"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        4192,
        4320
      ],
      "id": "dc40fd70-67bf-43db-8eb7-7336f8956618",
      "name": "Reativar IA"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "11800d83-ecca-4f9c-a878-a2419db0c8e9",
              "name": "message.chat_id",
              "value": "={{ $('Webhook EVO').item.json.body.data.key.remoteJid || '' }}",
              "type": "string"
            },
            {
              "id": "c33f9527-e661-49e5-8e5e-64f3b430928a",
              "name": "message.content_type",
              "value": "={{ $('Webhook EVO').item.json.body.data.message.extendedTextMessage ? 'text' : '' }}{{ $('Webhook EVO').item.json.body.data.message.conversation ? 'text' : '' }}{{ $('Webhook EVO').item.json.body.data.message.audioMessage ? 'audio' : '' }}{{ $('Webhook EVO').item.json.body.data.message.imageMessage ? 'image' : '' }}",
              "type": "string"
            },
            {
              "id": "06eba1c9-cff0-4f68-b6da-6bb0092466b7",
              "name": "message.content",
              "value": "={{ $('Webhook EVO').item.json.body.data.message.extendedTextMessage?.text || '' }}{{ $('Webhook EVO').item.json.body.data.message.imageMessage?.caption || '' }}{{ $('Webhook EVO').item.json.body.data.message.conversation || '' }}",
              "type": "string"
            },
            {
              "id": "b97f1af3-5361-46fc-9303-d644921231d8",
              "name": "message.timestamp",
              "value": "={{ $('Webhook EVO').item.json.body.data.messageTimestamp.toDateTime('s').toISO() }}",
              "type": "string"
            },
            {
              "id": "dc3dc59c-90a3-4a45-bea2-de092c91083b",
              "name": "message.content_url",
              "value": "={{ $('Webhook EVO').item.json.body.data.message.audioMessage?.url || '' }}{{ $('Webhook EVO').item.json.body.data.message.imageMessage?.url || '' }}",
              "type": "string"
            },
            {
              "id": "8b01a818-a456-476e-bace-adefe2f04eb4",
              "name": "message.event",
              "value": "={{ $('Webhook EVO').item.json.body.data.key.fromMe ? 'outcoming' : 'incoming' }}",
              "type": "string"
            },
            {
              "id": "886e3751-e39b-4fc6-98d1-3113eaeebbb4",
              "name": "=body.event",
              "value": "={{ $('Webhook EVO').item.json.body.event }}",
              "type": "string"
            },
            {
              "id": "d04a0c6e-7842-41d2-bdb0-c0ce51d6dad7",
              "name": "Telefone",
              "value": "={{ $('Webhook EVO').item.json.body.data.key.remoteJid }}",
              "type": "string"
            },
            {
              "id": "a57db642-3e13-452e-bb5b-19f7e9f3bd5d",
              "name": "NomeWpp",
              "value": "={{ $json.body.data.pushName }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "79d4216b-ce42-46d5-8ba4-e2871ff2463a",
      "name": "Dados",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1392,
        3824
      ]
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        3904,
        4352
      ],
      "id": "3b525086-af80-4bba-abe7-8b5fecab14bd",
      "name": "Wait",
      "webhookId": "b9c0dc3b-a05b-4e71-bcbe-fee8c71142a2"
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "n8n_chat_histories",
          "mode": "list",
          "cachedResultName": "n8n_chat_histories"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "session_id": "={{ $('Dados').item.json.Telefone }}",
            "message": "={\"type\": \"ai\", \"content\": \"{{ $('Rotas').item.json.message.content.replace(/\\n/g, ' ') }}\", \"additional_kwargs\": {}, \"response_metadata\": {}}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "session_id",
              "displayName": "session_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "message",
              "displayName": "message",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        4400,
        4480
      ],
      "id": "35ab55fb-a5ac-499b-a4bc-7203733ca374",
      "name": "Salvar Historicoo Humano1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        6720,
        4320
      ],
      "id": "a6153d67-569e-45b9-a7f2-739b6bffab54",
      "name": "OpenAI Chat Model4"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.mensagem_completa }}",
        "options": {
          "systemMessage": "={\n  \"name\": \"AgenteRag\",\n  \"objectives\": [\n    \"Responder somente com dados obtidos da ferramenta buscar_documentos, sem dicas extras\"\n  ],\n  \"tools\": [\n    {\n      \"name\": \"buscar_documentos\",\n      \"description\": \"Use esta ferramenta para obter a resposta. Se n√£o houver dados, retorne: n√£o invente resposta somente do que vier da tool buscar_documentos'.\",\n      \"required\": true\n    }\n  ],\n  \"general_rules\": [\n    \"N√£o inventar respostas\",\n    \"Sempre usar a ferramenta buscar_documentos\",\n    \"caso n√£o tenha uma resposta envie a resposta assim: sem dica de resposta\"\n  ]\n}\n"
        }
      },
      "id": "ae4b662d-1323-4844-a31d-cbb646c3920d",
      "name": "Agente Rag",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        6720,
        4144
      ]
    },
    {
      "parameters": {
        "content": "# Agente RAG",
        "height": 80,
        "width": 336,
        "color": 4
      },
      "id": "3a21254f-f43d-47bf-a1a9-50f91cff5093",
      "name": "Sticky Note10",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        6688,
        4032
      ]
    },
    {
      "parameters": {
        "content": "",
        "height": 620,
        "width": 820,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        6672,
        4032
      ],
      "typeVersion": 1,
      "id": "29e1fdbb-04f3-4ea1-8a7b-85be2f96be62",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Analise se j√° existeuma coluca pareceida se sim atualize ela se n√£o crie uma nova linha",
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1CSEZu8voEQ6Rl61YIwNXF_WA5VxfFqhcBcp-REZ2_8g",
          "mode": "list",
          "cachedResultName": "Treinamento Agente IA",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1CSEZu8voEQ6Rl61YIwNXF_WA5VxfFqhcBcp-REZ2_8g/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "P√°gina1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1CSEZu8voEQ6Rl61YIwNXF_WA5VxfFqhcBcp-REZ2_8g/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Pergunta": "={{ $fromAI(\"Pergunta\",\"isso √© a pergunta\") }}",
            "Resposta": "={{ $fromAI(\"Resposta\",\"isso √© a resposta\") }}"
          },
          "matchingColumns": [
            "Pergunta"
          ],
          "schema": [
            {
              "id": "Pergunta",
              "displayName": "Pergunta",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Resposta",
              "displayName": "Resposta",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "26501083-ea1f-42ec-9359-8770689f8023",
      "name": "Atualizar_treinamento",
      "type": "n8n-nodes-base.googleSheetsTool",
      "position": [
        3088,
        5264
      ],
      "typeVersion": 4.5
    },
    {
      "parameters": {
        "operation": "text",
        "options": {}
      },
      "id": "81611337-de97-4e19-a036-0f83a8a02ee4",
      "name": "Extract Document Text",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        3984,
        5456
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "id": "ba241f3c-418c-436a-b26a-d9a45674e021",
      "name": "Extract PDF Text",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        3984,
        4896
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.mimeType }}",
                    "rightValue": "application/pdf",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "d324b22b-cdf4-4216-a5ac-7db17ab11851"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "PDF"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "2ae7faa7-a936-4621-a680-60c512163034",
                    "leftValue": "={{ $json.mimeType }}",
                    "rightValue": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "excel"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "8bd558b2-8c70-4edd-ab19-92540895ae46",
                    "leftValue": "={{ $json.mimeType }}",
                    "rightValue": "application/vnd.google-apps.spreadsheet",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "CVS"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "fc193b06-363b-4699-a97d-e5a850138b0e",
                    "leftValue": "={{ $json.mimeType }}",
                    "rightValue": "application/vnd.google-apps.document",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Google Docs"
            }
          ]
        },
        "options": {
          "fallbackOutput": 3
        }
      },
      "id": "43ce3099-759c-4006-bcb9-7d9b5c7cedcd",
      "name": "Switch",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        3680,
        5136
      ]
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "aggregation": "concatenate",
              "field": "data"
            }
          ]
        },
        "options": {}
      },
      "id": "9a8984f1-4069-4655-b1dd-03f5a16546f3",
      "name": "Summarize1",
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1,
      "position": [
        4352,
        5120
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "5fe26e5f-d612-4de6-a380-cfcf39bdf6d9",
      "name": "Extract from Excel",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        3984,
        5280
      ]
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "returnAll": true,
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "18-CqlOjNbInksf8wj4nK41rl3Os-paYs",
            "mode": "list",
            "cachedResultName": "TREINAMENTO IA DEVTOWER",
            "cachedResultUrl": "https://drive.google.com/drive/folders/18-CqlOjNbInksf8wj4nK41rl3Os-paYs"
          }
        },
        "options": {
          "fields": [
            "mimeType",
            "id",
            "name"
          ]
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        3328,
        5152
      ],
      "id": "51096f9c-5272-4dc7-8d09-ab1f0c970b0a",
      "name": "Google Drive",
      "executeOnce": true
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "documents",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "neq",
              "keyValue": "0"
            }
          ]
        }
      },
      "id": "a7dbd4a5-b5fa-4757-86ba-56323bf5ed0e",
      "name": "Deleta linhas antigas do documento1",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        3120,
        5024
      ],
      "alwaysOutputData": true,
      "executeOnce": false
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 5
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        2928,
        4912
      ],
      "id": "b4d3453a-9d4f-416e-b68b-01f982d53743",
      "name": "Schedule Trigger",
      "disabled": true
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "n8n_chat_histories",
          "mode": "list",
          "cachedResultName": "n8n_chat_histories"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "session_id": "={{ $('Dados').item.json.Telefone }}",
            "message": "={\"type\": \"human\", \"content\": \"{{ $('Rotas').item.json.message.content.replace(/\\n/g, ' ') }}\", \"additional_kwargs\": {}, \"response_metadata\": {}}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "session_id",
              "displayName": "session_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "message",
              "displayName": "message",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        4384,
        4176
      ],
      "id": "e193f5c1-7f87-45a5-a348-f8d97f776288",
      "name": "Salvar Historicoo Humano"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $('Dados').item.json.Telefone }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "atendimento_ia",
              "fieldValue": "pause"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        9808,
        4960
      ],
      "id": "ae04a012-01fe-410b-b92b-516a78bda5e0",
      "name": "Pausar IA1"
    },
    {
      "parameters": {},
      "id": "f147beed-0b2e-444f-b96c-232e3d83ae28",
      "name": "Execute Workflow Trigger",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [
        5888,
        3456
      ]
    },
    {
      "parameters": {
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "e598b0c9eef217ebae69caabf7f9f17969e71c7551b3ea56caafea679433115d@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Agendamentos Agentes IA"
        },
        "returnAll": true,
        "options": {
          "timeMin": "={{ $json.timestamp }}"
        }
      },
      "id": "36473bc7-5939-4c53-a602-b0b466bd70e4",
      "name": "Google Calendar",
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1.2,
      "position": [
        5504,
        5264
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "806d2106-d234-428e-a909-db00044fc342",
              "leftValue": "={{ $json.start.dateTime }}",
              "rightValue": "={{ $('Schedule Trigger1').item.json.timestamp.toDateTime().plus(0, minutes) }}",
              "operator": {
                "type": "dateTime",
                "operation": "after"
              }
            },
            {
              "id": "aab42f56-d82f-434d-8319-00e3c2c690f3",
              "leftValue": "={{ $json.start.dateTime }}",
              "rightValue": "={{ $('Schedule Trigger1').item.json.timestamp.toDateTime().plus(5, minutes) }}",
              "operator": {
                "type": "dateTime",
                "operation": "before"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        5888,
        5536
      ],
      "id": "11ef5491-60c1-4a49-a12e-6fba27b8c890",
      "name": "5 Minutos antes",
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "806d2106-d234-428e-a909-db00044fc342",
              "leftValue": "={{ $json.start.dateTime }}",
              "rightValue": "={{ $('Schedule Trigger1').item.json.timestamp.toDateTime().plus(55, minutes) }}",
              "operator": {
                "type": "dateTime",
                "operation": "after"
              }
            },
            {
              "id": "aab42f56-d82f-434d-8319-00e3c2c690f3",
              "leftValue": "={{ $json.start.dateTime }}",
              "rightValue": "={{ $('Schedule Trigger1').item.json.timestamp.toDateTime().plus(60, minutes) }}",
              "operator": {
                "type": "dateTime",
                "operation": "before"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        5968,
        5120
      ],
      "id": "729f4e95-e5ac-4850-b9b9-42e3b32ff7c4",
      "name": "2 Hora antes",
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "5427ed1f-2dd2-4f7c-b7f4-9b13cd780bc7",
              "leftValue": "={{ $json.kind }}",
              "rightValue": "calendar#event",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        6224,
        5104
      ],
      "id": "94ff9f5f-66b2-4895-8af0-cef4d49af28d",
      "name": "If7"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "5427ed1f-2dd2-4f7c-b7f4-9b13cd780bc7",
              "leftValue": "={{ $json.kind }}",
              "rightValue": "calendar#event",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        6080,
        5664
      ],
      "id": "6cb47cca-f70b-48ab-ae89-835c3ce5176c",
      "name": "If8"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "n8n_chat_histories",
        "filters": {
          "conditions": [
            {
              "keyName": "session_id",
              "keyValue": "={{ $('If7').item.json.summary.match(/\\d{12}/)[0] + '@s.whatsapp.net' }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        6752,
        5072
      ],
      "id": "031c3ee9-a1e9-4c54-b40d-8baa68efebd0",
      "name": "Supabase3",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a5af6299-68f1-4d3a-b2a7-c2ed65aa4ae6",
              "name": "remoteJid",
              "value": "={{ $('Loop Over Items4').item.json.description }}",
              "type": "string"
            },
            {
              "id": "fc721c8e-bfd6-4364-9c30-b0038118856f",
              "name": "Tempo",
              "value": "Crie uma mensagem avisando que falta 1 hora para a reuni√£o ",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        6480,
        5072
      ],
      "id": "c268285e-949a-4741-9db1-c61441ede4b5",
      "name": "Edit Fields5"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.sessionID }}",
        "contextWindowLength": 100
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        6992,
        5376
      ],
      "id": "8f3496c3-20f8-41ac-988f-b8d53f4c503a",
      "name": "Postgres Chat Memory1"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "n8n_chat_histories",
        "filters": {
          "conditions": [
            {
              "keyName": "session_id",
              "keyValue": "={{ $('If8').item.json.summary.match(/\\d{12}/)[0] + '@s.whatsapp.net' }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        6512,
        5424
      ],
      "id": "445d0f2f-90aa-4dfb-b8c2-5fadeff977b7",
      "name": "Supabase4",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Edit Fields2').item.json.Tempo }}",
        "options": {
          "systemMessage": "=Voc√™ foi acionado pois vai avisar quanto tempo falta para a apresenta√ß√£o, diga apenas o tempo que falta e se precisa de algo antes da reuni√£o, sem dicas de uso ou informa√ß√µes extras. Diga que a apresenta√ß√£o ser√° feita atrav√©s de uma v√≠deo chamada no Whatsapp"
        }
      },
      "id": "e66df1d2-fbb9-4389-b2aa-31a91956c430",
      "name": "Atendente2",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        6768,
        5584
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c930cacf-b5ee-4120-a192-d68715d71d57",
              "name": "remoteJid",
              "value": "={{ $('Google Calendar').item.json.description }}",
              "type": "string"
            },
            {
              "id": "e7775c3f-04e5-4b6f-9695-dad8654b7ff8",
              "name": "Tempo",
              "value": "Crie uma mensagem avisando que falta 5 minutos para a reuni√£o ",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        6288,
        5344
      ],
      "id": "1907d437-5036-42fb-9c01-7916b56d761d",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "DevTower",
        "remoteJid": "={{ $('Google Calendar').item.json.description }}",
        "messageText": "={{ $json.output }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        7424,
        5232
      ],
      "id": "5019117d-713f-448e-b4b6-6ea604a2a6bc",
      "name": "Evolution API7"
    },
    {
      "parameters": {
        "content": "# AVISO REUNI√ÉO CHEGANDO",
        "height": 80,
        "width": 551.2183277924504,
        "color": 5
      },
      "id": "911d9c5e-0895-4541-b7cb-49fbbed92c8b",
      "name": "Sticky Note27",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        5232,
        5056
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes"
            }
          ]
        }
      },
      "id": "a435e872-dca1-4d0b-9e4c-9c7895415ba0",
      "name": "Schedule Trigger1",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        5280,
        5200
      ],
      "disabled": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        6768,
        5376
      ],
      "id": "5ca468f0-cec2-45e5-8420-2eb96ba9e984",
      "name": "OpenAI Chat Model5"
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "cad06ca6-73fa-49ec-a5f5-bec2b54ccab8",
      "name": "Loop Over Items4",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        5744,
        5280
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Edit Fields5').item.json.Tempo }}",
        "options": {
          "systemMessage": "=Voc√™ foi acionado pois vai avisar quanto tempo falta para a apresenta√ß√£o, diga apenas o tempo que falta e se precisa de algo antes da reuni√£o, sem dicas de uso ou informa√ß√µes extras"
        }
      },
      "id": "a9568647-353e-4f8e-952b-fbf8758f6562",
      "name": "Atendente3",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        7024,
        5104
      ]
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        7424,
        5680
      ],
      "id": "715e3e9f-886f-432a-b9f0-3a32aa5f09e2",
      "name": "Wait1",
      "webhookId": "d72239cb-b635-4ac2-95b6-0f66b77e9b6c"
    },
    {
      "parameters": {
        "content": "",
        "height": 881,
        "width": 2503,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        5200,
        4992
      ],
      "typeVersion": 1,
      "id": "8b2a946c-cbfa-4035-910d-70971af7cb10",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "triggerTimes": {
          "item": [
            {
              "mode": "custom",
              "cronExpression": "*/12 8-16 * * 1-5"
            }
          ]
        }
      },
      "name": "Cron Prospec√ß√£o",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [
        464,
        2544
      ],
      "id": "c71205ce-f6a9-4d43-842d-bc6951d681e4"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "Prospec√ß√£o",
        "limit": 1,
        "filters": {
          "conditions": [
            {
              "keyName": "status",
              "condition": "eq",
              "keyValue": "novo"
            }
          ]
        }
      },
      "name": "Buscar Lead Prospec√ß√£o",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        704,
        2544
      ],
      "id": "4412494f-4ef1-4716-ad83-7eab98d73ee4"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "DevTower",
        "remoteJid": "={{ $('Buscar Lead Prospec√ß√£o').item.json.telefone }}",
        "messageText": "={{ $json.output }}",
        "options_message": {}
      },
      "name": "Enviar Mensagem Inicial",
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        1904,
        2432
      ],
      "id": "7c1d2f23-58ea-42bb-8cd5-4ac6efc5dd98",
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "Prospec√ß√£o",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $('Buscar Lead Prospec√ß√£o').item.json.telefone }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "status",
              "fieldValue": "aguardando_resposta"
            },
            {
              "fieldId": "ultima_interacao",
              "fieldValue": "={{ $now }}"
            }
          ]
        }
      },
      "name": "Atualizar Status",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2128,
        2352
      ],
      "id": "8393396c-64b8-40f4-95d9-ada628d8b89d"
    },
    {
      "parameters": {},
      "name": "Executar Manual",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        464,
        2032
      ],
      "id": "a9ca0c50-8c2f-4db3-9f26-313151895d75",
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4a6d9aac-8565-4c58-abe3-8741393a5535",
              "leftValue": "={{ $json.origem }}",
              "rightValue": "prospeccao",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1840,
        3824
      ],
      "id": "6efca3c1-c102-4623-bdec-d9a9be5997ea",
      "name": "prospeccao"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "Prospec√ß√£o",
        "limit": 1,
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $json.Telefone }}"
            }
          ]
        }
      },
      "name": "Buscar prospeccao",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1600,
        3824
      ],
      "id": "3fa6d5bb-0cb5-4700-b03e-b1a55e5650ae",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "aa4797a8-0b64-48de-848d-6cc7d3e2f652",
      "name": "OpenAI Chat Model3",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        7328,
        2656
      ]
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "5a63bed6-ec4d-4247-8045-bc9dec1aaaef",
      "name": "Embeddings OpenAI1",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1,
      "position": [
        6768,
        2672
      ]
    },
    {
      "parameters": {
        "content": "# Agente IA",
        "height": 80,
        "width": 196,
        "color": 5
      },
      "id": "2bb13794-82c9-4b40-a5c1-13b4f911fa58",
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        7568,
        2224
      ]
    },
    {
      "parameters": {
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "id": "f0ae4079-73e1-4e00-8967-59d79593606e",
      "name": "Supabase Vector Store1",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        6944,
        2624
      ]
    },
    {
      "parameters": {
        "content": "",
        "height": 780,
        "width": 820,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        7552,
        2192
      ],
      "typeVersion": 1,
      "id": "89f42697-170c-47c0-9f45-a2ccbc73eccd",
      "name": "Sticky Note14"
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {}
      },
      "id": "d7e81535-bc5b-46a4-9743-7bc338ce6c98",
      "name": "OpenAI4",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        8544,
        2512
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "76af16ec-69c3-4c68-a4bc-0825abdb53f8",
      "name": "Loop Over Items",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        9184,
        2320
      ]
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"messages\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"string\"\n      }\n    }\n  },\n  \"required\": [\"messages\"]\n}"
      },
      "id": "b19d8753-5e02-45ee-8f81-6815b63f0ca7",
      "name": "OutputParser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        8768,
        2512
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Whatsapp message to be splitted and formated: {{ $json.output }}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "={\n  \"messages\": [\n    \"Por favor, gere a sa√≠da no seguinte formato JSON: {\\\"messages\\\": [\\\"splitedMessage\\\", \\\"splitedMessage\\\", \\\"splitedMessage\\\"]}\",\n    \"As mensagens devem ser divididas de forma natural, afinal estamos conversando com um humano. Certifique-se de que a resposta siga exatamente essa estrutura, incluindo os colchetes e as aspas.\",\n    \"Jamais separe uma mensagem vazia. Cada mensagem deve ter entre 300 e 500 caracteres, sem cortar informa√ß√µes, pois √© uma conversa de chat.\",\n    \"Certifique-se de que a resposta siga exatamente essa estrutura: *negrito* (substitua '**' por '*') n√£o mande nada em negrito remova todos '*'; ~tachado~ (caso seja algo exclu√≠do/alterado); _it√°lico_ (extremamente raro).\",\n    \"Tudo o que for link, pode colocar entre \\\"`\\\", ou seja, na seguinte formata√ß√£o: `www.link.com.br`. Use sempre essa formata√ß√£o para todos os links.\"\n  ]\n}"
            }
          ]
        }
      },
      "id": "390a749f-26af-4cf1-b21c-b33b0892736e",
      "name": "Parser  Chain1",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.4,
      "position": [
        8544,
        2224
      ]
    },
    {
      "parameters": {
        "content": "",
        "height": 620,
        "width": 1380,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        8432,
        2032
      ],
      "typeVersion": 1,
      "id": "54efa178-1bad-4692-8fbd-19b17934c18b",
      "name": "Sticky Note21"
    },
    {
      "parameters": {
        "content": "# Divis√£o de Mensagens Inteligente - Texto",
        "height": 80,
        "width": 736,
        "color": 5
      },
      "id": "00c7a1b5-412c-4d2f-822d-1381e527b1fe",
      "name": "Sticky Note24",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        8448,
        2064
      ]
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        7568,
        2576
      ],
      "id": "ff305f1f-477b-4aa0-8ca4-968a9ffdf18a",
      "name": "OpenAI Chat Model6"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Mensagem Completa1').item.json.mensagem_completa }}",
        "options": {
          "systemMessage": "={\n  \"name\": \"Patrick\",\n  \"context\": {\n    \"identity\": \"Assistente de Prospec√ß√£o\",\n    \"language\": \"portugu√™s brasileiro\",\n    \"date\": \"{{ $now.weekdayLong }}, {{ $now.format('dd/MM/yyyy') }}, {{ $now.hour.toString().padStart(2, '0') }}:{{ $now.minute.toString().padStart(2, '0') }}\"\n  },\n  \"updated_info\": \"{{ $json.output }}\",\n  \"personality\": [\n    \"Objetivo e claro\",\n    \"Tom amig√°vel e profissional\",\n    \"Usa emojis com modera√ß√£o\",\n    \"Evita repeti√ß√µes e cumprimentos gen√©ricos\",\n    \"Adapta o tom ao perfil do cliente\"\n  ],\n  \"objectives\": [\n    \"Gerar conex√£o sem parecer vendedor\",\n    \"Entender como √© feito o atendimento no neg√≥cio\",\n    \"Identificar dores no atendimento via WhatsApp\",\n    \"Conduzir o cliente at√© o agendamento da apresenta√ß√£o\"\n  ],\n  \"general_rules\": [\n    \"O n√∫mero de WhatsApp do cliente j√° √© conhecido. Nunca solicite novamente.\",\n    \"Evite termos t√©cnicos e explica√ß√µes longas.\",\n    \"Se o cliente fizer uma pergunta direta fora do fluxo, o agente pode responder de forma objetiva, com base em updated_info, mesmo que n√£o esteja no step atual.\",\n    \"N√£o enviar cumprimentos.\",\n    \"Nunca chame o cliente de ‚ÄúPatrick‚Äù.\",\n    \"Se o cliente demonstrar ou disser que n√£o tem interesse, envie um ‚ÄúObrigado pelo seu tempo‚Äù e **encerrar** o fluxo.\",\n    \"Envie o v√≠deo uma √∫nica vez.\",\n    \"N√£o iniciar o Step 1 sem que o cliente tenha enviado alguma mensagem antes.\"\n  ],\n  \"tools\": [\n    {\n      \"name\": \"verificar_disponibilidade\",\n      \"usage\": \"Consulta hor√°rios livres na agenda de apresenta√ß√µes com base em eventos reais no Google Calendar.\",\n      \"rules\": \"Analise a mensagem do cliente e identifique a inten√ß√£o de agendamento. Os per√≠odos v√°lidos s√£o: 'amanh√£', 'pr√≥xima semana' ou uma data espec√≠fica no formato 'YYYY-MM-DD'. Ao identificar, envie para a tool um JSON assim: { \\\"periodo\\\": \\\"amanh√£\\\" }. A ferramenta retornar√° os hor√°rios dispon√≠veis (08h √†s 18h). Use exatamente o valor retornado em mensagem_final como resposta para o cliente, sem modificar, resumir ou reformatar.\"\n    },\n    {\n      \"name\": \"criar_reuniao\",\n      \"usage\": \"Use quando precisar agendar uma apresenta√ß√£o com o cliente. Utilize o n√∫mero de WhatsApp conhecido. Apenas colete a data e o per√≠odo. Apresenta√ß√µes de segunda a sexta, das 8h √†s 18h.\"\n    },\n    {\n      \"name\": \"reagendar_reuniao\",\n      \"usage\": \"Use quando a pessoa solicitar que mude a data da apresenta√ß√£o. Utilize o n√∫mero de WhatsApp conhecido. Apenas colete a nova data e o per√≠odo.\"\n    },\n    {\n      \"name\": \"cancelar_reuniao\",\n      \"usage\": \"Use quando precisar cancelar uma apresenta√ß√£o com o cliente. Utilize o n√∫mero de WhatsApp conhecido. Confirme apenas a data a ser cancelada.\"\n    },\n    {\n      \"name\": \"enviar_video\",\n      \"usage\": \"Use quando o cliente demonstrar interesse em saber como funciona a automa√ß√£o. Envia automaticamente um v√≠deo demonstrativo pelo WhatsApp.\",\n      \"rules\": \"Chame a tool imediatamente ap√≥s o cliente mostrar interesse ou pedir mais informa√ß√µes. N√£o explique em texto, apenas diga que est√° enviando o v√≠deo e acione a ferramenta.\"\n    }\n  ],\n  \"flow\": {\n    \"steps\": [\n      {\n        \"step\": \"Identificar quem atende\",\n        \"instructions\": \"Perguntar diretamente quem cuida do WhatsApp da oficina.\",\n        \"example_message\": \"√â voc√™ mesmo quem atende o WhatsApp da oficina?\"\n      },\n      {\n        \"step\": \"Oferecer v√≠deo\",\n        \"instructions\": \"Apresentar de forma direta a proposta e oferecer o v√≠deo curto.\",\n        \"example_message\": \"Posso te enviar um v√≠deo r√°pido que pode melhorar a forma como voc√™ atende os clientes no WhatsApp?\"\n      },\n      {\n        \"step\": \"Enviar v√≠deo + convite\",\n        \"instructions\": \"Se o cliente demonstrar interesse, acionar a tool enviar_video e j√° convidar para uma apresenta√ß√£o r√°pida.\",\n        \"example_message\": \"Vou te mandar o v√≠deo üëá Depois, se fizer sentido pra voc√™, marcamos uma apresenta√ß√£o r√°pida de 10 minutos mostrando como essa automa√ß√£o funciona na pr√°tica.\"\n      },\n      {\n        \"step\": \"Agendar apresenta√ß√£o\",\n        \"instructions\": \"Convidar o cliente para marcar a apresenta√ß√£o.\",\n        \"example_message\": \"Que dia e per√≠odo seria melhor pra gente marcar essa apresenta√ß√£o de 10 minutos?\"\n      },\n      {\n        \"step\": \"Finalizar com protocolo\",\n        \"instructions\": \"Agrade√ßa, confirme o agendamento da apresenta√ß√£o e informe o n√∫mero de atendimento 009874.\",\n        \"example_message\": \"Apresenta√ß√£o confirmada! Estarei contigo no hor√°rio combinado pra te mostrar como tudo funciona. Seu n√∫mero de atendimento √©: 009874 üëç\"\n      }\n    ]\n  }\n}"
        }
      },
      "id": "d77f4c06-5e3f-4907-9028-680cdeeea0ea",
      "name": "Atendente4",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        7712,
        2336
      ]
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Dados').item.json.Telefone }}",
        "contextWindowLength": 30
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        7632,
        2720
      ],
      "id": "16a64a48-a012-4cb5-a6e5-082cf824fe25",
      "name": "Postgres Chat Memory2"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "009874",
                    "operator": {
                      "type": "string",
                      "operation": "notContains"
                    },
                    "id": "2aa763f7-cf04-44e7-9bbb-8f8de823aef8"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Continuar na IA"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "820760d6-3546-4007-8917-55d366a74261",
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "009874",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Avisar Lead grupo"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        8160,
        2336
      ],
      "id": "c8c1e18b-4bca-43da-8c38-bd405b0f06df",
      "name": "Switch3"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "DevTower",
        "remoteJid": "={{ $('Dados').item.json.Telefone }}",
        "messageText": "={{ $json.output }}",
        "options_message": {
          "delay": 4200,
          "linkPreview": false
        }
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        9424,
        2336
      ],
      "id": "94e2f1a6-3ccf-4434-a25f-af71bf878b81",
      "name": "Evolution API3"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        9152,
        1744
      ],
      "id": "ec7cb528-52a3-49c1-85e8-a79298dbcef4",
      "name": "Merge"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "defac08a-6745-422b-bb05-90da9f47d91b",
              "leftValue": "={{ $('Busca Telefone1').last().json.values() }}",
              "rightValue": "",
              "operator": {
                "type": "array",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        8640,
        1744
      ],
      "id": "6f0b3aec-da04-4d3d-b8c4-437b329f7d32",
      "name": "If9"
    },
    {
      "parameters": {
        "content": "",
        "height": 380,
        "width": 1380,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        8432,
        1600
      ],
      "typeVersion": 1,
      "id": "7577888e-841b-4587-853f-4ab4cd5bf61c",
      "name": "Sticky Note58"
    },
    {
      "parameters": {
        "content": "# Cadastra Chat Supabase",
        "height": 80,
        "width": 450,
        "color": 5
      },
      "id": "ee07c2e1-6747-47d7-bdcd-1992c37e1a86",
      "name": "Sticky Note59",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        8448,
        1616
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "chats",
        "filters": {
          "conditions": [
            {
              "keyName": "phone",
              "keyValue": "={{ $('Webhook EVO').item.json.body.data.key.remoteJid }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        8480,
        1744
      ],
      "id": "d444e9bb-4915-45ec-9bcd-d26a91562439",
      "name": "Busca Telefone1",
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "tableId": "chats",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "phone",
              "fieldValue": "={{ $('Dados').item.json.Telefone }}"
            },
            {
              "fieldId": "updated_at",
              "fieldValue": "={{ $now}}"
            },
            {
              "fieldId": "created_at",
              "fieldValue": "={{ $now}}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        8928,
        1632
      ],
      "id": "79592abc-9a6e-4678-9853-0f71630599fc",
      "name": "Adiciona CHAT supabase1"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "chats",
        "filters": {
          "conditions": [
            {
              "keyName": "phone",
              "condition": "eq",
              "keyValue": "={{ $('Dados').item.json.Telefone }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "updated_at",
              "fieldValue": "={{ $now }}"
            },
            {
              "fieldId": "created_at",
              "fieldValue": "={{ $now }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        8944,
        1824
      ],
      "id": "eba98166-e65c-4364-b0fd-eb53e477c140",
      "name": "Atualiza CHAT Supabase1",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "tableId": "chat_messages",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "phone",
              "fieldValue": "={{ $('Dados').item.json.Telefone }}"
            },
            {
              "fieldId": "bot_message",
              "fieldValue": "={{ $('Atendente4').item.json.output }}"
            },
            {
              "fieldId": "user_message",
              "fieldValue": "={{ $('Dados').item.json.message.content }}"
            },
            {
              "fieldId": "message_type",
              "fieldValue": "={{ $('Dados').item.json.body.event }}"
            },
            {
              "fieldId": "created_at",
              "fieldValue": "={{ $now }}"
            },
            {
              "fieldId": "nomewpp",
              "fieldValue": "={{ $('Dados').item.json.NomeWpp }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        9344,
        1744
      ],
      "id": "89827343-5be9-4777-8b14-cb91414f4e9f",
      "name": "Cria Hist√≥rico Supabase1"
    },
    {
      "parameters": {
        "fieldToSplitOut": "output.messages",
        "options": {
          "destinationFieldName": "output"
        }
      },
      "id": "a87ffbe5-9cfc-4577-b82b-9fec54cdb9e9",
      "name": "Split de Mensagem1",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        8944,
        2272
      ]
    },
    {
      "parameters": {
        "amount": 1
      },
      "id": "839567eb-c774-4768-b75e-6f175b7f54fe",
      "name": "1 segundo1",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        9648,
        2336
      ],
      "webhookId": "a2c69e1c-13fe-44a2-962c-1249288537eb"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $('Dados').item.json.Telefone }}"
      },
      "id": "b8d01d2d-e42b-482c-831c-b13485dbc330",
      "name": "Delete Memory1",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        9552,
        1744
      ]
    },
    {
      "parameters": {
        "name": "buscar_documentos",
        "description": "Analise o documento se encontrar uma informa√ß√£o que seja relevante traga o texto dele como resposta sem altera√ß√µes, caso n√£o encontre devolva o resultado em branco sem nem um texto",
        "topK": 2
      },
      "id": "c9a78c8f-00a8-4793-ac26-75b7dd136068",
      "name": "buscar_documentos1",
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1,
      "position": [
        7040,
        2464
      ]
    },
    {
      "parameters": {
        "content": "",
        "height": 620,
        "width": 980,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        5664,
        2192
      ],
      "typeVersion": 1,
      "id": "fb566c40-5511-480d-9200-8360c6c56e8c",
      "name": "Sticky Note25"
    },
    {
      "parameters": {
        "content": "",
        "height": 660,
        "width": 960,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        4672,
        2160
      ],
      "typeVersion": 1,
      "id": "38524055-b2e3-4d73-81c5-5a6f51207d25",
      "name": "Sticky Note28"
    },
    {
      "parameters": {
        "content": "",
        "height": 500,
        "width": 1120,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3504,
        2320
      ],
      "typeVersion": 1,
      "id": "673ca47b-6802-4490-9101-ef650bde6741",
      "name": "Sticky Note34"
    },
    {
      "parameters": {
        "content": "# Pausar IA",
        "height": 80,
        "width": 216,
        "color": 4
      },
      "id": "85bf2bd6-539e-411b-afcc-0357ee203e95",
      "name": "Sticky Note42",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        3504,
        2320
      ]
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "options": {
          "fileName": "file.png",
          "mimeType": "image/png"
        }
      },
      "id": "112109eb-89cb-466c-8bfb-b6f5cc79e06b",
      "name": "Convert to File2",
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        4928,
        2656
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3c5ccbc9-69d1-4b13-a7c3-e6945bc8c655",
              "name": "data",
              "value": "={{ $('Webhook EVO').item.json.body.data.message.base64 }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "e470a150-a0f9-4bb0-90a1-cc460acad7e8",
      "name": "Edit Fields4",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4784,
        2656
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "ade56c50-1520-4760-8df5-e99617d6d3ad",
              "leftValue": "={{ $('Webhook EVO').item.json.body.data.message.imageMessage.caption }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "57e83881-6dc2-4dfb-a519-f658c8cd8c90",
      "name": "If10",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        5264,
        2656
      ]
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Dados').item.json.Telefone }}",
        "messageData": "={{ $('Dados').item.json.message.content }}, {{ $json.content.replace(/\\n/g, \"\\\\n\").replace(/['\"]/g, '').trim()  }}",
        "tail": true
      },
      "id": "affad191-2a8e-4096-997b-65c890e3079e",
      "name": "Redis",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        5424,
        2672
      ]
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Dados').item.json.Telefone }}",
        "messageData": "={{ $json.content.replace(/\\n/g, \"\\\\n\").replace(/['\"]/g, '').trim()  }}",
        "tail": true
      },
      "id": "6de6529d-3141-4bf8-83ce-c175261b1155",
      "name": "Redis6",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        5424,
        2496
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "52aaf749-fe4f-44e4-880e-15b2bfc027f1",
                    "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                    "rightValue": "extendedTextMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "e514e613-fd6a-48bd-b0ae-bae2448c810e",
                    "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                    "rightValue": "conversation",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                    "rightValue": "audioMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "c0e434dd-1268-421d-b81b-3a5e90ed9550",
                    "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                    "rightValue": "imageMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "image"
            }
          ]
        },
        "options": {}
      },
      "id": "2f2904c1-7aa8-41c5-a327-f40d69cd349f",
      "name": "Switch5",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        4704,
        2384
      ]
    },
    {
      "parameters": {
        "content": "# Mensagem Picotada",
        "height": 80,
        "width": 396,
        "color": 4
      },
      "id": "35801d70-2746-4d1c-b6ec-a841f0428b66",
      "name": "Sticky Note16",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        5664,
        2192
      ]
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "text": "Analise a imagem e me traga um resumo simples e o mais curto poss√≠vel do que ela √©",
        "inputType": "base64",
        "options": {}
      },
      "id": "bfbec491-1b69-49f3-897e-f40655b463f9",
      "name": "OpenAI2",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.6,
      "position": [
        5088,
        2656
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "d5a342e9-585b-42ea-be44-644adae10199",
              "leftValue": "={{ $json.Redis2 }}",
              "rightValue": "={{ $json.Redis1 }}",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "5f330622-c960-4a63-a972-446f364f7e95",
      "name": "Compara Get Memory",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        6304,
        2464
      ]
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Dados').item.json.Telefone }}",
        "messageData": "={{ $('Dados').item.json.message.content }}",
        "tail": true
      },
      "id": "f083f940-5cd0-4e64-bda0-246c97f30c27",
      "name": "Text Memory",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        5424,
        2176
      ]
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Dados').item.json.Telefone }}",
        "messageData": "={{ $json.text }}",
        "tail": true
      },
      "id": "a6034c4c-0e07-4f1f-9096-3142d0f7c9f2",
      "name": "Audio Memory",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        5424,
        2336
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f336a1ff-e577-489d-a739-1eb8bd509245",
              "name": "Redis2",
              "value": "={{ $json.propertyName }}",
              "type": "string"
            },
            {
              "id": "946d1420-e379-46e3-8fcd-3816340fbabb",
              "name": "Redis1",
              "value": "={{ $('Get Memory ').item.json.propertyName }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "156e063e-54a7-4787-bd63-407c56b9a10b",
      "name": "Edit Fields11",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        6144,
        2464
      ]
    },
    {
      "parameters": {
        "amount": 2,
        "unit": "minutes"
      },
      "id": "610418e6-f84e-4fd2-a572-22d98931a20e",
      "name": "Wait4",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        5840,
        2464
      ],
      "webhookId": "9f0edf0b-ca36-42a6-bab6-bf62ca08ac51"
    },
    {
      "parameters": {
        "operation": "get",
        "key": "={{ $('Dados').item.json.Telefone }}",
        "options": {}
      },
      "id": "3f952bf9-0c23-40ac-9271-f425bf1d7661",
      "name": "Get Memory ",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        5712,
        2464
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "key": "={{ $('Dados').item.json.Telefone }}",
        "options": {}
      },
      "id": "b129769e-0248-4d41-b705-c2925123d32f",
      "name": "Get Memory 3",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        6000,
        2464
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Dados').item.json.message.event }}",
                    "rightValue": "outcoming",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "7c878f9b-2c93-4061-954a-a832153e7647"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "outcoming"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "d7b42536-638f-4128-b51b-6aa913e9d9bc",
                    "leftValue": "={{ $('Dados').item.json.message.event }}",
                    "rightValue": "incoming",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "incoming"
            }
          ]
        },
        "options": {}
      },
      "id": "a789eb6a-f697-4133-ae8c-fe2b10eea26c",
      "name": "Switch7",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        3568,
        2560
      ]
    },
    {
      "parameters": {
        "content": "# Filtro de mensagem",
        "height": 80,
        "width": 356,
        "color": 4
      },
      "id": "7699b1c3-d4e5-4be4-8506-c221f91a3040",
      "name": "Sticky Note35",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        4672,
        2160
      ]
    },
    {
      "parameters": {
        "jsCode": "const redis1 = JSON.parse($json.Redis1);\nconst redis2 = JSON.parse($json.Redis2);\n\nconst combinadoSemDuplicatas = Array.from(new Set([...redis1, ...redis2]));\n\nconst mensagem = combinadoSemDuplicatas.join(\" \");\n\nreturn [{ json: { mensagem_completa: mensagem } }];"
      },
      "id": "7e8a5a2a-8612-404d-b9e4-3105a620b2c3",
      "name": "Mensagem Completa1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        6528,
        2432
      ]
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "options": {
          "fileName": "file.ogg",
          "mimeType": "application/ogg"
        }
      },
      "id": "4de1f9bd-6e6f-4048-aacc-8d47764b216d",
      "name": "Convert to File3",
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        5072,
        2464
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3c5ccbc9-69d1-4b13-a7c3-e6945bc8c655",
              "name": "data",
              "value": "={{ $('Webhook EVO').item.json.body.data.message.base64 }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "91703c90-63e2-415e-bbdf-bbb8359aaec9",
      "name": "Edit Fields12",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4912,
        2464
      ]
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "id": "f51674f4-9cc2-4de1-bdbd-1950ca46c756",
      "name": "OpenAI5",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.6,
      "position": [
        5248,
        2464
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $('Dados').item.json.Telefone }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "atendimento_ia",
              "fieldValue": "pause"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        4048,
        2352
      ],
      "id": "f81491ad-ee15-4b2c-a8cd-d1c7c373f0e1",
      "name": "Pausar IA2"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "keyValue": "={{ $('Dados').item.json.Telefone }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        3840,
        2656
      ],
      "id": "da6c868f-0b90-4f81-8100-c8b426e94bd2",
      "name": "Verificar Pause1"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.atendimento_ia }}",
                    "rightValue": "pause",
                    "operator": {
                      "type": "string",
                      "operation": "notStartsWith"
                    },
                    "id": "ff00573b-e517-43c6-8644-14a4fe8565d1"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Ia Ativa"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "3ef0e01c-cc14-4663-bb4d-2905b350c3ab",
                    "leftValue": "={{ $json.atendimento_ia }}",
                    "rightValue": "pause",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Ia pausada"
            }
          ]
        },
        "options": {}
      },
      "id": "9022937d-5aaf-43b0-b153-6a3f7c76db01",
      "name": "Rota Atendimento1",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        4080,
        2656
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "9865cb5b-33da-490c-afc3-186457d5b564",
                    "operator": {
                      "type": "string",
                      "operation": "notEquals"
                    },
                    "leftValue": "={{ $('Dados').item.json.message.content }}",
                    "rightValue": "Atendimento finalizado"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "IA Pausada"
            },
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "5a9a1fee-b408-469f-a08c-e8d690fc9792",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "leftValue": "={{ $('Dados').item.json.message.content }}",
                    "rightValue": "Atendimento finalizado"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Reativar IA"
            }
          ]
        },
        "options": {}
      },
      "id": "e3bbd5b3-fdd5-4538-a8af-1ef916555151",
      "name": "Rotas2",
      "type": "n8n-nodes-base.switch",
      "position": [
        3728,
        2432
      ],
      "typeVersion": 3.2
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $('Dados').item.json.Telefone }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "atendimento_ia",
              "fieldValue": "reativada"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        4208,
        2480
      ],
      "id": "ff7288db-4148-44b7-95db-5abfca4fcbd9",
      "name": "Reativar IA1"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        3920,
        2512
      ],
      "id": "6ed97d05-22f8-4e3f-b043-1822b4e6ee4f",
      "name": "Wait2",
      "webhookId": "b9c0dc3b-a05b-4e71-bcbe-fee8c71142a2"
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "n8n_chat_histories",
          "mode": "list",
          "cachedResultName": "n8n_chat_histories"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "session_id": "={{ $('Dados').item.json.Telefone }}",
            "message": "={\"type\": \"ai\", \"content\": \"{{ $('Dados').item.json.message.content }}\", \"additional_kwargs\": {}, \"response_metadata\": {}}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "session_id",
              "displayName": "session_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "message",
              "displayName": "message",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        4432,
        2640
      ],
      "id": "009f89ca-02c4-4c06-b4a9-ea39afd8fc37",
      "name": "Salvar Historicoo Humano2"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        6752,
        2480
      ],
      "id": "d55a09b1-c68b-4219-9e12-8a626252480a",
      "name": "OpenAI Chat Model7"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.mensagem_completa }}",
        "options": {
          "systemMessage": "={\n  \"name\": \"AgenteRag\",\n  \"objectives\": [\n    \"Responder SOMENTE com dados obtidos da ferramenta buscar_documentos, sem dicas extras\"\n  ],\n  \"tools\": [\n    {\n      \"name\": \"buscar_documentos\",\n      \"description\": \"Use esta ferramenta para obter a resposta. Se n√£o houver dados, retorne: n√£o invente resposta somente do que vier da tool buscar_documentos'.\",\n      \"required\": true\n    }\n  ],\n  \"general_rules\": [\n    \"N√ÉO inventar respostas\",\n    \"Sempre usar a ferramenta buscar_documentos\",\n    \"caso n√£o tenha uma resposta envie a resposta assim: sem dica de resposta\"\n  ]\n}\n"
        }
      },
      "id": "7f1463ee-26c4-4cac-a86c-08fc03e673be",
      "name": "Agente Rag1",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        6752,
        2304
      ]
    },
    {
      "parameters": {
        "content": "# Agente RAG",
        "height": 80,
        "width": 336,
        "color": 4
      },
      "id": "207e2b58-e12f-4a9c-8a77-338c59ff7507",
      "name": "Sticky Note36",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        6704,
        2192
      ]
    },
    {
      "parameters": {
        "content": "",
        "height": 620,
        "width": 820,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        6688,
        2192
      ],
      "typeVersion": 1,
      "id": "e5271b40-a9d3-4cbb-a782-161d9bbae514",
      "name": "Sticky Note38"
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "n8n_chat_histories",
          "mode": "list",
          "cachedResultName": "n8n_chat_histories"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "session_id": "={{ $('Dados').item.json.Telefone }}",
            "message": "={\"type\": \"human\", \"content\": \"{{ $('Dados').item.json.message.content }}\", \"additional_kwargs\": {}, \"response_metadata\": {}}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "session_id",
              "displayName": "session_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "message",
              "displayName": "message",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        4400,
        2336
      ],
      "id": "de7e6f07-96c4-4a91-a124-6372cf5ed72f",
      "name": "Salvar Historicoo Humano3"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        9248,
        2992
      ],
      "id": "10c5505a-b8a1-4fd2-96b0-42fc493d292d",
      "name": "OpenAI Chat Model8"
    },
    {
      "parameters": {
        "content": "",
        "height": 400,
        "width": 1620,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        8400,
        2720
      ],
      "typeVersion": 1,
      "id": "0ad7cd2f-d394-4063-b5fe-2dca0e609204",
      "name": "Sticky Note46"
    },
    {
      "parameters": {
        "content": "# AVISAR NOVO LEAD NO GRUPO",
        "height": 80,
        "width": 656,
        "color": 5
      },
      "id": "e26f04d8-e522-4cb5-93f2-9b7500935aad",
      "name": "Sticky Note47",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        8432,
        2736
      ]
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "DevTower",
        "remoteJid": "={{ $('Dados').item.json.Telefone }}",
        "messageText": "={{ $json.output }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        8448,
        2832
      ],
      "id": "b053f852-546f-431e-a4d8-fd8140d0ba77",
      "name": "Evolution API4"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "DevTower",
        "remoteJid": "120363418043329@g.us",
        "messageText": "={{ (() => { \n  const telefone = $('Dados').item.json.Telefone;\n  return 'üö® Novo Lead: wa.me/' + telefone.split('@')[0] + ' üö®';\n})() }}\n\n*Cliente:* {{ $('Dados').item.json.NomeWpp }}\n\n*CASO:*\n{{ $json.text }}",
        "options_message": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        9568,
        2832
      ],
      "id": "15b2da6c-f888-4d8b-af3a-ddda9966d586",
      "name": "Evolution API5"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "chat_messages",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "phone",
              "condition": "eq",
              "keyValue": "={{ $('Dados').item.json.Telefone }}"
            },
            {
              "keyName": "active",
              "condition": "eq",
              "keyValue": "true"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        8640,
        2832
      ],
      "id": "c54cd029-21da-4560-b6dc-91da2f5d30d5",
      "name": "ListMessages-Supabase",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "conversas",
        "include": "specifiedFields",
        "fieldsToInclude": "id,message_type,created_at,user_message, bot_message,phone",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        8848,
        2832
      ],
      "id": "8c965fe3-66d7-4944-ad10-dbd793e0382a",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "jsCode": "return $('Aggregate').all().map(item => {\n  // Tenta acessar a propriedade 'conversas' e verifica se ela √© um array\n  const conversas = item.json.conversas || []; // Garante que √© pelo menos um array vazio\n\n  if (!Array.isArray(conversas)) {\n    throw new Error(\"A propriedade 'conversas' n√£o √© um array.\");\n  }\n\n  // Processa cada conversa e verifica as mensagens\n  const textoUnico = conversas.map(conversa => {\n    const cliente = conversa.user_message || \"sem mensagem do chatbot\";\n    const agente = conversa.bot_message || \"sem resposta\";\n    \n    // Verifica se a data existe e formata\n    const dataOriginal = conversa.created_at || \"Data da Mensagem indispon√≠vel\";\n    const dataFormatada = dataOriginal !== \"Data da Mensagem indispon√≠vel\"\n      ? formatarData(dataOriginal)\n      : dataOriginal;\n\n    return `em: ${dataFormatada}\\n\\n - agente(chatbot): ${agente} \\n - cliente: ${cliente}\\n`;\n  }).join('\\n\\n');\n\n  // Retorna o texto final como resultado\n  return {\n    json: {\n      texto: textoUnico\n    }\n  };\n});\n\n// Fun√ß√£o para formatar a data\nfunction formatarData(dataString) {\n  const data = new Date(dataString); // Converte a string em objeto Date\n  if (isNaN(data)) {\n    return \"Data inv√°lida\"; // Retorna se a data n√£o for v√°lida\n  }\n  \n  // Formata no padr√£o DD/MM/YYYY HH:mm\n  const dia = String(data.getDate()).padStart(2, '0');\n  const mes = String(data.getMonth() + 1).padStart(2, '0'); // M√™s come√ßa em 0\n  const ano = data.getFullYear();\n  const horas = String(data.getHours()).padStart(2, '0');\n  const minutos = String(data.getMinutes()).padStart(2, '0');\n  \n  return `${dia}/${mes}/${ano} ${horas}:${minutos}`;\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        9024,
        2832
      ],
      "id": "481b71ae-f568-4bc5-aab3-1375b26c1e16",
      "name": "Code"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={\n  \"role\": \"Agente Resumidor de atendimento\",\n  \"proposito\": \"Analisar conversas cliente-agente e criar resumos detalhados do atendimento\",\n  \"instrucoes\": {\n    \"tarefa_principal\": \"Extrair e resumir apenas sobre o atendimento do cliente a partir das conversas\",\n    \"formato\": \"Incluir data da sess√£o quando dispon√≠vel\",\n    \"foco\": \"demandas do cliente, excluir respostas do agente\",\n    \"estilo\": \"Resumos detalhados mas concisos\",\n    \"evitar\": \"Dicas de uso, informa√ß√µes extras ou explica√ß√µes\",\n    \"Me de o resultado somente com o resumo sem caracteres especiais\"\n  },\n  \"formato_entrada\": {\n    \"conversa\": \"{{ $json.texto }}\"\n  },\n  \"formato_saida\": {\n    \"resumo\": \"Descri√ß√£o concisa do caso do cliente e data do agendamento\"\n  }\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.5,
      "position": [
        9232,
        2832
      ],
      "id": "184b372a-611a-434d-80e9-e3126d9182d8",
      "name": "Basic LLM Chain"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $('Dados').item.json.Telefone }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "atendimento_ia",
              "fieldValue": "pause"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        9808,
        2832
      ],
      "id": "8e95e976-093c-4a7f-a972-10cc6f3cd1d3",
      "name": "Pausar IA3"
    },
    {
      "parameters": {
        "batchSize": 1,
        "options": {}
      },
      "name": "Split In Batches",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 1,
      "position": [
        944,
        1872
      ],
      "id": "6cfd08f1-224c-40a8-a651-6734991f101a"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "Prospec√ß√£o",
        "limit": 1,
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $json.Telefone }}"
            }
          ]
        }
      },
      "name": "Verificar no Supabase",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1168,
        1872
      ],
      "id": "45d0e27d-41cc-406f-8dd2-fbcddaa54409",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $json.telefone }}",
              "operation": "isEmpty"
            }
          ]
        }
      },
      "name": "IF N√£o Existe?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1392,
        1872
      ],
      "id": "458dcace-994f-4e8f-a9ff-11689a96558a"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1g0IJPaROsWYEmFHipYZK9fouAEHYY0Ec7hZXJ2831uk",
          "mode": "list",
          "cachedResultName": "Analise de Atendimento",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g0IJPaROsWYEmFHipYZK9fouAEHYY0Ec7hZXJ2831uk/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1511455453,
          "mode": "list",
          "cachedResultName": "pagina1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g0IJPaROsWYEmFHipYZK9fouAEHYY0Ec7hZXJ2831uk/edit#gid=1511455453"
        },
        "options": {}
      },
      "name": "Ler Planilha Google1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [
        720,
        1872
      ],
      "id": "8dcb7097-d9f5-45a7-97bd-2a0ec69a055f"
    },
    {
      "parameters": {
        "tableId": "Prospec√ß√£o",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "nome",
              "fieldValue": "={{ $('Split In Batches').item.json.Nome }}"
            },
            {
              "fieldId": "telefone",
              "fieldValue": "={{ $('Split In Batches').item.json.Telefone }}"
            },
            {
              "fieldId": "ramo",
              "fieldValue": "={{ $('Split In Batches').item.json.Ramo }}"
            },
            {
              "fieldId": "status",
              "fieldValue": "novo"
            },
            {
              "fieldId": "origem",
              "fieldValue": "prospeccao"
            },
            {
              "fieldId": "created_at",
              "fieldValue": "={{ $now }}"
            }
          ]
        }
      },
      "name": "Inserir no Supabase1",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1600,
        1936
      ],
      "id": "9745ab86-4028-498a-8692-f7038fe42c80"
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        1568,
        2672
      ],
      "id": "aac56d52-1216-433f-9bba-f879895110ae",
      "name": "OpenAI Chat Model9"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "gere mensagem conforme o prompt",
        "options": {
          "systemMessage": "={\n  \"name\": \"Agente de Prospec√ß√£o\",\n  \"context\": {\n    \"identity\": \"Patrick, da DevTower\",\n    \"business\": \"DevTower - Solu√ß√µes em Automa√ß√£o com IA\",\n    \"language\": \"portugu√™s brasileiro\",\n    \"date\": \"{{ $now.weekdayLong }}, {{ $now.format('dd/MM/yyyy') }}, {{ $now.hour.toString().padStart(2, '0') }}:{{ $now.minute.toString().padStart(2, '0') }}\"\n  },\n  \"personality\": [\n    \"Natural e informal\",\n    \"Simples, direto e humano\",\n    \"Nada de linguagem de vendedor ou IA\"\n  ],\n  \"objectives\": [\n    \"Enviar apenas uma sauda√ß√£o inicial de forma simples e humana\"\n  ],\n  \"general_rules\": [\n    \"A mensagem deve conter apenas 'Bom dia', 'Boa tarde' ou 'Boa noite', de forma simp√°tica, sem mais nenhum conte√∫do\",\n    \"De 00h00 at√© 11h59 ‚Üí diga 'Bom dia'\",\n    \"De 12h00 at√© 17h59 ‚Üí diga 'Boa tarde'\",\n    \"De 18h00 at√© 23h59 ‚Üí diga 'Boa noite'\",\n    \"N√£o adicione emojis, links ou frases complementares\",\n    \"Nunca envie mais de uma mensagem por contato\",\n    \"N√£o inicie conversa nem fa√ßa perguntas\"\n  ],\n  \"flow\": {\n    \"steps\": [\n      {\n        \"step\": \"Enviar sauda√ß√£o conforme hor√°rio\",\n        \"instructions\": \"Envie apenas a sauda√ß√£o correspondente ao hor√°rio atual do sistema\",\n        \"example_message\": {\n          \"manh√£\": \"Bom dia\",\n          \"tarde\": \"Boa tarde\",\n          \"noite\": \"Boa noite\"\n        }\n      }\n    ]\n  }\n}\n"
        }
      },
      "id": "7ea4dae7-fb8f-4417-a9bf-b737cf8acee3",
      "name": "Atendente5",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        1520,
        2400
      ]
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Buscar Lead Prospec√ß√£o').item.json.telefone }}",
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        1744,
        2672
      ],
      "id": "edc49b5b-3f8f-4ee0-ab0a-a21c9d257d88",
      "name": "Postgres Chat Memory3"
    },
    {
      "parameters": {
        "content": "",
        "height": 560,
        "width": 1940,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        400,
        2304
      ],
      "typeVersion": 1,
      "id": "82f79f2c-9af1-49cb-acda-b43a4384023e",
      "name": "Sticky Note39"
    },
    {
      "parameters": {
        "content": "## AGENTE DE PROSPEC√á√ÉO",
        "height": 80,
        "width": 416,
        "color": 4
      },
      "id": "157522d5-3a3a-4f64-b6ae-c266b20b3678",
      "name": "Sticky Note68",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        448,
        2320
      ]
    },
    {
      "parameters": {
        "content": "",
        "height": 460,
        "width": 1380,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        400,
        1744
      ],
      "typeVersion": 1,
      "id": "504337f5-3772-42ff-ac86-1cf0adc796f9",
      "name": "Sticky Note43"
    },
    {
      "parameters": {
        "content": "## ADICIONAR DADOS DA PLANILHA NO SUPABASE",
        "height": 80,
        "width": 676,
        "color": 4
      },
      "id": "42ffb4de-fcb9-4f22-ac89-3c32ad9d1447",
      "name": "Sticky Note69",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        448,
        1760
      ]
    },
    {
      "parameters": {
        "content": "# Agente IA",
        "height": 80,
        "width": 196,
        "color": 5
      },
      "id": "cd132b61-d9b9-4073-9db9-951e07d1bc84",
      "name": "Sticky Note51",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        7568,
        4032
      ]
    },
    {
      "parameters": {
        "content": "",
        "height": 840,
        "width": 820,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        7552,
        4016
      ],
      "typeVersion": 1,
      "id": "fe4ca963-ce77-4b0e-a59e-493576d0b1c7",
      "name": "Sticky Note52"
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        7600,
        4352
      ],
      "id": "2a315ca5-370f-4ee6-84cb-4c9abc4b2855",
      "name": "OpenAI Chat Model10"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Mensagem Completa').item.json.mensagem_completa }}",
        "options": {
          "systemMessage": "={\n  \"name\": \"Patrick\",\n  \"context\": {\n    \"identity\": \"Consultor especializado em automa√ß√£o de atendimento e agendamento via WhatsApp\",\n    \"language\": \"portugu√™s brasileiro\",\n    \"date\": \"{{ $now.weekdayLong }}, {{ $now.format('dd/MM/yyyy') }}, {{ $now.hour.toString().padStart(2, '0') }}:{{ $now.minute.toString().padStart(2, '0') }}\"\n  },\n  \"updated_info\": \"{{ $json.output }}\",\n  \"personality\": [\n    \"Direto e claro\",\n    \"Tom profissional com empatia\",\n    \"Usa emojis com prop√≥sito\",\n    \"Evita repeti√ß√µes e cumprimentos gen√©ricos\",\n    \"Adapta o tom ao perfil do cliente\",\n    \"Chama o cliente pelo nome sempre que poss√≠vel\"\n  ],\n  \"objectives\": [\n    \"Entender como o atendimento √© feito hoje\",\n    \"Mapear falhas ou gargalos no atendimento e agendamento\",\n    \"Fazer o cliente enxergar os ganhos com a automa√ß√£o\",\n    \"Levar o cliente naturalmente at√© o agendamento\"\n  ],\n  \"general_rules\": [\n    \"O n√∫mero de WhatsApp do cliente j√° √© conhecido. N√£o pe√ßa novamente.\",\n    \"Evite explica√ß√µes t√©cnicas. Priorize uma conversa simples e estrat√©gica.\",\n    \"N√£o envie links ou arquivos. Baseie a conversa nos exemplos definidos.\",\n    \"Evite parecer rob√¥. Demonstre interesse real no neg√≥cio do cliente.\"\n  ],\n  \"tools\": [\n    {\n      \"name\": \"verificar_disponibilidade\",\n      \"usage\": \"Consulta hor√°rios livres na agenda de apresenta√ß√µes com base em eventos reais no Google Calendar.\",\n      \"rules\": \"Analise a mensagem do cliente e identifique a inten√ß√£o de agendamento. Os per√≠odos v√°lidos s√£o: 'amanh√£', 'pr√≥xima semana' ou uma data espec√≠fica no formato 'YYYY-MM-DD'. Ao identificar, envie para a tool um JSON assim: { \\\"periodo\\\": \\\"amanh√£\\\" }. A ferramenta retornar√° os hor√°rios dispon√≠veis (08h √†s 18h). Use exatamente o valor retornado em mensagem_final como resposta para o cliente, sem modificar, resumir ou reformatar.\"\n    },\n    {\n      \"name\": \"criar_reuniao\",\n      \"usage\": \"Use quando precisar agendar uma apresenta√ß√£o com o cliente. Utilize o n√∫mero de WhatsApp conhecido. Apenas colete a data e o per√≠odo. Apresenta√ß√µes de segunda a sexta, das 8h √†s 18h.\"\n    },\n    {\n      \"name\": \"reagendar_reuniao\",\n      \"usage\": \"Use quando a pessoa solicitar que mude a data da apresenta√ß√£o. Utilize o n√∫mero de WhatsApp conhecido. Apenas colete a nova data e o per√≠odo.\"\n    },\n    {\n      \"name\": \"cancelar_reuniao\",\n      \"usage\": \"Use quando precisar cancelar uma apresenta√ß√£o com o cliente. Utilize o n√∫mero de WhatsApp conhecido. Confirme apenas a data a ser cancelada.\"\n    }\n  ],\n  \"flow\": {\n    \"steps\": [\n      {\n        \"step\": \"Se apresentar e pedir o nome\",\n        \"instructions\": \"Se apresentar como secret√°ria da DevTower e perguntar o nome do cliente\",\n        \"example_message\": \"Ol√°! Aqui √© o Patrick, da equipe DevTower üòä Como posso te chamar?\"\n      },\n      {\n        \"step\": \"Entender o que deseja otimizar\",\n        \"instructions\": \"Investigar de forma simples qual processo o cliente quer automatizar ou tornar mais eficiente\",\n        \"example_message\": \"Me conta: o que hoje no seu atendimento voc√™ gostaria que funcionasse de forma mais pr√°tica e autom√°tica?\"\n      },\n      {\n        \"step\": \"Conectar benef√≠cio √† necessidade\",\n        \"instructions\": \"Relacionar a automa√ß√£o que j√° entregamos (como atendimento com agendamento) ao problema mencionado\",\n        \"example_message\": \"Entendi! Isso √© exatamente o que nossa automa√ß√£o resolve. A gente j√° ajuda outras empresas a agilizar esse tipo de atendimento e economizar tempo todos os dias ‚è±Ô∏è\"\n      },\n      {\n        \"step\": \"Convidar para apresenta√ß√£o\",\n        \"instructions\": \"Convidar o cliente para ver uma apresenta√ß√£o direta, mostrando como funciona na realidade dele\",\n        \"example_message\": \"Quer ver como isso funciona na pr√°tica? Posso agendar uma apresenta√ß√£o r√°pida, direta e personalizada pra sua realidade.\"\n      },\n      {\n        \"step\": \"Coletar disponibilidade\",\n        \"instructions\": \"Perguntar o melhor dia e per√≠odo para marcar a apresenta√ß√£o\",\n        \"example_message\": \"Qual dia e per√≠odo (manh√£ ou tarde) funciona melhor pra voc√™?\"\n      },\n      {\n        \"step\": \"Finalizar com protocolo\",\n        \"instructions\": \"Agradecer, confirmar o agendamento e informar o numero do atendimento 009874\",\n        \"example_message\": \"Show! Vou te chamar alguns minutos antes da reuni√£o pra alinhar tudo. Seu n√∫mero de protocolo √© 009874 üìå\"\n      }\n    ]\n  }\n}"
        }
      },
      "id": "f8299aa3-6ab3-40fa-b937-274df1bf3c88",
      "name": "Atendente6",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        7680,
        4176
      ]
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Dados').item.json.Telefone }}",
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        7664,
        4512
      ],
      "id": "a335ef84-abe9-49ac-b4f5-233d0730cddf",
      "name": "Postgres Chat Memory4"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "009874",
                    "operator": {
                      "type": "string",
                      "operation": "notContains"
                    },
                    "id": "2aa763f7-cf04-44e7-9bbb-8f8de823aef8"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Continuar na IA"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "820760d6-3546-4007-8917-55d366a74261",
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "009874",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Avisar Lead grupo"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        8144,
        4192
      ],
      "id": "693642b0-454a-4f69-abf3-a3d2ff2700a3",
      "name": "Switch9"
    },
    {
      "parameters": {
        "name": "verificar_disponibilidade",
        "description": "=tool({\n  name: \"verificar_disponibilidade\",\n  description: \"Consulta hor√°rios livres reais na agenda (segunda a sexta, das 08h √†s 18h, com intervalos de 30 minutos). Aceita per√≠odos como 'amanh√£', 'pr√≥xima semana' ou uma data no formato 'YYYY-MM-DD'. Caso n√£o informe nada, retorna os dois hor√°rios dispon√≠veis mais pr√≥ximos.\",\n  parameters: {\n    dia: {\n      type: \"string\",\n      required: false,\n      description: \"Dia desejado para agendamento: 'amanh√£', 'pr√≥xima semana' ou data no formato YYYY-MM-DD.\"\n    },\n    periodo: {\n      type: \"string\",\n      required: false,\n      enum: [\"manha\", \"tarde\"],\n      description: \"Per√≠odo do dia preferido: 'manha' ou 'tarde'.\"\n    }\n  },\n  run: async ({ dia, periodo }) => {\n    const periodoTexto = (dia || \"amanh√£\").toLowerCase().trim();\n\n    const resultado = await callWorkflow(\"verificar_disponibilidade\", {\n      periodo: periodoTexto\n    });\n\n    const todosHorarios = resultado.horarios_disponiveis\n      ? resultado.horarios_disponiveis.split(\",\").map(h => h.trim())\n      : [];\n\n    // Filtro opcional por per√≠odo\n    let selecionados = todosHorarios;\n    if (periodo === \"manha\" || periodo === \"tarde\") {\n      selecionados = todosHorarios.filter(horario => {\n        const hora = parseInt(horario.slice(0, 2), 10);\n        return periodo === \"manha\" ? hora < 12 : hora >= 12;\n      });\n    }\n\n    const formatarHorario = (horarioStr) => {\n      const [hora, minuto] = horarioStr.split(\"‚Äì\")[0].split(\":\").map(Number);\n      const hoje = new Date();\n      const dataBase = new Date(hoje);\n      if (dia && /^\\d{4}-\\d{2}-\\d{2}$/.test(dia)) {\n        dataBase.setTime(new Date(dia).getTime());\n      } else if (periodoTexto.includes(\"semana\")) {\n        dataBase.setDate(hoje.getDate() + 7);\n      } else if (periodoTexto.includes(\"amanh√£\")) {\n        dataBase.setDate(hoje.getDate() + 1);\n      }\n\n      dataBase.setHours(hora, minuto, 0, 0);\n\n      const dias = [\"Domingo\", \"Segunda-feira\", \"Ter√ßa-feira\", \"Quarta-feira\", \"Quinta-feira\", \"Sexta-feira\", \"S√°bado\"];\n      const diaSemana = dias[dataBase.getDay()];\n      const diaStr = String(dataBase.getDate()).padStart(2, '0');\n      const mesStr = String(dataBase.getMonth() + 1).padStart(2, '0');\n      const horaStr = `${hora}h${minuto > 0 ? String(minuto).padStart(2, '0') : ''}`;\n\n      return `üìÖ ${diaSemana} (${diaStr}/${mesStr}) √†s ${horaStr}`;\n    };\n\n    const formatados = selecionados.slice(0, 2).map(formatarHorario);\n\n    return [\n      \"Tenho os seguintes hor√°rios dispon√≠veis:\",\n      ...formatados,\n      \"Quais voc√™ prefere?\"\n    ].join(\"\\n\");\n  }\n});\n",
        "workflowId": {
          "__rl": true,
          "value": "t8OIthtzQCF1yBHA",
          "mode": "list",
          "cachedResultName": "DevTower"
        },
        "fields": {
          "values": [
            {
              "name": "Evento",
              "stringValue": "disponibilidade"
            },
            {
              "name": "periodo",
              "stringValue": "={{ $('Mensagem Completa1').item.json.mensagem_completa }}"
            }
          ]
        },
        "specifyInputSchema": true,
        "jsonSchemaExample": "{\n  \"horarios_disponiveis\": [\n    \"üìÖ Quarta-feira (05/06) √†s 09h\",\n    \"üìÖ Quarta-feira (05/06) √†s 09h30\"\n  ]\n}\n"
      },
      "id": "458e4326-88a0-48ea-9c19-e11928c7ede3",
      "name": "verificar_disponibilidade1",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        7744,
        2832
      ],
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "e598b0c9eef217ebae69caabf7f9f17969e71c7551b3ea56caafea679433115d@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Agendamentos Agentes IA"
        },
        "returnAll": true,
        "options": {
          "timeMin": "={{ $json.start }}",
          "timeMax": "={{ $json.end }}"
        }
      },
      "id": "408a1b65-1a2e-4c8e-9811-6e3f6f5803de",
      "name": "Get Eventos Agenda1",
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1,
      "position": [
        6752,
        3696
      ],
      "alwaysOutputData": true,
      "notesInFlow": false
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "string": [
            {
              "name": "horarios_disponiveis",
              "value": "={{$input.all().map(i => i.json.horario).join(', ')}}"
            }
          ]
        },
        "options": {}
      },
      "id": "365b40d8-5edd-4d3a-8a6b-e26c18963bd6",
      "name": "Formatar Sa√≠da1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [
        7264,
        3712
      ]
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        7504,
        3760
      ],
      "id": "55392986-951e-494a-ab3d-523389b6868e",
      "name": "Limit"
    },
    {
      "parameters": {
        "functionCode": "const startTime = new Date($node[\"Parse Date\"].json.start);\nconst endTime = new Date($node[\"Parse Date\"].json.end);\nconst MIN_BLOCK_MINUTES = 30;\n\n// Verifica se o Google Agenda retornou eventos\nconst isEmpty = !items || items.length === 0 || Object.keys(items[0].json).length === 0;\n\n// Se n√£o h√° eventos, o dia inteiro est√° livre\nconst eventosUnificados = [];\n\nif (!isEmpty) {\n  // Extrai e valida os eventos\n  const eventos = items.map(item => {\n    const startObj = item.json.start;\n    const endObj = item.json.end;\n\n    if (!startObj || !endObj) return null;\n\n    const start = new Date(startObj.dateTime || startObj.date);\n    const end = new Date(endObj.dateTime || endObj.date);\n\n    return start < end ? { start, end } : null;\n  }).filter(Boolean).sort((a, b) => a.start - b.start);\n\n  // Une eventos sobrepostos ou colados\n  for (const evento of eventos) {\n    if (\n      eventosUnificados.length === 0 ||\n      evento.start > eventosUnificados[eventosUnificados.length - 1].end\n    ) {\n      eventosUnificados.push({ ...evento });\n    } else {\n      const ultimo = eventosUnificados[eventosUnificados.length - 1];\n      ultimo.end = new Date(Math.max(ultimo.end.getTime(), evento.end.getTime()));\n    }\n  }\n}\n\n// Identifica intervalos livres\nconst livre = [];\n\nif (isEmpty) {\n  // Dia todo livre\n  livre.push({ inicio: new Date(startTime), fim: new Date(endTime) });\n} else {\n  let cursor = new Date(startTime);\n\n  for (const evento of eventosUnificados) {\n    if (evento.start > cursor) {\n      const diff = (evento.start - cursor) / (1000 * 60);\n      if (diff >= MIN_BLOCK_MINUTES) {\n        livre.push({ inicio: new Date(cursor), fim: new Date(evento.start) });\n      }\n    }\n    if (evento.end > cursor) cursor = new Date(evento.end);\n  }\n\n  // Tempo livre depois do √∫ltimo evento at√© o fim do dia\n  if (cursor < endTime) {\n    const diff = (endTime - cursor) / (1000 * 60);\n    if (diff >= MIN_BLOCK_MINUTES) {\n      livre.push({ inicio: new Date(cursor), fim: new Date(endTime) });\n    }\n  }\n}\n\n// Fun√ß√£o auxiliar para evitar colis√µes com eventos (caso eles existam)\nfunction slotColide(slotInicio, slotFim, eventos) {\n  return eventos.some(evento =>\n    slotInicio < evento.end && slotFim > evento.start\n  );\n}\n\n// Gera os slots de 30min\nconst slots = [];\n\nfor (const intervalo of livre) {\n  let slotStart = new Date(intervalo.inicio);\n  while (slotStart.getTime() + MIN_BLOCK_MINUTES * 60 * 1000 <= intervalo.fim.getTime()) {\n    const slotEnd = new Date(slotStart.getTime() + MIN_BLOCK_MINUTES * 60 * 1000);\n\n    // Verifica colis√£o apenas se houver eventos\n    if (isEmpty || !slotColide(slotStart, slotEnd, eventosUnificados)) {\n      slots.push({ inicio: new Date(slotStart), fim: new Date(slotEnd) });\n    }\n\n    slotStart = slotEnd;\n  }\n}\n\n// Formata os hor√°rios\nreturn slots.map(slot => {\n  const format = d => d.toTimeString().slice(0, 5);\n  return {\n    json: {\n      horario: `${format(slot.inicio)}‚Äì${format(slot.fim)}`\n    }\n  };\n});"
      },
      "id": "45134fbc-d5d3-4263-8023-c401ae522236",
      "name": "Gerar com eventos",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        7008,
        3760
      ]
    },
    {
      "parameters": {
        "content": "# Agendamento",
        "height": 80,
        "width": 283,
        "color": 5
      },
      "id": "147c29b7-6b1b-49a4-ac57-026962dea256",
      "name": "Sticky Note53",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        5968,
        3120
      ]
    },
    {
      "parameters": {
        "resource": "calendar",
        "calendar": {
          "__rl": true,
          "value": "e598b0c9eef217ebae69caabf7f9f17969e71c7551b3ea56caafea679433115d@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Agendamentos Agentes IA"
        },
        "timeMin": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"query\"][\"start\"] }}",
        "timeMax": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"query\"][\"end\"] }}",
        "options": {}
      },
      "id": "03258301-3a10-4e84-b57d-c0db94ec377c",
      "name": "Disponibilidade4",
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1.1,
      "position": [
        7184,
        3280
      ]
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "e598b0c9eef217ebae69caabf7f9f17969e71c7551b3ea56caafea679433115d@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Agendamentos Agentes IA"
        },
        "start": "={{ $('Switch10').item.json.query.start }}",
        "end": "={{ $('Switch10').item.json.query.end }}",
        "additionalFields": {
          "attendees": [],
          "description": "={{ $('Execute Workflow Trigger').item.json.query.resumo_conversa }}",
          "summary": "=Atendimento para cliente {{ $('Switch10').item.json.query.nome }} - {{ $('Execute Workflow Trigger').item.json.whatsapp }}"
        }
      },
      "id": "8b42f054-23ee-4398-b9ce-190b4a0439f6",
      "name": "Marca2",
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1.1,
      "position": [
        7632,
        3152
      ]
    },
    {
      "parameters": {
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "e598b0c9eef217ebae69caabf7f9f17969e71c7551b3ea56caafea679433115d@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Agendamentos Agentes IA"
        },
        "options": {
          "query": "={\n  \"q\": \"{{ $json[\"whatsapp\"] }}\"\n}"
        }
      },
      "id": "7721f83b-70c9-4c2b-aa9a-b49027d29e09",
      "name": "J√° tem um evento2",
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1.1,
      "position": [
        6512,
        3136
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "delete",
        "calendar": {
          "__rl": true,
          "value": "e598b0c9eef217ebae69caabf7f9f17969e71c7551b3ea56caafea679433115d@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Agendamentos Agentes IA"
        },
        "eventId": "={{ $item(\"0\").$node[\"Verifica evento4\"].json[\"id\"] }}",
        "options": {}
      },
      "id": "b8bb8417-ddcd-4b7a-a672-c2c895ade217",
      "name": "Google Calendar5",
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1.1,
      "position": [
        6800,
        3376
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "calendar": {
          "__rl": true,
          "value": "e598b0c9eef217ebae69caabf7f9f17969e71c7551b3ea56caafea679433115d@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Agendamentos Agentes IA"
        },
        "eventId": "={{ $item(\"0\").$node[\"Verifica evento5\"].json[\"id\"] }}",
        "useDefaultReminders": false,
        "updateFields": {
          "end": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"query\"][\"end\"] }}",
          "sendUpdates": "all",
          "start": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"query\"][\"start\"] }}"
        }
      },
      "id": "1f0a680d-9ccf-4705-b9aa-c5460c373a9e",
      "name": "Google Calendar6",
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1.1,
      "position": [
        7744,
        3536
      ]
    },
    {
      "parameters": {
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "e598b0c9eef217ebae69caabf7f9f17969e71c7551b3ea56caafea679433115d@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Agendamentos Agentes IA"
        },
        "returnAll": true,
        "options": {
          "query": "=Atendimento para cliente {{ $('Switch10').item.json.query.nome }} - {{ $('Execute Workflow Trigger').item.json.whatsapp }}"
        }
      },
      "id": "d1e8f44e-526f-417a-89d6-d56b9cd60804",
      "name": "Verifica evento4",
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1.1,
      "position": [
        6528,
        3360
      ]
    },
    {
      "parameters": {
        "operation": "getAll",
        "calendar": {
          "__rl": true,
          "value": "e598b0c9eef217ebae69caabf7f9f17969e71c7551b3ea56caafea679433115d@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Agendamentos Agentes IA"
        },
        "returnAll": true,
        "options": {
          "query": "={{ $item(\"0\").$node[\"Switch10\"].json[\"query\"][\"email\"] }}"
        }
      },
      "id": "22085f47-27f8-48de-b9fa-416f8b3ee2e8",
      "name": "Verifica evento5",
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1.1,
      "position": [
        7488,
        3536
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "be5649a9-7624-4621-bd2d-84c25577c0ce",
              "leftValue": "={{ $json.available }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "a99373be-da3d-4eba-a2ae-fce7cde7e267",
      "name": "If13",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        7040,
        3600
      ]
    },
    {
      "parameters": {
        "resource": "calendar",
        "calendar": {
          "__rl": true,
          "value": "e598b0c9eef217ebae69caabf7f9f17969e71c7551b3ea56caafea679433115d@group.calendar.google.com",
          "mode": "list",
          "cachedResultName": "Agendamentos Agentes IA"
        },
        "timeMin": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"query\"][\"start\"] }}",
        "timeMax": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"query\"][\"end\"] }}",
        "options": {}
      },
      "id": "3668e0e9-9361-45d4-8103-798e172e80f1",
      "name": "Disponibilidade5",
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1.1,
      "position": [
        6528,
        3552
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "86ff282a-3ede-4417-98c1-0d10858bc5dc",
              "name": "response",
              "value": "=Voc√™ j√° tem uma reuni√£o agendada para o dia: {{(() => { \n    const data = new Date($json.start.dateTime);\n    const opcoes = { day: '2-digit', month: 'long', hour: '2-digit', minute: '2-digit' };\n    return `dia ${data.toLocaleDateString('pt-BR', opcoes).replace(' ', ' de ').replace(',', ' √†s')}`;\n})()}} gostaria de reagendar? ",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "8a3e5d10-a1c2-446e-a12c-ade7617888e2",
      "name": "Edit Fields18",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        7024,
        3136
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "8d192ed0-aebd-404e-8339-daab0d29651f",
              "leftValue": "={{ $item(\"0\").$node[\"J√° tem um evento2\"].json[\"attendees\"][\"0\"][\"email\"] }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "345c9ef1-123f-48be-9780-2b2be8c9ee37",
      "name": "If14",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        6752,
        3152
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7f842ffa-cd8f-40ab-a0a7-40dc173357a7",
              "name": "response",
              "value": "Informe o usu√°rio que o agendamento foi cancelado e que estar√° sempre √† disposi√ß√£o para um novo agendamento.",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "29c129f3-0505-4e4d-b070-f89210641002",
      "name": "Edit Fields19",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        7040,
        3392
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "04c6ca35-7572-4699-bcb7-bbf2f2a6e6a4",
              "name": "response",
              "value": "hor√°rio n√£o disponivel, pe√ßa outro hor√°rio",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "26477ede-60da-4d6c-9b60-47a218acd178",
      "name": "Edit Fields20",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        7632,
        3376
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"Evento\"] }}",
                    "rightValue": "agendamento",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "95f443a9-2c80-4a95-9a0a-4d83d16b85c3"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "agendamento"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "7a57e8e8-5227-4cde-8d58-7b447cd55a17",
                    "leftValue": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"Evento\"] }}",
                    "rightValue": "cancelamento",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "cancelamento"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d788021f-29ab-41f2-b355-2b18963d30f2",
                    "leftValue": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"Evento\"] }}",
                    "rightValue": "reagendamento",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "reagendamento"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "2dfbfdb0-74bf-49b5-8ae0-da3de20e49e6",
                    "leftValue": "={{ $item(\"0\").$node[\"Execute Workflow Trigger\"].json[\"Evento\"] }}",
                    "rightValue": "disponibilidade",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "disponibilidade"
            }
          ]
        },
        "options": {}
      },
      "id": "f638a067-c4f0-42aa-8fbf-f0b5af5d5657",
      "name": "Switch10",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        6112,
        3440
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "be5649a9-7624-4621-bd2d-84c25577c0ce",
              "leftValue": "={{ $json.available }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "2fd57c36-b10a-4ebe-b159-9c3510885e33",
      "name": "If15",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        7344,
        3152
      ]
    },
    {
      "parameters": {
        "name": "criar_reuniao",
        "description": "=Chame esta ferramenta ap√≥s o usu√°rio informar a data do agendamento e o hor√°rio.\n\nNa vari√°vel \"nome\", preencha com o nome do usu√°rio.\nNa vari√°vel \"whatsapp\", preencha com o n√∫mero do WhatsApp do usu√°rio.\n\nA data provavelmente ser√° informada no formato brasileiro (como \"10/06\" ou \"10 de junho\"), o que significa dia 10 do m√™s 6 (junho). Interprete sempre como **dd/mm/yyyy**, e n√£o mm/dd/yyyy.\n\nAp√≥s interpretar corretamente a data e o hor√°rio, converta para o formato:\n\nyyyy-mm-ddTHH:MM:00-03:00\n\nExemplo: \"10/06/2025 √†s 15h\" deve virar:\n\"2025-06-10T15:00:00-03:00\"\n\nEm seguida, adicione 30 minutos ao hor√°rio e preencha a vari√°vel \"end\" com o mesmo formato.",
        "workflowId": {
          "__rl": true,
          "value": "t8OIthtzQCF1yBHA",
          "mode": "list",
          "cachedResultName": "DevTower"
        },
        "fields": {
          "values": [
            {
              "name": "Evento",
              "stringValue": "agendamento"
            },
            {
              "name": "whatsapp",
              "stringValue": "={{ (() => { \n  const telefone = $('Dados').item.json.Telefone;\n  return 'wa.me/' + telefone.split('@')[0] + '';\n})() }}"
            }
          ]
        },
        "specifyInputSchema": true,
        "jsonSchemaExample": "{\n  \"nome\": \"J√∫nior\",\n  \"whatsapp\": \"554799653313\",\n  \"resumo_conversa\": \"Cliente solicitou troca de √≥leo para ve√≠culo √†s 15h.\",\n  \"start\": \"2025-06-10T15:00:00-03:00\",\n  \"end\": \"2025-06-10T15:30:00-03:00\"\n}"
      },
      "id": "884d34b5-8241-4466-8907-c799f608016f",
      "name": "criar_reuniao2",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        7904,
        2864
      ]
    },
    {
      "parameters": {
        "name": "cancelar_reuniao",
        "description": "=Chame esta ferramenta ap√≥s o usu√°rio informar que quer cancelar a reuni√£o, utilize o whatsapp e nome\n\nNa vari√°vel \"nome\", voc√™ vai preencher o nome do usu√°rio e na variavel \"whatsapp\" voc√™ vai preencher com whatsapp do usu√°rio",
        "workflowId": {
          "__rl": true,
          "value": "t8OIthtzQCF1yBHA",
          "mode": "list",
          "cachedResultName": "DevTower"
        },
        "fields": {
          "values": [
            {
              "name": "Evento",
              "stringValue": "cancelamento"
            },
            {
              "name": "whatsapp",
              "stringValue": "={{ (() => { \n  const telefone = $('Dados').item.json.Telefone;\n  return 'wa.me/' + telefone.split('@')[0] + '';\n})() }}"
            }
          ]
        },
        "specifyInputSchema": true,
        "jsonSchemaExample": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"whatsapp\": {\n      \"type\": \"string\"\n    }\n  },\n  \"required\": [\"whatsapp\"]\n}"
      },
      "id": "2084a446-501f-4dd6-b9da-6c729455ec96",
      "name": "cancelar_reuniao2",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        8224,
        2800
      ]
    },
    {
      "parameters": {
        "name": "reagendar_reuniao",
        "description": "=Ap√≥s o usu√°rio informar que quer reagendar o nome, whatsapp e nova data Chame esta tool\n\nNa vari√°vel \"nome\", voc√™ vai preencher o nome do usu√°rio e na variavel \"email\" voc√™ vai preencher com whatsapp do usu√°rio\n\nA data do agendamento voc√™ vai transformar para seguinte formato, exemplo: 2024-10-18T14:30:00-03:00 e vai preencher a variavel \"start\"\n\nEm seguida voc√™ vai inserir 30 minutos a mais depois no hor√°rio de agendamento e na variavel \"end\" voc√™ vai prencher com o horario no mesmo formato da variavel start",
        "workflowId": {
          "__rl": true,
          "value": "t8OIthtzQCF1yBHA",
          "mode": "list",
          "cachedResultName": "DevTower"
        },
        "fields": {
          "values": [
            {
              "name": "Evento",
              "stringValue": "reagendamento"
            },
            {
              "name": "Remotejid",
              "stringValue": "={{ $('Dados').item.json.NomeWpp }}"
            }
          ]
        },
        "specifyInputSchema": true,
        "jsonSchemaExample": "{\n  \"nome\": \"nome do usuario\",\n  \"whatsapp\": \"whatsapp do usuario\",\n  \"resumo_conversa\": \"crie um resumo especifico do problema\",\n  \"start\": \"data hora do inicio da reuni√£o\",\n  \"end\": \"data hora do fim da reuni√£o\"\n}\n"
      },
      "id": "bdfbea00-fabb-404d-a96d-c4a9c5e1af3d",
      "name": "reagendar_reuniao2",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        8064,
        2864
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "86ff282a-3ede-4417-98c1-0d10858bc5dc",
              "name": "response",
              "value": "=Agendamento conclu√≠do para a data {{(() => { \n    const data = new Date($json.start.dateTime);\n    const opcoes = { day: '2-digit', month: 'long', hour: '2-digit', minute: '2-digit' };\n    return `dia ${data.toLocaleDateString('pt-BR', opcoes).replace(' ', ' de ').replace(',', ' √†s')}`;\n})()}}\no link da reuni√£o √©: {{ $json.hangoutLink }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "5d119329-34d0-423c-a41a-e6fae9bbacb1",
      "name": "Edit Fields21",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        7872,
        3264
      ]
    },
    {
      "parameters": {
        "content": "",
        "height": 800.6667333432747,
        "width": 2503.09595343677,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        5824,
        3104
      ],
      "typeVersion": 1,
      "id": "fafae79d-1e2e-4d42-af55-b5682f0a290f",
      "name": "Sticky Note60"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7f842ffa-cd8f-40ab-a0a7-40dc173357a7",
              "name": "response",
              "value": "=sua reuni√£o foi reagendada para a data:{{(() => { \n    const data = new Date($json.start.dateTime);\n    const opcoes = { day: '2-digit', month: 'long', hour: '2-digit', minute: '2-digit' };\n    return `dia ${data.toLocaleDateString('pt-BR', opcoes).replace(' ', ' de ').replace(',', ' √†s')}`;\n})()}} o link da reuni√£o √©: {{ $json.hangoutLink }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "93cd5eca-9ae7-4554-812f-b9779e6f2be9",
      "name": "Edit Fields22",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        8048,
        3520
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "keyValue": "={{ $json.telefone }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        944,
        2544
      ],
      "id": "3ee61af3-6c5b-4d0d-8832-3d2d58aaed65",
      "name": "Supabase2",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4a6d9aac-8565-4c58-abe3-8741393a5535",
              "leftValue": "={{ $json.telefone }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1152,
        2416
      ],
      "id": "ffe6c085-6c73-43bc-b186-367541f9f62f",
      "name": "If16"
    },
    {
      "parameters": {
        "tableId": "dados_cliente",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "nomewpp",
              "fieldValue": "={{ $('Buscar Lead Prospec√ß√£o').item.json.nome }}"
            },
            {
              "fieldId": "telefone",
              "fieldValue": "={{ $('Buscar Lead Prospec√ß√£o').item.json.telefone }}"
            },
            {
              "fieldId": "created_at",
              "fieldValue": "={{ $now}}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1344,
        2512
      ],
      "id": "3ee1f934-06f7-4236-9b77-f11750a17aff",
      "name": "Supabase5"
    },
    {
      "parameters": {
        "name": "verificar_disponibilidade",
        "description": "=tool({\n  name: \"verificar_disponibilidade\",\n  description: \"Consulta hor√°rios livres reais na agenda (segunda a sexta, das 08h √†s 18h, com intervalos de 30 minutos). Aceita per√≠odos como 'amanh√£', 'pr√≥xima semana' ou uma data no formato 'YYYY-MM-DD'. Caso n√£o informe nada, retorna os dois hor√°rios dispon√≠veis mais pr√≥ximos.\",\n  parameters: {\n    dia: {\n      type: \"string\",\n      required: false,\n      description: \"Dia desejado para agendamento: 'amanh√£', 'pr√≥xima semana' ou data no formato YYYY-MM-DD.\"\n    },\n    periodo: {\n      type: \"string\",\n      required: false,\n      enum: [\"manha\", \"tarde\"],\n      description: \"Per√≠odo do dia preferido: 'manha' ou 'tarde'.\"\n    }\n  },\n  run: async ({ dia, periodo }) => {\n    const periodoTexto = (dia || \"amanh√£\").toLowerCase().trim();\n\n    const resultado = await callWorkflow(\"verificar_disponibilidade\", {\n      periodo: periodoTexto\n    });\n\n    const todosHorarios = resultado.horarios_disponiveis\n      ? resultado.horarios_disponiveis.split(\",\").map(h => h.trim())\n      : [];\n\n    // Filtro opcional por per√≠odo\n    let selecionados = todosHorarios;\n    if (periodo === \"manha\" || periodo === \"tarde\") {\n      selecionados = todosHorarios.filter(horario => {\n        const hora = parseInt(horario.slice(0, 2), 10);\n        return periodo === \"manha\" ? hora < 12 : hora >= 12;\n      });\n    }\n\n    const formatarHorario = (horarioStr) => {\n      const [hora, minuto] = horarioStr.split(\"‚Äì\")[0].split(\":\").map(Number);\n      const hoje = new Date();\n      const dataBase = new Date(hoje);\n      if (dia && /^\\d{4}-\\d{2}-\\d{2}$/.test(dia)) {\n        dataBase.setTime(new Date(dia).getTime());\n      } else if (periodoTexto.includes(\"semana\")) {\n        dataBase.setDate(hoje.getDate() + 7);\n      } else if (periodoTexto.includes(\"amanh√£\")) {\n        dataBase.setDate(hoje.getDate() + 1);\n      }\n\n      dataBase.setHours(hora, minuto, 0, 0);\n\n      const dias = [\"Domingo\", \"Segunda-feira\", \"Ter√ßa-feira\", \"Quarta-feira\", \"Quinta-feira\", \"Sexta-feira\", \"S√°bado\"];\n      const diaSemana = dias[dataBase.getDay()];\n      const diaStr = String(dataBase.getDate()).padStart(2, '0');\n      const mesStr = String(dataBase.getMonth() + 1).padStart(2, '0');\n      const horaStr = `${hora}h${minuto > 0 ? String(minuto).padStart(2, '0') : ''}`;\n\n      return `üìÖ ${diaSemana} (${diaStr}/${mesStr}) √†s ${horaStr}`;\n    };\n\n    const formatados = selecionados.slice(0, 2).map(formatarHorario);\n\n    return [\n      \"Tenho os seguintes hor√°rios dispon√≠veis:\",\n      ...formatados,\n      \"Quais voc√™ prefere?\"\n    ].join(\"\\n\");\n  }\n});\n",
        "workflowId": {
          "__rl": true,
          "value": "t8OIthtzQCF1yBHA",
          "mode": "list",
          "cachedResultName": "DevTower"
        },
        "fields": {
          "values": [
            {
              "name": "Evento",
              "stringValue": "disponibilidade"
            },
            {
              "name": "periodo",
              "stringValue": "={{ $('Mensagem Completa').item.json.mensagem_completa }}"
            }
          ]
        },
        "specifyInputSchema": true,
        "jsonSchemaExample": "{\n  \"horarios_disponiveis\": [\n    \"üìÖ Quarta-feira (05/06) √†s 09h\",\n    \"üìÖ Quarta-feira (05/06) √†s 09h30\"\n  ]\n}\n"
      },
      "id": "1c4f5157-738c-4096-8070-cee3e12a6e21",
      "name": "verificar_disponibilidade",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        7760,
        4704
      ],
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "name": "criar_reuniao",
        "description": "=Chame esta ferramenta ap√≥s o usu√°rio informar a data do agendamento e o hor√°rio.\n\nNa vari√°vel \"nome\", preencha com o nome do usu√°rio.\nNa vari√°vel \"whatsapp\", preencha com o n√∫mero do WhatsApp do usu√°rio.\n\nA data provavelmente ser√° informada no formato brasileiro (como \"10/06\" ou \"10 de junho\"), o que significa dia 10 do m√™s 6 (junho). Interprete sempre como **dd/mm/yyyy**, e n√£o mm/dd/yyyy.\n\nAp√≥s interpretar corretamente a data e o hor√°rio, converta para o formato:\n\nyyyy-mm-ddTHH:MM:00-03:00\n\nExemplo: \"10/06/2025 √†s 15h\" deve virar:\n\"2025-06-10T15:00:00-03:00\"\n\nEm seguida, adicione 30 minutos ao hor√°rio e preencha a vari√°vel \"end\" com o mesmo formato.",
        "workflowId": {
          "__rl": true,
          "value": "t8OIthtzQCF1yBHA",
          "mode": "list",
          "cachedResultName": "DevTower"
        },
        "fields": {
          "values": [
            {
              "name": "Evento",
              "stringValue": "agendamento"
            },
            {
              "name": "whatsapp",
              "stringValue": "={{ (() => { \n  const telefone = $('Dados').item.json.Telefone;\n  return 'wa.me/' + telefone.split('@')[0] + '';\n})() }}"
            }
          ]
        },
        "specifyInputSchema": true,
        "jsonSchemaExample": "{\n  \"nome\": \"J√∫nior\",\n  \"whatsapp\": \"554799653313\",\n  \"resumo_conversa\": \"Cliente solicitou troca de √≥leo para ve√≠culo √†s 15h.\",\n  \"start\": \"2025-06-10T15:00:00-03:00\",\n  \"end\": \"2025-06-10T15:30:00-03:00\"\n}"
      },
      "id": "9556685c-a3be-4e09-a070-ef2258cdcc92",
      "name": "criar_reuniao3",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        7920,
        4704
      ]
    },
    {
      "parameters": {
        "name": "cancelar_reuniao",
        "description": "=Chame esta ferramenta ap√≥s o usu√°rio informar que quer cancelar a reuni√£o, utilize o whatsapp e nome\n\nNa vari√°vel \"nome\", voc√™ vai preencher o nome do usu√°rio e na variavel \"whatsapp\" voc√™ vai preencher com whatsapp do usu√°rio",
        "workflowId": {
          "__rl": true,
          "value": "t8OIthtzQCF1yBHA",
          "mode": "list",
          "cachedResultName": "DevTower"
        },
        "fields": {
          "values": [
            {
              "name": "Evento",
              "stringValue": "cancelamento"
            },
            {
              "name": "whatsapp",
              "stringValue": "={{ (() => { \n  const telefone = $('Dados').item.json.Telefone;\n  return 'wa.me/' + telefone.split('@')[0] + '';\n})() }}"
            }
          ]
        },
        "specifyInputSchema": true,
        "jsonSchemaExample": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"whatsapp\": {\n      \"type\": \"string\"\n    }\n  },\n  \"required\": [\"whatsapp\"]\n}"
      },
      "id": "a95c6764-5310-4f58-8e07-b4d4e6995cf3",
      "name": "cancelar_reuniao3",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        8240,
        4704
      ]
    },
    {
      "parameters": {
        "name": "reagendar_reuniao",
        "description": "=Ap√≥s o usu√°rio informar que quer reagendar o nome, whatsapp e nova data Chame esta tool\n\nNa vari√°vel \"nome\", voc√™ vai preencher o nome do usu√°rio e na variavel \"email\" voc√™ vai preencher com whatsapp do usu√°rio\n\nA data do agendamento voc√™ vai transformar para seguinte formato, exemplo: 2024-10-18T14:30:00-03:00 e vai preencher a variavel \"start\"\n\nEm seguida voc√™ vai inserir 30 minutos a mais depois no hor√°rio de agendamento e na variavel \"end\" voc√™ vai prencher com o horario no mesmo formato da variavel start",
        "workflowId": {
          "__rl": true,
          "value": "t8OIthtzQCF1yBHA",
          "mode": "list",
          "cachedResultName": "DevTower"
        },
        "fields": {
          "values": [
            {
              "name": "Evento",
              "stringValue": "reagendamento"
            },
            {
              "name": "Remotejid",
              "stringValue": "={{ $('Dados').item.json.NomeWpp }}"
            }
          ]
        },
        "specifyInputSchema": true,
        "jsonSchemaExample": "{\n  \"nome\": \"nome do usuario\",\n  \"whatsapp\": \"whatsapp do usuario\",\n  \"resumo_conversa\": \"crie um resumo especifico do problema\",\n  \"start\": \"data hora do inicio da reuni√£o\",\n  \"end\": \"data hora do fim da reuni√£o\"\n}\n"
      },
      "id": "f7b6c3e7-0d20-491e-b82a-84def096309e",
      "name": "reagendar_reuniao3",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        8080,
        4704
      ]
    },
    {
      "parameters": {
        "functionCode": "const normalize = (str) =>\n  str.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '').replace(/[^\\w\\s/-]/g, '').toLowerCase();\n\nconst input = normalize($json.periodo || '');\nconst now = new Date();\n\nlet start = new Date();\nlet end = new Date();\n\nconst weekdays = {\n  segunda: 1,\n  terca: 2,\n  quarta: 3,\n  quinta: 4,\n  sexta: 5,\n  sabado: 6,\n  domingo: 0\n};\n\n// ======== 1. Determina o DIA ========\nif (input.includes('hoje')) {\n  // j√° est√° com a data de hoje\n} else if (input.includes('amanha')) {\n  start.setDate(now.getDate() + 1);\n} else if (input.includes('depois de amanha')) {\n  start.setDate(now.getDate() + 2);\n} else if (input.includes('proxima semana') || input.includes('semana que vem')) {\n  // segunda a domingo da pr√≥xima semana\n  const day = now.getDay();\n  const diff = 7 - day + 1; // pr√≥xima segunda\n  start.setDate(now.getDate() + diff);\n  end = new Date(start);\n  end.setDate(start.getDate() + 6);\n  start.setHours(8, 0, 0, 0);\n  end.setHours(18, 0, 0, 0);\n  return [{ json: { start: start.toISOString(), end: end.toISOString() } }];\n} else {\n  // Detectar dias da semana\n  for (const [dia, numero] of Object.entries(weekdays)) {\n    if (input.includes(dia)) {\n      const currentDay = now.getDay();\n      let daysToAdd = (numero - currentDay + 7) % 7;\n      daysToAdd = daysToAdd === 0 ? 7 : daysToAdd; // garante \"pr√≥xima segunda\" se hoje j√° for segunda\n      start.setDate(now.getDate() + daysToAdd);\n      break;\n    }\n  }\n\n  // Detectar datas exatas (YYYY-MM-DD ou DD/MM/YYYY)\n  const matchISO = input.match(/\\d{4}-\\d{2}-\\d{2}/);\n  const matchBR = input.match(/\\b(\\d{2})\\/(\\d{2})\\/(\\d{4})\\b/);\n  if (matchISO) {\n    start = new Date(matchISO[0]);\n  } else if (matchBR) {\n    const [_, d, m, y] = matchBR;\n    start = new Date(`${y}-${m}-${d}`);\n  }\n}\n\nend = new Date(start); // come√ßa com mesmo dia\n\n// ======== 2. Determina o PER√çODO DO DIA ========\nif (input.includes('manha')) {\n  start.setHours(8, 0, 0, 0);\n  end.setHours(12, 0, 0, 0);\n} else if (input.includes('tarde')) {\n  start.setHours(13, 0, 0, 0);\n  end.setHours(17, 0, 0, 0);\n} else if (input.includes('noite')) {\n  start.setHours(18, 0, 0, 0);\n  end.setHours(21, 0, 0, 0);\n} else {\n  // per√≠odo integral do expediente\n  start.setHours(8, 0, 0, 0);\n  end.setHours(18, 0, 0, 0);\n}\n\nreturn [{ json: { start: start.toISOString(), end: end.toISOString() } }];\n"
      },
      "id": "758b28f4-c5dc-466d-b04f-1606695be950",
      "name": "Parse Date",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        6480,
        3744
      ]
    },
    {
      "parameters": {
        "functionCode": "function formatarHorarioCompleto(horario, dataReferencia) {\n  const [hora, minuto] = horario.split(\"‚Äì\")[0].split(\":\");\n  const data = new Date(dataReferencia);\n  data.setHours(parseInt(hora), parseInt(minuto), 0, 0);\n\n  const dias = [\"Domingo\", \"Segunda-feira\", \"Ter√ßa-feira\", \"Quarta-feira\", \"Quinta-feira\", \"Sexta-feira\", \"S√°bado\"];\n  const diaSemana = dias[data.getDay()];\n  const dia = String(data.getDate()).padStart(2, '0');\n  const mes = String(data.getMonth() + 1).padStart(2, '0');\n  const horaFormatada = `${data.getHours()}h${data.getMinutes() > 0 ? data.getMinutes().toString().padStart(2, '0') : ''}`;\n\n  return `üìÖ ${diaSemana} (${dia}/${mes}) √†s ${horaFormatada}`;\n}\n\n// Pega os hor√°rios (string ou array)\nconst rawHorarios = $json.horarios_disponiveis;\nconst horarios = typeof rawHorarios === 'string'\n  ? rawHorarios.split(',').map(h => h.trim())\n  : Array.isArray(rawHorarios)\n    ? rawHorarios\n    : [];\n\nconst dataReferencia = new Date($node[\"Parse Date\"].json.start || new Date());\nconst agora = new Date();\n\n// ‚ö†Ô∏è Verifica se √© s√°bado (6) ou domingo (0)\nconst diaSemana = dataReferencia.getDay();\nif (diaSemana === 6 || diaSemana === 0) {\n  return [\n    {\n      json: {\n        mensagem_final: \"‚ö†Ô∏è N√£o temos atendimento nos finais de semana. A oficina funciona de segunda a sexta, das 08h √†s 18h.\"\n      }\n    }\n  ];\n}\n\n// Filtra hor√°rios que ainda n√£o passaram\nconst horariosFuturos = horarios.filter(horario => {\n  const [hora, minuto] = horario.split(\"‚Äì\")[0].split(\":\");\n  const dataHorario = new Date(dataReferencia);\n  dataHorario.setHours(parseInt(hora), parseInt(minuto), 0, 0);\n  return dataHorario >= agora;\n});\n\n// Pega at√© dois hor√°rios futuros\nconst doisHorarios = horariosFuturos.slice(0, 2).map(h => formatarHorarioCompleto(h, dataReferencia));\n\n// Mensagem final formatada com \\\\n\nconst mensagem = [\n  \"Tenho os seguintes hor√°rios dispon√≠veis:\",\n  ...doisHorarios,\n  \"Qual voc√™ prefere?\"\n].join(\"\\\\n\");\n\nreturn [\n  {\n    json: {\n      mensagem_final: mensagem\n    }\n  }\n];\n"
      },
      "name": "Formatar hor√°rios",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        7760,
        3744
      ],
      "id": "a164c471-53db-4032-8f07-b13367e60193"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "",
        "options": {}
      },
      "id": "27773636-6a34-4e6b-804b-44476dcf666f",
      "name": "Responder",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        8048,
        3712
      ]
    },
    {
      "parameters": {
        "toolDescription": "Envia um v√≠deo explicativo da automa√ß√£o via WhatsApp",
        "method": "POST",
        "url": "https://webhook.devtower.online/webhook/mcmcnffhssdk",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"numero\": \"{{ $('Webhook EVO').item.json.body.data.key.remoteJid }}\"\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        8224,
        2592
      ],
      "id": "3ccc3462-00f0-401a-b4de-50d9c5f07b2c",
      "name": "enviar_video"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "mcmcnffhssdk",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        6832,
        1840
      ],
      "id": "9bf7a4cc-6491-4bdc-b49b-bb0d0cfbb7ac",
      "name": "Webhook",
      "webhookId": "e3f1afb7-6a3b-4270-806b-78adb3f34ef9"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "operation": "send-video",
        "instanceName": "DevTower",
        "remoteJid": "={{ $json.body.numero }}",
        "media": "=link",
        "options_message": {
          "delay": 10000
        }
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        7072,
        1840
      ],
      "id": "7a57eb96-460d-46a5-956e-c3dbee23f222",
      "name": "Evolution API6",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "content": "",
        "height": 341,
        "width": 1023,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        6704,
        1680
      ],
      "typeVersion": 1,
      "id": "d1dd3dda-98ef-43fd-bda6-3a79cfed9d43",
      "name": "Sticky Note61"
    },
    {
      "parameters": {
        "content": "# V√≠deo Whatsapp Oficinas",
        "height": 80,
        "width": 563,
        "color": 5
      },
      "id": "9fe45b66-1af2-4664-88cd-58af20205f75",
      "name": "Sticky Note62",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        6752,
        1696
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "Prospec√ß√£o",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $json.data.key.remoteJid }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "status",
              "fieldValue": "video_enviado"
            },
            {
              "fieldId": "ultima_interacao",
              "fieldValue": "={{ $now }}"
            }
          ]
        }
      },
      "name": "Atualizar Status1",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        7280,
        1824
      ],
      "id": "38ec9deb-3617-442b-ac50-85764612d6dd"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "Prospec√ß√£o",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $('Execute Workflow Trigger').item.json.whatsapp }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "status",
              "fieldValue": "apresentacao_agendada"
            },
            {
              "fieldId": "ultima_interacao",
              "fieldValue": "={{ $now }}"
            }
          ]
        }
      },
      "name": "Atualizar Status2",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        8080,
        3200
      ],
      "id": "6b7c9661-4230-4f05-993c-9bd66910db18"
    },
    {
      "parameters": {
        "triggerTimes": {
          "item": [
            {
              "hour": 7
            }
          ]
        }
      },
      "name": "Cron planilha",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [
        464,
        1872
      ],
      "id": "250d5c88-ac89-4c06-9b7d-9691b15077f2"
    },
    {
      "parameters": {
        "contextWindowLength": 50
      },
      "id": "6091ab53-99cc-4c90-9208-8a157079a66e",
      "name": "Mem√≥ria",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "position": [
        1008,
        1280
      ],
      "typeVersion": 1.3,
      "notes": "TEMPLATE DESENVOLVIDO POR RODRIGO ALVES\nwww.youtube.com/@rodrigoalveslps?sub_confirmation=1\n\nCOMUNIDADE PRODUZIMOS IA WHATSAPP\nhttps://chat.whatsapp.com/DCXhD8UTjPaAXigl6Q5zmk\n\nCURSO M√ÅQUINA DE AGENTES IA E AUTOMA√á√ïES\nhttps://checkout.produzimosia.com/OE11373AF"
    },
    {
      "parameters": {
        "url": "https://local-business-search.p.rapidapi.com/search",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "query",
              "value": "={{ $('Webhook1').item.json.body.termo_de_busca }}"
            },
            {
              "name": "limit",
              "value": "120"
            },
            {
              "name": "language",
              "value": "PT"
            },
            {
              "name": "region",
              "value": "br"
            },
            {
              "name": "extract_emails_and_contacts",
              "value": "true"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-rapidapi-host",
              "value": "local-business-search.p.rapidapi.com"
            },
            {
              "name": "x-rapidapi-key",
              "value": "=SUA CHAVE AQUI"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        752,
        1456
      ],
      "id": "150c24d5-0e0c-47e6-ac9c-4cf8dbb0d445",
      "name": "rapidapi_local-business-search",
      "notes": "TEMPLATE DESENVOLVIDO POR RODRIGO ALVES\nwww.youtube.com/@rodrigoalveslps?sub_confirmation=1\n\nCOMUNIDADE PRODUZIMOS IA WHATSAPP\nhttps://chat.whatsapp.com/DCXhD8UTjPaAXigl6Q5zmk\n\nCURSO M√ÅQUINA DE AGENTES IA E AUTOMA√á√ïES\nhttps://checkout.produzimosia.com/OE11373AF"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1g0IJPaROsWYEmFHipYZK9fouAEHYY0Ec7hZXJ2831uk",
          "mode": "list",
          "cachedResultName": "Analise de Atendimento",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g0IJPaROsWYEmFHipYZK9fouAEHYY0Ec7hZXJ2831uk/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1511455453,
          "mode": "list",
          "cachedResultName": "pagina1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1g0IJPaROsWYEmFHipYZK9fouAEHYY0Ec7hZXJ2831uk/edit#gid=1511455453"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Nome": "={{ $json.name }}",
            "N√∫mero": "={{ $json.phone_number }}",
            "Ramo": "mecanica",
            "Telefone": "={{ \"55\" + $json.phone_number.replace(/\\D/g,\"\").replace(/^55/,\"\").replace(/^(\\d{2})9(\\d{8})$/, \"$1$2\") + \"@s.whatsapp.net\" }}",
            "Observa√ß√£o (opcional)": "={{ $json.full_address }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Nome",
              "displayName": "Nome",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "N√∫mero",
              "displayName": "N√∫mero",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Telefone",
              "displayName": "Telefone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Ramo",
              "displayName": "Ramo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Observa√ß√£o (opcional)",
              "displayName": "Observa√ß√£o (opcional)",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        1264,
        1456
      ],
      "id": "d48f3880-1917-4a3a-89f6-8df9e84d95d9",
      "name": "inclui_dados_planilha",
      "alwaysOutputData": true,
      "onError": "continueRegularOutput",
      "notes": "TEMPLATE DESENVOLVIDO POR RODRIGO ALVES\nwww.youtube.com/@rodrigoalveslps?sub_confirmation=1\n\nCOMUNIDADE PRODUZIMOS IA WHATSAPP\nhttps://chat.whatsapp.com/DCXhD8UTjPaAXigl6Q5zmk\n\nCURSO M√ÅQUINA DE AGENTES IA E AUTOMA√á√ïES\nhttps://checkout.produzimosia.com/OE11373AF"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=Prompt do Agente de Prospec√ß√£o de Neg√≥cios\n\nIDENTIDADE E MISS√ÉO\nVoc√™ √© um assistente especializado em prospec√ß√£o de neg√≥cios. Sua fun√ß√£o principal √© interpretar solicita√ß√µes de usu√°rios sobre informa√ß√µes de empresas e neg√≥cios e acionar a ferramenta pega\\_dados\\_dos\\_negocios para coletar esses dados automaticamente em uma planilha.\n\nFERRAMENTA DISPON√çVEL\nNome: pega\\_dados\\_dos\\_negocios\nPar√¢metro obrigat√≥rio: termo\\_de\\_busca\nDescri√ß√£o: string no formato \"\\[O que voc√™ busca] em \\[Cidade], \\[Pa√≠s/Estado]\". O termo pode ser escrito em portugu√™s ou em ingl√™s.\n\nDESCRI√á√ÉO DETALHADA DE termo\\_de\\_busca\nO campo termo\\_de\\_busca √© utilizado para encontrar informa√ß√µes sobre estabelecimentos ou servi√ßos em uma localidade espec√≠fica. O texto pode estar em portugu√™s ou em ingl√™s e deve seguir esta estrutura:\n\\[O que voc√™ busca] em \\[Cidade], \\[Pa√≠s/Estado]\n\n* \\[O que voc√™ busca]: tipo de servi√ßo ou estabelecimento (ex.: Hot√©is, Restaurantes, Museus).\n* em: palavra fixa \"em\" (ou \"in\", se preferir ingl√™s).\n* \\[Cidade], \\[Pa√≠s/Estado]: nome da cidade e do pa√≠s ou estado.\n\nEXEMPLOS R√ÅPIDOS\nInten√ß√£o: Hot√©is em S√£o Francisco, EUA      -> termo\\_de\\_busca: Hot√©is em S√£o Francisco, EUA\nInten√ß√£o: Farm√°cias em Rio de Janeiro       -> termo\\_de\\_busca: Farm√°cias em Rio de Janeiro, Brasil\nInten√ß√£o: Restaurantes japoneses em S√£o Paulo -> termo\\_de\\_busca: Restaurantes japoneses em S√£o Paulo, Brasil\nInten√ß√£o: Aeroportos em Londres             -> termo\\_de\\_busca: Aeroportos em Londres, Reino Unido\n\nRESPONSABILIDADES PRINCIPAIS\n\n1. Interpretar solicita√ß√µes: identificar tipo de neg√≥cio, localiza√ß√£o e filtros.\n2. Construir o termo\\_de\\_busca: montar a string no formato exigido, em portugu√™s ou ingl√™s conforme necess√°rio.\n3. Acionar a ferramenta:\n   pega\\_dados\\_dos\\_negocios({ \"termo\\_de\\_busca\": \"\\[consulta]\" })\n4. Confirmar execu√ß√£o: informar ao usu√°rio que os dados foram coletados e adicionados √† planilha.\n\nDIRETRIZES DE COMPORTAMENTO\nAo receber uma solicita√ß√£o:\n\n* Identificar os elementos‚Äëchave.\n* Normalizar os termos e montar o termo\\_de\\_busca no formato correto.\n* Chamar a ferramenta e responder de forma concisa ao usu√°rio.\n\nFORMATO DA RESPOSTA AO USU√ÅRIO\n\n* Confirmar o que foi solicitado.\n* Informar que a busca foi realizada e que os dados est√£o na planilha.\n\nEXEMPLOS DE INTERA√á√ÉO\nExemplo 1\nUsu√°rio: \"Quero informa√ß√µes sobre cl√≠nicas m√©dicas no Rio de Janeiro\".\nAgente:\ntermo\\_de\\_busca: Cl√≠nicas m√©dicas em Rio de Janeiro, Brasil\nChamada: pega\\_dados\\_dos\\_negocios({ \"termo\\_de\\_busca\": \"Cl√≠nicas m√©dicas em Rio de Janeiro, Brasil\" })\nResposta: Busquei e coletei informa√ß√µes sobre cl√≠nicas m√©dicas no Rio de Janeiro. Os dados j√° foram adicionados √† sua planilha de prospec√ß√£o.\n\nExemplo 2\nUsu√°rio: \"Preciso de dados de restaurantes japoneses em S√£o Paulo\".\nAgente:\ntermo\\_de\\_busca: Restaurantes japoneses em S√£o Paulo, Brasil\nChamada: pega\\_dados\\_dos\\_negocios({ \"termo\\_de\\_busca\": \"Restaurantes japoneses em S√£o Paulo, Brasil\" })\nResposta: Coletei informa√ß√µes sobre restaurantes japoneses em S√£o Paulo. Todos os dados foram inseridos na planilha.\n\nExemplo 3\nUsu√°rio: \"Me ajuda a encontrar escrit√≥rios de advocacia especializados em direito trabalhista na Zona Sul do Rio\".\nAgente:\ntermo\\_de\\_busca: Escrit√≥rios de advocacia trabalhista em Zona Sul Rio de Janeiro, Brasil\nChamada: pega\\_dados\\_dos\\_negocios({ \"termo\\_de\\_busca\": \"Escrit√≥rios de advocacia trabalhista em Zona Sul Rio de Janeiro, Brasil\" })\nResposta: Busquei escrit√≥rios de advocacia especializados em direito trabalhista na Zona Sul do Rio de Janeiro. As informa√ß√µes j√° est√£o dispon√≠veis na sua planilha.\n\nTRATAMENTO DE CASOS ESPECIAIS\nSolicita√ß√µes amb√≠guas: pedir esclarecimentos.\nM√∫ltiplas localiza√ß√µes: executar buscas separadas e avisar o usu√°rio.\nSegmentos amplos: sugerir refinamentos.\n\nRESPOSTAS PADR√ÉO\nAp√≥s coleta bem‚Äësucedida: \"Coletei as informa√ß√µes sobre \\[busca] em \\[local]. Os dados j√° foram adicionados √† sua planilha de prospec√ß√£o.\"\nQuando precisar de esclarecimentos: \"Para garantir que eu colete as informa√ß√µes mais relevantes, poderia especificar \\[informa√ß√£o faltante]?\"\nPara confirma√ß√£o: \"Entendi que voc√™ precisa de dados sobre \\[busca] em \\[local]. Vou coletar essas informa√ß√µes agora.\"\n\nPRINC√çPIOS IMPORTANTES\n\n* Proatividade: deduzir inten√ß√µes com informa√ß√µes incompletas quando poss√≠vel.\n* Precis√£o: usar o formato exato de termo\\_de\\_busca.\n* Concis√£o: confirmar a a√ß√£o sem explica√ß√µes desnecess√°rias.\n* Confiabilidade: sempre confirmar quando os dados forem adicionados.\n\nLIMITA√á√ïES\n\n* N√£o fornecer os dados diretamente na conversa.\n* N√£o analisar nem interpretar os dados coletados.\n* N√£o sugerir estrat√©gias de prospec√ß√£o.\n* Focar apenas em coletar e confirmar a inser√ß√£o dos dados na planilha.\n\nLembre-se: Voc√™ √© a ponte entre a solicita√ß√£o do usu√°rio e a coleta automatizada de dados. Interprete corretamente, construa o termo\\_de\\_busca e acione a ferramenta com precis√£o.\n"
        }
      },
      "id": "27a3ad74-6091-4d1a-baa9-294f9161f901",
      "name": "Agente IA",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        928,
        1072
      ],
      "typeVersion": 1.8,
      "notes": "TEMPLATE DESENVOLVIDO POR RODRIGO ALVES\nwww.youtube.com/@rodrigoalveslps?sub_confirmation=1\n\nCOMUNIDADE PRODUZIMOS IA WHATSAPP\nhttps://chat.whatsapp.com/DCXhD8UTjPaAXigl6Q5zmk\n\nCURSO M√ÅQUINA DE AGENTES IA E AUTOMA√á√ïES\nhttps://checkout.produzimosia.com/OE11373AF"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1344,
        1072
      ],
      "id": "08b5fbaa-e0ee-486f-a79b-2a5e8e5f506c",
      "name": "Fim2"
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "42c5df71-5ce6-4746-90fc-4b197f51b873",
      "name": "Solicitar leads",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "position": [
        688,
        1072
      ],
      "webhookId": "1fc494f1-781c-4f54-b3fc-d14132ad2ca6",
      "typeVersion": 1.1,
      "notes": "TEMPLATE DESENVOLVIDO POR RODRIGO ALVES\nwww.youtube.com/@rodrigoalveslps?sub_confirmation=1\n\nCOMUNIDADE PRODUZIMOS IA WHATSAPP\nhttps://chat.whatsapp.com/DCXhD8UTjPaAXigl6Q5zmk\n\nCURSO M√ÅQUINA DE AGENTES IA E AUTOMA√á√ïES\nhttps://checkout.produzimosia.com/OE11373AF",
      "disabled": true
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "id": "d8e7310d-06a4-4c7d-af6b-548ecdaac241",
      "name": "Modelo de Linguagem",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        848,
        1264
      ],
      "typeVersion": 1.2,
      "notes": "TEMPLATE DESENVOLVIDO POR RODRIGO ALVES\nwww.youtube.com/@rodrigoalveslps?sub_confirmation=1\n\nCOMUNIDADE PRODUZIMOS IA WHATSAPP\nhttps://chat.whatsapp.com/DCXhD8UTjPaAXigl6Q5zmk\n\nCURSO M√ÅQUINA DE AGENTES IA E AUTOMA√á√ïES\nhttps://checkout.produzimosia.com/OE11373AF"
    },
    {
      "parameters": {
        "toolDescription": "Busca dados de estabelecimentos, empresas e servi√ßos a partir de um termo de busca",
        "method": "POST",
        "url": "=https://webhook.devtower.online/webhook/SKAJFKAJAKSLJF",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "termo_de_busca",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        1168,
        1264
      ],
      "id": "d33b80fc-f514-47f8-b740-f5d689b96d45",
      "name": "busca_dados",
      "notes": "TEMPLATE DESENVOLVIDO POR RODRIGO ALVES\nwww.youtube.com/@rodrigoalveslps?sub_confirmation=1\n\nCOMUNIDADE PRODUZIMOS IA WHATSAPP\nhttps://chat.whatsapp.com/DCXhD8UTjPaAXigl6Q5zmk\n\nCURSO M√ÅQUINA DE AGENTES IA E AUTOMA√á√ïES\nhttps://checkout.produzimosia.com/OE11373AF"
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        1008,
        1456
      ],
      "id": "3c6eeaff-d4e1-41ce-a50a-f3f97d5f45b0",
      "name": "separa_dados",
      "notes": "TEMPLATE DESENVOLVIDO POR RODRIGO ALVES\nwww.youtube.com/@rodrigoalveslps?sub_confirmation=1\n\nCOMUNIDADE PRODUZIMOS IA WHATSAPP\nhttps://chat.whatsapp.com/DCXhD8UTjPaAXigl6Q5zmk\n\nCURSO M√ÅQUINA DE AGENTES IA E AUTOMA√á√ïES\nhttps://checkout.produzimosia.com/OE11373AF"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "26b63941-4d20-43ff-af60-6b148ce28706",
              "name": "response",
              "value": "Preenchi l√° na planilha os neg√≥cios que eu encontrei",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1552,
        1456
      ],
      "id": "4d9d7bf0-1ace-4cc7-beb9-ed73ae89942f",
      "name": "responde_IA",
      "notes": "TEMPLATE DESENVOLVIDO POR RODRIGO ALVES\nwww.youtube.com/@rodrigoalveslps?sub_confirmation=1\n\nCOMUNIDADE PRODUZIMOS IA WHATSAPP\nhttps://chat.whatsapp.com/DCXhD8UTjPaAXigl6Q5zmk\n\nCURSO M√ÅQUINA DE AGENTES IA E AUTOMA√á√ïES\nhttps://checkout.produzimosia.com/OE11373AF"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "SKAJFKAJAKSLJF",
        "responseMode": "lastNode",
        "responseData": "allEntries",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        464,
        1456
      ],
      "id": "d6236cf5-401a-4ff7-9827-6001c0324ea4",
      "name": "Webhook1",
      "webhookId": "2f63aff5-a13a-4d10-ad1d-a6f4335bc7fa",
      "notes": "TEMPLATE DESENVOLVIDO POR RODRIGO ALVES\nwww.youtube.com/@rodrigoalveslps?sub_confirmation=1\n\nCOMUNIDADE PRODUZIMOS IA WHATSAPP\nhttps://chat.whatsapp.com/DCXhD8UTjPaAXigl6Q5zmk\n\nCURSO M√ÅQUINA DE AGENTES IA E AUTOMA√á√ïES\nhttps://checkout.produzimosia.com/OE11373AF"
    },
    {
      "parameters": {
        "content": "",
        "height": 720,
        "width": 1360,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        400,
        912
      ],
      "id": "415c2239-8723-4a7b-942f-eae5b8211ba5",
      "name": "Sticky Note30"
    },
    {
      "parameters": {
        "content": "## FLUXO BUSCADOR DE LEADS GOOGLE MEU NEG√ìCIO",
        "height": 80,
        "width": 660,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        432,
        944
      ],
      "id": "d32f3d91-5776-4d63-a2f4-859a6cfa9fc4",
      "name": "Sticky Note63"
    },
    {
      "parameters": {
        "content": "## Instru√ß√µes de Uso\n1. Crie um path √∫nico no webhook e modifique o endere√ßo na tool\n2. Troque a credencial da api Link: https://rapidapi.com/letscrape-6bRBa3QguO5/api/local-business-search [rapidapi_local-business-search]\n3. Preencha o campo abaixo do [x-rapidapi-key] com a sua chave\n4. Selecione os campos a ser preenchidos na sua tabela do google sheets",
        "height": 220,
        "width": 690,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1504,
        1200
      ],
      "id": "03717bb3-f7ac-4279-ab20-42bfacf93b81",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## Instru√ß√µes de Uso\n\n\nEsse √© o agente disparador de mensagens\n\n1. Defina de quanto em quanto tempo o fluxo vai acionar",
        "height": 220,
        "width": 690,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2048,
        2592
      ],
      "id": "8f67a976-bf1b-4c62-ae09-c05c9770c8da",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "CREATE TABLE prospeccao (\n  id BIGSERIAL PRIMARY KEY,\n  nome TEXT,\n  telefone TEXT,\n  ramo TEXT,\n  status TEXT,\n  origem TEXT,\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  ultima_interacao TIMESTAMPTZ\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        2112,
        224
      ],
      "id": "1751bd75-b1db-4502-bc04-bc4ff9daf5ba",
      "name": "Cria Tabela Prospeccao"
    },
    {
      "parameters": {
        "content": "",
        "height": 200
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        448,
        576
      ],
      "typeVersion": 1,
      "id": "b54c24b9-1dd3-4f86-a107-dad25ed2fc12",
      "name": "Sticky Note64"
    },
    {
      "parameters": {
        "content": "",
        "height": 200
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1248,
        176
      ],
      "typeVersion": 1,
      "id": "174f3109-efa1-4dfb-914f-d23f5038ed80",
      "name": "Sticky Note70"
    },
    {
      "parameters": {
        "content": "",
        "height": 200
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1488,
        576
      ],
      "typeVersion": 1,
      "id": "5bc48221-95e6-4e47-ad28-ce4966d79259",
      "name": "Sticky Note75"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "create table dados_cliente (\n  id bigserial primary key,\n  created_at TIMESTAMPTZ, \n  telefone text, \n  nomewpp text,\n  atendimento_ia text\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        784,
        192
      ],
      "id": "643cc684-98db-4d86-920b-db8239c4fae5",
      "name": "Cria Tabela Dados Cliente1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- Create a table to store your documents\ncreate table documents (\n  id bigserial primary key,\n  content text, -- corresponds to Document.pageContent\n  metadata jsonb, -- corresponds to Document.metadata\n  embedding vector(1536) -- 1536 works for OpenAI embeddings, change if needed\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        1824,
        224
      ],
      "id": "3cb1665e-01de-4309-a9e8-2778e9b8889b",
      "name": "Cria Tabela Documentos1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "delete from documents",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        1552,
        592
      ],
      "id": "9e684fb5-82a9-4b3a-8131-4b7faab9c6b5",
      "name": "Deleta Conte√∫do Documentos1"
    },
    {
      "parameters": {
        "content": "",
        "height": 200
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1504,
        176
      ],
      "typeVersion": 1,
      "id": "770e505c-69cd-47f9-b8a7-d40bc4d4b958",
      "name": "Sticky Note76"
    },
    {
      "parameters": {
        "content": "",
        "height": 200
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1760,
        176
      ],
      "typeVersion": 1,
      "id": "9e666d61-f494-4a78-ba7b-022abc3a8a07",
      "name": "Sticky Note77"
    },
    {
      "parameters": {
        "content": "",
        "height": 200
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        464,
        176
      ],
      "typeVersion": 1,
      "id": "892c1c7f-bf6d-4967-b02b-fdb14d788563",
      "name": "Sticky Note78"
    },
    {
      "parameters": {
        "content": "",
        "height": 200
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        992,
        176
      ],
      "typeVersion": 1,
      "id": "86cf315e-46ce-4a80-9f16-982a3dc59348",
      "name": "Sticky Note79"
    },
    {
      "parameters": {
        "content": "",
        "height": 200
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        960,
        576
      ],
      "typeVersion": 1,
      "id": "6b19f319-b6f7-4004-8579-7ff0b7c23142",
      "name": "Sticky Note80"
    },
    {
      "parameters": {
        "content": "",
        "height": 200
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        720,
        176
      ],
      "typeVersion": 1,
      "id": "3f8a8dd2-1655-4846-8172-973ccc057440",
      "name": "Sticky Note81"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "delete from n8n_chat_histories",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        512,
        624
      ],
      "id": "80e5cd58-07eb-4e75-9a3d-6d4e020753b1",
      "name": "Deleta Hist√≥rico1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "create function match_documents (\n  query_embedding vector(1536),\n  match_count int default null,\n  filter jsonb DEFAULT '{}'\n) returns table (\n  id bigint,\n  content text,\n  metadata jsonb,\n  similarity float\n)\nlanguage plpgsql\nas $$\n#variable_conflict use_column\nbegin\n  return query\n  select\n    id,\n    content,\n    metadata,\n    1 - (documents.embedding <=> query_embedding) as similarity\n  from documents\n  where metadata @> filter\n  order by documents.embedding <=> query_embedding\n  limit match_count;\nend;\n$$;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        1568,
        192
      ],
      "id": "1fd643e0-6b75-4838-90a6-74ad1c0bf187",
      "name": "Cria fun√ß√£o Busca em Vetor1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "create extension vector;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        1312,
        192
      ],
      "id": "8c8c8a7f-2b1b-4cb1-a8ba-40df10456741",
      "name": "Cria Extens√£o Vetor1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "create table chats (\n  id bigserial primary key,\n  created_at TIMESTAMPTZ, \n  phone text,\n  updated_at text\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        1040,
        192
      ],
      "id": "8372be2c-4c5a-4430-971c-2954e1f098e3",
      "name": "Cria Tabela Chats1"
    },
    {
      "parameters": {
        "content": "",
        "height": 200
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1232,
        576
      ],
      "typeVersion": 1,
      "id": "28e8f286-66fc-4087-b906-5752275b42cf",
      "name": "Sticky Note82"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "delete from chats",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        1280,
        592
      ],
      "id": "5bf06eb8-b307-4437-acd8-68c614fe1a54",
      "name": "Deleta Conte√∫do Chats1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "delete from dados_cliente",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        1024,
        592
      ],
      "id": "425817ca-9663-4b73-8933-3e8034a234cc",
      "name": "Deleta Conte√∫do Dados Cliente1"
    },
    {
      "parameters": {
        "content": "",
        "height": 200
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        704,
        576
      ],
      "typeVersion": 1,
      "id": "026ce8f6-42a8-4584-9fce-82ee8f84515b",
      "name": "Sticky Note83"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "delete from chat_messages",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        768,
        592
      ],
      "id": "7ca05eef-1156-482d-b504-f2f1ac03c757",
      "name": "Deleta Conte√∫do Chat_Messages1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "CREATE TABLE chat_messages (\n  id BIGSERIAL PRIMARY KEY,\n  created_at TIMESTAMPTZ, \n  phone TEXT,\n  nomewpp TEXT, \n  bot_message TEXT,\n  user_message TEXT, \n  message_type TEXT,\n  active BOOLEAN DEFAULT TRUE\n);\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        528,
        192
      ],
      "id": "b904caa6-44ca-43b1-b013-4299d258d389",
      "name": "Cria Tabela Chat_Messages1"
    },
    {
      "parameters": {
        "content": "# Ferramentas para criar\n\n",
        "height": 80,
        "width": 456,
        "color": 4
      },
      "id": "e3c86ce0-6bb6-474e-8dae-123fff76d2b2",
      "name": "Sticky Note15",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        464,
        80
      ]
    },
    {
      "parameters": {
        "content": "# Ferramentas para apagar dados da tabela\n\n",
        "height": 80,
        "width": 1016,
        "color": 3
      },
      "id": "a0beb4f3-078d-4b21-970b-9642f761bc5c",
      "name": "Sticky Note29",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        432,
        464
      ]
    },
    {
      "parameters": {
        "content": "",
        "height": 380,
        "width": 1920,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        400,
        32
      ],
      "typeVersion": 1,
      "id": "7c4302cf-efa1-43f5-afd0-11e2deef050f",
      "name": "Sticky Note84"
    },
    {
      "parameters": {
        "content": "",
        "height": 380,
        "width": 1680,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        400,
        432
      ],
      "typeVersion": 1,
      "id": "5713d72f-bf94-447b-8808-0407c81ff48e",
      "name": "Sticky Note85"
    },
    {
      "parameters": {
        "content": "",
        "height": 200,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2048,
        176
      ],
      "typeVersion": 1,
      "id": "8815359c-9aa9-4bbc-beb0-06848339c616",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "## Mude a sua credencial do Postgress para criar todas as tabelas",
        "height": 80,
        "width": 790,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1360,
        80
      ],
      "id": "84944bce-e7cc-4479-b8af-1452ee70fe45",
      "name": "Sticky Note86"
    }
  ],
  "pinData": {
    "Webhook EVO": [
      {
        "json": {
          "headers": {
            "host": "webhook.devtower.online",
            "user-agent": "axios/1.7.9",
            "content-length": "1042",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "x-forwarded-for": "172.18.0.1",
            "x-forwarded-host": "webhook.devtower.online",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "b819fc3c4831",
            "x-real-ip": "172.18.0.1"
          },
          "params": {},
          "query": {},
          "body": {
            "event": "messages.upsert",
            "instance": "DevTower",
            "data": {
              "key": {
                "remoteJid": "554733559795@s.whatsapp.net",
                "fromMe": false,
                "id": "3EB0168D971163D9DB5771"
              },
              "pushName": "CRV Vistorias",
              "status": "DELIVERY_ACK",
              "message": {
                "conversation": "Seria referente a qual assunto? Dependendo o que for posso repassar aos vistoriadores e eles j√° lhe d√£o um retorno",
                "messageContextInfo": {
                  "deviceListMetadata": {
                    "senderKeyHash": "nHI8IwL/w1PG0w==",
                    "senderTimestamp": "1755774670",
                    "senderAccountType": "E2EE",
                    "receiverAccountType": "E2EE",
                    "recipientKeyHash": "sA9fVmjfbfKrJQ==",
                    "recipientTimestamp": "1754672832"
                  },
                  "deviceListMetadataVersion": 2,
                  "messageSecret": "inbFfudh28TFyvhKJfQl8x+J3JJ2KmDAWEPGe3mnmHo="
                }
              },
              "messageType": "conversation",
              "messageTimestamp": 1755792948,
              "instanceId": "7a15c239-481b-4f8b-bbf7-4af7015f0343",
              "source": "web"
            },
            "destination": "https://webhook.devtower.online/webhook/DevTower",
            "date_time": "2025-08-21T13:15:48.451Z",
            "sender": "554799653313@s.whatsapp.net",
            "server_url": "https://api.devtower.online",
            "apikey": "C001DDEC0A22-4235-BCBE-DC7AE935AFEB"
          },
          "webhookUrl": "https://webhook.devtower.online/webhook/DevTower",
          "executionMode": "production"
        }
      }
    ],
    "Execute Workflow Trigger": [
      {
        "json": {
          "query": {
            "nome": "Breno",
            "email": "brendanedlem@gmail.com",
            "start": "2025-03-14T15:00:00-03:00",
            "end": "2025-03-14T15:50:00-03:00"
          },
          "Evento": "agendamento",
          "Remotejid": "553199905686@s.whatsapp.net"
        }
      }
    ],
    "Schedule Trigger1": [
      {
        "json": {
          "timestamp": "2025-08-01T06:30:28.005-03:00",
          "Readable date": "August 1st 2025, 6:30:28 am",
          "Readable time": "6:30:28 am",
          "Day of week": "Friday",
          "Year": "2025",
          "Month": "August",
          "Day of month": "01",
          "Hour": "06",
          "Minute": "30",
          "Second": "28",
          "Timezone": "America/Sao_Paulo (UTC-03:00)"
        }
      }
    ],
    "Webhook": [
      {
        "json": {
          "headers": {
            "host": "webhook.devtower.online",
            "user-agent": "axios/1.8.3",
            "content-length": "40",
            "accept": "application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "x-forwarded-for": "172.18.0.1",
            "x-forwarded-host": "webhook.devtower.online",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "b819fc3c4831",
            "x-real-ip": "172.18.0.1"
          },
          "params": {},
          "query": {},
          "body": {
            "numero": "554733043619@s.whatsapp.net"
          },
          "webhookUrl": "https://webhook.devtower.online/webhook/e3f1afb7-6a3b-4270-806b-78adb3f34ef9",
          "executionMode": "production"
        }
      }
    ],
    "Webhook1": [
      {
        "json": {
          "headers": {
            "host": "webhook.devtower.online",
            "user-agent": "axios/1.8.3",
            "content-length": "55",
            "accept": "application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "x-forwarded-for": "172.18.0.1",
            "x-forwarded-host": "webhook.devtower.online",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "b819fc3c4831",
            "x-real-ip": "172.18.0.1"
          },
          "params": {},
          "query": {},
          "body": {
            "termo_de_busca": "Oficinas mec√¢nicas em Brusque, SC"
          },
          "webhookUrl": "https://webhook.devtower.online/webhook/2f63aff5-a13a-4d10-ad1d-a6f4335bc7fa",
          "executionMode": "production"
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-09-08T20:10:22.783Z",
      "createdAt": "2025-09-08T20:10:22.783Z",
      "role": "workflow:owner",
      "workflowId": "R79i6iWxhZDB2UUa",
      "projectId": "o60HadikmqrvYZ9Z"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 5,
  "updatedAt": "2025-09-08T20:10:22.783Z",
  "versionId": "3c1e97b5-2ce4-496a-9ce2-9df0cfadbe1b"
}