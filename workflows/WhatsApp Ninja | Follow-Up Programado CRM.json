{
  "active": false,
  "connections": {
    "Webhook1": {
      "main": [
        [
          {
            "node": "Execution Data1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Get Lead": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Create Lead": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Update Lead": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Execution Data1": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-06-15T14:49:59.399Z",
  "id": "RNHWxk1EncRcDLnT",
  "isArchived": false,
  "meta": null,
  "name": "WhatsApp Ninja | Follow-Up Programado CRM",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "checkout-crm",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -220,
        160
      ],
      "id": "4e8d2533-95a7-4dcc-9278-71c772516ac3",
      "name": "Webhook1",
      "webhookId": "7ff557a4-a6cd-4606-8134-7146dd281033"
    },
    {
      "parameters": {
        "model": "gpt-4o",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        260,
        480
      ],
      "id": "6cd22707-a3aa-4991-b22a-38935a123b73",
      "name": "OpenAI Chat Model1"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "leads",
        "filters": {
          "conditions": [
            {
              "keyName": "email",
              "keyValue": "={{ $fromAI(\"email\",\"user_email\") }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        380,
        680
      ],
      "id": "0b5cce3c-09b0-4e69-bad5-6567a30e7d14",
      "name": "Get Lead"
    },
    {
      "parameters": {
        "tableId": "leads",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "name",
              "fieldValue": "={{ $fromAI(\"name\",\"user name\") }}"
            },
            {
              "fieldId": "phone",
              "fieldValue": "={{ $fromAI(\"phone\",\"User phone number\") }}"
            },
            {
              "fieldId": "email",
              "fieldValue": "={{ $fromAI(\"email\",\"user email\") }}"
            },
            {
              "fieldId": "status",
              "fieldValue": "={{ $fromAI(\"status\",\"webhook type\") }}"
            },
            {
              "fieldId": "product_name",
              "fieldValue": "={{ $fromAI(\"product_name\",\"product name\") }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        500,
        680
      ],
      "id": "fc2767c9-e19d-4ab6-ba7b-345e16dc18c9",
      "name": "Create Lead"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "leads",
        "filters": {
          "conditions": [
            {
              "keyName": "email",
              "condition": "eq",
              "keyValue": "={{ $fromAI(\"user_email\",\"lead email\") }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "status",
              "fieldValue": "={{ $fromAI(\"webhook_type\") }}"
            },
            {
              "fieldId": "product_name",
              "fieldValue": "={{ $fromAI(\"product_name\",\"product name\") }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        620,
        680
      ],
      "id": "69e39f7d-a305-4231-a824-32868d5041bd",
      "name": "Update Lead"
    },
    {
      "parameters": {
        "dataToSave": {
          "values": [
            {
              "key": "number",
              "value": "={{ $json.body.Customer?.mobile || $json.body.phone}}"
            },
            {
              "key": "name",
              "value": "={{ $json.body.Customer?.full_name || $json.body.name}}"
            },
            {
              "key": "type",
              "value": "LEAD"
            },
            {
              "key": "product",
              "value": "={{ $json.body.Product?.product_name || $json.body.product_name}}"
            },
            {
              "key": "webhook",
              "value": "={{ $json.body.webhook_event_type || $json.body.status}}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executionData",
      "typeVersion": 1,
      "position": [
        60,
        160
      ],
      "id": "a2f61b87-de85-485d-90a7-754d00fd854a",
      "name": "Execution Data1"
    },
    {
      "parameters": {
        "content": "# Tags\n### Salva nome e n√∫mero para debug",
        "height": 340,
        "width": 220
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        0
      ],
      "id": "ce0a2dd9-df28-416f-8c6e-e3ad5b7b54ca",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "agent": "openAiFunctionsAgent",
        "promptType": "define",
        "text": "={{ $json.body }}",
        "options": {
          "systemMessage": "1 - Check if the lead is in the Database already\n\n2 - If not, create user record\n\n3 - Else, Update the record, but only if status is not\"order_approved\" or \"purchase_approved\""
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        320,
        160
      ],
      "id": "7453d593-d3d8-4f19-b81d-e4e9fa7451cd",
      "name": "AI Agent",
      "executeOnce": false,
      "retryOnFail": true,
      "maxTries": 2,
      "onError": "continueErrorOutput"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "createdAt": "2025-06-15T14:49:59.399Z",
      "updatedAt": "2025-06-15T14:49:59.399Z",
      "role": "workflow:owner",
      "workflowId": "RNHWxk1EncRcDLnT",
      "projectId": "o60HadikmqrvYZ9Z"
    }
  ],
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-06-14T14:35:30.743Z",
      "updatedAt": "2025-06-14T14:35:30.743Z",
      "id": "f7Ttu7FQN3EvRKX9",
      "name": "ü•∑üèº Ninja Automa√ß√µes"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2025-06-15T14:49:59.399Z",
  "versionId": "8a271c43-e275-41e1-86c4-50dd5c6f3e6b"
}