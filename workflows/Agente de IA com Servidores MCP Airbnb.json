{
  "active": false,
  "activeVersion": null,
  "activeVersionId": null,
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Mensagem não é minha",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Agente de IA",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "Agente de IA",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Qual tipo de dado?": {
      "main": [
        [
          {
            "node": "Definindo mensagem de texto",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "base64 pra binário",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Base64 pra binário",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensagem não é minha": {
      "main": [
        [
          {
            "node": "Qual tipo de dado?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Definindo mensagem de texto": {
      "main": [
        [
          {
            "node": "Agente de IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Base64 pra binário": {
      "main": [
        [
          {
            "node": "Analisador de Imagens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "base64 pra binário": {
      "main": [
        [
          {
            "node": "Transcrição do áudio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transcrição do áudio": {
      "main": [
        [
          {
            "node": "Definindo mensagem de áudio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analisador de Imagens": {
      "main": [
        [
          {
            "node": "Agente de IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Definindo mensagem de áudio": {
      "main": [
        [
          {
            "node": "Agente de IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agente de IA": {
      "main": [
        [
          {
            "node": "API WhatsApp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-06-20T15:05:23.275Z",
  "id": "6HDiOm7X79s4JuWQ",
  "isArchived": false,
  "meta": null,
  "name": "Agente de IA com Servidores MCP Airbnb",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "b3ea2895-6fee-4583-bf47-4ff1dc384d68",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -640,
        300
      ],
      "id": "a066624a-f045-47fa-bec6-536d951ce001",
      "name": "Webhook",
      "webhookId": "b3ea2895-6fee-4583-bf47-4ff1dc384d68"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        880,
        540
      ],
      "id": "fc4d2f63-bc65-4d75-a9ff-cd2bd5fd4866",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "58nXg6cOh7QVFFh8",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Webhook').item.json.body.data.key.remoteJid }}",
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        1040,
        540
      ],
      "id": "bfc0da87-52c7-49fd-b197-1767c3dbf8b0",
      "name": "Postgres Chat Memory"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-mcp.mcpClientTool",
      "typeVersion": 1,
      "position": [
        1420,
        560
      ],
      "id": "0218a267-4655-451f-9ec0-94d6e7eac941",
      "name": "Airbnb List Tools"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-mcp.mcpClientTool",
      "typeVersion": 1,
      "position": [
        1560,
        560
      ],
      "id": "40640049-0c66-4e08-9b3e-2757972d1d5d",
      "name": "Airbnb Execute Tools"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-mcp.mcpClientTool",
      "typeVersion": 1,
      "position": [
        1420,
        840
      ],
      "id": "a0d7f1f7-e4c4-4c04-be5a-6f194f92c3ab",
      "name": "Tavily List Tools"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-mcp.mcpClientTool",
      "typeVersion": 1,
      "position": [
        1560,
        840
      ],
      "id": "2c9d645e-840c-4439-82a0-6b0bd8c7345a",
      "name": "Tavily Execute Tools"
    },
    {
      "parameters": {
        "content": "## Airbnb Tools\nRepositório do servidor [aqui](https://github.com/openbnb-org/mcp-server-airbnb)",
        "height": 260,
        "width": 460,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1220,
        480
      ],
      "id": "fa11667c-5a93-4061-a37d-c7a6fc967ad5",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## Tavily Tools\nRepositório do servidor [aqui](https://github.com/tavily-ai/tavily-mcp)",
        "height": 260,
        "width": 460,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1220,
        760
      ],
      "id": "d95875c9-d14a-489a-b281-c50c3ec0ee0d",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## Cérebro",
        "height": 220,
        "width": 380,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        780,
        480
      ],
      "id": "666993c5-5ec3-49a8-b298-3b7bd2b24244",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "## Tratamento de Dados",
        "height": 640,
        "width": 800,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        0
      ],
      "id": "eab2ce21-828d-47d5-b3f7-e155124641cb",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.data.messageType }}",
                    "rightValue": "conversation",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "e015fcd2-e945-4d57-af67-a0059156aa74"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Texto"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a05b5da9-e6f2-4c20-b0de-d4e10e6d0d62",
                    "leftValue": "={{ $json.body.data.messageType }}",
                    "rightValue": "audioMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Áudio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "df3f6803-7f5f-4417-8a75-02df480fb7d8",
                    "leftValue": "={{ $json.body.data.messageType }}",
                    "rightValue": "imageMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Imagem"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -200,
        280
      ],
      "id": "40e6fc0b-8221-41cd-9a8b-3d550995dda2",
      "name": "Qual tipo de dado?"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "fc8d2c42-17c3-438f-b87b-c307680299f7",
              "leftValue": "={{ $json.body.data.key.fromMe }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -440,
        300
      ],
      "id": "94caada3-4caa-4f5a-ad41-4b01d8271e4e",
      "name": "Mensagem não é minha"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "86d13735-39c8-4f6f-8d28-82b42b84dd99",
              "name": "content",
              "value": "={{ $json.body.data.message.conversation }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        300,
        80
      ],
      "id": "ea9d12b1-e938-4037-a1c1-6c0283460bd0",
      "name": "Definindo mensagem de texto"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "body.data.message.base64",
        "options": {}
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        80,
        440
      ],
      "id": "0ec1ddc9-9f1d-4492-8fd4-8b8dbc57c9cb",
      "name": "Base64 pra binário"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "body.data.message.base64",
        "options": {
          "fileName": "data",
          "mimeType": "audio/ogg"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        80,
        260
      ],
      "id": "c2731b75-b270-4275-a466-f80d0c183f38",
      "name": "base64 pra binário"
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        300,
        260
      ],
      "id": "02b7b1cb-b54e-41de-9f87-cae84c9af1d6",
      "name": "Transcrição do áudio",
      "credentials": {
        "openAiApi": {
          "id": "58nXg6cOh7QVFFh8",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "text": "Descreva todos os elementos presentes na imagem, inclusive tudo o que está escrito. Inclusive, nome de marcas, apps etc.",
        "inputType": "base64",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        500,
        440
      ],
      "id": "8416451a-4d0e-45a6-b30e-8d8f9e87cdee",
      "name": "Analisador de Imagens",
      "credentials": {
        "openAiApi": {
          "id": "58nXg6cOh7QVFFh8",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8b910260-e778-4b34-9697-6c85b79b7d39",
              "name": "content",
              "value": "={{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        500,
        260
      ],
      "id": "10c32132-acc4-4dc7-9a48-52beb7ca3d04",
      "name": "Definindo mensagem de áudio"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{$json.content}}",
        "options": {
          "systemMessage": "=Você é um assistente pessoal do Anwar Hermuche.\n\n# Ferramentas\nAntes de pesquisar na internet, use a ferramenta \"list_internet_tools\". Depois que já souber quais ferramentas você tem acesso para pesquisar na internet, use \"execute_internet_tools\".\n\nO mesmo para pesquisar sobre Airbnbs. Use o \"list_airbnb_tools\" primeiro e depois use o \"execute_airbnb_tools\".\n\n\n# REGRAS\n- Data e hora atual: {{ $now.format(\"dd/MM/yyyy HH:mm:ss\") }}, horário de Brasília.\n- Não use markdown. Use *negrito* e _italico_. Além disso, bullet points são permitidos também."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        920,
        260
      ],
      "id": "4679171b-a65b-4359-a693-dde55dadf55e",
      "name": "Agente de IA"
    },
    {
      "parameters": {
        "options_Create_instance": {}
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        1380,
        260
      ],
      "id": "0add789a-009a-4c70-8433-9787bdaa1fa9",
      "name": "API WhatsApp"
    },
    {
      "parameters": {
        "content": "## Recebimento dos dados",
        "height": 340,
        "width": 620,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -680,
        160
      ],
      "id": "a996a8aa-9533-4dfc-909a-cd0012ba290f",
      "name": "Sticky Note4"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-06-20T15:05:23.275Z",
      "createdAt": "2025-06-20T15:05:23.275Z",
      "role": "workflow:owner",
      "workflowId": "6HDiOm7X79s4JuWQ",
      "projectId": "o60HadikmqrvYZ9Z"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-07-02T13:46:14.763Z",
  "versionId": "a1f6854d-f459-4d56-b484-48da34fb068a"
}