{
  "active": false,
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Supabase1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase1": {
      "main": [
        [
          {
            "node": "Aggregate1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate1": {
      "main": [
        [
          {
            "node": "gera rankins",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "gera rankins": {
      "main": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Auto-fixing Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Auto-fixing Output Parser",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Auto-fixing Output Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Basic LLM Chain1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain1": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Supabase2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase2": {
      "main": [
        [
          {
            "node": "Envia resumo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-06-21T13:38:10.175Z",
  "id": "EXQ1gNLau16iTnnS",
  "isArchived": false,
  "meta": null,
  "name": "Gestor de comunidade Resumos Semanais",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "weeks",
              "triggerAtDay": [
                6
              ],
              "triggerAtHour": 20,
              "triggerAtMinute": 20
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        0,
        0
      ],
      "id": "d20e43fe-43b1-4205-aa6a-f8be5e598856",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "resumos",
        "returnAll": true,
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "tipo",
              "condition": "eq",
              "keyValue": "diario"
            },
            {
              "keyName": "created_at",
              "condition": "lte",
              "keyValue": "={{ $now }}"
            },
            {
              "keyName": "created_at",
              "condition": "gte",
              "keyValue": "={{ $now.minus(7 'days') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        260,
        0
      ],
      "id": "11e8c27b-3994-495c-9a34-278c239af34a",
      "name": "Supabase"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "include": "specifiedFields",
        "fieldsToInclude": "conteudo",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        480,
        0
      ],
      "id": "5155e0d2-1dea-460e-a36e-34a0b35a3b6b",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "mensagens_grupo",
        "returnAll": true,
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "created_at",
              "condition": "gte",
              "keyValue": "={{ $now.minus(7, 'days') }}"
            },
            {
              "keyName": "created_at",
              "condition": "lte",
              "keyValue": "={{ $now }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        680,
        0
      ],
      "id": "8fd53d32-c3d3-43f2-8e08-3b765321f7cc",
      "name": "Supabase1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9509485e-99cb-4638-8e49-737c844f98e8",
              "name": "ranking",
              "value": "={{ (() => {\n  const dados = $json.data ?? [];\n\n  const contagem = {};\n  for (const { numero, nome } of dados) {\n    if (!contagem[numero]) {\n      contagem[numero] = { qt: 0, nome: nome || numero };\n    }\n    contagem[numero].qt += 1;\n  }\n\n  const medalhas = ['ü•á', 'ü•à', 'ü•â'];\n\n  return Object.values(contagem)\n    .sort((a, b) => b.qt - a.qt)\n    .slice(0, 3)\n    .map((p, i) => `${medalhas[i]} ${i + 1}. ${p.nome} ‚Äî ${p.qt} intera√ß√µes`)\n    .join('\\n');\n})() }}\n",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1120,
        0
      ],
      "id": "d2720ead-c34c-48fb-bcc7-59e30b424cee",
      "name": "gera rankins"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "include": "specifiedFields",
        "fieldsToInclude": "numero, nome",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        920,
        0
      ],
      "id": "d55306fe-43b4-4956-8249-e96f27c025e0",
      "name": "Aggregate1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Aggregate').item.json.data }}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "=Voc√™ √© um analista de comunidade da Dascia Academy. Sua tarefa √© criar um resumo **voltado exclusivamente para os alunos e participantes da comunidade** com base nas conversas e trocas da √∫ltima semana.\n\nVoc√™ receber√° os resumos de cada dia da semana.\n\nSeu objetivo √© entregar um conte√∫do leve, inspirador e informativo, destacando:\n\n1. Os temas que mais geraram discuss√µes e aprendizado\n2. Os principais insights pr√°ticos e estrat√©gicos compartilhados\n3. Ferramentas, t√©cnicas e estrat√©gias que surgiram nas conversas\n4. O sentimento geral da comunidade durante a semana\n5. Uma mensagem de fechamento que motive os membros a continuar colaborando e executando, nada clich√™, algo que realmente motive.\n\nN√£o fa√ßa introdu√ß√µes, apenas retorne o formato a seguir.\nRetorne o texto no seguinte formato:\n\nT√≥pcios da semana: t√≥pico 1, t√≥pico 2 e t√≥pico 3\n\nüìå Temas em Destaque:\n- Tema 1: resumo breve do que foi discutido\n- Tema 2: resumo breve\n- Tema 3: resumo breve\n\nüí° Principais Insights da Semana:\n- Insight 1\n- Insight 2\n- Insight 3\n\nüõ†Ô∏è Ferramentas e Estrat√©gias Citadas:\n- Ferramenta 1 ‚Äì breve explica√ß√£o ou contexto\n- Estrat√©gia X ‚Äì como foi aplicada ou discutida\n\nüåü Sentimento Geral:\nUm par√°grafo descrevendo o clima da semana, o n√≠vel de energia e colabora√ß√£o.\n\nüí≠ Considera√ß√µes Finais:\nMensagem de fechamento que inspire os membros a continuar participando, compartilhando e executando suas ideias.\n"
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.6,
      "position": [
        1460,
        0
      ],
      "id": "2301bc7a-7d96-4eea-be2e-fbb26a617ebe",
      "name": "Basic LLM Chain"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash-preview-05-20",
        "options": {
          "temperature": 0.2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1360,
        160
      ],
      "id": "2060e2fc-250f-4b46-be07-8ae0780c18eb",
      "name": "Google Gemini Chat Model"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserAutofixing",
      "typeVersion": 1,
      "position": [
        1640,
        160
      ],
      "id": "7901d82a-f81b-4875-b953-a48b2c0cecea",
      "name": "Auto-fixing Output Parser"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"topicos_principais\": \"Micro-SaaS, Marketing de Influ√™ncia, Automa√ß√£o com IA\",\n  \"destaques_da_semana\": [\n    {\n      \"tema\": \"Viabilidade de Micro-SaaS\",\n      \"resumo\": \"Discuss√µes sobre modelos sustent√°veis de micro-SaaS e como nichar solu√ß√µes aumenta a longevidade dos produtos.\"\n    },\n    {\n      \"tema\": \"Marketing Org√¢nico com IA\",\n      \"resumo\": \"Estrat√©gias para viralizar no TikTok usando CapCut, Gemini e narrativas centradas em dor de p√∫blico-alvo.\"\n    },\n    {\n      \"tema\": \"Estrutura√ß√£o de Produtos Digitais\",\n      \"resumo\": \"Trocas sobre constru√ß√£o de produtos enxutos com valida√ß√£o r√°pida e aproveitamento de APIs e automa√ß√µes.\"\n    }\n  ],\n  \"insights\": [\n    \"Focar em problemas reais de nichos √© mais eficaz do que buscar produtos virais gen√©ricos.\",\n    \"Marketing de influ√™ncia funciona melhor com narrativa pessoal e conte√∫do visual din√¢mico.\",\n    \"Ferramentas low-code + IA aceleram valida√ß√£o de produto com baixo custo.\"\n  ],\n  \"ferramentas_e_estrategias\": [\n    \"CapCut ‚Äì usado para criar v√≠deos virais com IA.\",\n    \"Gemini ‚Äì usado para gerar conte√∫do r√°pido com boa qualidade.\",\n    \"Notion + Zapier ‚Äì usados para organizar tarefas com automa√ß√µes simples.\"\n  ],\n  \"sentimento_geral\": \"Semana energ√©tica e colaborativa, com foco em execu√ß√£o pr√°tica e inova√ß√£o com IA.\",\n  \"consideracoes_finais\": \"A semana mostrou como a uni√£o de estrat√©gia, criatividade e execu√ß√£o pode acelerar ideias. A comunidade se manteve ativa, compartilhando erros, acertos e oportunidades. Continuamos firmes na miss√£o de construir juntos, aprendendo e evoluindo lado a lado.\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        1780,
        420
      ],
      "id": "b2995714-2103-4fde-8286-1071bb7e1530",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1580,
        360
      ],
      "id": "39fcba25-f3a1-40a6-aae0-f32d0b04ed21",
      "name": "OpenAI Chat Model"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "583096ae-46f3-430c-9864-a4e4be06b203",
              "name": "mensagem",
              "value": "=*Resumo Semanal - Conversa Fiada üìÖ Per√≠odo: {{ $now.minus(7, 'days').format('dd/MM') }} a {{ $now.format('dd/MM') }}\n\n*Ranking de Membros Mais ativos:*\n{{ $('gera rankins').item.json.ranking }}\nüìå *Principais t√≥picos:* {{ $json.output.topicos_principais }}\n\n*Destaques da Semana:*\n{{ $json.output.destaques_da_semana.map(d => `*Tema:* ${d.tema}\\n*Resumo:* ${d.resumo}`).join('\\n\\n') }}\n\nüí° *Principais Insights:*\n{{ $json.output.insights.map(i => \"- \" + i).join('\\n') }}\n\nüõ†Ô∏è Ferramentas e Estrat√©gias Mencionadas:\n{{ $json.output.ferramentas_e_estrategias.map(i => \"- \" + i).join('\\n') }}\n\nüåü Sentimento Geral:\n- {{ $json.output.sentimento_geral }}\n\nüí≠ Considera√ß√µes Finais:\n- {{ $json.output.consideracoes_finais }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1920,
        0
      ],
      "id": "dae5ddf1-97b2-479a-afe2-f0e1b027442f",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Basic LLM Chain').item.json.output.insights }}",
        "messages": {
          "messageValues": [
            {
              "message": "=Voc√™ √© um apresentador de um mini podcast sobre empreendedorismo e inova√ß√£o na comunidade da Dascia Academy.\n\nSua tarefa √© transformar um conjunto de **insights em texto** em um **roteiro falado**, com uma linguagem natural, fluida e leve ‚Äî como se estivesse conversando com o ouvinte em um epis√≥dio curto.\n\n‚ö†Ô∏è N√£o leia o texto original. Reescreva com tom de conversa, informal e direto ao ponto. Pode usar express√µes como \"olha s√≥\", \"uma coisa legal que surgiu foi\", \"vale a pena ficar de olho\", \"d√° pra aplicar isso no seu neg√≥cio agora\", etc.\n\nüéØ Objetivo:\n- Inspirar o ouvinte\n- Refor√ßar aprendizados da semana\n- Estimular a√ß√£o e reflex√£o pr√°tica\n\nRetorne apenas o texto final em formato de fala. Mantenha o tom humano e evite rob√¥ ou leitura for√ßada.\n\nAgora transforme os seguintes insights em um mini epis√≥dio de podcast:"
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.6,
      "position": [
        2160,
        0
      ],
      "id": "6a3f6459-11f1-4f85-a21d-bf6277c89991",
      "name": "Basic LLM Chain1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        2100,
        200
      ],
      "id": "eb08fc50-0d5c-4b97-bdcd-e07390ab9cc1",
      "name": "OpenAI Chat Model1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "key",
              "value": "sua chave api"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"model\": \"gemini-2.5-flash-preview-tts\",\n    \"contents\": [{\n      \"parts\": [{\n        \"text\": \"{{ $json.text.replaceAll('\\n').replaceAll('\\n\\n') }}\"\n      }]\n    }],\n    \"generationConfig\": {\n      \"responseModalities\": [\"AUDIO\"],\n      \"speechConfig\": {\n        \"voiceConfig\": {\n          \"prebuiltVoiceConfig\": {\n            \"voiceName\": \"Zephyr\"  \n          }\n        }\n      }\n    }\n  }",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2560,
        0
      ],
      "id": "f4d05683-01a9-43a7-b37e-71b77397e6a2",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "jsCode": "function pcmToWav(pcmBase64) {\n  const pcmData = Buffer.from(pcmBase64, 'base64');\n  const wavHeader = Buffer.alloc(44);\n\n  const numChannels = 1;\n  const sampleRate = 24000;\n  const bitsPerSample = 16;\n  const byteRate = sampleRate * numChannels * bitsPerSample / 8;\n  const blockAlign = numChannels * bitsPerSample / 8;\n  const dataSize = pcmData.length;\n  const fileSize = dataSize + 44 - 8;\n\n  wavHeader.write('RIFF', 0);                         // ChunkID\n  wavHeader.writeUInt32LE(fileSize, 4);              // ChunkSize\n  wavHeader.write('WAVE', 8);                        // Format\n  wavHeader.write('fmt ', 12);                       // Subchunk1ID\n  wavHeader.writeUInt32LE(16, 16);                   // Subchunk1Size (PCM)\n  wavHeader.writeUInt16LE(1, 20);                    // AudioFormat (1 = PCM)\n  wavHeader.writeUInt16LE(numChannels, 22);          // NumChannels\n  wavHeader.writeUInt32LE(sampleRate, 24);           // SampleRate\n  wavHeader.writeUInt32LE(byteRate, 28);             // ByteRate\n  wavHeader.writeUInt16LE(blockAlign, 32);           // BlockAlign\n  wavHeader.writeUInt16LE(bitsPerSample, 34);        // BitsPerSample\n  wavHeader.write('data', 36);                       // Subchunk2ID\n  wavHeader.writeUInt32LE(dataSize, 40);             // Subchunk2Size\n\n  const wavBuffer = Buffer.concat([wavHeader, pcmData]);\n  return wavBuffer.toString('base64');\n}\n\nconst audioBase64 = $json[\"candidates\"][0].content.parts[0].inlineData.data;\nreturn [{ json: { wav_base64: pcmToWav(audioBase64) } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2820,
        0
      ],
      "id": "ad528552-d73c-4783-89a9-6c06b942b33a",
      "name": "Code"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "wav_base64",
        "options": {
          "mimeType": "audio/mpeg"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        3060,
        0
      ],
      "id": "8bf84ce3-72fc-4209-8b63-5150db4c16d0",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://seu id do supabase.supabase.co/storage/v1/object/audios/resumosemanal-{{ $now.format('dd-MM-yyyy') }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "=sua role secret"
            },
            {
              "name": "Authorization",
              "value": "Bearer sua role secret"
            }
          ]
        },
        "sendBody": true,
        "contentType": "binaryData",
        "inputDataFieldName": "data",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3300,
        0
      ],
      "id": "47b08461-206c-4388-85a1-d5a6cdf8fe1f",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "tableId": "resumos",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "audio_url",
              "fieldValue": "=https://kzpedtrkyqvszjzzndcl.supabase.co/storage/v1/object/public/audios//resumosemanal-{{ $now.format('dd-MM-yyyy') }}"
            },
            {
              "fieldId": "tipo",
              "fieldValue": "semanal"
            },
            {
              "fieldId": "conteudo",
              "fieldValue": "={{ $('Edit Fields').item.json.mensagem }}"
            },
            {
              "fieldId": "ranking",
              "fieldValue": "={{ $('gera rankins').item.json.ranking }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        3540,
        0
      ],
      "id": "ba560c7a-393d-4b5f-9b59-6b31df05a53a",
      "name": "Supabase2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evolutionapi.seu dominio.com/message/sendText/sua instancia",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "sua chave api"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "=120363399514150691@g.us"
            },
            {
              "name": "text",
              "value": "={{ $('Edit Fields').item.json.mensagem }}\n*Link do resumo em podcast:* {{ $json.audio_url }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3800,
        0
      ],
      "id": "3e3c2567-1f55-403d-b9ef-d16e7aa9a56b",
      "name": "Envia resumo"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "createdAt": "2025-06-21T13:38:10.175Z",
      "updatedAt": "2025-06-21T13:38:10.175Z",
      "role": "workflow:owner",
      "workflowId": "EXQ1gNLau16iTnnS",
      "projectId": "o60HadikmqrvYZ9Z"
    }
  ],
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-06-21T13:38:26.289Z",
  "versionId": "7e1c101a-09e6-4457-b540-e02adaf7f899"
}