{
  "active": false,
  "activeVersion": null,
  "activeVersionId": null,
  "connections": {
    "Code": {
      "main": [
        [
          {
            "node": "Enviar Mensagem WhatsApp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook1": {
      "main": [
        [
          {
            "node": "Set Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Create User": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Create Payment": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get User": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Data": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-06-15T14:52:08.245Z",
  "id": "lPTs4x7yHpk6XCsS",
  "isArchived": false,
  "meta": null,
  "name": "Recupera√ß√£o de Checkout",
  "nodes": [
    {
      "parameters": {
        "jsCode": "// Pega o texto da vari√°vel de entrada\nlet inputText = $input.first().json.output;\n\n// Substitui todos os casos de **texto** para *texto*\nlet outputText = inputText.replace(/\\*\\*(.*?)\\*\\*/g, '*$1*');\n\n// Substitui todas as ocorr√™ncias de \\n para \\n\\n\noutputText = outputText.replace(/([^\\n]|^)\\n([^\\n]|$)/g, '$1\\n\\n$2');\n\n// Retorna o resultado\nreturn {\n  json: {\n    outputText: outputText\n  }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        620,
        520
      ],
      "id": "ed83fbe5-5992-48b9-9f6b-cd61bff03da3",
      "name": "Code"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "teste-webhook",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -700,
        520
      ],
      "id": "6e629e8a-9e42-4c04-89a4-94db521cf83d",
      "name": "Webhook1",
      "webhookId": "7ff557a4-a6cd-4606-8134-7146dd281033"
    },
    {
      "parameters": {
        "model": "gpt-4o",
        "options": {
          "temperature": 0.2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -180,
        880
      ],
      "id": "cfe0783e-d34b-489e-8f13-46943fcf7f94",
      "name": "OpenAI Chat Model"
    },
    {
      "parameters": {
        "tableId": "users",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "name",
              "fieldValue": "={{ $fromAI(\"name\",\"user name\") }}"
            },
            {
              "fieldId": "phone",
              "fieldValue": "={{ $fromAI(\"phone\",\"User phone number\") }}"
            },
            {
              "fieldId": "email",
              "fieldValue": "={{ $fromAI(\"email\",\"user email\") }}"
            },
            {
              "fieldId": "address",
              "fieldValue": "={{ $fromAI(\"address\",\"user address\") }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        260,
        940
      ],
      "id": "78677b0f-d483-40b5-af90-d078df719d23",
      "name": "Create User"
    },
    {
      "parameters": {
        "tableId": "payments",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "user_email",
              "fieldValue": "={{ $fromAI(\"user_email\",\"user email\") }}"
            },
            {
              "fieldId": "amount",
              "fieldValue": "={{ $fromAI(\"payment_amount\") }}"
            },
            {
              "fieldId": "payment_method",
              "fieldValue": "={{ $fromAI(\"payment_method\") }}"
            },
            {
              "fieldId": "transaction_id",
              "fieldValue": "={{ $fromAI(\"transaction_id\") }}"
            },
            {
              "fieldId": "status",
              "fieldValue": "={{ $fromAI(\"payment_status\") }}"
            },
            {
              "fieldId": "created_at",
              "fieldValue": "={{ $fromAI(\"payment_created_at\") }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        380,
        940
      ],
      "id": "99185097-d2cc-441f-963d-0b2c0dd28053",
      "name": "Create Payment"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "users",
        "filters": {
          "conditions": [
            {
              "keyName": "email",
              "keyValue": "={{ $fromAI(\"email\",\"user_email\") }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabaseTool",
      "typeVersion": 1,
      "position": [
        500,
        940
      ],
      "id": "4e2e7a2d-845d-492b-befc-089b29b4907b",
      "name": "Get User"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.body }}",
        "options": {
          "systemMessage": "webhook boleto gerado:\nusers: Verificar se o usu√°rio j√° existe no banco de dados. Caso n√£o exista, crie o usu√°rio.\npayments: Registrar um novo pagamento com status 'pending' e m√©todo 'boleto'.\n\nwebhook pix gerado:\nusers: Verificar se o usu√°rio j√° existe no banco de dados.\npayments: Registrar um novo pagamento com status 'pending' e m√©todo 'pix'.\n\nwebhook carrinho abandonado:\nusers: Nenhuma altera√ß√£o no banco de dados.\npayments: Nenhuma altera√ß√£o no banco de dados.\n\nwebhook compra recusada:\nusers: Nenhuma altera√ß√£o no banco de dados.\npayments: Registrar novo pagamento com status 'failed'.\n\nwebhook compra aprovada:\nusers: Criar um novo usu√°rio se n√£o existir no banco de dados.\npayments: Registrar novo pagamento com status 'approved'.\nusers: Enviar mensagem de confirma√ß√£o e libera√ß√£o do curso.\n\nwebhook reembolso:\nusers: Nenhuma altera√ß√£o no banco de dados.\npayments: Alterar status do pagamento para 'refunded'.\n\nwebhook chargeback:\nusers: Nenhuma altera√ß√£o no banco de dados.\npayments: Alterar status do pagamento para 'chargeback'.\n\n\nSeu output final deve ser escrito com base nos seguintes templates:\n\nCrie a mensagem exatamente como os templates abaixo, substituindo apenas os valores entre chaves de acordo com o input\n1. Compra Aprovada\nüì¢ Parab√©ns, {customer_name}! üöÄ\n\nSeu acesso ao curso AUTOMA√á√ÉO NA PR√ÅTICA foi liberado! üéâ\n\nüîπ Pr√≥ximos Passos:\n‚úÖ Acesse o curso agora: [link_para_o_curso]\n‚úÖ Entre no nosso grupo exclusivo: [link_do_grupo]\n‚úÖ Qualquer d√∫vida, fale conosco!\n\nüí≥ Pagamento Confirmado\nüí∞ Valor: {amount}\nüìÑ Transa√ß√£o: {transaction_id}\n\nAproveite o curso e transforme seu neg√≥cio com automa√ß√£o! üî•\n\n2. Boleto Gerado\nüì¢ Ol√°, {customer_name}!\n\nSeu boleto para o curso AUTOMA√á√ÉO NA PR√ÅTICA foi gerado.\n\nüîπ Detalhes do pagamento:\nüí∞ Valor: {amount}\nüè¶ Vencimento: {due_date}\nüîó C√≥digo do boleto: {boleto_barcode}\n\nüìå Importante: Seu acesso ao curso ser√° liberado assim que o pagamento for confirmado.\n\nCaso precise de ajuda, estamos √† disposi√ß√£o!\n\n3. Pix Gerado\nüì¢ Ol√°, {customer_name}!\n\nGeramos um pagamento via PIX para sua inscri√ß√£o no curso AUTOMA√á√ÉO NA PR√ÅTICA!\n\nüîπ Detalhes:\nüí∞ Valor: {amount}\nüè¶ Copie e pague via PIX: {pix_code}\n\nüìå Seu acesso ser√° liberado automaticamente ap√≥s a confirma√ß√£o do pagamento.\n\nSe precisar de suporte, fale conosco! üòä\n\n4. Carrinho Abandonado\nüò¢ {customer_name}, percebemos que voc√™ n√£o finalizou sua inscri√ß√£o!\n\nSeu acesso ao curso AUTOMA√á√ÉO NA PR√ÅTICA est√° quase garantido.\n\nüî• Voc√™ ainda tem chance de entrar e transformar seu neg√≥cio com automa√ß√£o!\n\nüîó Concluir pagamento: [link_de_pagamento]\n\nüìå Se precisar de ajuda, estamos por aqui!\n\n5. Compra Recusada\n‚ö†Ô∏è Pagamento n√£o aprovado, {customer_name}\n\nInfelizmente, seu pagamento n√£o foi autorizado. Mas n√£o se preocupe! Voc√™ pode tentar novamente.\n\nüîπ Op√ß√µes dispon√≠veis:\n‚úÖ Tente novamente com outro cart√£o.\n‚úÖ Escolha boleto ou PIX para finalizar sua compra.\nüîó Acesse seu pedido: [link_de_pagamento]\n\nSe precisar de suporte, entre em contato. Queremos te ver automatizando seu neg√≥cio! üöÄ\n\n6. Reembolso\nüîÑ Seu reembolso foi processado, {customer_name}!\n\nüìå O valor de {amount} (ID: {transaction_id}) ser√° devolvido em at√© 5 dias √∫teis para sua conta.\n\nSe precisar de algo mais, estamos √† disposi√ß√£o!\n\n7. Chargeback\n‚ö†Ô∏è Chargeback detectado!\n\nOl√°, {customer_name}. Identificamos que sua compra do curso AUTOMA√á√ÉO NA PR√ÅTICA teve um chargeback.\n\nüîπ Se isso foi um erro ou se precisar de mais informa√ß√µes, entre em contato com nossa equipe.\n\nüìå Seu acesso ao curso foi suspenso at√© que a situa√ß√£o seja resolvida.\n\nFale conosco e vamos resolver isso juntos! üòä"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        140,
        500
      ],
      "id": "77deaae7-51ce-43cc-ab85-02054cda6a2c",
      "name": "AI Agent",
      "executeOnce": false,
      "retryOnFail": true,
      "maxTries": 2,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e25f0d78-739b-4f81-8796-fb6c63ac144e",
              "name": "instancia",
              "value": "",
              "type": "string"
            },
            {
              "id": "64bd6f7a-7210-4e55-bf46-b4a2177fda23",
              "name": "api_key",
              "value": "",
              "type": "string"
            },
            {
              "id": "57ea23a3-9bc5-4254-b2b3-14709638ef13",
              "name": "evo_url",
              "value": "",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -260,
        500
      ],
      "id": "82117560-db77-49ad-8feb-60f8b43fc0b8",
      "name": "Set Data"
    },
    {
      "parameters": {
        "content": "## Envia Mensagem",
        "height": 340,
        "width": 320,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        820,
        380
      ],
      "id": "032610de-62ba-4e68-b1aa-d7ce194a6380",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Set Data').item.json.evo_url }}/message/sendText/{{ $('Set Data').item.json.instancia }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('Set Data').item.json.api_key }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"number\": \"{{ $('Webhook1').item.json.body.Customer.mobile.replace('+','') + '@s.whatsapp.net' }}\",\n  \"text\": \"{{ $json.outputText.replace(/\\n/g, '\\\\n').replace(/\\\"/g, '\\\\\"').trim() }}\"}\n",
        "options": {}
      },
      "id": "36cf3d2d-faa6-4388-88cb-e205d760c124",
      "name": "Enviar Mensagem WhatsApp",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        920,
        560
      ],
      "continueOnFail": true
    },
    {
      "parameters": {
        "content": "# Opera√ß√µes no Supabase\n### Cria Usu√°rios e Pagamentos",
        "height": 280,
        "width": 600,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        20,
        800
      ],
      "id": "ae54eb9a-4899-4a38-9d33-4420012b5a3b",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## Limpa Texto",
        "height": 340
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        560,
        380
      ],
      "id": "8fbee354-01b8-421f-aac3-561a6194b035",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "## Agente de IA",
        "height": 340,
        "width": 560,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -20,
        380
      ],
      "id": "e9233b2c-2c17-4795-8822-805c310cbcb2",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "## Credenciais e Vari√°veis",
        "height": 320,
        "width": 340,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -380,
        380
      ],
      "id": "16374078-6594-4011-a152-7ba9768f3543",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "```\n‚ñà‚ñà‚ñà‚ñÑ‚ñÑ‚ñÑ‚ñÑ    ‚ñÑ‚ñà  ‚ñà‚ñà‚ñà‚ñÑ‚ñÑ‚ñÑ‚ñÑ        ‚ñÑ‚ñà    ‚ñÑ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà \n‚ñà‚ñà‚ñà‚ñÄ‚ñÄ‚ñÄ‚ñà‚ñà‚ñÑ ‚ñà‚ñà‚ñà  ‚ñà‚ñà‚ñà‚ñÄ‚ñÄ‚ñÄ‚ñà‚ñà‚ñÑ     ‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà    ‚ñà‚ñà‚ñà \n‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñå ‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà     ‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà    ‚ñà‚ñà‚ñà \n‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñå ‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà     ‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà    ‚ñà‚ñà‚ñà \n‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñå ‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà     ‚ñà‚ñà‚ñà ‚ñÄ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà \n‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà  ‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà     ‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà    ‚ñà‚ñà‚ñà \n‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà  ‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà     ‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà    ‚ñà‚ñà‚ñà \n ‚ñÄ‚ñà   ‚ñà‚ñÄ  ‚ñà‚ñÄ    ‚ñÄ‚ñà   ‚ñà‚ñÄ  ‚ñà‚ñÑ ‚ñÑ‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà    ‚ñà‚ñÄ  \n                         ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ               \n```",
        "height": 200,
        "width": 540,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        0
      ],
      "id": "a6fa413e-9429-4a91-a619-360336b03cb9",
      "name": "Sticky Note5"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-06-15T14:52:08.245Z",
      "createdAt": "2025-06-15T14:52:08.245Z",
      "role": "workflow:owner",
      "workflowId": "lPTs4x7yHpk6XCsS",
      "projectId": "o60HadikmqrvYZ9Z"
    }
  ],
  "staticData": null,
  "tags": [
    {
      "updatedAt": "2025-06-14T14:35:30.743Z",
      "createdAt": "2025-06-14T14:35:30.743Z",
      "id": "f7Ttu7FQN3EvRKX9",
      "name": "ü•∑üèº Ninja Automa√ß√µes"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2025-06-15T14:52:08.245Z",
  "versionId": "6a393566-1a8c-478d-af21-9655e2b5c8ec"
}